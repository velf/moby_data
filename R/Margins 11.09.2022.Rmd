---
title: "Gender Diversity and Inclusion in Video Game Development"
editor_options: 
  markdown: 
    wrap: 72
---

###Preparations

Libraries \ read in libraries

```{r, results='hide'}
util_libraries <- c("foreign", "reshape2", "stargazer", "arm", "plyr", "tidyverse", "stringr", "qdapRegex", "GGally", "progress", "pracma", "lubridate", "DescTools", "Matrix.utils", "irr", "psych", 'gtools', "Hmisc", "colorspace")
vis_libraries  <- c("ggplot2", "ggrepel", "grid", "gridExtra", "RColorBrewer", "scales", "corrplot", "ggeffects", "cowplot", "plot.matrix", "corrgram", "ggnetwork", "vioplot", "dotwhisker", "sjPlot", "sjlabelled", "sjmisc", "plot3D", "ggpubr", "ggExtra", "ggraph")
stat_libraries <- c("network", "sna", "igraph", "moments", "nortest", "MASS", "randomForest", "sandwich", "lmtest", "gmodels", "margins", "sampleSelection", "pROC", "pscl",  "pwr", "relaimpo", "lme4", "plm", "caret", "ResourceSelection", "rvest", "cluster", "factoextra", "outliers", "acss", 'asbio','akima', 'plotly', 'factoextra', 'interactions', 'robustbase', "sandwich", "modelr", "broom", "mgcv", "stringdist", "sem", "lavaan", "corrr")

#install.packages(util_libraries)
#install.packages(vis_libraries)
#install.packages(stat_libraries)

for (l in 1:length(util_libraries)){ library(util_libraries[l], character.only = TRUE)}
for (l in 1:length(vis_libraries)){ library(vis_libraries[l], character.only = TRUE)}
for (l in 1:length(stat_libraries)){ library(stat_libraries[l], character.only = TRUE)}
```

Graph theme set

```{r}
theme_set(theme_bw())

dropLeadingZero <- function(l){
  str_replace(l, '0(?=.)', '')
}
```

Clear the workspace

```{r}
rm(list=ls())
```

###Read data

Read files

```{r}
#Main data file, filtered
moby<-read.csv("moby_data1_17_01_2022.csv")

#Main data file, unfiltered
full<-read.csv("old_moby_data.csv")

#Sales data files from various sources
sales1<-read.csv("Video_Games_Sales_as_at_22_Dec_2016.csv") # source: https://github.com/kumartej/DataMining
sales2<-read.csv("vgsales-12-4-2019-short.csv") #source: https://www.kaggle.com/datasets/ashaheedq/video-games-sales-2019
sales3<-read.csv("vgsales.csv") #source: https://www.kaggle.com/datasets/gregorut/videogamesales?select=vgsales.csv

#Sales data 2 variable name to match the other two files
sales2$combined_sales <- sales2$Total_Shipped
sales2$combined_sales[is.na(sales2$Total_Shipped)]<- sales2$Global_Sales[is.na(sales2$Total_Shipped)]

#Later data collection to 2019 (to extract user scores)
big_moby <- read.csv("game_data_0805_2019.csv")
```



Match games with sales data by game name (exact match)
Sales 1
```{r}
n_games <- dim(moby)[1]
match_loc<-matrix(nrow=n_games, ncol=1)

#match game titles from main data and sales data 1
for (i in 1:n_games) {
  #if(i/100==trunc(i/100)){print(i)}
  name <- moby$name[i]
  match_loc[i] <- match(name, sales1$Name)
}

#add sales data at the matched observation
name_compare <- cbind(moby$name, sales1$Name[match_loc])
moby$global_sales1 <- sales1$Global_Sales[match_loc]

#Min sales value - replace zero values with half the min nonzero value
paste("sales1, min sales value = ", min(moby$global_sales1, na.rm=T))
paste("sales1, min nonzero sales value = ", min(moby$global_sales1[moby$global_sales1>0], na.rm=T))
if(min(moby$global_sales1, na.rm=T)==0){
  moby$global_sales1[moby$global_sales2==0] <- min(moby$global_sales1[moby$global_sales1>0], na.rm=T)/2
}

#calculate annual sales
moby$global_sales1_annual <- moby$global_sales1/(2016-moby$year)

#log annual sales
moby$log_global_sales1_annual <- log10(moby$global_sales1_annual)+6

#N of observations with valid sales data
paste("sales1, proportion with sales data = ", round(sum(!is.na(name_compare[,2]))/n_games, digits = 2))
```

Sales 2
```{r}
#It seems that "Total Shipped" and "Global Sales" is the same, and it is in units sold. Not data about sales in dollars. (Checked with Grand Theft Auto V).
#Missing data of "Total Shipped" is actually "Global Sales".

sales2$new_total_shipped <- sales2$Total_Shipped
sales2$new_total_shipped[is.na(sales2$new_total_shipped)] <- sales2$Global_Sales[is.na(sales2$new_total_shipped)]

n_games <- dim(moby)[1]
match_loc<-matrix(nrow=n_games, ncol=1)

#match game titles from main data and sales data 1
for (i in 1:n_games) {
  #if(i/100==trunc(i/100)){print(i)}
  name <- moby$name[i]
  match_loc[i] <- match(name, sales2$Name)
}

#add sales data at the matched observation
name_compare <- cbind(moby$name, sales2$Name[match_loc])
moby$global_sales2 <- sales2$new_total_shipped[match_loc]

#Min sales value - replace zero values with half the min nonzero value
paste("sales2, min sales value = ", min(moby$global_sales2, na.rm=T))
paste("sales2, min nonzero sales value = ", min(moby$global_sales2[moby$global_sales2>0], na.rm=T))
if(min(moby$global_sales2, na.rm=T)==0){
  moby$global_sales2[moby$global_sales2==0] <- min(moby$global_sales2[moby$global_sales2>0], na.rm=T)/2
}


#calculate annual sales, in millions of units
moby$global_sales2_annual <- moby$global_sales2/(2016-moby$year)

#log annual sales, in units
moby$log_global_sales2_annual <- log10(moby$global_sales2_annual)+6

#N of observations with valid sales data
paste("sales2, proportion with sales data = ", round(sum(!is.na(name_compare[,2]))/n_games, digits = 2))
```


Sales 3
```{r}
n_games <- dim(moby)[1]
match_loc<-matrix(nrow=n_games, ncol=1)

#match game titles from main data and sales data 1
for (i in 1:n_games) {
  #if(i/100==trunc(i/100)){print(i)}
  name <- moby$name[i]
  match_loc[i] <- match(name, sales3$Name)
}

#add sales data at the matched observation
name_compare <- cbind(moby$name, sales3$Name[match_loc])
moby$global_sales3 <- sales3$Global_Sales[match_loc]

#Min sales value - replace zero values with half the min nonzero value
paste("sales3, min sales value = ", min(moby$global_sales3, na.rm=T))
paste("sales3, min nonzero sales value = ", min(moby$global_sales3[moby$global_sales3>0], na.rm=T))
if(min(moby$global_sales3, na.rm=T)==0){
  moby$global_sales3[moby$global_sales3==0] <- min(moby$global_sales3[moby$global_sales3>0], na.rm=T)/2
}

#calculate annual sales
moby$global_sales3_annual <- moby$global_sales3/(2016-moby$year)

#log annual sales
moby$log_global_sales3_annual <- log10(moby$global_sales3_annual)+6

#N of observations with valid sales data
paste("sales3, proportion with sales data = ", round(sum(!is.na(name_compare[,2]))/n_games, digits = 2))
```


Sales data from source 1 and source 3 are identical. Sales 2 has the largest coverage
```{r, fig.width = 4, fig.height = 4}
panel.cor <- function(x, y, digits = 2, prefix = "", cex.cor, ...) {
    usr <- par("usr")
    on.exit(par(usr))
    par(usr = c(0, 1, 0, 1))
    Cor <- abs(cor(x, y, use="complete.obs")) # Remove abs function if desired
    txt <- paste0(prefix, format(c(Cor, 0.123456789), digits = digits)[1])
    if(missing(cex.cor)) {
        cex.cor <- 0.4 / strwidth(txt)
    }
    text(0.5, 0.5, txt,
         cex = 1 + cex.cor * Cor) # Resize the text by level of correlation
}


df <- data.frame(moby$global_sales1,moby$global_sales2,moby$global_sales3)
colnames(df) <- c("sales 1", "sales 2", "sales 3")
#pairs(df)
suppressWarnings({
pairs(df,
      upper.panel = panel.cor,    # Correlation panel
      lower.panel = panel.smooth)
})
```


Big moby user score match
```{r}
n_games <- dim(moby)[1]

match_loc<-matrix(nrow=n_games, ncol=1)

#match game titles from main data and big moby dataset
for (i in 1:n_games) {
  #if(i/100==trunc(i/100)){print(i)}
  name <- moby$name[i]
  match_loc[i] <- match(name, big_moby$game_name)
}

#add user score data at the matched observation
name_compare <- cbind(moby$name, big_moby$game_name[match_loc])
paste("from big moby, proportion mathed = ", round(sum(!is.na(name_compare[,2]))/n_games, digits = 2))

#add user score to those matched
moby$user_score <- big_moby$user_score_mean[match_loc]
paste("from big moby, proportion with user score = ", round(sum(table(moby$user_score))/n_games, digits = 2))
```

Generate a variables list
```{r}
var_list <- cbind(colnames(moby))
```


Creating inclusion variables with user-friendly names
```{r}
moby$mixing <- moby$assortativity_rev_z
moby$bonding <- moby$weighted_cross_edges_ratio_z
moby$incorporating <- moby$female_coreness_log_z
moby$mixing_z <- (moby$mixing-min(moby$mixing, na.rm=T))/sd(moby$mixing)
moby$bonding_z <- (moby$bonding-min(moby$bonding, na.rm=T))/sd(moby$bonding)
moby$incorporating_z <- (moby$incorporating-min(moby$incorporating, na.rm=T))/sd(moby$incorporating)
moby$combined <- moby$mixing*moby$bonding*moby$incorporating
```

Firm-level dataset from means of game level values
```{r, message=FALSE, warning = FALSE}
#developer firm level aggregation
moby_dev_firm_level <- aggregate(moby, list(dev_firm = moby$org_dev), mean)
```






#Descriptive figure for trends

```{r}
moby$combined_raw <- moby$mixing*moby$bonding*moby$incorporating

mean(moby$prop_women)
mean(moby$combined_raw)

mean_propw <- data.frame(ci.mean(prop_women ~ year, data=full)) 
mean_inclusion <- data.frame(ci.mean(combined_raw ~ year, data=moby)) 
```

```{r, fig.width = 2.5, fig.height = 2.5}

#Color set
hi_color = "#b4de75"
lo_color = "#69629a"
third_color="darkorange"
fourth_color="deepskyblue2"

m_top <- 2
m_left <-0
m_bottom <- 0
m_right <- 0
ts <- 3.2
tit_s <- 11
iqr_alpha <- 0.07
ribbon_alpha <- 0.33

#Function for axis tick label number formatting
#--------add as:-----scale_x_continuous(expand = c(0,0), labels = dropLeadingZero)----------------------
scaleFUN <- function(x) sprintf("%.2f", x)

dropLeadingZero <- function(l){
  str_replace(scaleFUN(l), '0.', '.')
}
#-------------------------------------------------------------------------------------------------------


min_y <- min(min(mean_propw$mean), min(mean_inclusion$mean))
max_y <- max(max(mean_propw$mean), max(mean_inclusion$mean))



desc_trends <- ggplot()+

  #gender diversity
  geom_line(data=mean_propw,   aes(x=year, y=mean, group = 1), color=lo_color)+
  geom_ribbon(data=mean_propw, aes(year, ymin=lower, ymax=upper, group = 1),alpha=ribbon_alpha, fill=lo_color)+
  geom_smooth(data=mean_propw,   aes(x=year, y=mean, group = 1), method = "lm", formula = y ~ x, color=lo_color, size = 0.3, linetype = 2, se = FALSE)+

  #inclusion
  geom_line(data=mean_inclusion,   aes(x=year, y=mean, group = 1), color=hi_color)+
  geom_ribbon(data=mean_inclusion, aes(year, ymin=lower, ymax=upper, group = 1),alpha=ribbon_alpha, fill=hi_color)+
  geom_smooth(data=mean_inclusion,   aes(x=year, y=mean, group = 1), method = "lm", formula = y ~ x, color=hi_color, size = 0.3, linetype = 2, se = FALSE)+
  
  annotate(geom="text", x=2,    y=0.176, label="Proportion of\nfemale\ndevelopers", lineheight = .8,  col="black", size=2.9, hjust = 0, alpha = 1) +
    #geom_segment(aes(y=0.85,    x=0.25, yend = 0.81, xend = 0.28),size=0.6, col = hi_color, alpha=0.66, linetype=3) +
  
  annotate(geom="text", x=14,    y=0.08, label="Combined\ninclusion", lineheight = .8,   col="black", size=2.9, hjust = 1, alpha = 1) +
    #geom_segment(aes(y=0.72,    x=.25, yend = 0.76, xend = .28),size=0.6, col = lo_color, alpha=0.66, linetype=3) +
  
  #axes formatting
  scale_y_continuous(
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     breaks = c(0.06, 0.09, 0.12, 0.15, 0.18), 
                     name="") +
  scale_x_discrete(   breaks = mean_propw$year[seq(1, length(mean_propw$yea), by = 2)],
                      expand = c(0.001,0.001), 
                      name="") +

  

  #theme
  theme(aspect.ratio=1, 
            panel.grid.major.x = element_line(color = "gray50",size = 0.1,linetype = 1),
            panel.grid.major.y = element_line(color = "gray50",size = 0.1,linetype = 1),
            panel.grid.minor = element_blank(), 
            panel.background = element_blank(), 
            panel.border = element_rect(colour = "black", 
                                        fill=NA, 
                                        size=0.2),
            legend.position = c(0.2, 0.3),
            plot.title = element_text(size = tit_s, face = "bold", colour = "black"),
            #axis.ticks.y = element_blank(),
            axis.title.y = element_text(size = 11, colour = "black"),
            axis.text.x = element_text(size = 9, colour = "black", angle = 90, vjust = 0.5, hjust=1),
            axis.text.y = element_text(size = 9, colour = "black"),
            plot.margin = unit(c(m_top,m_right,m_bottom,m_left), "mm")
            )


desc_trends
```

```{r}
ggsave("desc_trends.pdf", desc_trends, width = 2.5, height = 2.5)
```

Significance of descriptive trends
```{r}
summary(lm(prop_women ~ year, data = full))

summary(lm(mean ~ as.numeric(year), data = mean_propw))
```





###Bivariate plots

Pairwise LOESS plots of diversity and inclusion associated to outcome variables
```{r, fig.width = 7.5, fig.height = 7}
#Color set
hi_color = "#b4de75"
lo_color = "#69629a"
third_color="darkorange"
fourth_color="deepskyblue2"

#Select the default fill color
c=lo_color

#Span for LOESS curves
sp=1


#Function for axis tick label number formatting
#--------add as:-----scale_x_continuous(expand = c(0,0), labels = dropLeadingZero)----------------------
scaleFUN <- function(x) sprintf("%.2f", x)

dropLeadingZero <- function(l){
  str_replace(scaleFUN(l), '0.', '.')
}
#-------------------------------------------------------------------------------------------------------


#Plot theme specification
my_theme <-   theme(aspect.ratio=1, 
        legend.position = "none",
        #panel.grid.major = element_blank(), 
        #panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", 
                                    fill=NA, 
                                    size=0.2),
        #legend.position = c(0.2, 0.3),
        plot.title = element_text(size = 11, face = "bold", colour = "black"),
        #axis.ticks = element_line(colour = "black", size = 0.1),
        axis.title.y = element_text(size = 11, colour = "black"),
        axis.text.x = element_text(size = 9, colour = "black"),
        axis.text.y = element_text(size = 9, colour = "black"),
        panel.grid.major = element_line(size=0.2),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        plot.margin = unit(c(3,3,3,3), "points")
  )


#Plots

div_dist <- ggplot() +
  stat_smooth(data=moby, aes(x=blau2, y=game_dist_prev5yr), method = "loess", formula = y ~ x, span=sp, se = T,size=0.5, alpha=0.2, na.rm=TRUE, color=c, fill=c) +
    scale_x_continuous(expand = c(0,0), labels = dropLeadingZero) +
    scale_y_continuous(expand = c(0,0), labels = dropLeadingZero) +
  
    labs(y="Distinctiveness") +
    labs(x="Diversity") +

    my_theme


div_rev <- ggplot() +
  stat_smooth(data=moby[moby$rank_avg>0,], aes(x=blau2, y=rank_avg), method = "loess", formula = y ~ x, span=sp, se = T,size=0.5, alpha=0.2, na.rm=TRUE, color=c, fill=c) +
    scale_x_continuous(expand = c(0,0), labels = dropLeadingZero) +
    scale_y_continuous(expand = c(0,0)) +
  
    labs(y="Review") +
    labs(x="Diversity") +
  
my_theme


div_user <- ggplot() +
  stat_smooth(data=moby[moby$user_score>0,], aes(x=blau2, y=user_score), method = "loess", formula = y ~ x, span=sp, se = T,size=0.5, alpha=0.2, na.rm=TRUE, color=c, fill=c) +
    scale_x_continuous(expand = c(0,0), labels = dropLeadingZero) +
    scale_y_continuous(expand = c(0,0)) +
  
    labs(y="User score") +
    labs(x="Diversity") +
  
my_theme



div_sales <- ggplot() +
  stat_smooth(data=moby, aes(x=blau2, y=log_global_sales2_annual), method = "loess", formula = y ~ x, span=sp, se = T,size=0.5, alpha=0.2, na.rm=TRUE, color=c, fill=c) +
    scale_x_continuous(expand = c(0,0), labels = dropLeadingZero) +
    scale_y_continuous(expand = c(0,0)) +
  
    labs(y="Sales") +
    labs(x="Diversity") +
  
my_theme



dist_rev <- ggplot() +
  stat_smooth(data=moby[moby$rank_avg>0,], aes(x=game_dist_prev5yr, y=rank_avg), method = "loess", formula = y ~ x, span=sp, se = T,size=0.5, alpha=0.2, na.rm=TRUE, color=c, fill=c) +
    scale_x_continuous(expand = c(0,0), labels = dropLeadingZero) +
    scale_y_continuous(expand = c(0,0)) +
  
    labs(y="Review") +
    labs(x="Distinctiveness") +
  
my_theme

dist_user <- ggplot() +
  stat_smooth(data=moby[moby$user_score>0,], aes(x=game_dist_prev5yr, y=user_score), method = "loess", formula = y ~ x, span=sp, se = T,size=0.5, alpha=0.2, na.rm=TRUE, color=c, fill=c) +
    scale_x_continuous(expand = c(0,0), labels = dropLeadingZero) +
    scale_y_continuous(expand = c(0,0)) +
  
    labs(y="User score") +
    labs(x="Distinctiveness") +
  
my_theme

dist_sales <- ggplot() +
  stat_smooth(data=moby, aes(x=game_dist_prev5yr, y=log_global_sales2_annual), method = "loess", formula = y ~ x, span=sp, se = T,size=0.5, alpha=0.2, na.rm=TRUE, color=c, fill=c) +
    scale_x_continuous(expand = c(0,0), labels = dropLeadingZero) +
    scale_y_continuous(expand = c(0,0)) +
  
    labs(y="Sales") +
    labs(x="Distinctiveness") +
  
my_theme



rev_user <- ggplot() +
  stat_smooth(data=moby[moby$rank_avg>0 & moby$user_score>0,], aes(x=rank_avg, y=user_score), method = "loess", formula = y ~ x, span=sp, se = T,size=0.5, alpha=0.2, na.rm=TRUE, color=c, fill=c) +
    scale_x_continuous(expand = c(0,0)) +
    scale_y_continuous(expand = c(0,0)) +
  
    labs(y="User score") +
    labs(x="Review") +
  
my_theme


user_rev <- ggplot() +
  stat_smooth(data=moby[moby$rank_avg>0 & moby$user_score>0,], aes(y=rank_avg, x=user_score), method = "loess", formula = y ~ x, span=sp, se = T,size=0.5, alpha=0.2, na.rm=TRUE, color=c, fill=c) +
    scale_x_continuous(expand = c(0,0)) +
    scale_y_continuous(expand = c(0,0)) +
  
    labs(y="Review") +
    labs(x="User score") +
  
my_theme



rev_sales <- ggplot() +
  stat_smooth(data=moby[moby$rank_avg>49,], aes(x=rank_avg, y=log_global_sales2_annual), method = "loess", formula = y ~ x, span=sp, se = T,size=0.5, alpha=0.2, na.rm=TRUE, color=c, fill=c) +
    scale_x_continuous(expand = c(0,0), breaks = scales::pretty_breaks(n = 5)) +
    scale_y_continuous(expand = c(0,0)) +
    #coord_cartesian(ylim=c(3.75, 5.3)) +

  
    labs(y="Sales") +
    labs(x="Review") +
  
my_theme

rev_sales2 <- ggplot() +
  stat_smooth(data=moby[moby$rank_avg>49,], aes(x=rank_avg, y=log_global_sales2_annual), method = "loess", formula = y ~ x, span=sp, se = T,size=0.5, alpha=0.2, na.rm=TRUE, color=c, fill=c) +
    scale_x_continuous(expand = c(0,0), breaks = scales::pretty_breaks(n = 5)) +
    scale_y_continuous(expand = c(0,0)) +
    coord_cartesian(ylim=c(3.75, 5.3)) +

  
    labs(y="Sales") +
    labs(x="Review") +
  
my_theme


user_sales <- ggplot() +
  stat_smooth(data=moby[moby$user_score>0,], aes(x=user_score, y=log_global_sales2_annual), method = "loess", formula = y ~ x, span=sp, se = T,size=0.5, alpha=0.2, na.rm=TRUE, color=c, fill=c) +
    scale_x_continuous(expand = c(0,0), breaks = scales::pretty_breaks(n = 3)) +
    scale_y_continuous(expand = c(0,0)) +
    #coord_cartesian(ylim=c(3.75, 5.3)) +
  
    labs(y="Sales") +
    labs(x="User score") +
  
my_theme

user_sales2 <- ggplot() +
  stat_smooth(data=moby[moby$user_score>0,], aes(x=user_score, y=log_global_sales2_annual), method = "loess", formula = y ~ x, span=sp, se = T,size=0.5, alpha=0.2, na.rm=TRUE, color=c, fill=c) +
    scale_x_continuous(expand = c(0,0), breaks = scales::pretty_breaks(n = 3)) +
    scale_y_continuous(expand = c(0,0)) +
    coord_cartesian(ylim=c(3.75, 5.3)) +
  
    labs(y="Sales") +
    labs(x="User score") +
  
my_theme


#Draw thge plots
loess_graphs <- grid.arrange(
                  div_dist,
                  div_rev,
                  div_user,
                  div_sales,
                  
                  dist_rev,
                  dist_user,
                  dist_sales,
                  
                  user_rev,
                  user_sales,
                  
                  rev_sales,
                  
                  layout_matrix = rbind(c(1, 2, 3, 4),
                                        c(NA, 5, 6, 7),
                                        c(NA, NA, 8, 9),
                                        c(NA, NA, NA, 10)
                                        )
                  
                  )
```

```{r}
ggsave("loess_graphs.pdf", loess_graphs, width = 6, height = 6)
```







Bivariate LOESS plots of the interaction of Diversity and Inclusion metrics WITH Distinctiveness

```{r, fig.width = 5, fig.height = 2.5}

#Colors
hi_color = "#b4de75"
lo_color = "#69629a"
third_color="darkorange"
fourth_color="deepskyblue2"

#Plot theme specification
my_theme <-     theme(aspect.ratio=1, 
        legend.position = "none",
        panel.grid.major = element_line(size=0.2), 
        #panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", 
                                    fill=NA, 
                                    size=0.2),
        #legend.position = c(0.2, 0.3),
        plot.title = element_text(size = 11, face = "bold", colour = "black"),
        #axis.ticks = element_line(colour = "black", size = 0.1),
        axis.title.y = element_text(size = 11, colour = "black"),
        axis.text.x = element_text(size = 9, colour = "black"),
        axis.text.y = element_text(size = 9, colour = "black"),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        plot.margin = unit(c(0,0,0,0), "points")
  )



div_inclusions_dist <- ggplot() +
  stat_smooth(data=moby, aes(x=blau2*mixing, y=game_dist_prev5yr), method = "loess", formula = y ~ x, span=1, se = T,size=0.5, alpha=0.2, na.rm=TRUE, color=lo_color, fill=lo_color) +
  stat_smooth(data=moby, aes(x=blau2*bonding, y=game_dist_prev5yr), method = "loess", formula = y ~ x, span=1, se = T,size=0.5, alpha=0.2, na.rm=TRUE, color=hi_color, fill=hi_color) +
  stat_smooth(data=moby, aes(x=blau2*incorporating, y=game_dist_prev5yr), method = "loess", formula = y ~ x, span=1, se = T,size=0.5, alpha=0.2, na.rm=TRUE, color=third_color, fill=third_color) +
  
  
  #annotate(geom="text", x=.015,    y=0.893, label="Mixing", lineheight = .8,  col=lo_color, size=2.9, hjust = 0, alpha = 1) +
  #annotate(geom="text", x=.015,    y=0.883, label="Bonding", lineheight = .8,  col=hi_color, size=2.9, hjust = 0, alpha = 1) +
  #annotate(geom="text", x=.015,    y=0.873, label="Incorporating", lineheight = .8,  col=third_color, size=2.9, hjust = 0, alpha = 1) +
  
  annotate(geom="text", x=.25,    y=0.815, label="Div. \u00D7 Mix.", lineheight = .8,  col=lo_color, size=3, hjust = 0, alpha = 1, angle = 55) +
  annotate(geom="text", x=.15,    y=0.81, label="Div. \u00D7 Bond.", lineheight = .8,  col=hi_color, size=3, hjust = 0, alpha = 1, angle = 45) +
  annotate(geom="text", x=.20,    y=0.791, label="Div. \u00D7 Incorp.", lineheight = .8,  col=third_color, size=3, hjust = 0, alpha = 1, angle = 21) +
  
    scale_x_continuous(expand = c(0,0)) +
    coord_cartesian(xlim=c(0,0.35), ylim = c(0.78,0.9)) +
    scale_y_continuous(expand = c(0,0)) +
  
    labs(y="Distinctiveness") +
    labs(x="Diversity \u00D7 Inclusion") +
  
my_theme




div_inclusions_rev <- ggplot() +
  stat_smooth(data=moby[moby$rank_avg>0,], aes(x=blau2*mixing, y=rank_avg), method = "loess", formula = y ~ x, span=1, se = T,size=0.5, alpha=0.2, na.rm=TRUE, color=lo_color, fill=lo_color) +
  stat_smooth(data=moby[moby$rank_avg>0,], aes(x=blau2*bonding, y=rank_avg), method = "loess", formula = y ~ x, span=1, se = T,size=0.5, alpha=0.2, na.rm=TRUE, color=hi_color, fill=hi_color) +
  stat_smooth(data=moby[moby$rank_avg>0,], aes(x=blau2*incorporating, y=rank_avg), method = "loess", formula = y ~ x, span=1, se = T,size=0.5, alpha=0.2, na.rm=TRUE, color=third_color, fill=third_color) +
  
  #annotate(geom="text", x=.015,    y=0.893, label="Mixing", lineheight = .8,  col=lo_color, size=2.9, hjust = 0, alpha = 1) +
  #annotate(geom="text", x=.015,    y=0.883, label="Bonding", lineheight = .8,  col=hi_color, size=2.9, hjust = 0, alpha = 1) +
  #annotate(geom="text", x=.015,    y=0.873, label="Incorporating", lineheight = .8,  col=third_color, size=2.9, hjust = 0, alpha = 1) +
  
  annotate(geom="text", x=.04,    y=72.8, label="Div. \u00D7 Mix.", lineheight = .8,  col=lo_color, size=3, hjust = 0, alpha = 1, angle = 0) +
  annotate(geom="text", x=.12,    y=65.8, label="Div. \u00D7 Bond.", lineheight = .8,  col=hi_color, size=3, hjust = 0, alpha = 1, angle = 0) +
  annotate(geom="text", x=.17,    y=71.7, label="Div. \u00D7 Incorp.", lineheight = .8,  col=third_color, size=3, hjust = 0, alpha = 1, angle = 0) +
  
    scale_x_continuous(expand = c(0,0)) +
    coord_cartesian(xlim=c(0,0.35), ylim=c(60,80)) +
    scale_y_continuous(expand = c(0,0)) +
  
    labs(y="Review") +
    labs(x="Diversity \u00D7 Inclusion") +
  
 my_theme


grid.arrange(div_inclusions_dist, div_inclusions_rev, nrow=1)

```

###Correlations path diagram 
Data preparation
```{r}
#Calculate interactions as variables
moby$div_mixing  <- moby$blau2*moby$mixing
moby$div_bonding <- moby$blau2*moby$bonding 
moby$div_incorporating <- moby$blau2*moby$incorporating

#Make data frame
df <- data.frame(cbind(moby$blau2*moby$mixing, moby$blau2*moby$bonding, moby$blau2*moby$incorporating, moby$game_dist_prev5yr, moby$rank_avg, moby$log_global_sales2_annual))
colnames(df) <- c("Div. x Mix.", "Div. x Bond.", "Div. x Incorp.", "Dist.", "Review", "Sales")
df$Review[df$Review==0] <- NA

#Correlations
cor_results <- rcorr(as.matrix(df),type="pearson")
```

Plotting
```{r, fig.width = 9, fig.height = 3}
#Calculate correlations
tidy_cors <- df %>% 
  correlate() %>% 
  stretch()

#Create graph, filtering very small and very large correlations to take out ties among interactions
graph_cors <- tidy_cors %>%
  filter(abs(r) > .005 & abs(r) < .5) %>%
  graph_from_data_frame(directed = FALSE)

#Arrange nodes
coord_file <- data.frame(y=NA, x=NA)
coord_file[1,] <- c(1,.5) 
coord_file[2,] <- c(.5,.5)
coord_file[3,] <- c(0,.5)
coord_file[4,] <- c(.5,3)
coord_file[5,] <- c(.5,4.5)
coord_file[6,] <- c(.5,6)
```


```{r, fig.width = 2.5, fig.height = 2.5}
#Color selection for positive and negative ties
hi_color="midnightblue"
lo_color="red4"

#Creating grades of colors
lo_color_1 <- lighten(lo_color, .8)
lo_color_2 <- lighten(lo_color, .6)
lo_color_3 <- lighten(lo_color, .4)
lo_color_4 <- lighten(lo_color, .2)
lo_color_5 <- lo_color
lo_color_6 <- darken(lo_color, .2)
lo_color_7 <- darken(lo_color, .4)
lo_color_8 <- darken(lo_color, .6)
lo_color_9 <- darken(lo_color, .8)

hi_color_1 <- lighten(hi_color, .8)
hi_color_2 <- lighten(hi_color, .6)
hi_color_3 <- lighten(hi_color, .4)
hi_color_4 <- lighten(hi_color, .2)
hi_color_5 <- hi_color
hi_color_6 <- darken(hi_color, .2)
hi_color_7 <- darken(hi_color, .4)
hi_color_8 <- darken(hi_color, .6)
hi_color_9 <- darken(hi_color, .8)

#-------------scale_x_continuous(expand = c(0,0), labels = dropLeadingZero)-----------------------------
scaleFUN <- function(x) sprintf("%.2f", x)

dropLeadingZero <- function(l){
  str_replace(scaleFUN(l), '0.', '.')
}
#-------------------------------------------------------------------------------------------------------


#Plotting
corr_arcs <- ggraph(graph_cors, coord_file) +
  geom_edge_arc(aes(edge_alpha = (0.9*r-(abs(r)^0.6)), edge_width = (abs(r)^0.33)/8, color = r), strength=0.12, lineend = "round", linejoin = "round") +
  scale_edge_width(range=c(0.33, 2)) +
  guides(edge_alpha = "none", edge_width = "none", edge_colourbar=guide_colourbar(title="R")) +
   scale_edge_colour_gradientn(name="r", limits = c(-.3, .3), labels = dropLeadingZero, 
          colors = c(lo_color_9,lo_color_9,lo_color_9,lo_color_9,lo_color_9,lo_color_9,lo_color_8,lo_color_8,lo_color_8,lo_color_8,lo_color_8,lo_color_8,
                     lo_color_7,lo_color_7,lo_color_7,lo_color_7,lo_color_7,lo_color_7,lo_color_6,lo_color_6,lo_color_6,lo_color_6,lo_color_6,lo_color_6,
                     lo_color_5,lo_color_5,lo_color_5,lo_color_5,lo_color_5,lo_color_5,lo_color_4,lo_color_4,lo_color_4,lo_color_4,lo_color_4,lo_color_4,
                     lo_color_3,lo_color_3,lo_color_3,lo_color_3,lo_color_3,lo_color_3,lo_color_2,lo_color_2,lo_color_2,lo_color_2,lo_color_2,lo_color_2,
                     lo_color_1,lo_color_1,lo_color_1,lo_color_1,lo_color_1,lo_color_1,
                     "white",
                     hi_color_1, hi_color_1,hi_color_1, hi_color_1,hi_color_1, hi_color_1, 
                     hi_color_2, hi_color_2,hi_color_2, hi_color_2,hi_color_2, hi_color_2,hi_color_3, hi_color_3,hi_color_3, hi_color_3,hi_color_3, hi_color_3,
                     hi_color_4, hi_color_4,hi_color_4, hi_color_4,hi_color_4, hi_color_4,hi_color_5, hi_color_5,hi_color_5, hi_color_5,hi_color_5, hi_color_5,
                     hi_color_6, hi_color_6,hi_color_6, hi_color_6,hi_color_6, hi_color_6,hi_color_7, hi_color_7,hi_color_7, hi_color_7,hi_color_7, hi_color_7,
                     hi_color_8, hi_color_8,hi_color_8, hi_color_8,hi_color_8, hi_color_8,hi_color_9, hi_color_9,hi_color_9, hi_color_9,hi_color_9, hi_color_9)) +
  
  
  geom_node_point(color = "black", size = 2) +
  geom_node_text(aes(label = name), repel = F, hjust=0.1, angle=0, size = 3, colour = "black", 
                 position = position_nudge(x = c(-.1, -.1, -.1, -.2, -.27, -.12),
                                           y = c(.13, .13, .13, -.1, -.1, -.1))
                 ) +
  coord_cartesian(clip = "off") +
  theme(      #aspect.ratio=1,
              plot.margin = unit(c(0,0,0,0), "points"),
              panel.background = element_blank(), 
              panel.border = element_blank(),
              legend.position = c(.97, 0.85),
              legend.key.height = unit(.30, 'cm'),
              legend.key.width = unit(.33, 'cm'),
              legend.text=element_text(size = 6, colour = "black", hjust=1),
              legend.title = element_text(size = 8, colour = "black", face = "bold.italic"),
              legend.background=element_blank(),
              plot.title = element_text(size = 11, face = "bold", colour = "black")
              )

#Draw plot
corr_arcs
```


```{r}
ggsave("corr_arcs.pdf", corr_arcs, width = 2.5, height = 2.5)
```

Six plots version of the story how diversity x inclsuion leads to outcomes
```{r, fig.width = 6, fig.height = 4}
#Set small margin value
sm=3

#Plot
six_plots <- grid.arrange(
                                    div_inclusions_dist + labs(title="a") + theme(plot.margin = unit(c(sm,sm,sm,sm), "points")), 
                                    dist_rev            + labs(title="b")+ theme(plot.margin = unit(c(sm,sm,sm,sm), "points")),
                                    rev_sales           + labs(title="c")+ theme(plot.margin = unit(c(sm,sm,sm,sm), "points")),
                                    div_inclusions_rev  + labs(title="d")+ theme(plot.margin = unit(c(sm,sm,sm,sm), "points")),
                                    dist_sales          + labs(title="e")+ theme(plot.margin = unit(c(sm,sm,sm,sm), "points")),
                                    corr_arcs           + labs(title="f", position = position_nudge(x=-200))+ theme(plot.title = element_text(hjust = 0.278), plot.margin = unit(c(sm,sm+12,sm+20,sm), "points")),
                                    #widths = 2:1,
                                    #rel_heights = c(1, 1/2, 1/2, 1/2, 1/2),
                                    layout_matrix=rbind( 
                                                        c(1,2,3), 
                                                        c(4,5,6)
                                                        )
                                    )

```


```{r}
ggsave("six_plots.pdf", six_plots, width = 6, height = 4)
```

Two plots version of the story how diversity x inclsuion leads to outcomes
```{r, fig.width = 5, fig.height = 2.5}
#Set small margin value
sm=3

#Plot
two_plots <- grid.arrange(
                                    div_inclusions_dist + labs(title="a") + theme(plot.margin = unit(c(sm,sm,sm,sm), "points")), 
                                    corr_arcs           + labs(title="b") + theme(plot.margin = unit(c(sm,sm+10,sm+15,sm), "points")),
                                    #widths = 1:1,
                                    #heights = 1:1,
                                    nrow=1
                          )

```
```{r}
ggsave("two_plots.pdf", two_plots, width = 5, height = 2.5)
```

Five plots version of the story how diversity x inclsuion leads to outcomes
1: praparing the smaller plots subplot
```{r, fig.width = 3, fig.height = 3}
small_plots <- grid.arrange(
                                    dist_rev + labs(title="b"), 
                                    dist_user  + labs(title="d"),
                                    rev_sales2 + labs(title="c"),
                                    user_sales2 + labs(title="e"),
                                    #widths = 2:1,
                                    #rel_heights = c(1, 1/2, 1/2, 1/2, 1/2),
                                    layout_matrix=rbind(c(1,3), c(2,4)))
```
2: assembling the larger plot and small subplot matrix
```{r, fig.width = 6, fig.height = 3}
success_graphs_small <-grid.arrange(div_inclusions_dist + labs(title="a"), 
                                    small_plots,
                                    #widths = 2:1,
                                    #rel_heights = c(1, 1/2, 1/2, 1/2, 1/2),
                                    layout_matrix=rbind(c(1,2)))
```

```{r}
ggsave("success_graphs_small.pdf", success_graphs_small, width = 6, height = 3)
```



Relationship btw distinctiveness and review score differs by diversity X
inclusion, filtered data

```{r, fig.width = 2.5, fig.height = 2.5}


#-------------scale_x_continuous(expand = c(0,0), labels = dropLeadingZero)-----------------------------
scaleFUN <- function(x) sprintf("%.2f", x)

dropLeadingZero <- function(l){
  str_replace(scaleFUN(l), '0.', '.')
}
#-------------------------------------------------------------------------------------------------------

hi_color = "#b4de75"
lo_color = "#69629a"





moby$div_bottom50 <- moby$prop_women2<=median(moby$prop_women2, na.rm=T)
moby$div_top50 <- moby$prop_women2>median(moby$prop_women2, na.rm=T)

q <- quantile(moby$prop_women2, probs = c(1/3, 2/3), na.rm=T)
moby$div_bottom33 <- moby$prop_women2<=q[1]
moby$div_top33 <- moby$prop_women2>q[2]

q <- quantile(moby$prop_women2, probs = c(1/4, 3/4), na.rm=T)
moby$div_bottom25 <- moby$prop_women2<=q[1]
moby$div_top25 <- moby$prop_women2>q[2]

q <- quantile(moby$prop_women2, probs = c(1/10, 9/10), na.rm=T)
moby$div_bottom10 <- moby$prop_women2<=q[1]
moby$div_top10 <- moby$prop_women2>q[2]




dist_div_rev_mobydata <- ggplot() +
  
stat_smooth(data=moby[moby$rank_avg>30 & moby$div_top50==T,], aes(x=game_dist_prev5yr, y=rank_avg), 
            method = "loess", 
            #method = "lm",
            formula = y ~ x, 
            span=1, 
            se = T,size=0.5, alpha=0.5, na.rm=TRUE, color=hi_color, fill=hi_color) +  
  
stat_smooth(data=moby[moby$rank_avg>30 & moby$div_bottom50==T,], aes(x=game_dist_prev5yr, y=rank_avg), 
            method = "loess", 
            #method = "lm",
            formula = y ~ x, 
            span=1, 
            se = T, size=0.5, alpha=0.2, na.rm=TRUE, color=lo_color, fill=lo_color) +
  
  annotate(geom="text", x=.66,    y=73, label="Female prop.\nlow 50%", lineheight = .8,  col=lo_color, size=3.5, hjust = 0, alpha = 1, angle = 0) +
  annotate(geom="text", x=.69,    y=62.5, label="Female prop.\nhigh 50%", lineheight = .8,  col=hi_color, size=3.5, hjust = 0, alpha = 1, angle = 55) +

  
    scale_x_continuous(expand = c(0,0), labels = dropLeadingZero) +
    coord_cartesian(ylim=c(61,77), xlim=c(.633, .93)) +
    scale_y_continuous(expand = c(0,0)) +
  
    labs(y="Review") +
    labs(x="Distinctiveness") +
  
  theme(aspect.ratio=1, 
        legend.position = "none",
        panel.grid.major = element_line(size=0.2), 
        #panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", 
                                    fill=NA, 
                                    size=0.2),
        #legend.position = c(0.2, 0.3),
        plot.title = element_text(size = 11, face = "bold", colour = "black"),
        #axis.ticks = element_line(colour = "black", size = 0.1),
        axis.title.y = element_text(size = 11, colour = "black"),
        axis.text.x = element_text(size = 9, colour = "black"),
        axis.text.y = element_text(size = 9, colour = "black"),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank()
  )



dist_div_rev_mobydata
```
Relationship btw distinctiveness and review score differs by diversity X
inclusion, full dataset
```{r, fig.width = 2.5, fig.height = 2.5}


#-------------scale_x_continuous(expand = c(0,0), labels = dropLeadingZero)-----------------------------
scaleFUN <- function(x) sprintf("%.2f", x)

dropLeadingZero <- function(l){
  str_replace(scaleFUN(l), '0.', '.')
}
#-------------------------------------------------------------------------------------------------------

hi_color = "#b4de75"
lo_color = "#69629a"





full$div_bottom50 <- full$prop_women2<=median(full$prop_women2, na.rm=T)
full$div_top50 <- full$prop_women2>median(full$prop_women2, na.rm=T)

q <- quantile(full$prop_women2, probs = c(1/3, 2/3), na.rm=T)
full$div_bottom33 <- full$prop_women2<=q[1]
full$div_top33 <- full$prop_women2>q[2]

q <- quantile(full$prop_women2, probs = c(1/4, 3/4), na.rm=T)
full$div_bottom25 <- full$prop_women2<=q[1]
full$div_top25 <- full$prop_women2>q[2]

q <- quantile(full$prop_women2, probs = c(1/10, 9/10), na.rm=T)
full$div_bottom10 <- full$prop_women2<=q[1]
full$div_top10 <- full$prop_women2>q[2]




dist_div_rev_fulldata <- ggplot() +
  
stat_smooth(data=full[full$rank_avg>30 & full$div_top50==T,], aes(x=game_dist_prev5yr, y=rank_avg), method = "loess", formula = y ~ x, span=1, se = T,size=0.5, alpha=0.5, na.rm=TRUE, color=hi_color, fill=hi_color) +  
  
stat_smooth(data=full[full$rank_avg>30 & full$div_bottom50==T,], aes(x=game_dist_prev5yr, y=rank_avg), method = "loess", formula = y ~ x, span=1, se = T,size=0.5, alpha=0.2, na.rm=TRUE, color=lo_color, fill=lo_color) +
  
  annotate(geom="text", x=.67,    y=73, label="Female prop.\nbelow median", lineheight = .8,  col=lo_color, size=3.5, hjust = 0, alpha = 1, angle = 0) +
  annotate(geom="text", x=.687,    y=63.1, label="Female prop.\nabove median", lineheight = .8,  col=hi_color, size=3.5, hjust = 0, alpha = 1, angle = 55) +

  
    scale_x_continuous(expand = c(0,0), labels = dropLeadingZero) +
    coord_cartesian(ylim=c(61,77), xlim=c(.633, .93)) +
    scale_y_continuous(expand = c(0,0)) +
  
    labs(y="Review") +
    labs(x="Distinctiveness") +
  
  theme(aspect.ratio=1, 
        legend.position = "none",
        panel.grid.major = element_line(size=0.2), 
        #panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", 
                                    fill=NA, 
                                    size=0.2),
        #legend.position = c(0.2, 0.3),
        plot.title = element_text(size = 11, face = "bold", colour = "black"),
        #axis.ticks = element_line(colour = "black", size = 0.1),
        axis.title.y = element_text(size = 11, colour = "black"),
        axis.text.x = element_text(size = 9, colour = "black"),
        axis.text.y = element_text(size = 9, colour = "black"),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank()
  )



dist_div_rev_fulldata
```



```{r}
ggsave("dist_div_rev_fulldata.pdf", dist_div_rev_fulldata, width = 2.5, height = 2.5)
```





Relationship btw review score and sales differs by diversity X
inclusion, filtered data

```{r, fig.width = 2.5, fig.height = 2.5}


#-------------scale_x_continuous(expand = c(0,0), labels = dropLeadingZero)-----------------------------
scaleFUN <- function(x) sprintf("%.2f", x)

dropLeadingZero <- function(l){
  str_replace(scaleFUN(l), '0.', '.')
}
#-------------------------------------------------------------------------------------------------------

hi_color = "#b4de75"
lo_color = "#69629a"





moby$div_bottom50 <- moby$prop_women2<=median(moby$prop_women2, na.rm=T)
moby$div_top50 <- moby$prop_women2>median(moby$prop_women2, na.rm=T)

q <- quantile(moby$prop_women2, probs = c(1/3, 2/3), na.rm=T)
moby$div_bottom33 <- moby$prop_women2<=q[1]
moby$div_top33 <- moby$prop_women2>q[2]

q <- quantile(moby$prop_women2, probs = c(1/4, 3/4), na.rm=T)
moby$div_bottom25 <- moby$prop_women2<=q[1]
moby$div_top25 <- moby$prop_women2>q[2]

q <- quantile(moby$prop_women2, probs = c(1/10, 9/10), na.rm=T)
moby$div_bottom10 <- moby$prop_women2<=q[1]
moby$div_top10 <- moby$prop_women2>q[2]




dist_div_rev_mobydata <- ggplot() +
  
stat_smooth(data=moby[moby$rank_avg>30 & moby$div_top50==T,], aes(x=rank_avg, y=log_global_sales2_annual), 
            method = "loess", 
            #method = "lm",
            formula = y ~ x, 
            span=1, 
            se = T,size=0.5, alpha=0.5, na.rm=TRUE, color=hi_color, fill=hi_color) +  
  
stat_smooth(data=moby[moby$rank_avg>30 & moby$div_bottom50==T,], aes(x=rank_avg, y=log_global_sales2_annual), 
            method = "loess", 
            #method = "lm",
            formula = y ~ x, 
            span=1, 
            se = T, size=0.5, alpha=0.2, na.rm=TRUE, color=lo_color, fill=lo_color) +
  
  #annotate(geom="text", x=.66,    y=73, label="Female prop.\nlow 50%", lineheight = .8,  col=lo_color, size=3.5, hjust = 0, alpha = 1, angle = 0) +
  #annotate(geom="text", x=.69,    y=62.5, label="Female prop.\nhigh 50%", lineheight = .8,  col=hi_color, size=3.5, hjust = 0, alpha = 1, angle = 55) +

  
    scale_x_continuous(expand = c(0,0), breaks = scales::pretty_breaks(n = 5)) +
    coord_cartesian(xlim=c(35,93), ylim=c(3.6, 4.9)) +
    scale_y_continuous(expand = c(0,0), breaks = scales::pretty_breaks(n = 5)) +
  
    labs(y="Sales") +
    labs(x="Review") +
  
  theme(aspect.ratio=1, 
        legend.position = "none",
        panel.grid.major = element_line(size=0.2), 
        #panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", 
                                    fill=NA, 
                                    size=0.2),
        #legend.position = c(0.2, 0.3),
        plot.title = element_text(size = 11, face = "bold", colour = "black"),
        #axis.ticks = element_line(colour = "black", size = 0.1),
        axis.title.y = element_text(size = 11, colour = "black"),
        axis.text.x = element_text(size = 9, colour = "black"),
        axis.text.y = element_text(size = 9, colour = "black"),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank()
  )



dist_div_rev_mobydata
```
Relationship btw distinctiveness and review score differs by diversity X
inclusion, full dataset
```{r, fig.width = 2.5, fig.height = 2.5}


#-------------scale_x_continuous(expand = c(0,0), labels = dropLeadingZero)-----------------------------
scaleFUN <- function(x) sprintf("%.2f", x)

dropLeadingZero <- function(l){
  str_replace(scaleFUN(l), '0.', '.')
}
#-------------------------------------------------------------------------------------------------------

hi_color = "#b4de75"
lo_color = "#69629a"





full$div_bottom50 <- full$prop_women2<=median(full$prop_women2, na.rm=T)
full$div_top50 <- full$prop_women2>median(full$prop_women2, na.rm=T)

q <- quantile(full$prop_women2, probs = c(1/3, 2/3), na.rm=T)
full$div_bottom33 <- full$prop_women2<=q[1]
full$div_top33 <- full$prop_women2>q[2]

q <- quantile(full$prop_women2, probs = c(1/4, 3/4), na.rm=T)
full$div_bottom25 <- full$prop_women2<=q[1]
full$div_top25 <- full$prop_women2>q[2]

q <- quantile(full$prop_women2, probs = c(1/10, 9/10), na.rm=T)
full$div_bottom10 <- full$prop_women2<=q[1]
full$div_top10 <- full$prop_women2>q[2]




dist_div_rev_fulldata <- ggplot() +
  
stat_smooth(data=full[full$rank_avg>30 & full$div_top50==T,], aes(x=game_dist_prev5yr, y=rank_avg), method = "loess", formula = y ~ x, span=1, se = T,size=0.5, alpha=0.5, na.rm=TRUE, color=hi_color, fill=hi_color) +  
  
stat_smooth(data=full[full$rank_avg>30 & full$div_bottom50==T,], aes(x=game_dist_prev5yr, y=rank_avg), method = "loess", formula = y ~ x, span=1, se = T,size=0.5, alpha=0.2, na.rm=TRUE, color=lo_color, fill=lo_color) +
  
  annotate(geom="text", x=.67,    y=73, label="Female prop.\nbelow median", lineheight = .8,  col=lo_color, size=3.5, hjust = 0, alpha = 1, angle = 0) +
  annotate(geom="text", x=.687,    y=63.1, label="Female prop.\nabove median", lineheight = .8,  col=hi_color, size=3.5, hjust = 0, alpha = 1, angle = 55) +

  
    scale_x_continuous(expand = c(0,0), labels = dropLeadingZero) +
    coord_cartesian(ylim=c(61,77), xlim=c(.633, .93)) +
    scale_y_continuous(expand = c(0,0)) +
  
    labs(y="Review") +
    labs(x="Distinctiveness") +
  
  theme(aspect.ratio=1, 
        legend.position = "none",
        panel.grid.major = element_line(size=0.2), 
        #panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", 
                                    fill=NA, 
                                    size=0.2),
        #legend.position = c(0.2, 0.3),
        plot.title = element_text(size = 11, face = "bold", colour = "black"),
        #axis.ticks = element_line(colour = "black", size = 0.1),
        axis.title.y = element_text(size = 11, colour = "black"),
        axis.text.x = element_text(size = 9, colour = "black"),
        axis.text.y = element_text(size = 9, colour = "black"),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank()
  )



dist_div_rev_fulldata







###Models Predicting Creativity (Distinctiveness)

Add a game count per developer firm variable
```{r}
df <- data.frame(moby$org_dev)
dev_firm_level_obs <- aggregate(df, list(dev_firm = df$moby.org_dev), FUN = length)
colnames(dev_firm_level_obs) <- c("org_dev", "n")
t <- data.frame(table(dev_firm_level_obs$n))
t2 <- data.frame(table(moby$n_per_org_dev))

n_firms <- dim(dev_firm_level_obs)[1]
moby$n_per_org_dev <- 0

#match dev firm n to dataset
for (i in 1:n_firms) {
  firm <- dev_firm_level_obs$org_dev[i]
  match_yes <- match(moby$org_dev, firm)
  moby$n_per_org_dev[match_yes==1] <- dev_firm_level_obs[i,2]
}



ggplot(t, aes(x=Var1, y=Freq)) + 
  geom_bar(stat = "identity", color="white", fill=lo_color) +
  
      scale_x_discrete(expand = c(0,0)) +
      scale_y_continuous(expand = c(0,0)) +
  
      labs(y="Frequency") +
      labs(x="Games by Firm") +
  
    theme(aspect.ratio=1, 
        legend.position = "none",
        panel.grid.major = element_line(size=0.2), 
        #panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", 
                                    fill=NA, 
                                    size=0.2),
        #legend.position = c(0.2, 0.3),
        plot.title = element_text(size = 11, face = "bold", colour = "black"),
        #axis.ticks = element_line(colour = "black", size = 0.1),
        axis.title.y = element_text(size = 11, colour = "black"),
        axis.text.x = element_text(size = 9, colour = "black"),
        axis.text.y = element_text(size = 9, colour = "black"),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank()
  )
```



##Without inclusion

```{r}
#standardized variables
moby$game_dist_prev5yr_z <- (moby$game_dist_prev5yr-min(moby$game_dist_prev5yr, na.rm=T))/sd(moby$game_dist_prev5yr)
moby$prop_women2_z <- (moby$prop_women2-min(moby$prop_women2, na.rm=T))/sd(moby$prop_women2)
moby$blau2_z <- (moby$blau2-min(moby$blau2, na.rm=T))/sd(moby$blau2)


moby_dev_firm_level$game_dist_prev5yr_z <- (moby_dev_firm_level$game_dist_prev5yr-min(moby_dev_firm_level$game_dist_prev5yr, na.rm=T))/sd(moby_dev_firm_level$game_dist_prev5yr)
moby_dev_firm_level$prop_women2_z <- (moby_dev_firm_level$prop_women2-min(moby_dev_firm_level$prop_women2, na.rm=T))/sd(moby_dev_firm_level$prop_women2)
moby_dev_firm_level$blau2_z <- (moby_dev_firm_level$blau2-min(moby_dev_firm_level$blau2, na.rm=T))/sd(moby_dev_firm_level$blau2)

#team size fixed effects: 20 equal sized quantiles of team size
moby$N_quantiles <- cut(moby$N, quantile(moby$N, probs=seq(0,1,0.05)))
table(moby$N_quantiles)


#1. basic model
without_inclusion <- lm(
  game_dist_prev5yr ~
    blau2 +
    N +
    #as.factor(N_quantiles) + 
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby
)


#2. basic model team size FE
without_inclusion_teamfe <- lm(
  game_dist_prev5yr ~
    blau2 +
    #N +
    as.factor(N_quantiles) +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby
)

#3. standardized model
without_inclusion_z <- lm(
  game_dist_prev5yr_z ~
    blau2_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby
)


#4. fixed effects for developer firm
without_inclusion_fe_1 <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby[moby$n_per_org_dev>=1,],
  index="org_dev",
  model="within"
)

without_inclusion_fe_2 <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby[moby$n_per_org_dev>=2,],
  index="org_dev",
  model="within"
)


without_inclusion_fe_5 <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby[moby$n_per_org_dev>=5,],
  index="org_dev",
  model="within"
)

without_inclusion_fe_10 <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby[moby$n_per_org_dev>=10,],
  index="org_dev",
  model="within"
)


#5. random effects for developer firm
without_inclusion_re <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby,
  index="org_dev",
  model="random"
)


#6. fixed effects model with dummies

org_dev_list <- table(moby$org_dev)
org_dev_list_repeats <- org_dev_list[org_dev_list>1]
org_dev_list_repeats_list <- as.numeric(names(org_dev_list_repeats))
org_dev_list_nonrepeats <- org_dev_list[org_dev_list==1]
org_dev_list_nonrepeats_list <- as.numeric(names(org_dev_list_nonrepeats))

delete_index <- match(org_dev_list_nonrepeats_list, moby$org_dev)

moby_repeat_devs <- moby[-delete_index,]

without_inclusion_fe_dummies <- lm(
  game_dist_prev5yr_z ~
    blau2_z +
    as.factor(org_dev) +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
  ,
  data = moby_repeat_devs
)



#7. developer firm level model
without_inclusion_aggr <- lm(
  game_dist_prev5yr ~
    blau2 +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby_dev_firm_level
)


#8. developer firm level model, standardized
without_inclusion_aggr_z <- lm(
  game_dist_prev5yr_z ~
    blau2_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby_dev_firm_level
)


# Adjust standard errors
#1.1 basic model, robust SE
cov1         <- vcovHC(without_inclusion, type = "HC1")
without_inclusion_robust_se    <- sqrt(diag(cov1))

#1.2 basic model, clustered SE
cov1         <- vcovHC(without_inclusion, type = "HC1", cluster=moby$org_dev)
without_inclusion_clustered_se    <- sqrt(diag(cov1))

#2. basic model team size FE, robust SE
cov1         <- vcovHC(without_inclusion_teamfe, type = "HC1")
without_inclusion_teamfe_robust_se    <- sqrt(diag(cov1))

#3.1 standardized model, robust SE
cov1         <- vcovHC(without_inclusion_z, type = "HC1")
without_inclusion_z_robust_se    <- sqrt(diag(cov1))

#3.2 standardized model, clustered SE
cov1         <- vcovHC(without_inclusion_z, type = "HC1", cluster=moby$org_dev)
without_inclusion_z_clustered_se    <- sqrt(diag(cov1))

#4. fixed effects for developer firm, clustered SE
cov1         <- vcovHC(without_inclusion_fe_1, type = "HC1", cluster = "group")
without_inclusion_fe_1_clustered_se    <- sqrt(diag(cov1))

cov1         <- vcovHC(without_inclusion_fe_2, type = "HC1", cluster = "group")
without_inclusion_fe_2_clustered_se    <- sqrt(diag(cov1))

cov1         <- vcovHC(without_inclusion_fe_5, type = "HC1", cluster = "group")
without_inclusion_fe_5_clustered_se    <- sqrt(diag(cov1))

cov1         <- vcovHC(without_inclusion_fe_10, type = "HC1", cluster = "group")
without_inclusion_fe_10_clustered_se    <- sqrt(diag(cov1))

#5. random effects for developer firm, clsutered SE
cov1         <- vcovHC(without_inclusion_re, type = "HC1", cluster = "group")
without_inclusion_re_clustered_se    <- sqrt(diag(cov1))


#6. fixed effects model with dummies
cov1         <- vcovHC(without_inclusion_fe_dummies, type = "HC1", cluster=moby$org_dev)
without_inclusion_fe_dummies_clustered_se    <- sqrt(diag(cov1))

#7. developer firm level model, robust SE
cov1         <- vcovHC(without_inclusion_aggr, type = "HC1")
without_inclusion_aggr_robust_se    <- sqrt(diag(cov1))

#8. developer firm level model, standardized, robust SE
cov1         <- vcovHC(without_inclusion_aggr_z, type = "HC1")
without_inclusion_aggr_z_robust_se    <- sqrt(diag(cov1))


# Stargazer output
#1. basic model
stargazer(without_inclusion,without_inclusion,
          column.labels=c('Base, rob SE', 'Base, clus SE'),
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "mixing*"), 
          se = list(without_inclusion_robust_se, without_inclusion_clustered_se),
          omit.stat = c("f", "ser")
          )

#2. basic model team size FE, robust SE
stargazer(without_inclusion_teamfe,
          column.labels='Base model team N FE',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "mixing*"), 
          se = list(NULL, without_inclusion_teamfe_robust_se),
          omit.stat = c("f", "ser")
          )
#3. standardized model
stargazer(without_inclusion_z,without_inclusion_z,
          column.labels=c('Std, rob SE', 'Std, clus SE'),
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "mixing*"), 
          se = list(without_inclusion_z_robust_se,without_inclusion_z_clustered_se),
          omit.stat = c("f", "ser")
          )


#4. fixed effects for developer firm, clustered SE
m1 <- without_inclusion_fe_1
m2 <- without_inclusion_fe_2
m3 <- without_inclusion_fe_5
m4 <- without_inclusion_fe_10

stargazer(m1,m2,m3,m4,
          column.labels=c('n>=1','n>=2', 'n>=5', 'n>=10'),
          dep.var.caption = "Dev firm FE, clus SE",
          type="text", 
          keep = c("blau*", "mixing*"), 
          se = list(without_inclusion_fe_1_clustered_se, without_inclusion_fe_2_clustered_se, without_inclusion_fe_5_clustered_se, without_inclusion_fe_10_clustered_se),
          omit.stat = c("f", "ser")
          )

#5. random effects for developer firm, clustered SE
stargazer(without_inclusion_re,
          column.labels='Dev firm RE',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "mixing*"), 
          se = list(NULL, without_inclusion_re_clustered_se),
          omit.stat = c("f", "ser")
          )

#6. fixed effects model with dummies
stargazer(without_inclusion_fe_dummies,
          column.labels='Dev firm FE dummies',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "mixing*"), 
          se = list(NULL, without_inclusion_fe_dummies_clustered_se),
          omit.stat = c("f", "ser")
          )
#7. developer firm level model, robust SE
stargazer(without_inclusion_aggr,
          column.labels='Dev firm level',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "mixing*"), 
          se = list(NULL, without_inclusion_aggr_robust_se),
          omit.stat = c("f", "ser")
          )
#8. developer firm level model, standardized, robust SE
stargazer(without_inclusion_aggr_z,
          column.labels='Dev firm level std',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "mixing*"), 
          se = list(NULL, without_inclusion_aggr_z_robust_se),
          omit.stat = c("f", "ser")
          )
```



##Mixing

    blau2 +
    mixing +
    blau2 * mixing +

```{r}
moby$mixing <- moby$assortativity_rev_z
moby_dev_firm_level$mixing <- moby_dev_firm_level$assortativity_rev_z

#standardized variables
moby$game_dist_prev5yr_z <- (moby$game_dist_prev5yr-min(moby$game_dist_prev5yr, na.rm=T))/sd(moby$game_dist_prev5yr)
moby$prop_women2_z <- (moby$prop_women2-min(moby$prop_women2, na.rm=T))/sd(moby$prop_women2)
moby$mixing_z <- (moby$mixing-min(moby$mixing, na.rm=T))/sd(moby$mixing)
moby$blau2_z <- (moby$blau2-min(moby$blau2, na.rm=T))/sd(moby$blau2)


moby_dev_firm_level$game_dist_prev5yr_z <- (moby_dev_firm_level$game_dist_prev5yr-min(moby_dev_firm_level$game_dist_prev5yr, na.rm=T))/sd(moby_dev_firm_level$game_dist_prev5yr)
moby_dev_firm_level$prop_women2_z <- (moby_dev_firm_level$prop_women2-min(moby_dev_firm_level$prop_women2, na.rm=T))/sd(moby_dev_firm_level$prop_women2)
moby_dev_firm_level$mixing_z <- (moby_dev_firm_level$mixing-min(moby_dev_firm_level$mixing, na.rm=T))/sd(moby_dev_firm_level$mixing)
moby_dev_firm_level$blau2_z <- (moby_dev_firm_level$blau2-min(moby_dev_firm_level$blau2, na.rm=T))/sd(moby_dev_firm_level$blau2)


#1. basic model
mixing <- lm(
  game_dist_prev5yr ~
    blau2 +
    mixing +
    blau2 * mixing +
    N +
    #as.factor(N_quantiles) + 
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby
)


#2. basic model team size FE
mixing_teamfe <- lm(
  game_dist_prev5yr ~
    blau2 +
    mixing +
    blau2 * mixing +
    #N +
    as.factor(N_quantiles) +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby
)

#3. standardized model
mixing_z <- lm(
  game_dist_prev5yr_z ~
    blau2_z +
    mixing_z +
    blau2_z * mixing_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby
)


#4. fixed effects for developer firm
mixing_fe_1 <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    mixing_z +
    blau2_z * mixing_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby[moby$n_per_org_dev>=1,],
  index="org_dev",
  model="within"
)

mixing_fe_2 <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    mixing_z +
    blau2_z * mixing_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby[moby$n_per_org_dev>=2,],
  index="org_dev",
  model="within"
)


mixing_fe_5 <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    mixing_z +
    blau2_z * mixing_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby[moby$n_per_org_dev>=5,],
  index="org_dev",
  model="within"
)

mixing_fe_10 <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    mixing_z +
    blau2_z * mixing_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby[moby$n_per_org_dev>=10,],
  index="org_dev",
  model="within"
)


#5. random effects for developer firm
mixing_re <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    mixing_z +
    blau2_z * mixing_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby,
  index="org_dev",
  model="random"
)


#6. fixed effects model with dummies

org_dev_list <- table(moby$org_dev)
org_dev_list_repeats <- org_dev_list[org_dev_list>1]
org_dev_list_repeats_list <- as.numeric(names(org_dev_list_repeats))
org_dev_list_nonrepeats <- org_dev_list[org_dev_list==1]
org_dev_list_nonrepeats_list <- as.numeric(names(org_dev_list_nonrepeats))

delete_index <- match(org_dev_list_nonrepeats_list, moby$org_dev)

moby_repeat_devs <- moby[-delete_index,]

mixing_fe_dummies <- lm(
  game_dist_prev5yr_z ~
    blau2_z +
    mixing_z +
    blau2_z * mixing_z +
    as.factor(org_dev) +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
  ,
  data = moby_repeat_devs
)



#7. developer firm level model
mixing_aggr <- lm(
  game_dist_prev5yr ~
    blau2_z +
    mixing_z +
    blau2_z * mixing_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby_dev_firm_level
)


#8. developer firm level model, standardized
mixing_aggr_z <- lm(
  game_dist_prev5yr_z ~
    blau2_z +
    mixing_z +
    blau2_z * mixing_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby_dev_firm_level
)


# Adjust standard errors
#1.1 basic model, robust SE
cov1         <- vcovHC(mixing, type = "HC1")
mixing_robust_se    <- sqrt(diag(cov1))

#1.2 basic model, clustered SE
cov1         <- vcovHC(mixing, type = "HC1", cluster=moby$org_dev)
mixing_clustered_se    <- sqrt(diag(cov1))

#2. basic model team size FE, robust SE
cov1         <- vcovHC(mixing_teamfe, type = "HC1")
mixing_teamfe_robust_se    <- sqrt(diag(cov1))

#3.1 standardized model, robust SE
cov1         <- vcovHC(mixing_z, type = "HC1")
mixing_z_robust_se    <- sqrt(diag(cov1))

#3.2 standardized model, clustered SE
cov1         <- vcovHC(mixing_z, type = "HC1", cluster=moby$org_dev)
mixing_z_clustered_se    <- sqrt(diag(cov1))

#4. fixed effects for developer firm, clustered SE
cov1         <- vcovHC(mixing_fe_1, type = "HC1", cluster = "group")
mixing_fe_1_clustered_se    <- sqrt(diag(cov1))

cov1         <- vcovHC(mixing_fe_2, type = "HC1", cluster = "group")
mixing_fe_2_clustered_se    <- sqrt(diag(cov1))

cov1         <- vcovHC(mixing_fe_5, type = "HC1", cluster = "group")
mixing_fe_5_clustered_se    <- sqrt(diag(cov1))

cov1         <- vcovHC(mixing_fe_10, type = "HC1", cluster = "group")
mixing_fe_10_clustered_se    <- sqrt(diag(cov1))

#5. random effects for developer firm, clsutered SE
cov1         <- vcovHC(mixing_re, type = "HC1", cluster = "group")
mixing_re_clustered_se    <- sqrt(diag(cov1))


#6. fixed effects model with dummies
cov1         <- vcovHC(mixing_fe_dummies, type = "HC1", cluster=moby$org_dev)
mixing_fe_dummies_clustered_se    <- sqrt(diag(cov1))

#7. developer firm level model, robust SE
cov1         <- vcovHC(mixing_aggr, type = "HC1")
mixing_aggr_robust_se    <- sqrt(diag(cov1))

#8. developer firm level model, standardized, robust SE
cov1         <- vcovHC(mixing_aggr_z, type = "HC1")
mixing_aggr_z_robust_se    <- sqrt(diag(cov1))


# Stargazer output
#1. basic model
stargazer(mixing,mixing,
          column.labels=c('Base, rob SE', 'Base, clus SE'),
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "mixing*"), 
          se = list(mixing_robust_se, mixing_clustered_se),
          omit.stat = c("f", "ser")
          )

#2. basic model team size FE, robust SE
stargazer(mixing_teamfe,
          column.labels='Base model team N FE',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "mixing*"), 
          se = list(mixing_teamfe_robust_se),
          omit.stat = c("f", "ser")
          )
#3. standardized model
stargazer(mixing_z,mixing_z,
          column.labels=c('Std, rob SE', 'Std, clus SE'),
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "mixing*"), 
          se = list(mixing_z_robust_se,mixing_z_clustered_se),
          omit.stat = c("f", "ser")
          )


#4. fixed effects for developer firm, clustered SE
m1 <- mixing_fe_1
m2 <- mixing_fe_2
m3 <- mixing_fe_5
m4 <- mixing_fe_10

stargazer(m1,m2,m3,m4,
          column.labels=c('n>=1','n>=2', 'n>=5', 'n>=10'),
          dep.var.caption = "Dev firm FE, clus SE",
          type="text", 
          keep = c("blau*", "mixing*"), 
          se = list(mixing_fe_1_clustered_se, mixing_fe_2_clustered_se, mixing_fe_5_clustered_se, mixing_fe_10_clustered_se),
          omit.stat = c("f", "ser")
          )

#5. random effects for developer firm, clustered SE
stargazer(mixing_re,
          column.labels='Dev firm RE',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "mixing*"), 
          se = list(mixing_re_clustered_se),
          omit.stat = c("f", "ser")
          )

#6. fixed effects model with dummies
stargazer(mixing_fe_dummies,
          column.labels='Dev firm FE dummies',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "mixing*"), 
          se = list(mixing_fe_dummies_clustered_se),
          omit.stat = c("f", "ser")
          )
#7. developer firm level model, robust SE
stargazer(mixing_aggr,
          column.labels='Dev firm level',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "mixing*"), 
          se = list(mixing_aggr_robust_se),
          omit.stat = c("f", "ser")
          )
#8. developer firm level model, standardized, robust SE
stargazer(mixing_aggr_z,
          column.labels='Dev firm level std',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "mixing*"), 
          se = list(mixing_aggr_z_robust_se),
          omit.stat = c("f", "ser")
          )
```

##Bonding weighted_cross_edges_ratio_z

```{r}
moby$bonding <- moby$weighted_cross_edges_ratio_z
moby_dev_firm_level$bonding <- moby_dev_firm_level$weighted_cross_edges_ratio_z

#standardized variables
moby$game_dist_prev5yr_z <- (moby$game_dist_prev5yr-min(moby$game_dist_prev5yr, na.rm=T))/sd(moby$game_dist_prev5yr)
moby$prop_women2_z <- (moby$prop_women2-min(moby$prop_women2, na.rm=T))/sd(moby$prop_women2)
moby$bonding_z <- (moby$bonding-min(moby$bonding, na.rm=T))/sd(moby$bonding)
moby$blau2_z <- (moby$blau2-min(moby$blau2, na.rm=T))/sd(moby$blau2)


moby_dev_firm_level$game_dist_prev5yr_z <- (moby_dev_firm_level$game_dist_prev5yr-min(moby_dev_firm_level$game_dist_prev5yr, na.rm=T))/sd(moby_dev_firm_level$game_dist_prev5yr)
moby_dev_firm_level$prop_women2_z <- (moby_dev_firm_level$prop_women2-min(moby_dev_firm_level$prop_women2, na.rm=T))/sd(moby_dev_firm_level$prop_women2)
moby_dev_firm_level$bonding_z <- (moby_dev_firm_level$bonding-min(moby_dev_firm_level$bonding, na.rm=T))/sd(moby_dev_firm_level$bonding)
moby_dev_firm_level$blau2_z <- (moby_dev_firm_level$blau2-min(moby_dev_firm_level$blau2, na.rm=T))/sd(moby_dev_firm_level$blau2)

#1. basic model
bonding <- lm(
  game_dist_prev5yr ~
    blau2 +
    bonding +
    blau2 * bonding +
    N +
    #as.factor(N_quantiles) + 
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby
)


#2. basic model team size FE
bonding_teamfe <- lm(
  game_dist_prev5yr ~
    blau2 +
    bonding +
    blau2 * bonding +
    #N +
    as.factor(N_quantiles) +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby
)

#3. standardized model
bonding_z <- lm(
  game_dist_prev5yr_z ~
    blau2_z +
    bonding_z +
    blau2_z * bonding_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby
)


#4. fixed effects for developer firm
bonding_fe_1 <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    bonding_z +
    blau2_z * bonding_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby[moby$n_per_org_dev>=1,],
  index="org_dev",
  model="within"
)

bonding_fe_2 <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    bonding_z +
    blau2_z * bonding_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby[moby$n_per_org_dev>=2,],
  index="org_dev",
  model="within"
)


bonding_fe_5 <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    bonding_z +
    blau2_z * bonding_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby[moby$n_per_org_dev>=5,],
  index="org_dev",
  model="within"
)

bonding_fe_10 <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    bonding_z +
    blau2_z * bonding_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby[moby$n_per_org_dev>=10,],
  index="org_dev",
  model="within"
)


#5. random effects for developer firm
bonding_re <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    bonding_z +
    blau2_z * bonding_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby,
  index="org_dev",
  model="random"
)


#6. fixed effects model with dummies

org_dev_list <- table(moby$org_dev)
org_dev_list_repeats <- org_dev_list[org_dev_list>1]
org_dev_list_repeats_list <- as.numeric(names(org_dev_list_repeats))
org_dev_list_nonrepeats <- org_dev_list[org_dev_list==1]
org_dev_list_nonrepeats_list <- as.numeric(names(org_dev_list_nonrepeats))

delete_index <- match(org_dev_list_nonrepeats_list, moby$org_dev)

moby_repeat_devs <- moby[-delete_index,]

bonding_fe_dummies <- lm(
  game_dist_prev5yr_z ~
    blau2_z +
    bonding_z +
    blau2_z * bonding_z +
    as.factor(org_dev) +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
  ,
  data = moby_repeat_devs
)



#7. developer firm level model
bonding_aggr <- lm(
  game_dist_prev5yr ~
    blau2_z +
    bonding_z +
    blau2_z * bonding_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby_dev_firm_level
)


#8. developer firm level model, standardized
bonding_aggr_z <- lm(
  game_dist_prev5yr_z ~
    blau2_z +
    bonding_z +
    blau2_z * bonding_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby_dev_firm_level
)


# Adjust standard errors
#1.1 basic model, robust SE
cov1         <- vcovHC(bonding, type = "HC1")
bonding_robust_se    <- sqrt(diag(cov1))

#1.2 basic model, clustered SE
cov1         <- vcovHC(bonding, type = "HC1", cluster=moby$org_dev)
bonding_clustered_se    <- sqrt(diag(cov1))

#2. basic model team size FE, robust SE
cov1         <- vcovHC(bonding_teamfe, type = "HC1")
bonding_teamfe_robust_se    <- sqrt(diag(cov1))

#3.1 standardized model, robust SE
cov1         <- vcovHC(bonding_z, type = "HC1")
bonding_z_robust_se    <- sqrt(diag(cov1))

#3.2 standardized model, clustered SE
cov1         <- vcovHC(bonding_z, type = "HC1", cluster=moby$org_dev)
bonding_z_clustered_se    <- sqrt(diag(cov1))

#4. fixed effects for developer firm, clustered SE
cov1         <- vcovHC(bonding_fe_1, type = "HC1", cluster = "group")
bonding_fe_1_clustered_se    <- sqrt(diag(cov1))

cov1         <- vcovHC(bonding_fe_2, type = "HC1", cluster = "group")
bonding_fe_2_clustered_se    <- sqrt(diag(cov1))

cov1         <- vcovHC(bonding_fe_5, type = "HC1", cluster = "group")
bonding_fe_5_clustered_se    <- sqrt(diag(cov1))

cov1         <- vcovHC(bonding_fe_10, type = "HC1", cluster = "group")
bonding_fe_10_clustered_se    <- sqrt(diag(cov1))

#5. random effects for developer firm, clsutered SE
cov1         <- vcovHC(bonding_re, type = "HC1", cluster = "group")
bonding_re_clustered_se    <- sqrt(diag(cov1))


#6. fixed effects model with dummies
cov1         <- vcovHC(bonding_fe_dummies, type = "HC1", cluster=moby$org_dev)
bonding_fe_dummies_clustered_se    <- sqrt(diag(cov1))

#7. developer firm level model, robust SE
cov1         <- vcovHC(bonding_aggr, type = "HC1")
bonding_aggr_robust_se    <- sqrt(diag(cov1))

#8. developer firm level model, standardized, robust SE
cov1         <- vcovHC(bonding_aggr_z, type = "HC1")
bonding_aggr_z_robust_se    <- sqrt(diag(cov1))


# Stargazer output
#1. basic model
stargazer(bonding,bonding,
          column.labels=c('Base, rob SE', 'Base, clus SE'),
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "bonding*"), 
          se = list(bonding_robust_se, bonding_clustered_se),
          omit.stat = c("f", "ser")
          )

#2. basic model team size FE, robust SE
stargazer(bonding_teamfe,
          column.labels='Base model team N FE',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "bonding*"), 
          se = list(bonding_teamfe_robust_se),
          omit.stat = c("f", "ser")
          )
#3. standardized model
stargazer(bonding_z,bonding_z,
          column.labels=c('Std, rob SE', 'Std, clus SE'),
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "bonding*"), 
          se = list(bonding_z_robust_se,bonding_z_clustered_se),
          omit.stat = c("f", "ser")
          )


#4. fixed effects for developer firm, clustered SE
m1 <- bonding_fe_1
m2 <- bonding_fe_2
m3 <- bonding_fe_5
m4 <- bonding_fe_10

stargazer(m1,m2,m3,m4,
          column.labels=c('n>=1','n>=2', 'n>=5', 'n>=10'),
          dep.var.caption = "Dev firm FE, clus SE",
          type="text", 
          keep = c("blau*", "bonding*"), 
          se = list(bonding_fe_1_clustered_se, bonding_fe_2_clustered_se, bonding_fe_5_clustered_se, bonding_fe_10_clustered_se),
          omit.stat = c("f", "ser")
          )

#5. random effects for developer firm, clustered SE
stargazer(bonding_re,
          column.labels='Dev firm RE',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "bonding*"), 
          se = list(bonding_re_clustered_se),
          omit.stat = c("f", "ser")
          )

#6. fixed effects model with dummies
stargazer(bonding_fe_dummies,
          column.labels='Dev firm FE dummies',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "bonding*"), 
          se = list(bonding_fe_dummies_clustered_se),
          omit.stat = c("f", "ser")
          )
#7. developer firm level model, robust SE
stargazer(bonding_aggr,
          column.labels='Dev firm level',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "bonding*"), 
          se = list(bonding_aggr_robust_se),
          omit.stat = c("f", "ser")
          )
#8. developer firm level model, standardized, robust SE
stargazer(bonding_aggr_z,
          column.labels='Dev firm level std',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "bonding*"), 
          se = list(bonding_aggr_z_robust_se),
          omit.stat = c("f", "ser")
          )
```

##Incorporating female_coreness_log_z

```{r}
moby$incorporating <- moby$female_coreness_log_z
moby_dev_firm_level$incorporating <- moby_dev_firm_level$female_coreness_log_z

#standardized variables
moby$game_dist_prev5yr_z <- (moby$game_dist_prev5yr-min(moby$game_dist_prev5yr, na.rm=T))/sd(moby$game_dist_prev5yr)
moby$prop_women2_z <- (moby$prop_women2-min(moby$prop_women2, na.rm=T))/sd(moby$prop_women2)
moby$incorporating_z <- (moby$incorporating-min(moby$incorporating, na.rm=T))/sd(moby$incorporating)
moby$blau2_z <- (moby$blau2-min(moby$blau2, na.rm=T))/sd(moby$blau2)


moby_dev_firm_level$game_dist_prev5yr_z <- (moby_dev_firm_level$game_dist_prev5yr-min(moby_dev_firm_level$game_dist_prev5yr, na.rm=T))/sd(moby_dev_firm_level$game_dist_prev5yr)
moby_dev_firm_level$prop_women2_z <- (moby_dev_firm_level$prop_women2-min(moby_dev_firm_level$prop_women2, na.rm=T))/sd(moby_dev_firm_level$prop_women2)
moby_dev_firm_level$incorporating_z <- (moby_dev_firm_level$incorporating-min(moby_dev_firm_level$incorporating, na.rm=T))/sd(moby_dev_firm_level$incorporating)
moby_dev_firm_level$blau2_z <- (moby_dev_firm_level$blau2-min(moby_dev_firm_level$blau2, na.rm=T))/sd(moby_dev_firm_level$blau2)

#1. basic model
incorporating <- lm(
  game_dist_prev5yr ~
    blau2 +
    incorporating +
    blau2 * incorporating +
    N +
    #as.factor(N_quantiles) + 
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby
)


#2. basic model team size FE
incorporating_teamfe <- lm(
  game_dist_prev5yr ~
    blau2 +
    incorporating +
    blau2 * incorporating +
    #N +
    as.factor(N_quantiles) +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby
)

#3. standardized model
incorporating_z <- lm(
  game_dist_prev5yr_z ~
    blau2_z +
    incorporating_z +
    blau2_z * incorporating_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby
)


#4. fixed effects for developer firm
incorporating_fe_1 <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    incorporating_z +
    blau2_z * incorporating_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby[moby$n_per_org_dev>=1,],
  index="org_dev",
  model="within"
)

incorporating_fe_2 <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    incorporating_z +
    blau2_z * incorporating_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby[moby$n_per_org_dev>=2,],
  index="org_dev",
  model="within"
)


incorporating_fe_5 <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    incorporating_z +
    blau2_z * incorporating_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby[moby$n_per_org_dev>=5,],
  index="org_dev",
  model="within"
)

incorporating_fe_10 <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    incorporating_z +
    blau2_z * incorporating_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby[moby$n_per_org_dev>=10,],
  index="org_dev",
  model="within"
)


#5. random effects for developer firm
incorporating_re <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    incorporating_z +
    blau2_z * incorporating_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby,
  index="org_dev",
  model="random"
)


#6. fixed effects model with dummies

org_dev_list <- table(moby$org_dev)
org_dev_list_repeats <- org_dev_list[org_dev_list>1]
org_dev_list_repeats_list <- as.numeric(names(org_dev_list_repeats))
org_dev_list_nonrepeats <- org_dev_list[org_dev_list==1]
org_dev_list_nonrepeats_list <- as.numeric(names(org_dev_list_nonrepeats))

delete_index <- match(org_dev_list_nonrepeats_list, moby$org_dev)

moby_repeat_devs <- moby[-delete_index,]

incorporating_fe_dummies <- lm(
  game_dist_prev5yr_z ~
    blau2_z +
    incorporating_z +
    blau2_z * incorporating_z +
    as.factor(org_dev) +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
  ,
  data = moby_repeat_devs
)



#7. developer firm level model
incorporating_aggr <- lm(
  game_dist_prev5yr ~
    blau2_z +
    incorporating_z +
    blau2_z * incorporating_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby_dev_firm_level
)


#8. developer firm level model, standardized
incorporating_aggr_z <- lm(
  game_dist_prev5yr_z ~
    blau2_z +
    incorporating_z +
    blau2_z * incorporating_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby_dev_firm_level
)


# Adjust standard errors
#1.1 basic model, robust SE
cov1         <- vcovHC(incorporating, type = "HC1")
incorporating_robust_se    <- sqrt(diag(cov1))

#1.2 basic model, clustered SE
cov1         <- vcovHC(incorporating, type = "HC1", cluster=moby$org_dev)
incorporating_clustered_se    <- sqrt(diag(cov1))

#2. basic model team size FE, robust SE
cov1         <- vcovHC(incorporating_teamfe, type = "HC1")
incorporating_teamfe_robust_se    <- sqrt(diag(cov1))

#3.1 standardized model, robust SE
cov1         <- vcovHC(incorporating_z, type = "HC1")
incorporating_z_robust_se    <- sqrt(diag(cov1))

#3.2 standardized model, clustered SE
cov1         <- vcovHC(incorporating_z, type = "HC1", cluster=moby$org_dev)
incorporating_z_clustered_se    <- sqrt(diag(cov1))

#4. fixed effects for developer firm, clustered SE
cov1         <- vcovHC(incorporating_fe_1, type = "HC1", cluster = "group")
incorporating_fe_1_clustered_se    <- sqrt(diag(cov1))

cov1         <- vcovHC(incorporating_fe_2, type = "HC1", cluster = "group")
incorporating_fe_2_clustered_se    <- sqrt(diag(cov1))

cov1         <- vcovHC(incorporating_fe_5, type = "HC1", cluster = "group")
incorporating_fe_5_clustered_se    <- sqrt(diag(cov1))

cov1         <- vcovHC(incorporating_fe_10, type = "HC1", cluster = "group")
incorporating_fe_10_clustered_se    <- sqrt(diag(cov1))

#5. random effects for developer firm, clsutered SE
cov1         <- vcovHC(incorporating_re, type = "HC1", cluster = "group")
incorporating_re_clustered_se    <- sqrt(diag(cov1))


#6. fixed effects model with dummies
cov1         <- vcovHC(incorporating_fe_dummies, type = "HC1", cluster=moby$org_dev)
incorporating_fe_dummies_clustered_se    <- sqrt(diag(cov1))

#7. developer firm level model, robust SE
cov1         <- vcovHC(incorporating_aggr, type = "HC1")
incorporating_aggr_robust_se    <- sqrt(diag(cov1))

#8. developer firm level model, standardized, robust SE
cov1         <- vcovHC(incorporating_aggr_z, type = "HC1")
incorporating_aggr_z_robust_se    <- sqrt(diag(cov1))


# Stargazer output
#1. basic model
stargazer(incorporating,incorporating,
          column.labels=c('Base, rob SE', 'Base, clus SE'),
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "incorporating*"), 
          se = list(incorporating_robust_se, incorporating_clustered_se),
          omit.stat = c("f", "ser")
          )

#2. basic model team size FE, robust SE
stargazer(incorporating_teamfe,
          column.labels='Base model team N FE',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "incorporating*"), 
          se = list(incorporating_teamfe_robust_se),
          omit.stat = c("f", "ser")
          )
#3. standardized model
stargazer(incorporating_z,incorporating_z,
          column.labels=c('Std, rob SE', 'Std, clus SE'),
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "incorporating*"), 
          se = list(incorporating_z_robust_se,incorporating_z_clustered_se),
          omit.stat = c("f", "ser")
          )


#4. fixed effects for developer firm, clustered SE
m1 <- incorporating_fe_1
m2 <- incorporating_fe_2
m3 <- incorporating_fe_5
m4 <- incorporating_fe_10

stargazer(m1,m2,m3,m4,
          column.labels=c('n>=1','n>=2', 'n>=5', 'n>=10'),
          dep.var.caption = "Dev firm FE, clus SE",
          type="text", 
          keep = c("blau*", "incorporating*"), 
          se = list(incorporating_fe_1_clustered_se, incorporating_fe_2_clustered_se, incorporating_fe_5_clustered_se, incorporating_fe_10_clustered_se),
          omit.stat = c("f", "ser")
          )

#5. random effects for developer firm, clustered SE
stargazer(incorporating_re,
          column.labels='Dev firm RE',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "incorporating*"), 
          se = list(incorporating_re_clustered_se),
          omit.stat = c("f", "ser")
          )

#6. fixed effects model with dummies
stargazer(incorporating_fe_dummies,
          column.labels='Dev firm FE dummies',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "incorporating*"), 
          se = list(incorporating_fe_dummies_clustered_se),
          omit.stat = c("f", "ser")
          )
#7. developer firm level model, robust SE
stargazer(incorporating_aggr,
          column.labels='Dev firm level',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "incorporating*"), 
          se = list(incorporating_aggr_robust_se),
          omit.stat = c("f", "ser")
          )
#8. developer firm level model, standardized, robust SE
stargazer(incorporating_aggr_z,
          column.labels='Dev firm level std',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "incorporating*"), 
          se = list(incorporating_aggr_z_robust_se),
          omit.stat = c("f", "ser")
          )
```

##Combined

```{r}
moby$combined <- moby$mixing_z*moby$bonding_z*moby$incorporating_z
moby_dev_firm_level$combined <- moby_dev_firm_level$mixing_z*moby_dev_firm_level$bonding_z*moby_dev_firm_level$incorporating_z

#standardized variables
moby$game_dist_prev5yr_z <- (moby$game_dist_prev5yr-min(moby$game_dist_prev5yr, na.rm=T))/sd(moby$game_dist_prev5yr)
moby$prop_women2_z <- (moby$prop_women2-min(moby$prop_women2, na.rm=T))/sd(moby$prop_women2)
moby$combined_z <- (moby$combined-min(moby$combined, na.rm=T))/sd(moby$combined)
moby$blau2_z <- (moby$blau2-min(moby$blau2, na.rm=T))/sd(moby$blau2)
moby$rank_avg_01_z <- (moby$rank_avg_01-min(moby$rank_avg_01, na.rm=T))/sd(moby$rank_avg_01)


moby_dev_firm_level$game_dist_prev5yr_z <- (moby_dev_firm_level$game_dist_prev5yr-min(moby_dev_firm_level$game_dist_prev5yr, na.rm=T))/sd(moby_dev_firm_level$game_dist_prev5yr)
moby_dev_firm_level$prop_women2_z <- (moby_dev_firm_level$prop_women2-min(moby_dev_firm_level$prop_women2, na.rm=T))/sd(moby_dev_firm_level$prop_women2)
moby_dev_firm_level$combined_z <- (moby_dev_firm_level$combined-min(moby_dev_firm_level$combined, na.rm=T))/sd(moby_dev_firm_level$combined)
moby_dev_firm_level$blau2_z <- (moby_dev_firm_level$blau2-min(moby_dev_firm_level$blau2, na.rm=T))/sd(moby_dev_firm_level$blau2)

#1. basic model
combined <- lm(
  game_dist_prev5yr ~
    blau2 +
    combined +
    blau2 * combined +
    N +
    #as.factor(N_quantiles) + 
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby
)


#2. basic model team size FE
combined_teamfe <- lm(
  game_dist_prev5yr ~
    blau2 +
    combined +
    blau2 * combined +
    #N +
    as.factor(N_quantiles) +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby
)

#3. standardized model
combined_z <- lm(
  game_dist_prev5yr_z ~
    blau2_z +
    combined_z +
    blau2_z * combined_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby
)


#4. fixed effects for developer firm
combined_fe_1 <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    combined_z +
    blau2_z * combined_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby[moby$n_per_org_dev>=1,],
  index="org_dev",
  model="within"
)

combined_fe_2 <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    combined_z +
    blau2_z * combined_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby[moby$n_per_org_dev>=2,],
  index="org_dev",
  model="within"
)


combined_fe_5 <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    combined_z +
    blau2_z * combined_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby[moby$n_per_org_dev>=5,],
  index="org_dev",
  model="within"
)

combined_fe_10 <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    combined_z +
    blau2_z * combined_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby[moby$n_per_org_dev>=10,],
  index="org_dev",
  model="within"
)


#5. random effects for developer firm
combined_re <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    combined_z +
    blau2_z * combined_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby,
  index="org_dev",
  model="random"
)


#6. fixed effects model with dummies

org_dev_list <- table(moby$org_dev)
org_dev_list_repeats <- org_dev_list[org_dev_list>1]
org_dev_list_repeats_list <- as.numeric(names(org_dev_list_repeats))
org_dev_list_nonrepeats <- org_dev_list[org_dev_list==1]
org_dev_list_nonrepeats_list <- as.numeric(names(org_dev_list_nonrepeats))

delete_index <- match(org_dev_list_nonrepeats_list, moby$org_dev)

moby_repeat_devs <- moby[-delete_index,]

combined_fe_dummies <- lm(
  game_dist_prev5yr_z ~
    blau2_z +
    combined_z +
    blau2_z * combined_z +
    as.factor(org_dev) +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
  ,
  data = moby_repeat_devs
)



#7. developer firm level model
combined_aggr <- lm(
  game_dist_prev5yr ~
    blau2_z +
    combined_z +
    blau2_z * combined_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby_dev_firm_level
)


#8. developer firm level model, standardized
combined_aggr_z <- lm(
  game_dist_prev5yr_z ~
    blau2_z +
    combined_z +
    blau2_z * combined_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby_dev_firm_level
)


# Adjust standard errors
#1.1 basic model, robust SE
cov1         <- vcovHC(combined, type = "HC1")
combined_robust_se    <- sqrt(diag(cov1))

#1.2 basic model, clustered SE
cov1         <- vcovHC(combined, type = "HC1", cluster=moby$org_dev)
combined_clustered_se    <- sqrt(diag(cov1))

#2. basic model team size FE, robust SE
cov1         <- vcovHC(combined_teamfe, type = "HC1")
combined_teamfe_robust_se    <- sqrt(diag(cov1))

#3.1 standardized model, robust SE
cov1         <- vcovHC(combined_z, type = "HC1")
combined_z_robust_se    <- sqrt(diag(cov1))

#3.2 standardized model, clustered SE
cov1         <- vcovHC(combined_z, type = "HC1", cluster=moby$org_dev)
combined_z_clustered_se    <- sqrt(diag(cov1))

#4. fixed effects for developer firm, clustered SE
cov1         <- vcovHC(combined_fe_1, type = "HC1", cluster = "group")
combined_fe_1_clustered_se    <- sqrt(diag(cov1))

cov1         <- vcovHC(combined_fe_2, type = "HC1", cluster = "group")
combined_fe_2_clustered_se    <- sqrt(diag(cov1))

cov1         <- vcovHC(combined_fe_5, type = "HC1", cluster = "group")
combined_fe_5_clustered_se    <- sqrt(diag(cov1))

cov1         <- vcovHC(combined_fe_10, type = "HC1", cluster = "group")
combined_fe_10_clustered_se    <- sqrt(diag(cov1))

#5. random effects for developer firm, clsutered SE
cov1         <- vcovHC(combined_re, type = "HC1", cluster = "group")
combined_re_clustered_se    <- sqrt(diag(cov1))


#6. fixed effects model with dummies
cov1         <- vcovHC(combined_fe_dummies, type = "HC1", cluster=moby$org_dev)
combined_fe_dummies_clustered_se    <- sqrt(diag(cov1))

#7. developer firm level model, robust SE
cov1         <- vcovHC(combined_aggr, type = "HC1")
combined_aggr_robust_se    <- sqrt(diag(cov1))

#8. developer firm level model, standardized, robust SE
cov1         <- vcovHC(combined_aggr_z, type = "HC1")
combined_aggr_z_robust_se    <- sqrt(diag(cov1))


# Stargazer output
#1. basic model
stargazer(combined,combined,
          column.labels=c('Base, rob SE', 'Base, clus SE'),
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "combined*"), 
          se = list(combined_robust_se, combined_clustered_se),
          omit.stat = c("f", "ser")
          )

#2. basic model team size FE, robust SE
stargazer(combined_teamfe,
          column.labels='Base model team N FE',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "combined*"), 
          se = list(combined_teamfe_robust_se),
          omit.stat = c("f", "ser")
          )
#3. standardized model
stargazer(combined_z,combined_z,
          column.labels=c('Std, rob SE', 'Std, clus SE'),
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "combined*"), 
          se = list(combined_z_robust_se,combined_z_clustered_se),
          omit.stat = c("f", "ser")
          )


#4. fixed effects for developer firm, clustered SE
m1 <- combined_fe_1
m2 <- combined_fe_2
m3 <- combined_fe_5
m4 <- combined_fe_10

stargazer(m1,m2,m3,m4,
          column.labels=c('n>=1','n>=2', 'n>=5', 'n>=10'),
          dep.var.caption = "Dev firm FE, clus SE",
          type="text", 
          keep = c("blau*", "combined*"), 
          se = list(combined_fe_1_clustered_se, combined_fe_2_clustered_se, combined_fe_5_clustered_se, combined_fe_10_clustered_se),
          omit.stat = c("f", "ser")
          )

#5. random effects for developer firm, clustered SE
stargazer(combined_re,
          column.labels='Dev firm RE',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "combined*"), 
          se = list(combined_re_clustered_se),
          omit.stat = c("f", "ser")
          )

#6. fixed effects model with dummies
stargazer(combined_fe_dummies,
          column.labels='Dev firm FE dummies',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "combined*"), 
          se = list(combined_fe_dummies_clustered_se),
          omit.stat = c("f", "ser")
          )
#7. developer firm level model, robust SE
stargazer(combined_aggr,
          column.labels='Dev firm level',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "combined*"), 
          se = list(combined_aggr_robust_se),
          omit.stat = c("f", "ser")
          )
#8. developer firm level model, standardized, robust SE
stargazer(combined_aggr_z,
          column.labels='Dev firm level std',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "combined*"), 
          se = list(combined_aggr_z_robust_se),
          omit.stat = c("f", "ser")
          )
```

```{r, message=FALSE, warning = FALSE}
#developer firm level aggregation
moby_dev_firm_level <- aggregate(moby, list(dev_firm = moby$org_dev), mean)
```





###Models Predicting Success (Review Score)

Distinctiveness predicts review score differently by diversity
Using Blau diversity
```{r}

 dist_div <-  lm(
    rank_avg_01_z ~
      
      blau2_z +
      N +
      newbies_prop +
      games_tenure +
      star_prior +
      hold_single_firm +
      ratio_core_z +
      num_countries +
      plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
      year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
    data = moby[moby$rank_avg > 30, ]
  ) 

  dist_review <-  lm(
    rank_avg_01_z ~
      game_dist_prev5yr_z +
      
      N +
      newbies_prop +
      games_tenure +
      star_prior +
      hold_single_firm +
      ratio_core_z +
      num_countries +
      plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
      year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
    data = moby[moby$rank_avg > 30, ]
  )


 dist_review_by_div <-  lm(
    rank_avg_01_z ~
      game_dist_prev5yr_z +
      blau2_z +
      
      N +
      newbies_prop +
      games_tenure +
      star_prior +
      hold_single_firm +
      ratio_core_z +
      num_countries +
      plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
      year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
    data = moby[moby$rank_avg > 30, ]
  )
 
  dist_review_by_div_int <-  lm(
    rank_avg_01_z ~
      game_dist_prev5yr_z +
      blau2_z * game_dist_prev5yr_z +
      
      N +
      newbies_prop +
      games_tenure +
      star_prior +
      hold_single_firm +
      ratio_core_z +
      num_countries +
      plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
      year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
    data = moby[moby$rank_avg > 30, ]
  )
 


  
# Adjust standard errors
cov1         <- vcovHC(dist_div, type = "HC1")
dist_div_robust_se    <- sqrt(diag(cov1))

cov1         <- vcovHC(dist_div, type = "HC1", cluster=moby$org_dev)
dist_div_clustered_se    <- sqrt(diag(cov1))  

cov1         <- vcovHC(dist_review, type = "HC1")
dist_review_robust_se    <- sqrt(diag(cov1))

cov1         <- vcovHC(dist_review, type = "HC1", cluster=moby$org_dev)
dist_review_clustered_se    <- sqrt(diag(cov1)) 

cov1         <- vcovHC(dist_review_by_div, type = "HC1")
dist_review_by_div_robust_se    <- sqrt(diag(cov1))

cov1         <- vcovHC(dist_review_by_div, type = "HC1", cluster=moby$org_dev)
dist_review_by_div_clustered_se    <- sqrt(diag(cov1)) 

cov1         <- vcovHC(dist_review_by_div_int, type = "HC1")
dist_review_by_div_int_robust_se    <- sqrt(diag(cov1))

cov1         <- vcovHC(dist_review_by_div_int, type = "HC1", cluster=moby$org_dev)
dist_review_by_div_int_clustered_se    <- sqrt(diag(cov1))   
  
 
m0 <- dist_div
m1 <- dist_review
m2 <- dist_review_by_div
m3 <- dist_review_by_div_int
  
stargazer(m0,m1,m2,m3,
          #column.labels=c('Std, clus SE','Std, clus SE','Std, clus SE','Std, clus SE'),
          model.numbers = T,
          dep.var.labels = "Review Score (std)",
          type="text", 
          keep = c("*onst*", "game_dist_*", "blau*"),
          add.lines=list(c("Controls added", "Yes", "Yes", "Yes", "Yes")),
          order=c( "^game_dist_prev5yr_z$", "^blau2_z$","^game_dist_prev5yr_z:blau2_z$", "Constant"),
          table.layout = "=ldc-ta-s=n",
          se = list(dist_div_clustered_se, dist_review_clustered_se, dist_review_by_div_clustered_se, dist_review_by_div_int_clustered_se ),
          omit.stat = c("f", "ser")
          )

```

Distinctiveness predicts review score differently by diversity
Using Proportion of female
```{r}

 dist_div <-  lm(
    rank_avg_01_z ~
      
      prop_women2_z +
      N +
      newbies_prop +
      games_tenure +
      star_prior +
      hold_single_firm +
      ratio_core_z +
      num_countries +
      plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
      year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
    data = moby[moby$rank_avg > 30, ]
  ) 

  dist_review <-  lm(
    rank_avg_01_z ~
      game_dist_prev5yr_z +
      
      N +
      newbies_prop +
      games_tenure +
      star_prior +
      hold_single_firm +
      ratio_core_z +
      num_countries +
      plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
      year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
    data = moby[moby$rank_avg > 30, ]
  )


 dist_review_by_div <-  lm(
    rank_avg_01_z ~
      game_dist_prev5yr_z +
      prop_women2_z +
      
      N +
      newbies_prop +
      games_tenure +
      star_prior +
      hold_single_firm +
      ratio_core_z +
      num_countries +
      plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
      year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
    data = moby[moby$rank_avg > 30, ]
  )
 
  dist_review_by_div_int <-  lm(
    rank_avg_01_z ~
      game_dist_prev5yr_z +
      prop_women2_z * game_dist_prev5yr_z +
      
      N +
      newbies_prop +
      games_tenure +
      star_prior +
      hold_single_firm +
      ratio_core_z +
      num_countries +
      plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
      year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
    data = moby[moby$rank_avg > 30, ]
  )
 


  
# Adjust standard errors
cov1         <- vcovHC(dist_div, type = "HC1")
dist_div_robust_se    <- sqrt(diag(cov1))

cov1         <- vcovHC(dist_div, type = "HC1", cluster=moby$org_dev)
dist_div_clustered_se    <- sqrt(diag(cov1))  

cov1         <- vcovHC(dist_review, type = "HC1")
dist_review_robust_se    <- sqrt(diag(cov1))

cov1         <- vcovHC(dist_review, type = "HC1", cluster=moby$org_dev)
dist_review_clustered_se    <- sqrt(diag(cov1)) 

cov1         <- vcovHC(dist_review_by_div, type = "HC1")
dist_review_by_div_robust_se    <- sqrt(diag(cov1))

cov1         <- vcovHC(dist_review_by_div, type = "HC1", cluster=moby$org_dev)
dist_review_by_div_clustered_se    <- sqrt(diag(cov1)) 

cov1         <- vcovHC(dist_review_by_div_int, type = "HC1")
dist_review_by_div_int_robust_se    <- sqrt(diag(cov1))

cov1         <- vcovHC(dist_review_by_div_int, type = "HC1", cluster=moby$org_dev)
dist_review_by_div_int_clustered_se    <- sqrt(diag(cov1))   
  
 
m0 <- dist_div
m1 <- dist_review
m2 <- dist_review_by_div
m3 <- dist_review_by_div_int
  
stargazer(m0,m1,m2,m3,
          #column.labels=c('Std, clus SE','Std, clus SE','Std, clus SE','Std, clus SE'),
          model.numbers = T,
          dep.var.labels = "Review Score (std)",
          type="text", 
          keep = c("*onst*", "game_dist_*", "prop_w*"),
          add.lines=list(c("Controls added", "Yes", "Yes", "Yes", "Yes")),
          order=c( "^game_dist_prev5yr_z$", "^prop_women2_z$","^game_dist_prev5yr_z:prop_women2_z$", "Constant"),
          table.layout = "=ldc-ta-s=n",
          se = list(dist_div_clustered_se, dist_review_clustered_se, dist_review_by_div_clustered_se, dist_review_by_div_int_clustered_se ),
          omit.stat = c("f", "ser")
          )
```






Distinctiveness predicts review score differently by diversity
Using Blau and Combined Inclusion
```{r}


 dist_div_inc_sm <-  lm(
    rank_avg ~
      
      blau2+
      combined +
      blau2*combined
    ,
    data = moby[moby$rank_avg > 30, ]
  )

 dist_review_by_div_inc_sm <-  lm(
    rank_avg ~
      game_dist_prev5yr +
      blau2+
      combined +
      blau2*combined +
      blau2*combined  * game_dist_prev5yr 
    ,
    data = moby[moby$rank_avg > 30, ]
  )

 dist_review_by_div_inc <-  lm(
    rank_avg ~
      game_dist_prev5yr +
      blau2+
      combined +
      blau2*combined +
      blau2*combined  * game_dist_prev5yr +
      
      N +
      newbies_prop +
      games_tenure +
      star_prior +
      hold_single_firm +
      ratio_core_z +
      num_countries +
      plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
      year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
    data = moby[moby$rank_avg > 30, ]
  )
 
  dist_div_inc <-  lm(
    rank_avg ~
      blau2+
      combined +
      blau2*combined +
      
      N +
      newbies_prop +
      games_tenure +
      star_prior +
      hold_single_firm +
      ratio_core_z +
      num_countries +
      plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
      year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
    data = moby[moby$rank_avg > 30, ]
  )
 
  dist_review_sm <-  lm(
    rank_avg ~
      game_dist_prev5yr 
    ,
    data = moby[moby$rank_avg > 30, ]
  )
  
    dist_review <-  lm(
    rank_avg ~
      game_dist_prev5yr +
      
      N +
      newbies_prop +
      games_tenure +
      star_prior +
      hold_single_firm +
      ratio_core_z +
      num_countries +
      plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
      year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
    data = moby[moby$rank_avg > 30, ]
  )

 


m0 <- dist_div_inc
m1 <- dist_review
m2 <- dist_review_by_div_inc_sm
m3 <- dist_review_by_div_inc
  
stargazer(m0,m1,m2,m3,
          #column.labels='Dev firm level std',
          #dep.var.caption = "",
          type="text", 
          keep = c("*onst*", "game_dist_*", "blau*", "combin*"),
          add.lines=list(c("Controls added", "Yes", "Yes","No", "Yes")),
          table.layout = "=ldc-ta-s=n",
          order=c( "^blau2$","^combined$","^blau2:combined$", "^game_dist_prev5yr$","^game_dist_prev5yr:blau2$","^game_dist_prev5yr:combined$","^game_dist_prev5yr:blau2:combined$", "Constant")
          #se = list(NULL, without_inclusion_aggr_z_robust_se),
          #omit.stat = c("f", "ser")
          )


```



###Predictions and Marginsplots
Synthetic data file for interaction of two variables, with Robust SE (without fixed effects dummies factor)
```{r}
create_synt <- function(model_object, data_file, cluster_attrib=NULL) {
  # this is a function that creates synthetic data
  
  var_names <- names(model_object$coefficients)
  #delete intercept
  var_sel <- grepl("ntercept", var_names) #small and big i
  var_names <- var_names[!var_sel]
  #delete squared term
  var_sel <- grepl("2)", var_names)
  var_names <- var_names[!var_sel]

  #save interaction
  var_sel <- grepl(":", var_names)
  var_inter_names <- var_names[var_sel]
  
  var_inter_names <- unique(unlist(strsplit(var_inter_names, "[:]")))
  
  #delete interactions
  var_sel <- grepl(":", var_names)
  var_names <- var_names[!var_sel]
  
  #delete variables involved in interactions
  for (i in 1:length(var_inter_names)){
  var_names <- var_names[var_names!=var_inter_names[i]]
  }
  
  #results
  cbind(var_inter_names)
  cbind(var_names)
  
  #min and max values for interaction variables
  inter_min_vec <- array(0, dim=c(1,length(var_inter_names)))
  
  for (v in 1:length(var_inter_names)){
    inter_min_vec[v] <- min(as.numeric(unlist(data_file[var_inter_names[v]])), na.rm=TRUE)
  }
  
  inter_max_vec <- array(0, dim=c(1,length(var_inter_names)))
  
  for (v in 1:length(var_inter_names)){
    inter_max_vec[v] <- max(as.numeric(unlist(data_file[var_inter_names[v]])), na.rm=TRUE)
  }


  #interaction grid settings
  var1_from <- inter_min_vec[1]
  var1_to   <- inter_max_vec[1]
  var1_step <- (inter_max_vec[1]-inter_min_vec[1])/100
  
  #var1_from <- 0
  #var1_to   <- 1
  #var1_step <- 0.01
  
  var2_from <- inter_min_vec[2]
  var2_to   <- inter_max_vec[2]
  var2_step <- (inter_max_vec[2]-inter_min_vec[2])/100
  
  
  #number of variables and interactions
  n_inter_vars <- length(var_inter_names)
  n_vars <- length(var_names)
  
  #interaction combination
  inter_grid <- expand.grid(
                       seq(from = var1_from, to = var1_to, by = var1_step),
                       seq(from = var2_from, to = var2_to, by = var2_step)
                       )
  
  #fixing controls at the mean
  means_vec <- array(0, dim=c(1,n_vars))
  
  for (v in 1:n_vars){
    means_vec[v] <- mean(as.numeric(unlist(data_file[var_names[v]])), na.rm=TRUE)
  }
  
  #assembling the synthetic datafile
  n_rows <- dim(inter_grid)[1]
  means_grid <- matrix(means_vec,nrow=n_rows,ncol=length(means_vec),byrow=TRUE)
  
  syn_data <- data.frame(cbind(inter_grid, means_grid))
  names(syn_data) <- c(var_inter_names,var_names)
  
  #with clustered SE or robust SE
  #--if clustering attribute is added, clustered SE is computed, otherwise robust SE
  if(is.null(cluster_attrib)) {
      predvals <- predict(model_object, newdata=syn_data, se.fit = TRUE, vcov.fun = "vcovHC", vcov.type = "HC1")
  }
    if(!is.null(cluster_attrib)) {
      predvals <- predict(model_object, newdata=syn_data, se.fit = TRUE, vcov.fun = "vcovHC", vcov.type = "HC1", cluster=cluster_attrib)
  }

  
 
  
  #withour robust SE it would be:
  #predvals <- predict(model_object, newdata=syn_data, se.fit = TRUE)

  
  syn_data$ols_pred <- predvals$fit
  syn_data$ols_low <- (predvals$fit - 1.96 * predvals$se.fit)
  syn_data$ols_up <- (predvals$fit + 1.96 * predvals$se.fit)
  
  return(syn_data)
  }
```


```{r}
create_synt_one_var <-
  function(model_object,
           var,
           min,
           max,
           data_file,
           cluster_attrib = NULL) {
    # this is a function that creates synthetic data
    
    var_names <- names(model_object$coefficients)
    #delete intercept
    var_sel <- grepl("ntercept", var_names) #small and big i
    var_names <- var_names[!var_sel]
    #delete squared term
    var_sel <- grepl("2)", var_names)
    var_names <- var_names[!var_sel]
    
    #save selected variable
    var_sel <- var_names == var
    var_focal_name <- var_names[var_sel]
    
    #delete selected variable
    var_names <- var_names[!var_sel]
    
    #results
    cbind(var_focal_name)
    cbind(var_names)
    n_vars <- length(var_names)
    
    #min and max values for interaction variables
    if (is.na(min)) {
      var_focal_min <-
        min(as.numeric(unlist(data_file[var_focal_name])), na.rm = TRUE)
    } else{
      var_focal_min <- min
    }
    
    if (is.na(max)) {
      var_focal_max <-
        max(as.numeric(unlist(data_file[var_focal_name])), na.rm = TRUE)
    } else{
      var_focal_max <- max
    }
    
    
    var_focal_step <- (var_focal_max - var_focal_min) / 100
    
    #interaction combination
    inter_grid <- expand.grid(seq(from = var_focal_min, to = var_focal_max, by = var_focal_step))
    
    #fixing controls at the mean
    means_vec <- array(0, dim = c(1, n_vars))
    
    for (v in 1:n_vars) {
      means_vec[v] <-
        mean(as.numeric(unlist(data_file[var_names[v]])), na.rm = TRUE)
    }
    
    #assembling the synthetic datafile
    n_rows <- dim(inter_grid)[1]
    means_grid <-
      matrix(
        means_vec,
        nrow = n_rows,
        ncol = length(means_vec),
        byrow = TRUE
      )
    
    syn_data <- data.frame(cbind(inter_grid, means_grid))
    names(syn_data) <- c(var_focal_name, var_names)
    
    #with clustered SE or robust SE
    #--if clustering attribute is added, clustered SE is computed, otherwise robust SE
    if (is.null(cluster_attrib)) {
      predvals <-
        predict(
          model_object,
          newdata = syn_data,
          se.fit = TRUE,
          vcov.fun = "vcovHC",
          vcov.type = "HC1"
        )
    }
    if (!is.null(cluster_attrib)) {
      predvals <-
        predict(
          model_object,
          newdata = syn_data,
          se.fit = TRUE,
          vcov.fun = "vcovHC",
          vcov.type = "HC1",
          cluster = cluster_attrib
        )
    }
    
    #withour robust SE
    #predvals <- predict(model_object, newdata=syn_data, se.fit = TRUE)
    
    
    syn_data$ols_pred <- predvals$fit
    syn_data$ols_low <- (predvals$fit - 1.96 * predvals$se.fit)
    syn_data$ols_up <- (predvals$fit + 1.96 * predvals$se.fit)
    
    return(syn_data)
  }
```

Synthetic data file with fixed effects dummies factor
```{r}
create_synt_factor <-
  function(model_object, data_file, cluster_attrib = NULL) {
    # this is a function that creates synthetic data when there is a fixed effect factor
    
    # this is a function that creates synthetic data
    var_names <- names(model_object$coefficients)
    #delete intercept
    var_sel <- grepl("ntercept", var_names) #small and big i
    var_names <- var_names[!var_sel]
    #delete squared term
    var_sel <- grepl("2)", var_names)
    var_names <- var_names[!var_sel]
    
    #save interaction
    var_sel <- grepl(":", var_names)
    var_inter_names <- var_names[var_sel]
    
    var_inter_names <-
      unique(unlist(strsplit(var_inter_names, "[:]")))
    
    #delete interactions
    var_sel <- grepl(":", var_names)
    var_names <- var_names[!var_sel]
    
    #delete variables involved in interactions
    for (i in 1:length(var_inter_names)) {
      var_names <- var_names[var_names != var_inter_names[i]]
    }
    
    #identify factor
    var_sel <- grepl("as.factor*", var_names)
    var_factor_coefs <- var_names[var_sel]
    var_factor <-
      sub("\\).*", "", sub(".*\\(", "", var_factor_coefs))[1]
    
    #get the first factor level
    pos_start <-
      which(strsplit(var_factor_coefs[1], "")[[1]] == ")") + 1
    pos_end <- nchar(var_factor_coefs[1])
    var_factor_level <-
      as.numeric(substr(var_factor_coefs[1], pos_start, pos_end))
    
    #remove factors from variable list
    var_names <- var_names[!var_sel]
    
    #results
    cbind(var_inter_names)
    cbind(var_names)
    
    #min and max values for interaction variables
    inter_min_vec <- array(0, dim = c(1, length(var_inter_names)))
    
    for (v in 1:length(var_inter_names)) {
      inter_min_vec[v] <-
        min(as.numeric(unlist(data_file[var_inter_names[v]])), na.rm = TRUE)
    }
    
    inter_max_vec <- array(0, dim = c(1, length(var_inter_names)))
    
    for (v in 1:length(var_inter_names)) {
      inter_max_vec[v] <-
        max(as.numeric(unlist(data_file[var_inter_names[v]])), na.rm = TRUE)
    }
    
    
    #interaction grid settings
    var1_from <- inter_min_vec[1]
    var1_to   <- inter_max_vec[1]
    var1_step <- (inter_max_vec[1] - inter_min_vec[1]) / 100
    
    #var1_from <- 0
    #var1_to   <- 1
    #var1_step <- 0.01
    
    var2_from <- inter_min_vec[2]
    var2_to   <- inter_max_vec[2]
    var2_step <- (inter_max_vec[2] - inter_min_vec[2]) / 100
    
    
    #number of variables and interactions
    n_inter_vars <- length(var_inter_names)
    n_vars <- length(var_names)
    
    #interaction combination
    inter_grid <- expand.grid(
      seq(from = var1_from, to = var1_to, by = var1_step),
      seq(from = var2_from, to = var2_to, by = var2_step)
    )
    
    #fixing controls at the mean
    means_vec <- array(0, dim = c(1, n_vars))
    
    for (v in 1:n_vars) {
      means_vec[v] <-
        mean(as.numeric(unlist(data_file[var_names[v]])), na.rm = TRUE)
    }
    
    means_vec <- c(means_vec, var_factor_level)
    #assembling the synthetic datafile
    n_rows <- dim(inter_grid)[1]
    means_grid <-
      matrix(
        means_vec,
        nrow = n_rows,
        ncol = length(means_vec),
        byrow = TRUE
      )
    
    syn_data <- data.frame(cbind(inter_grid, means_grid))
    names(syn_data) <- c(var_inter_names, var_names, var_factor)
    
    #with clustered SE or robust SE
    #--if clustering attribute is added, clustered SE is computed, otherwise robust SE
    if (is.null(cluster_attrib)) {
      predvals <-
        predict(
          model_object,
          newdata = syn_data,
          se.fit = TRUE,
          vcov.fun = "vcovHC",
          vcov.type = "HC1"
        )
    }
    if (!is.null(cluster_attrib)) {
      predvals <-
        predict(
          model_object,
          newdata = syn_data,
          se.fit = TRUE,
          vcov.fun = "vcovHC",
          vcov.type = "HC1",
          cluster = cluster_attrib
        )
    }
    
    #withour robust SE it would be
    #predvals <- predict(model_object, newdata=syn_data, se.fit = TRUE)
    
    
    syn_data$ols_pred <- predvals$fit
    syn_data$ols_low <- (predvals$fit - 1.96 * predvals$se.fit)
    syn_data$ols_up <- (predvals$fit + 1.96 * predvals$se.fit)
    
    return(syn_data)
  }
```

Synthetic data file with fixed effects dummies factor and fixed slopes
```{r}
create_synt_factor_slopes <- function(model_object, model_object2, data_file) {
  # this is a function that creates synthetic data when there is a fixed effect factor

  # this is a function that creates synthetic data
  var_names <- names(model_object$coefficients)
  #delete intercept
  var_sel <- grepl("ntercept", var_names) #small and big i
  var_names <- var_names[!var_sel]
  #delete squared term
  var_sel <- grepl("2)", var_names)
  var_names <- var_names[!var_sel]

  #save interaction
  var_sel <- grepl(":", var_names)
  var_inter_names <- var_names[var_sel]
  
  var_inter_names <- unique(unlist(strsplit(var_inter_names, "[:]")))
  
  #delete interactions
  var_sel <- grepl(":", var_names)
  var_names <- var_names[!var_sel]
  
  #delete variables involved in interactions
  for (i in 1:length(var_inter_names)){
  var_names <- var_names[var_names!=var_inter_names[i]]
  }
  
  #identify factor
  var_sel <- grepl("as.factor*", var_names)
  var_factor_coefs <- var_names[var_sel]
  var_factor <- sub("\\).*", "", sub(".*\\(", "", var_factor_coefs))[1]

  #get the first factor level
  pos_start <- which(strsplit(var_factor_coefs[1], "")[[1]] == ")")+1
  pos_end <- nchar(var_factor_coefs[1])
  var_factor_level <- as.numeric(substr(var_factor_coefs[1], pos_start, pos_end))
  
  #remove factors from variable list
  var_names <- var_names[!var_sel]
  
  #results
  cbind(var_inter_names)
  cbind(var_names)
  
  #min and max values for interaction variables
  inter_min_vec <- array(0, dim=c(1,length(var_inter_names)))
  
  for (v in 1:length(var_inter_names)){
    inter_min_vec[v] <- min(as.numeric(unlist(data_file[var_inter_names[v]])), na.rm=TRUE)
  }
  
  inter_max_vec <- array(0, dim=c(1,length(var_inter_names)))
  
  for (v in 1:length(var_inter_names)){
    inter_max_vec[v] <- max(as.numeric(unlist(data_file[var_inter_names[v]])), na.rm=TRUE)
  }


  #interaction grid settings
  var1_from <- inter_min_vec[1]
  var1_to   <- inter_max_vec[1]
  var1_step <- (inter_max_vec[1]-inter_min_vec[1])/100
  
  #var1_from <- 0
  #var1_to   <- 1
  #var1_step <- 0.01
  
  var2_from <- inter_min_vec[2]
  var2_to   <- inter_max_vec[2]
  var2_step <- (inter_max_vec[2]-inter_min_vec[2])/100
  
  
  #number of variables and interactions
  n_inter_vars <- length(var_inter_names)
  n_vars <- length(var_names)
  
  #interaction combination
  inter_grid <- expand.grid(
                       seq(from = var1_from, to = var1_to, by = var1_step),
                       seq(from = var2_from, to = var2_to, by = var2_step)
                       )
  
  #fixing controls at the mean
  means_vec <- array(0, dim=c(1,n_vars))
  
  for (v in 1:n_vars){
    means_vec[v] <- mean(as.numeric(unlist(data_file[var_names[v]])), na.rm=TRUE)
  }
  
  means_vec <- c(means_vec, var_factor_level)
  #assembling the synthetic datafile
  n_rows <- dim(inter_grid)[1]
  means_grid <- matrix(means_vec,nrow=n_rows,ncol=length(means_vec),byrow=TRUE)
  
  syn_data <- data.frame(cbind(inter_grid, means_grid))
  names(syn_data) <- c(var_inter_names,var_names, var_factor)
  #with robust SE
  predvals <- predict(model_object2, newdata=syn_data, se.fit = TRUE, vcov.fun = "vcovHC", vcov.type = "HC3")
  #withour robust SE
  #predvals <- predict(model_object, newdata=syn_data, se.fit = TRUE)

  
  syn_data$ols_pred <- predvals$fit
  syn_data$ols_low <- (predvals$fit - 1.96 * predvals$se.fit)
  syn_data$ols_up <- (predvals$fit + 1.96 * predvals$se.fit)
  
  return(syn_data)
  }
```

```{r}
min(moby$mixing, na.rm = T)
max(moby$mixing, na.rm = T)
min(moby$bonding, na.rm = T)
max(moby$bonding, na.rm = T)
min(moby$incorporating, na.rm = T)
max(moby$incorporating, na.rm = T)
```



```{r}
syn_data_baseline_dist<-create_synt_one_var(without_inclusion,"blau2",0,1,moby, moby$org_dev)

syn_data_mixing<-create_synt(mixing,moby, moby$org_dev)
syn_data_bonding<-create_synt(bonding,moby, moby$org_dev)
syn_data_incorporating<-create_synt(incorporating,moby, moby$org_dev)
syn_data_combined<-create_synt(combined,moby, moby$org_dev)
syn_data_combined_z<-create_synt(combined_z,moby, moby$org_dev)

syn_data_mixing_fe<-create_synt_factor(mixing_fe_dummies,moby_repeat_devs, moby$org_dev)
syn_data_bonding_fe<-create_synt_factor(bonding_fe_dummies,moby_repeat_devs, moby$org_dev)
syn_data_incorporating_fe<-create_synt_factor(incorporating_fe_dummies,moby_repeat_devs, moby$org_dev)
syn_data_combined_fe<-create_synt_factor(combined_fe_dummies,moby_repeat_devs, moby$org_dev)

syn_data_mixing_aggr<-create_synt(mixing_aggr,moby_dev_firm_level)
syn_data_bonding_aggr<-create_synt(bonding_aggr,moby_dev_firm_level)
syn_data_incorporating_aggr<-create_synt(incorporating_aggr,moby_dev_firm_level)
syn_data_combined_aggr<-create_synt(combined_aggr,moby_dev_firm_level)
```

```{r}
hist(syn_data_combined$ols_pred)
```

# save syn_data out

```{r}
write.csv(syn_data_mixing, "synt_data_mixing_blau.csv")
write.csv(syn_data_bonding, "synt_data_bonding_blau.csv") 
write.csv(syn_data_incorporating, "synt_data_incorporating_blau.csv") 
write.csv(syn_data_combined, "synt_data_combined_blau.csv") 

write.csv(syn_data_mixing_aggr, "synt_data_mixing_aggr_blau.csv")
write.csv(syn_data_bonding_aggr, "synt_data_bonding_aggr_blau.csv") 
write.csv(syn_data_incorporating_aggr, "synt_data_incorporating_aggr_blau.csv") 
write.csv(syn_data_combined_aggr, "synt_data_combined_aggr_blau.csv") 
```


Margins plot - diversity for distinctiveness

```{r, fig.width = 2.5, fig.height = 2.5}
theme_set(theme_bw())

dropLeadingZero <- function(l){
  str_replace(l, '0(?=.)', '')
}

mean_diversity <- mean(moby$blau2)
min_diversity <- round(min(moby$blau2),2)
max_diversity <- round(max(moby$blau2),2)
sd_diversity <- sd(moby$blau2)
q1_diversity <- quantile(moby$blau2, probs = 0.25)
q3_diversity <- quantile(moby$blau2, probs = 0.75)

hi_color = "#b4de75"
lo_color = "#69629a"

x_range_filter=syn_data_baseline_dist$blau2<=max_diversity & syn_data_baseline_dist$blau2>=min_diversity


syn_data_mixing_min <- min(syn_data_mixing$ols_low)
syn_data_mixing_max <- max(syn_data_mixing$ols_up)
syn_data_mixing_min_inclusion <- min(syn_data_mixing$mixing)
syn_data_mixing_max_inclusion <- max(syn_data_mixing$mixing)

syn_data_bonding_min <- min(syn_data_bonding$ols_low)
syn_data_bonding_max <- max(syn_data_bonding$ols_up)
syn_data_bonding_min_inclusion <- min(syn_data_bonding$bonding)
syn_data_bonding_max_inclusion <- max(syn_data_bonding$bonding)

syn_data_incorporating_min <- min(syn_data_incorporating$ols_low)
syn_data_incorporating_max <- max(syn_data_incorporating$ols_up)
syn_data_incorporating_min_inclusion <- min(syn_data_incorporating$incorporating)
syn_data_incorporating_max_inclusion <- max(syn_data_incorporating$incorporating)

syn_data_combined_min <- min(syn_data_combined$ols_low)
syn_data_combined_max <- max(syn_data_combined$ols_up)
syn_data_combined_min_inclusion <- min(syn_data_combined$combined)
syn_data_combined_max_inclusion <- max(syn_data_combined$combined)

global_y_max <- max(c(syn_data_mixing_max, syn_data_bonding_max, syn_data_incorporating_max, syn_data_combined_max))
global_y_min <- min(c(syn_data_mixing_min, syn_data_bonding_min, syn_data_incorporating_min, syn_data_combined_min))


m_top <- 2
m_left <-0
m_bottom <- 0
m_right <- 0
ts <- 3.2
tit_s <- 11
iqr_alpha <- 0.07
ribbon_alpha <- 0.33


blau_dist_margins <- ggplot()+
  
  #annotate("rect", xmin = min_diversity, xmax = max_diversity, ymin = 0.65, ymax = 1, alpha = .05) +
  #annotate("rect", xmin = q1_diversity, xmax = q3_diversity, ymin = global_y_min, ymax = global_y_max, alpha = iqr_alpha) +
  #geom_vline(xintercept = q1_diversity,size=0.1) +
  #geom_vline(xintercept = q3_diversity,size=0.1) +
  #geom_vline(xintercept = mean_diversity,size=0.3, linetype="dashed", alpha = .5) +
  
  #prediction and CI
  geom_line(data=syn_data_baseline_dist[x_range_filter,],   aes(blau2, ols_pred), color=lo_color)+
  geom_ribbon(data=syn_data_baseline_dist[x_range_filter,], aes(blau2, ymin=ols_low, ymax=ols_up),alpha=ribbon_alpha, fill=lo_color)+

  
  #axes formatting
  scale_y_continuous(
                     #trans='log10',
                     #limits=c(global_y_min, global_y_max), 
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     #breaks = c(30, 50, 100, 200, 300, 400, 500), 
                     name="Predicted distinctiveness") +
  scale_x_continuous(
                     #limits=c(min_diversity, max_diversity),
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     #breaks = pretty(syn_data_mixing$blau2, n = 5), 
                     name="Diversity") +
  
#coord_cartesian(ylim = c(0.69, 0.90)) +
  
  
    #annotate(geom="text", x=mean_diversity-0.01,    y=0.87, label="Mean\n Gender\nDiversity", lineheight = .8,  col="black", size=3.2, hjust = 1, alpha = 1) +
  
    #annotate(geom="text", x=mean_diversity,    y=0.715, label="IQR of \nGender Diversity", lineheight = .8,  col="black", size=3.2, hjust = 0.5, alpha = 1) +
    #annotate("segment", x = q1_diversity, xend = q3_diversity, y = .70, yend = .70, size=0.2, arrow = arrow(ends = "both", angle = 45, length = unit(1,"mm"))) +
  
    #annotate(geom="text", x=.45,    y=0.847, label="Maximal\nInclusion", lineheight = .8,  col="black", size=3.2, hjust = 1, alpha = 1, angle = 20) +
    #geom_segment(aes(y=0.85,    x=0.25, yend = 0.81, xend = 0.28),size=0.6, col = hi_color, alpha=0.66, linetype=3) +
  
    #annotate(geom="text", x=.45,    y=0.779, label="Minimal\nInclusion", lineheight = .8,   col="black", size=3.2, hjust = 1, alpha = 1, angle = -12) +
    #geom_segment(aes(y=0.72,    x=.25, yend = 0.76, xend = .28),size=0.6, col = lo_color, alpha=0.66, linetype=3) +
  
    
  

  
  labs(title="a")+
  
  #theme
  theme(aspect.ratio=1, 
            panel.grid.major = element_line(size=0.2), 
            panel.grid.minor = element_blank(), 
            panel.background = element_blank(), 
            panel.border = element_rect(colour = "black", 
                                        fill=NA, 
                                        size=0.2),
            legend.position = c(0.2, 0.3),
            plot.title = element_text(size = tit_s, face = "bold", colour = "black"),
            #axis.ticks.y = element_blank(),
            axis.title.y = element_text(size = 11, colour = "black"),
            axis.text.x = element_text(size = 9, colour = "black"),
            axis.text.y = element_text(size = 9, colour = "black"),
            #plot.margin = unit(c(m_top,m_right-7,m_bottom,0), "mm")
            )




blau_dist_margins
#margins
```

Margins plot - game level

```{r, fig.width = 5, fig.height = 5}
theme_set(theme_bw())

dropLeadingZero <- function(l){
  str_replace(l, '0(?=.)', '')
}

mean_diversity <- mean(moby$blau2)
min_diversity <- min(moby$blau2)
max_diversity <- max(moby$blau2)
sd_diversity <- sd(moby$blau2)
q1_diversity <- quantile(moby$blau2, probs = 0.25)
q3_diversity <- quantile(moby$blau2, probs = 0.75)

hi_color = "#b4de75"
hi_color_dark = "#75914c"
lo_color = "#69629a"
lo_color_dark = "#4f4973"


syn_data_mixing_min <- min(syn_data_mixing$ols_low)
syn_data_mixing_max <- max(syn_data_mixing$ols_up)
syn_data_mixing_min_inclusion <- min(syn_data_mixing$mixing)
syn_data_mixing_max_inclusion <- max(syn_data_mixing$mixing)

syn_data_bonding_min <- min(syn_data_bonding$ols_low)
syn_data_bonding_max <- max(syn_data_bonding$ols_up)
syn_data_bonding_min_inclusion <- min(syn_data_bonding$bonding)
syn_data_bonding_max_inclusion <- max(syn_data_bonding$bonding)

syn_data_incorporating_min <- min(syn_data_incorporating$ols_low)
syn_data_incorporating_max <- max(syn_data_incorporating$ols_up)
syn_data_incorporating_min_inclusion <- min(syn_data_incorporating$incorporating)
syn_data_incorporating_max_inclusion <- max(syn_data_incorporating$incorporating)

syn_data_combined_min <- min(syn_data_combined$ols_low)
syn_data_combined_max <- max(syn_data_combined$ols_up)
syn_data_combined_min_inclusion <- min(syn_data_combined$combined)
syn_data_combined_max_inclusion <- max(syn_data_combined$combined)

global_y_max <- max(c(syn_data_mixing_max, syn_data_bonding_max, syn_data_incorporating_max, syn_data_combined_max))
global_y_min <- min(c(syn_data_mixing_min, syn_data_bonding_min, syn_data_incorporating_min, syn_data_combined_min))


m_top <- 2
m_left <-0
m_bottom <- 0
m_right <- 0
ts <- 3.2
tit_s <- 11
iqr_alpha <- 0.07
ribbon_alpha <- 0.33


mixing_margins_blue <- ggplot()+
  
  #annotate("rect", xmin = min_diversity, xmax = max_diversity, ymin = 0.65, ymax = 1, alpha = .05) +
  #annotate("rect", xmin = q1_diversity, xmax = q3_diversity, ymin = global_y_min, ymax = global_y_max, alpha = iqr_alpha) +
  #geom_vline(xintercept = q1_diversity,size=0.1) +
  #geom_vline(xintercept = q3_diversity,size=0.1) +
  #geom_vline(xintercept = mean_diversity,size=0.3, linetype="dashed", alpha = .5) +
  
  #min inclusion prediction and CI
  geom_line(data=syn_data_mixing[syn_data_mixing$mixing==syn_data_mixing_min_inclusion,],   aes(blau2, ols_pred), color=hi_color_1)+
  geom_ribbon(data=syn_data_mixing[syn_data_mixing$mixing==syn_data_mixing_min_inclusion,], aes(blau2, ymin=ols_low, ymax=ols_up),alpha=ribbon_alpha, fill=hi_color_1)+

  #max inclusion prediction and CI
  geom_line(data=syn_data_mixing[syn_data_mixing$mixing==syn_data_mixing_max_inclusion,],   aes(blau2, ols_pred), color=hi_color_9)+
  geom_ribbon(data=syn_data_mixing[syn_data_mixing$mixing==syn_data_mixing_max_inclusion,], aes(blau2, ymin=ols_low, ymax=ols_up),alpha=ribbon_alpha, fill=hi_color_9)+ 
  
  #axes formatting
  scale_y_continuous(
                     #trans='log10',
                     limits=c(global_y_min, global_y_max), 
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     #breaks = c(30, 50, 100, 200, 300, 400, 500), 
                     name="Predicted distinctiveness") +
  scale_x_continuous(limits=c(min_diversity, max_diversity),
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     breaks = pretty(syn_data_mixing$blau2, n = 5), 
                     name="") +
  
coord_cartesian(ylim = c(0.7, 0.87)) +
  
  
    #annotate(geom="text", x=mean_diversity-0.01,    y=0.87, label="Mean\n Gender\nDiversity", lineheight = .8,  col="black", size=3.2, hjust = 1, alpha = 1) +
  
    #annotate(geom="text", x=mean_diversity,    y=0.715, label="IQR of \nGender Diversity", lineheight = .8,  col="black", size=3.2, hjust = 0.5, alpha = 1) +
    #annotate("segment", x = q1_diversity, xend = q3_diversity, y = .70, yend = .70, size=0.2, arrow = arrow(ends = "both", angle = 45, length = unit(1,"mm"))) +
  
    annotate(geom="text", x=.45,    y=0.847, label="Maximal\nInclusion", lineheight = .8,  col=lo_color_dark, size=3.2, hjust = 1, alpha = 1, angle = 24) +
    #geom_segment(aes(y=0.85,    x=0.25, yend = 0.81, xend = 0.28),size=0.6, col = hi_color, alpha=0.66, linetype=3) +
  
    annotate(geom="text", x=.45,    y=0.780, label="Minimal\nInclusion", lineheight = .8,   col=lo_color, size=3.2, hjust = 1, alpha = 1, angle = -12) +
    #geom_segment(aes(y=0.72,    x=.25, yend = 0.76, xend = .28),size=0.6, col = lo_color, alpha=0.66, linetype=3) +
  
    
  

  
  labs(title="a: Mixing")+
  
  #theme
  theme(aspect.ratio=1, 
            panel.grid.major = element_line(size=0.2),  
            panel.grid.minor = element_blank(), 
            panel.background = element_blank(), 
            panel.border = element_rect(colour = "black", 
                                        fill=NA, 
                                        size=0.2),
            legend.position = c(0.2, 0.3),
            plot.title = element_text(size = tit_s, face = "bold", colour = "black"),
            #axis.ticks.y = element_blank(),
            axis.title.y = element_text(size = 11, colour = "black"),
            axis.text.x = element_text(size = 9, colour = "black"),
            axis.text.y = element_text(size = 9, colour = "black"),
            plot.margin = unit(c(m_top,m_right-7,m_bottom,0), "mm")
            )


mixing_margins <- ggplot()+
  
  #annotate("rect", xmin = min_diversity, xmax = max_diversity, ymin = 0.65, ymax = 1, alpha = .05) +
  #annotate("rect", xmin = q1_diversity, xmax = q3_diversity, ymin = global_y_min, ymax = global_y_max, alpha = iqr_alpha) +
  #geom_vline(xintercept = q1_diversity,size=0.1) +
  #geom_vline(xintercept = q3_diversity,size=0.1) +
  #geom_vline(xintercept = mean_diversity,size=0.3, linetype="dashed", alpha = .5) +
  
  #min inclusion prediction and CI
  geom_line(data=syn_data_mixing[syn_data_mixing$mixing==syn_data_mixing_min_inclusion,],   aes(blau2, ols_pred), color=lo_color)+
  geom_ribbon(data=syn_data_mixing[syn_data_mixing$mixing==syn_data_mixing_min_inclusion,], aes(blau2, ymin=ols_low, ymax=ols_up),alpha=ribbon_alpha, fill=lo_color)+

  #max inclusion prediction and CI
  geom_line(data=syn_data_mixing[syn_data_mixing$mixing==syn_data_mixing_max_inclusion,],   aes(blau2, ols_pred), color=hi_color)+
  geom_ribbon(data=syn_data_mixing[syn_data_mixing$mixing==syn_data_mixing_max_inclusion,], aes(blau2, ymin=ols_low, ymax=ols_up),alpha=ribbon_alpha, fill=hi_color)+ 
  
  #axes formatting
  scale_y_continuous(
                     #trans='log10',
                     limits=c(global_y_min, global_y_max), 
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     #breaks = c(30, 50, 100, 200, 300, 400, 500), 
                     name="Predicted distinctiveness") +
  scale_x_continuous(limits=c(min_diversity, max_diversity),
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     breaks = pretty(syn_data_mixing$blau2, n = 5), 
                     name="") +
  
coord_cartesian(ylim = c(0.7, 0.87)) +
  
  
    #annotate(geom="text", x=mean_diversity-0.01,    y=0.87, label="Mean\n Gender\nDiversity", lineheight = .8,  col="black", size=3.2, hjust = 1, alpha = 1) +
  
    #annotate(geom="text", x=mean_diversity,    y=0.715, label="IQR of \nGender Diversity", lineheight = .8,  col="black", size=3.2, hjust = 0.5, alpha = 1) +
    #annotate("segment", x = q1_diversity, xend = q3_diversity, y = .70, yend = .70, size=0.2, arrow = arrow(ends = "both", angle = 45, length = unit(1,"mm"))) +
  
    annotate(geom="text", x=.45,    y=0.847, label="Maximal\nInclusion", lineheight = .8,  col=hi_color_dark, size=3.2, hjust = 1, alpha = 1, angle = 24) +
    #geom_segment(aes(y=0.85,    x=0.25, yend = 0.81, xend = 0.28),size=0.6, col = hi_color, alpha=0.66, linetype=3) +
  
    annotate(geom="text", x=.45,    y=0.780, label="Minimal\nInclusion", lineheight = .8,   col=lo_color_dark, size=3.2, hjust = 1, alpha = 1, angle = -12) +
    #geom_segment(aes(y=0.72,    x=.25, yend = 0.76, xend = .28),size=0.6, col = lo_color, alpha=0.66, linetype=3) +
  
    
  

  
  labs(title="a: Mixing")+
  
  #theme
  theme(aspect.ratio=1, 
            panel.grid.major = element_line(size=0.2),  
            panel.grid.minor = element_blank(), 
            panel.background = element_blank(), 
            panel.border = element_rect(colour = "black", 
                                        fill=NA, 
                                        size=0.2),
            legend.position = c(0.2, 0.3),
            plot.title = element_text(size = tit_s, face = "bold", colour = "black"),
            #axis.ticks.y = element_blank(),
            axis.title.y = element_text(size = 11, colour = "black"),
            axis.text.x = element_text(size = 9, colour = "black"),
            axis.text.y = element_text(size = 9, colour = "black"),
            plot.margin = unit(c(m_top,m_right-7,m_bottom,0), "mm")
            )




bonding_margins <- ggplot()+
  
  #annotate("rect", xmin = min_diversity, xmax = max_diversity, ymin = 0.65, ymax = 1, alpha = .05) +
  #annotate("rect", xmin = q1_diversity, xmax = q3_diversity, ymin = global_y_min, ymax = global_y_max, alpha = iqr_alpha) +
  #geom_vline(xintercept = q1_diversity,size=0.1) +
  #geom_vline(xintercept = q3_diversity,size=0.1) +
  #geom_vline(xintercept = mean_diversity,size=0.3, linetype="dashed", alpha = .5) +
  
  #min inclusion prediction and CI
  geom_line(data=syn_data_bonding[syn_data_bonding$bonding==syn_data_bonding_min_inclusion,],   aes(blau2, ols_pred), color=lo_color)+
  geom_ribbon(data=syn_data_bonding[syn_data_bonding$bonding==syn_data_bonding_min_inclusion,], aes(blau2, ymin=ols_low, ymax=ols_up),alpha=ribbon_alpha, fill=lo_color)+

  #max inclusion prediction and CI
  geom_line(data=syn_data_bonding[syn_data_bonding$bonding==syn_data_bonding_max_inclusion,],   aes(blau2, ols_pred), color=hi_color)+
  geom_ribbon(data=syn_data_bonding[syn_data_bonding$bonding==syn_data_bonding_max_inclusion,], aes(blau2, ymin=ols_low, ymax=ols_up),alpha=ribbon_alpha, fill=hi_color)+ 
  
  #axes formatting
  scale_y_continuous(
                     #trans='log10',
                     limits=c(global_y_min, global_y_max), 
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     #breaks = c(30, 50, 100, 200, 300, 400, 500), 
                     name="") +
  scale_x_continuous(limits=c(min_diversity, max_diversity),
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     breaks = pretty(syn_data_bonding$blau2, n = 5), 
                     name="") +
  
coord_cartesian(ylim = c(0.7, 0.87)) +

  
  labs(title="b: Bonding")+
  
  #theme
  theme(aspect.ratio=1, 
            panel.grid.major = element_line(size=0.2),  
            panel.grid.minor = element_blank(), 
            panel.background = element_blank(), 
            panel.border = element_rect(colour = "black", 
                                        fill=NA, 
                                        size=0.2),
            legend.position = c(0.2, 0.3),
            plot.title = element_text(size = tit_s, face = "bold", colour = "black"),
            #axis.ticks.y = element_blank(),
            axis.title.y = element_text(size = 11, colour = "black"),
            axis.text.x = element_text(size = 9, colour = "black"),
            axis.text.y = element_text(size = 9, colour = "black"),
            plot.margin = unit(c(m_top,m_right,m_bottom,m_left), "mm")
            )




incorporating_margins <- ggplot()+
  
  #annotate("rect", xmin = min_diversity, xmax = max_diversity, ymin = 0.65, ymax = 1, alpha = .05) +
  #annotate("rect", xmin = q1_diversity, xmax = q3_diversity, ymin = global_y_min, ymax = global_y_max, alpha = iqr_alpha) +
  #geom_vline(xintercept = q1_diversity,size=0.1) +
  #geom_vline(xintercept = q3_diversity,size=0.1) +
  #geom_vline(xintercept = mean_diversity,size=0.3, linetype="dashed", alpha = .5) +
  
  #min inclusion prediction and CI
  geom_line(data=syn_data_incorporating[syn_data_incorporating$incorporating==syn_data_incorporating_min_inclusion,],   aes(blau2, ols_pred), color=lo_color)+
  geom_ribbon(data=syn_data_incorporating[syn_data_incorporating$incorporating==syn_data_incorporating_min_inclusion,], aes(blau2, ymin=ols_low, ymax=ols_up),alpha=ribbon_alpha, fill=lo_color)+

  #max inclusion prediction and CI
  geom_line(data=syn_data_incorporating[syn_data_incorporating$incorporating==syn_data_incorporating_max_inclusion,],   aes(blau2, ols_pred), color=hi_color)+
  geom_ribbon(data=syn_data_incorporating[syn_data_incorporating$incorporating==syn_data_incorporating_max_inclusion,], aes(blau2, ymin=ols_low, ymax=ols_up),alpha=ribbon_alpha, fill=hi_color)+ 
  
  #axes formatting
  scale_y_continuous(
                     #trans='log10',
                     limits=c(global_y_min, global_y_max), 
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     #breaks = c(30, 50, 100, 200, 300, 400, 500), 
                     name="Predicted distinctiveness") +
  scale_x_continuous(limits=c(min_diversity, max_diversity),
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     breaks = pretty(syn_data_incorporating$blau2, n = 5), 
                     name="Gender diversity") +
  
  coord_cartesian(ylim = c(0.7, 0.87)) +
  
  

  
  labs(title="c: Incorporating")+
  
  #theme
  theme(aspect.ratio=1, 
            panel.grid.major = element_line(size=0.2),  
            panel.grid.minor = element_blank(), 
            panel.background = element_blank(), 
            panel.border = element_rect(colour = "black", 
                                        fill=NA, 
                                        size=0.2),
            legend.position = c(0.2, 0.3),
            plot.title = element_text(size = tit_s, face = "bold", colour = "black"),
            #axis.ticks.y = element_blank(),
            axis.title.y = element_text(size = 11, colour = "black"),
            axis.text.x = element_text(size = 9, colour = "black"),
            axis.text.y = element_text(size = 9, colour = "black"),
            plot.margin = unit(c(m_top,m_right-7,m_bottom,m_left), "mm")
            )





combined_margins <- ggplot()+
  
  #annotate("rect", xmin = min_diversity, xmax = max_diversity, ymin = 0.65, ymax = 1, alpha = .05) +
  #annotate("rect", xmin = q1_diversity, xmax = q3_diversity, ymin = global_y_min, ymax = global_y_max, alpha = iqr_alpha) +
  #geom_vline(xintercept = q1_diversity,size=0.1) +
  #geom_vline(xintercept = q3_diversity,size=0.1) +
  #geom_vline(xintercept = mean_diversity,size=0.3, linetype="dashed", alpha = .5) +
  
  #min inclusion prediction and CI
  geom_line(data=syn_data_combined[syn_data_combined$combined==syn_data_combined_min_inclusion,],   aes(blau2, ols_pred), color=lo_color)+
  geom_ribbon(data=syn_data_combined[syn_data_combined$combined==syn_data_combined_min_inclusion,], aes(blau2, ymin=ols_low, ymax=ols_up),alpha=ribbon_alpha, fill=lo_color)+

  #max inclusion prediction and CI
  geom_line(data=syn_data_combined[syn_data_combined$combined==syn_data_combined_max_inclusion,],   aes(blau2, ols_pred), color=hi_color)+
  geom_ribbon(data=syn_data_combined[syn_data_combined$combined==syn_data_combined_max_inclusion,], aes(blau2, ymin=ols_low, ymax=ols_up),alpha=ribbon_alpha, fill=hi_color)+ 
  
  #axes formatting
  scale_y_continuous(
                     #trans='log10',
                     limits=c(global_y_min, global_y_max), 
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     #breaks = c(30, 50, 100, 200, 300, 400, 500), 
                     name="") +
  scale_x_continuous(limits=c(min_diversity, max_diversity),
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     breaks = pretty(syn_data_combined$blau2, n = 5), 
                     name="Gender diversity") +
  
  coord_cartesian(ylim = c(0.7, 0.87)) +
  
  

  
  labs(title="d: Combined inclusion")+
  
  #theme
  theme(aspect.ratio=1, 
            panel.grid.major = element_line(size=0.2),  
            panel.grid.minor = element_blank(), 
            panel.background = element_blank(), 
            panel.border = element_rect(colour = "black", 
                                        fill=NA, 
                                        size=0.2),
            legend.position = c(0.2, 0.3),
            plot.title = element_text(size = tit_s, face = "bold", colour = "black"),
            #axis.ticks.y = element_blank(),
            axis.title.y = element_text(size = 11, colour = "black"),
            axis.text.x = element_text(size = 9, colour = "black"),
            axis.text.y = element_text(size = 9, colour = "black"),
            plot.margin = unit(c(m_top,m_right,m_bottom,m_left), "mm")
            )





margins_gamelevel <- grid.arrange(mixing_margins, bonding_margins, incorporating_margins,combined_margins, nrow = 2)
#margins
```

```{r, fig.width = 4, fig.height = 4}
margins_gamelevel_v2 <- cowplot::plot_grid(mixing_margins, bonding_margins, incorporating_margins,combined_margins, align="h",rel_widths=1,  rel_heights = 1, scale=1, nrow=2)
margins_gamelevel_v2
```

```{r}
ggsave("margins_gamelevel_mid.pdf", margins_gamelevel_v2, width = 5, height = 5)
ggsave("margins_gamelevel_sm.pdf", margins_gamelevel_v2, width = 4, height = 4)
```



predictions for mixing

```{r}
q1_diversity <- quantile(moby$blau2, probs = 0.25)
q3_diversity <- quantile(moby$blau2, probs = 0.75)

print("------min-------")
data_at_min <- syn_data_mixing[syn_data_mixing$blau2==min(syn_data_mixing$blau2),]
data_at_min[data_at_min$mixing==1,]$ols_low
data_at_min[data_at_min$mixing==1,]$ols_pred
data_at_min[data_at_min$mixing==1,]$ols_up
print("------q1-------")
data_at_q1 <- syn_data_mixing[round(syn_data_mixing$blau2, digits=2)==round(q1_diversity, digits = 2),]
data_at_q1[data_at_q1$mixing==1,]$ols_low
data_at_q1[data_at_q1$mixing==1,]$ols_pred
data_at_q1[data_at_q1$mixing==1,]$ols_up
print("------q3-------")
data_at_q3 <- syn_data_mixing[round(syn_data_mixing$blau2, digits=2)==round(q3_diversity, digits = 2),]
data_at_q3[data_at_q3$mixing==1,]$ols_low
data_at_q3[data_at_q3$mixing==1,]$ols_pred
data_at_q3[data_at_q3$mixing==1,]$ols_up
print("------max-------")
data_at_max <- syn_data_mixing[syn_data_mixing$blau2==max(syn_data_mixing$blau2),]
data_at_max[data_at_max$mixing==1,]$ols_low
data_at_max[data_at_max$mixing==1,]$ols_pred
data_at_max[data_at_max$mixing==1,]$ols_up

data_at_max[data_at_max$mixing==1,]$ols_pred/data_at_min[data_at_min$mixing==1,]$ols_pred
```

predictions for bonding

```{r}
print("------min-------")
data_at_min <- syn_data_bonding[syn_data_bonding$blau2==min(syn_data_bonding$blau2),]
data_at_min[data_at_min$bonding==1,]$ols_low
data_at_min[data_at_min$bonding==1,]$ols_pred
data_at_min[data_at_min$bonding==1,]$ols_up
print("------q1-------")
data_at_q1 <- syn_data_bonding[round(syn_data_bonding$blau2, digits=3)==round(q1_diversity, digits = 3),]
data_at_q1[data_at_q1$bonding==1,]$ols_low
data_at_q1[data_at_q1$bonding==1,]$ols_pred
data_at_q1[data_at_q1$bonding==1,]$ols_up
print("------q3-------")
data_at_q3 <- syn_data_bonding[round(syn_data_bonding$blau2, digits=3)==round(q3_diversity, digits = 3),]
data_at_q3[data_at_q3$bonding==1,]$ols_low
data_at_q3[data_at_q3$bonding==1,]$ols_pred
data_at_q3[data_at_q3$bonding==1,]$ols_up
print("------max-------")
data_at_max <- syn_data_bonding[syn_data_bonding$blau2==max(syn_data_bonding$blau2),]
data_at_max[data_at_max$bonding==1,]$ols_low
data_at_max[data_at_max$bonding==1,]$ols_pred
data_at_max[data_at_max$bonding==1,]$ols_up

data_at_max[data_at_max$bonding==1,]$ols_pred/data_at_min[data_at_min$bonding==1,]$ols_pred
```

predictions for incorporating

```{r}
print("------min-------")
data_at_min <- syn_data_incorporating[syn_data_incorporating$blau2==min(syn_data_incorporating$blau2),]
data_at_min[data_at_min$incorporating==max(data_at_min$incorporating),]$ols_low
data_at_min[data_at_min$incorporating==max(data_at_min$incorporating),]$ols_pred
data_at_min[data_at_min$incorporating==max(data_at_min$incorporating),]$ols_up
print("------q1-------")
data_at_q1 <- syn_data_incorporating[round(syn_data_incorporating$blau2, digits=3)==round(q1_diversity, digits = 3),]
data_at_q1[data_at_q1$incorporating==max(data_at_min$incorporating),]$ols_low
data_at_q1[data_at_q1$incorporating==max(data_at_min$incorporating),]$ols_pred
data_at_q1[data_at_q1$incorporating==max(data_at_min$incorporating),]$ols_up
print("------q3-------")
data_at_q3 <- syn_data_incorporating[round(syn_data_incorporating$blau2, digits=3)==round(q3_diversity, digits = 3),]
data_at_q3[data_at_q3$incorporating==max(data_at_min$incorporating),]$ols_low
data_at_q3[data_at_q3$incorporating==max(data_at_min$incorporating),]$ols_pred
data_at_q3[data_at_q3$incorporating==max(data_at_min$incorporating),]$ols_up
print("------max-------")
data_at_max <- syn_data_incorporating[syn_data_incorporating$blau2==max(syn_data_incorporating$blau2),]
data_at_max[data_at_max$incorporating==max(data_at_min$incorporating),]$ols_low
data_at_max[data_at_max$incorporating==max(data_at_min$incorporating),]$ols_pred
data_at_max[data_at_max$incorporating==max(data_at_min$incorporating),]$ols_up

data_at_max[data_at_max$incorporating==max(data_at_min$incorporating),]$ols_pred/data_at_min[data_at_min$incorporating==max(data_at_min$incorporating),]$ols_pred
```

predictions for combined

```{r}
print("------min-------")
data_at_min <- syn_data_combined[syn_data_combined$blau2==min(syn_data_combined$blau2),]
data_at_min[data_at_min$combined==max(data_at_min$combined),]$ols_low
data_at_min[data_at_min$combined==max(data_at_min$combined),]$ols_pred
data_at_min[data_at_min$combined==max(data_at_min$combined),]$ols_up
print("------q1-------")
data_at_q1 <- syn_data_incorporating[round(syn_data_incorporating$blau2, digits=3)==round(q1_diversity, digits = 3),]
data_at_q1[data_at_q1$combined==max(data_at_min$combined),]$ols_low
data_at_q1[data_at_q1$combined==max(data_at_min$combined),]$ols_pred
data_at_q1[data_at_q1$combined==max(data_at_min$combined),]$ols_up
print("------q3-------")
data_at_q3 <- syn_data_combined[round(syn_data_incorporating$blau2, digits=3)==round(q3_diversity, digits = 3),]
data_at_q3[data_at_q3$combined==max(data_at_min$combined),]$ols_low
data_at_q3[data_at_q3$combinedg==max(data_at_min$combined),]$ols_pred
data_at_q3[data_at_q3$combined==max(data_at_min$combined),]$ols_up
print("------max-------")
data_at_max <- syn_data_combined[syn_data_incorporating$blau2==max(syn_data_incorporating$blau2),]
data_at_max[data_at_max$combined==max(data_at_min$combined),]$ols_low
data_at_max[data_at_max$combined==max(data_at_min$combined),]$ols_pred
data_at_max[data_at_max$combined==max(data_at_min$combined),]$ols_up

data_at_max[data_at_max$combined==max(data_at_min$combined),]$ols_pred/data_at_min[data_at_min$combined==max(data_at_min$combined),]$ols_pred
```

Margins plot - game level w firm FE

```{r, fig.width = 6.6, fig.height = 6.6}
theme_set(theme_bw())

dropLeadingZero <- function(l){
  str_replace(l, '0(?=.)', '')
}

mean_diversity <- mean(moby_repeat_devs$blau2_z)
min_diversity <- min(moby_repeat_devs$blau2_z)
max_diversity <- max(moby_repeat_devs$blau2_z)
sd_diversity <- sd(moby_repeat_devs$blau2_z)
q1_diversity <- quantile(moby_repeat_devs$blau2_z, probs = 0.25)
q3_diversity <- quantile(moby_repeat_devs$blau2_z, probs = 0.75)

hi_color = "#b4de75"
lo_color = "#69629a"


syn_data_mixing_min <- min(syn_data_mixing_fe$ols_low)
syn_data_mixing_max <- max(syn_data_mixing_fe$ols_up)
syn_data_mixing_min_inclusion <- min(syn_data_mixing_fe$mixing)
syn_data_mixing_max_inclusion <- max(syn_data_mixing_fe$mixing)

syn_data_bonding_min <- min(syn_data_bonding_fe$ols_low)
syn_data_bonding_max <- max(syn_data_bonding_fe$ols_up)
syn_data_bonding_min_inclusion <- min(syn_data_bonding_fe$bonding)
syn_data_bonding_max_inclusion <- max(syn_data_bonding_fe$bonding)

syn_data_incorporating_min <- min(syn_data_incorporating_fe$ols_low)
syn_data_incorporating_max <- max(syn_data_incorporating_fe$ols_up)
syn_data_incorporating_min_inclusion <- min(syn_data_incorporating_fe$incorporating)
syn_data_incorporating_max_inclusion <- max(syn_data_incorporating_fe$incorporating)

syn_data_combined_min <- min(syn_data_combined_fe$ols_low)
syn_data_combined_max <- max(syn_data_combined_fe$ols_up)
syn_data_combined_min_inclusion <- min(syn_data_combined_fe$combined)
syn_data_combined_max_inclusion <- max(syn_data_combined_fe$combined)

global_y_max <- max(c(syn_data_mixing_max, syn_data_bonding_max, syn_data_incorporating_max, syn_data_combined_max))
global_y_min <- min(c(syn_data_mixing_min, syn_data_bonding_min, syn_data_incorporating_min, syn_data_combined_min))
#global_y_max=0.9
#global_y_min=0.5


m_top <- 2
m_left <-0
m_bottom <- 0
m_right <- 0
ts <- 3.2
tit_s <- 11



mixing_margins_fe <- ggplot()+
  
  #annotate("rect", xmin = min_diversity, xmax = max_diversity, ymin = 0.65, ymax = 1, alpha = .05) +
  annotate("rect", xmin = q1_diversity, xmax = q3_diversity, ymin = global_y_min, ymax = global_y_max, alpha = .1) +
  geom_vline(xintercept = q1_diversity,size=0.1) +
  geom_vline(xintercept = q3_diversity,size=0.1) +
  geom_vline(xintercept = mean_diversity,size=0.3, linetype="dashed", alpha = .5) +
  
  #min inclusion prediction and CI
  geom_line(data=syn_data_mixing_fe[syn_data_mixing_fe$mixing==syn_data_mixing_min_inclusion,],   aes(blau2_z, ols_pred), color=lo_color)+
  geom_ribbon(data=syn_data_mixing_fe[syn_data_mixing_fe$mixing==syn_data_mixing_min_inclusion,], aes(blau2_z, ymin=ols_low, ymax=ols_up),alpha=0.2, fill=lo_color)+

  #max inclusion prediction and CI
  geom_line(data=syn_data_mixing_fe[syn_data_mixing_fe$mixing==syn_data_mixing_max_inclusion,],   aes(blau2_z, ols_pred), color=hi_color)+
  geom_ribbon(data=syn_data_mixing_fe[syn_data_mixing_fe$mixing==syn_data_mixing_max_inclusion,], aes(blau2_z, ymin=ols_low, ymax=ols_up),alpha=0.2, fill=hi_color)+ 
  
  #axes formatting
  scale_y_continuous(
                     #trans='log10',
                     limits=c(global_y_min, global_y_max), 
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     #breaks = c(30, 50, 100, 200, 300, 400, 500), 
                     name="Predicted distinctiveness") +
  scale_x_continuous(limits=c(min_diversity, max_diversity),
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     breaks = pretty(syn_data_mixing_fe$blau2_z, n = 5), 
                     name="") +
  
#coord_cartesian(ylim = c(0.69, 0.90)) +
  
  
    annotate(geom="text", x=mean_diversity-0.01,    y=0.88, label="Mean\n Gender\nDiversity", lineheight = .8,  col="black", size=3.2, hjust = 1, alpha = 1) +
  
    annotate(geom="text", x=mean_diversity,    y=0.715, label="IQR of \nGender Diversity", lineheight = .8,  col="black", size=3.2, hjust = 0.5, alpha = 1) +
    annotate("segment", x = q1_diversity, xend = q3_diversity, y = .70, yend = .70, size=0.2, arrow = arrow(ends = "both", angle = 45, length = unit(1,"mm"))) +
  
    annotate(geom="text", x=0.45,    y=0.87, label="Maximal\nInclusion", lineheight = .8,  col=hi_color, size=3.2, hjust = 1, alpha = 1) +
    #geom_segment(aes(y=0.85,    x=0.25, yend = 0.81, xend = 0.28),size=0.6, col = hi_color, alpha=0.66, linetype=3) +
  
    annotate(geom="text", x=.45,    y=0.71, label="Minimal\nInclusion", lineheight = .8,   col=lo_color, size=3.2, hjust = 1, alpha = 1) +
    #geom_segment(aes(y=0.72,    x=.25, yend = 0.76, xend = .28),size=0.6, col = lo_color, alpha=0.66, linetype=3) +
  
    
  

  
  labs(title="Mixing")+
  
  #theme
  theme(aspect.ratio=1, 
            #panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(), 
            panel.background = element_blank(), 
            panel.border = element_rect(colour = "black", 
                                        fill=NA, 
                                        size=0.2),
            legend.position = c(0.2, 0.3),
            plot.title = element_text(size = tit_s, face = "bold", colour = "black"),
            #axis.ticks.y = element_blank(),
            axis.title.y = element_text(size = 11, colour = "black"),
            axis.text.x = element_text(size = 9, colour = "black"),
            axis.text.y = element_text(size = 9, colour = "black"),
            plot.margin = unit(c(m_top,m_right,m_bottom,0), "mm")
            )




bonding_margins_fe <- ggplot()+
  
  #annotate("rect", xmin = min_diversity, xmax = max_diversity, ymin = 0.65, ymax = 1, alpha = .05) +
  #annotate("rect", xmin = q1_diversity, xmax = q3_diversity, ymin = global_y_min, ymax = global_y_max, alpha = .1) +
  #geom_vline(xintercept = q1_diversity,size=0.1) +
  #geom_vline(xintercept = q3_diversity,size=0.1) +
  #geom_vline(xintercept = mean_diversity,size=0.3, linetype="dashed", alpha = .5) +
  
  #min inclusion prediction and CI
  geom_line(data=syn_data_bonding_fe[syn_data_bonding_fe$bonding==syn_data_bonding_min_inclusion,],   aes(blau2_z, ols_pred), color=lo_color)+
  geom_ribbon(data=syn_data_bonding_fe[syn_data_bonding_fe$bonding==syn_data_bonding_min_inclusion,], aes(blau2_z, ymin=ols_low, ymax=ols_up),alpha=0.2, fill=lo_color)+

  #max inclusion prediction and CI
  geom_line(data=syn_data_bonding_fe[syn_data_bonding_fe$bonding==syn_data_bonding_max_inclusion,],   aes(blau2_z, ols_pred), color=hi_color)+
  geom_ribbon(data=syn_data_bonding_fe[syn_data_bonding_fe$bonding==syn_data_bonding_max_inclusion,], aes(blau2_z, ymin=ols_low, ymax=ols_up),alpha=0.2, fill=hi_color)+ 
  
  #axes formatting
  scale_y_continuous(
                     #trans='log10',
                     limits=c(global_y_min, global_y_max), 
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     #breaks = c(30, 50, 100, 200, 300, 400, 500), 
                     name="") +
  scale_x_continuous(limits=c(min_diversity, max_diversity),
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     breaks = pretty(syn_data_bonding_fe$blau2_z, n = 5), 
                     name="") +
  
#coord_cartesian(ylim = c(0.69, 0.90)) +

  
  labs(title="Bonding")+
  
  #theme
  theme(aspect.ratio=1, 
            #panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(), 
            panel.background = element_blank(), 
            panel.border = element_rect(colour = "black", 
                                        fill=NA, 
                                        size=0.2),
            legend.position = c(0.2, 0.3),
            plot.title = element_text(size = tit_s, face = "bold", colour = "black"),
            #axis.ticks.y = element_blank(),
            axis.title.y = element_text(size = 11, colour = "black"),
            axis.text.x = element_text(size = 9, colour = "black"),
            axis.text.y = element_text(size = 9, colour = "black"),
            plot.margin = unit(c(m_top,m_right,m_bottom,m_left), "mm")
            )




incorporating_margins_fe <- ggplot()+
  
  #annotate("rect", xmin = min_diversity, xmax = max_diversity, ymin = 0.65, ymax = 1, alpha = .05) +
  #annotate("rect", xmin = q1_diversity, xmax = q3_diversity, ymin = global_y_min, ymax = global_y_max, alpha = .1) +
  #geom_vline(xintercept = q1_diversity,size=0.1) +
  #geom_vline(xintercept = q3_diversity,size=0.1) +
  #geom_vline(xintercept = mean_diversity,size=0.3, linetype="dashed", alpha = .5) +
  
  #min inclusion prediction and CI
  geom_line(data=syn_data_incorporating_fe[syn_data_incorporating_fe$incorporating==syn_data_incorporating_min_inclusion,],   aes(blau2_z, ols_pred), color=lo_color)+
  geom_ribbon(data=syn_data_incorporating_fe[syn_data_incorporating_fe$incorporating==syn_data_incorporating_min_inclusion,], aes(blau2_z, ymin=ols_low, ymax=ols_up),alpha=0.2, fill=lo_color)+

  #max inclusion prediction and CI
  geom_line(data=syn_data_incorporating_fe[syn_data_incorporating_fe$incorporating==syn_data_incorporating_max_inclusion,],   aes(blau2_z, ols_pred), color=hi_color)+
  geom_ribbon(data=syn_data_incorporating_fe[syn_data_incorporating_fe$incorporating==syn_data_incorporating_max_inclusion,], aes(blau2_z, ymin=ols_low, ymax=ols_up),alpha=0.2, fill=hi_color)+ 
  
  #axes formatting
  scale_y_continuous(
                     #trans='log10',
                     limits=c(global_y_min, global_y_max), 
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     #breaks = c(30, 50, 100, 200, 300, 400, 500), 
                     name="Predicted distinctiveness") +
  scale_x_continuous(limits=c(min_diversity, max_diversity),
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     breaks = pretty(syn_data_incorporating_fe$blau2_z, n = 5), 
                     name="Gender diversity") +
  
  #coord_cartesian(ylim = c(0.69, 0.90)) +
  
  

  
  labs(title="Incorporating")+
  
  #theme
  theme(aspect.ratio=1, 
            #panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(), 
            panel.background = element_blank(), 
            panel.border = element_rect(colour = "black", 
                                        fill=NA, 
                                        size=0.2),
            legend.position = c(0.2, 0.3),
            plot.title = element_text(size = tit_s, face = "bold", colour = "black"),
            #axis.ticks.y = element_blank(),
            axis.title.y = element_text(size = 11, colour = "black"),
            axis.text.x = element_text(size = 9, colour = "black"),
            axis.text.y = element_text(size = 9, colour = "black"),
            plot.margin = unit(c(m_top,m_right,m_bottom,m_left), "mm")
            )





combined_margins_fe <- ggplot()+
  
  #annotate("rect", xmin = min_diversity, xmax = max_diversity, ymin = 0.65, ymax = 1, alpha = .05) +
  #annotate("rect", xmin = q1_diversity, xmax = q3_diversity, ymin = global_y_min, ymax = global_y_max, alpha = .1) +
  #geom_vline(xintercept = q1_diversity,size=0.1) +
  #geom_vline(xintercept = q3_diversity,size=0.1) +
  #geom_vline(xintercept = mean_diversity,size=0.3, linetype="dashed", alpha = .5) +
  
  #min inclusion prediction and CI
  geom_line(data=syn_data_combined_fe[syn_data_combined_fe$combined==syn_data_combined_min_inclusion,],   aes(blau2_z, ols_pred), color=lo_color)+
  geom_ribbon(data=syn_data_combined_fe[syn_data_combined_fe$combined==syn_data_combined_min_inclusion,], aes(blau2_z, ymin=ols_low, ymax=ols_up),alpha=0.2, fill=lo_color)+

  #max inclusion prediction and CI
  geom_line(data=syn_data_combined_fe[syn_data_combined_fe$combined==syn_data_combined_max_inclusion,],   aes(blau2_z, ols_pred), color=hi_color)+
  geom_ribbon(data=syn_data_combined_fe[syn_data_combined_fe$combined==syn_data_combined_max_inclusion,], aes(blau2_z, ymin=ols_low, ymax=ols_up),alpha=0.2, fill=hi_color)+ 
  
  #axes formatting
  scale_y_continuous(
                     #trans='log10',
                     limits=c(global_y_min, global_y_max), 
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     #breaks = c(30, 50, 100, 200, 300, 400, 500), 
                     name="") +
  scale_x_continuous(limits=c(min_diversity, max_diversity),
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     breaks = pretty(syn_data_combined_fe$blau2_z, n = 5), 
                     name="Gender diversity") +
  
  #coord_cartesian(ylim = c(0.69, 0.90)) +
  
  

  
  labs(title="Combined inclusion")+
  
  #theme
  theme(aspect.ratio=1, 
            #panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(), 
            panel.background = element_blank(), 
            panel.border = element_rect(colour = "black", 
                                        fill=NA, 
                                        size=0.2),
            legend.position = c(0.2, 0.3),
            plot.title = element_text(size = tit_s, face = "bold", colour = "black"),
            #axis.ticks.y = element_blank(),
            axis.title.y = element_text(size = 11, colour = "black"),
            axis.text.x = element_text(size = 9, colour = "black"),
            axis.text.y = element_text(size = 9, colour = "black"),
            plot.margin = unit(c(m_top,m_right,m_bottom,m_left), "mm")
            )





margins_gamelevel_fe <- grid.arrange(mixing_margins_fe, bonding_margins_fe, incorporating_margins_fe,combined_margins_fe, nrow = 2)
#margins
```

```{r}
ggsave("margins_fe_mid.pdf", margins_gamelevel_fe, width = 5, height = 5)
ggsave("margins_fe_sm.pdf", margins_gamelevel_fe, width = 4, height = 4)
```



Margins plot - firm level

```{r, fig.width = 6.6, fig.height = 6.6}
theme_set(theme_bw())

dropLeadingZero <- function(l){
  str_replace(l, '0(?=.)', '')
}

mean_diversity <- mean(moby_dev_firm_level$blau2_z)
min_diversity <- min(moby_dev_firm_level$blau2_z)
max_diversity <- max(moby_dev_firm_level$blau2_z)
sd_diversity <- sd(moby_dev_firm_level$blau2_z)
q1_diversity <- quantile(moby_dev_firm_level$blau2_z, probs = 0.25)
q3_diversity <- quantile(moby_dev_firm_level$blau2_z, probs = 0.75)

hi_color = "#b4de75"
lo_color = "#69629a"


syn_data_mixing_aggr_min <- min(syn_data_mixing_aggr$ols_low)
syn_data_mixing_aggr_max <- max(syn_data_mixing_aggr$ols_up)
syn_data_mixing_aggr_min_inclusion <- min(syn_data_mixing_aggr$mixing)
syn_data_mixing_aggr_max_inclusion <- max(syn_data_mixing_aggr$mixing)

syn_data_bonding_aggr_min <- min(syn_data_bonding_aggr$ols_low)
syn_data_bonding_aggr_max <- max(syn_data_bonding_aggr$ols_up)
syn_data_bonding_aggr_min_inclusion <- min(syn_data_bonding_aggr$bonding)
syn_data_bonding_aggr_max_inclusion <- max(syn_data_bonding_aggr$bonding)

syn_data_incorporating_aggr_min <- min(syn_data_incorporating_aggr$ols_low)
syn_data_incorporating_aggr_max <- max(syn_data_incorporating_aggr$ols_up)
syn_data_incorporating_aggr_min_inclusion <- min(syn_data_incorporating_aggr$incorporating)
syn_data_incorporating_aggr_max_inclusion <- max(syn_data_incorporating_aggr$incorporating)

syn_data_combined_aggr_min <- min(syn_data_combined_aggr$ols_low)
syn_data_combined_aggr_max <- max(syn_data_combined_aggr$ols_up)
syn_data_combined_aggr_min_inclusion <- min(syn_data_combined_aggr$combined)
syn_data_combined_aggr_max_inclusion <- max(syn_data_combined_aggr$combined)

global_y_max <- max(c(syn_data_mixing_aggr_max, syn_data_bonding_aggr_max, syn_data_incorporating_aggr_max, syn_data_combined_aggr_max))
global_y_min <- min(c(syn_data_mixing_aggr_min, syn_data_bonding_aggr_min, syn_data_incorporating_aggr_min, syn_data_combined_aggr_min))


m_top <- 2
m_left <-0
m_bottom <- 0
m_right <- 0
ts <- 3.2
tit_s <- 11
iqr_alpha <- 0.07
ribbon_alpha <- 0.33


mixing_margins_aggr <- ggplot()+
  
  #annotate("rect", xmin = min_diversity, xmax = max_diversity, ymin = 0.65, ymax = 1, alpha = .05) +
  annotate("rect", xmin = q1_diversity, xmax = q3_diversity, ymin = global_y_min, ymax = global_y_max, alpha = iqr_alpha) +
  geom_vline(xintercept = q1_diversity,size=0.1) +
  geom_vline(xintercept = q3_diversity,size=0.1) +
  geom_vline(xintercept = mean_diversity,size=0.3, linetype="dashed", alpha = .5) +
  
  #min inclusion prediction and CI
  geom_line(data=syn_data_mixing_aggr[syn_data_mixing_aggr$mixing==syn_data_mixing_aggr_min_inclusion,],   aes(blau2_z, ols_pred), color=lo_color)+
  geom_ribbon(data=syn_data_mixing_aggr[syn_data_mixing_aggr$mixing==syn_data_mixing_aggr_min_inclusion,], aes(blau2_z, ymin=ols_low, ymax=ols_up),alpha=ribbon_alpha, fill=lo_color)+

  #max inclusion prediction and CI
  geom_line(data=syn_data_mixing_aggr[syn_data_mixing_aggr$mixing==syn_data_mixing_aggr_max_inclusion,],   aes(blau2_z, ols_pred), color=hi_color)+
  geom_ribbon(data=syn_data_mixing_aggr[syn_data_mixing_aggr$mixing==syn_data_mixing_aggr_max_inclusion,], aes(blau2_z, ymin=ols_low, ymax=ols_up),alpha=ribbon_alpha, fill=hi_color)+ 
  
  #axes formatting
  scale_y_continuous(
                     #trans='log10',
                     limits=c(global_y_min, global_y_max), 
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     #breaks = c(30, 50, 100, 200, 300, 400, 500), 
                     name="Predicted distinctiveness") +
  scale_x_continuous(limits=c(min_diversity, max_diversity),
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     breaks = pretty(syn_data_mixing_aggr$blau2_z, n = 5), 
                     name="") +
  
coord_cartesian(ylim = c(0.69, 0.90)) +
  
  
    annotate(geom="text", x=mean_diversity-0.01,    y=0.88, label="Mean\n Gender\nDiversity", lineheight = .8,  col="black", size=3.2, hjust = 1, alpha = 1) +
  
    annotate(geom="text", x=mean_diversity,    y=0.715, label="IQR of \nGender Diversity", lineheight = .8,  col="black", size=3.2, hjust = 0.5, alpha = 1) +
    annotate("segment", x = q1_diversity, xend = q3_diversity, y = .70, yend = .70, size=0.2, arrow = arrow(ends = "both", angle = 45, length = unit(1,"mm"))) +
  
    annotate(geom="text", x=.42,    y=0.869, label="Maximal\nInclusion", lineheight = .8,  col="black", size=3.2, hjust = 1, alpha = 1, angle = 35.5) +
    #geom_segment(aes(y=0.85,    x=0.25, yend = 0.81, xend = 0.28),size=0.6, col = hi_color, alpha=0.66, linetype=3) +
  
    annotate(geom="text", x=.42,    y=0.74, label="Minimal\nInclusion", lineheight = .8,   col="black", size=3.2, hjust = 1, alpha = 1, angle = -30) +
    #geom_segment(aes(y=0.72,    x=.25, yend = 0.76, xend = .28),size=0.6, col = lo_color, alpha=0.66, linetype=3) +
  
    
  

  
  labs(title="Mixing")+
  
  #theme
  theme(aspect.ratio=1, 
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(), 
            panel.background = element_blank(), 
            panel.border = element_rect(colour = "black", 
                                        fill=NA, 
                                        size=0.2),
            legend.position = c(0.2, 0.3),
            plot.title = element_text(size = tit_s, face = "bold", colour = "black"),
            #axis.ticks.y = element_blank(),
            axis.title.y = element_text(size = 11, colour = "black"),
            axis.text.x = element_text(size = 9, colour = "black"),
            axis.text.y = element_text(size = 9, colour = "black"),
            plot.margin = unit(c(m_top,m_right,m_bottom,0), "mm")
            )




bonding_margins_aggr <- ggplot()+
  
  #annotate("rect", xmin = min_diversity, xmax = max_diversity, ymin = 0.65, ymax = 1, alpha = .05) +
  annotate("rect", xmin = q1_diversity, xmax = q3_diversity, ymin = global_y_min, ymax = global_y_max, alpha = iqr_alpha) +
  geom_vline(xintercept = q1_diversity,size=0.1) +
  geom_vline(xintercept = q3_diversity,size=0.1) +
  geom_vline(xintercept = mean_diversity,size=0.3, linetype="dashed", alpha = .5) +
  
  #min inclusion prediction and CI
  geom_line(data=syn_data_bonding_aggr[syn_data_bonding_aggr$bonding==syn_data_bonding_aggr_min_inclusion,],   aes(blau2_z, ols_pred), color=lo_color)+
  geom_ribbon(data=syn_data_bonding_aggr[syn_data_bonding_aggr$bonding==syn_data_bonding_aggr_min_inclusion,], aes(blau2_z, ymin=ols_low, ymax=ols_up),alpha=ribbon_alpha, fill=lo_color)+

  #max inclusion prediction and CI
  geom_line(data=syn_data_bonding_aggr[syn_data_bonding_aggr$bonding==syn_data_bonding_aggr_max_inclusion,],   aes(blau2_z, ols_pred), color=hi_color)+
  geom_ribbon(data=syn_data_bonding_aggr[syn_data_bonding_aggr$bonding==syn_data_bonding_aggr_max_inclusion,], aes(blau2_z, ymin=ols_low, ymax=ols_up),alpha=ribbon_alpha, fill=hi_color)+ 
  
  #axes formatting
  scale_y_continuous(
                     #trans='log10',
                     limits=c(global_y_min, global_y_max), 
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     #breaks = c(30, 50, 100, 200, 300, 400, 500), 
                     name="") +
  scale_x_continuous(limits=c(min_diversity, max_diversity),
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     breaks = pretty(syn_data_bonding_aggr$blau2_z, n = 5), 
                     name="") +
  
coord_cartesian(ylim = c(0.69, 0.90)) +

  
  labs(title="Bonding")+
  
  #theme
  theme(aspect.ratio=1, 
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(), 
            panel.background = element_blank(), 
            panel.border = element_rect(colour = "black", 
                                        fill=NA, 
                                        size=0.2),
            legend.position = c(0.2, 0.3),
            plot.title = element_text(size = tit_s, face = "bold", colour = "black"),
            #axis.ticks.y = element_blank(),
            axis.title.y = element_text(size = 11, colour = "black"),
            axis.text.x = element_text(size = 9, colour = "black"),
            axis.text.y = element_text(size = 9, colour = "black"),
            plot.margin = unit(c(m_top,m_right,m_bottom,m_left), "mm")
            )




incorporating_margins_aggr <- ggplot()+
  
  #annotate("rect", xmin = min_diversity, xmax = max_diversity, ymin = 0.65, ymax = 1, alpha = .05) +
  annotate("rect", xmin = q1_diversity, xmax = q3_diversity, ymin = global_y_min, ymax = global_y_max, alpha = iqr_alpha) +
  geom_vline(xintercept = q1_diversity,size=0.1) +
  geom_vline(xintercept = q3_diversity,size=0.1) +
  geom_vline(xintercept = mean_diversity,size=0.3, linetype="dashed", alpha = .5) +
  
  #min inclusion prediction and CI
  geom_ribbon(data=syn_data_incorporating_aggr[syn_data_incorporating_aggr$incorporating==syn_data_incorporating_aggr_min_inclusion,], aes(blau2_z, ymin=ols_low, ymax=ols_up),alpha=ribbon_alpha, fill=lo_color)+
  geom_line(data=syn_data_incorporating_aggr[syn_data_incorporating_aggr$incorporating==syn_data_incorporating_aggr_min_inclusion,],   aes(blau2_z, ols_pred), color=lo_color)+

  #max inclusion prediction and CI
  
  geom_ribbon(data=syn_data_incorporating_aggr[syn_data_incorporating_aggr$incorporating==syn_data_incorporating_aggr_max_inclusion,], aes(blau2_z, ymin=ols_low, ymax=ols_up),alpha=ribbon_alpha, fill=hi_color)+ 
  geom_line(data=syn_data_incorporating_aggr[syn_data_incorporating_aggr$incorporating==syn_data_incorporating_aggr_max_inclusion,],   aes(blau2_z, ols_pred), color=hi_color)+
  
  #axes formatting
  scale_y_continuous(
                     #trans='log10',
                     limits=c(global_y_min, global_y_max), 
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     #breaks = c(30, 50, 100, 200, 300, 400, 500), 
                     name="Predicted distinctiveness") +
  scale_x_continuous(limits=c(min_diversity, max_diversity),
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     breaks = pretty(syn_data_incorporating_aggr$blau2_z, n = 5), 
                     name="Gender diversity") +
  
  coord_cartesian(ylim = c(0.69, 0.90)) +
  
  

  
  labs(title="Incorporating")+
  
  #theme
  theme(aspect.ratio=1, 
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(), 
            panel.background = element_blank(), 
            panel.border = element_rect(colour = "black", 
                                        fill=NA, 
                                        size=0.2),
            legend.position = c(0.2, 0.3),
            plot.title = element_text(size = tit_s, face = "bold", colour = "black"),
            #axis.ticks.y = element_blank(),
            axis.title.y = element_text(size = 11, colour = "black"),
            axis.text.x = element_text(size = 9, colour = "black"),
            axis.text.y = element_text(size = 9, colour = "black"),
            plot.margin = unit(c(m_top,m_right,m_bottom,m_left), "mm")
            )





combined_margins_aggr <- ggplot()+
  
  #annotate("rect", xmin = min_diversity, xmax = max_diversity, ymin = 0.65, ymax = 1, alpha = .05) +
  annotate("rect", xmin = q1_diversity, xmax = q3_diversity, ymin = global_y_min, ymax = global_y_max, alpha = iqr_alpha) +
  geom_vline(xintercept = q1_diversity,size=0.1) +
  geom_vline(xintercept = q3_diversity,size=0.1) +
  geom_vline(xintercept = mean_diversity,size=0.3, linetype="dashed", alpha = .5) +
  
  #min inclusion prediction and CI
  geom_line(data=syn_data_combined_aggr[syn_data_combined_aggr$combined==syn_data_combined_aggr_min_inclusion,],   aes(blau2_z, ols_pred), color=lo_color)+
  geom_ribbon(data=syn_data_combined_aggr[syn_data_combined_aggr$combined==syn_data_combined_aggr_min_inclusion,], aes(blau2_z, ymin=ols_low, ymax=ols_up),alpha=ribbon_alpha, fill=lo_color)+

  #max inclusion prediction and CI
  geom_line(data=syn_data_combined_aggr[syn_data_combined_aggr$combined==syn_data_combined_aggr_max_inclusion,],   aes(blau2_z, ols_pred), color=hi_color)+
  geom_ribbon(data=syn_data_combined_aggr[syn_data_combined_aggr$combined==syn_data_combined_aggr_max_inclusion,], aes(blau2_z, ymin=ols_low, ymax=ols_up),alpha=ribbon_alpha, fill=hi_color)+ 
  
  #axes formatting
  scale_y_continuous(
                     #trans='log10',
                     limits=c(global_y_min, global_y_max), 
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     #breaks = c(30, 50, 100, 200, 300, 400, 500), 
                     name="") +
  scale_x_continuous(limits=c(min_diversity, max_diversity),
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     breaks = pretty(syn_data_combined_aggr$blau2_z, n = 5), 
                     name="Gender diversity") +
  
  coord_cartesian(ylim = c(0.69, 0.90)) +
  
  

  
  labs(title="Combined inclusion")+
  
  #theme
  theme(aspect.ratio=1, 
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(), 
            panel.background = element_blank(), 
            panel.border = element_rect(colour = "black", 
                                        fill=NA, 
                                        size=0.2),
            legend.position = c(0.2, 0.3),
            plot.title = element_text(size = tit_s, face = "bold", colour = "black"),
            #axis.ticks.y = element_blank(),
            axis.title.y = element_text(size = 11, colour = "black"),
            axis.text.x = element_text(size = 9, colour = "black"),
            axis.text.y = element_text(size = 9, colour = "black"),
            plot.margin = unit(c(m_top,m_right,m_bottom,m_left), "mm")
            )





margins_firmlevel <- grid.arrange(mixing_margins_aggr, bonding_margins_aggr, incorporating_margins_aggr,combined_margins_aggr, nrow = 2)
#margins
```

```{r}
ggsave("margins_firmlevel_mid.pdf", margins_firmlevel, width = 5, height = 5)
ggsave("margins_firmlevel_sm.pdf", margins_firmlevel, width = 4, height = 4)
```



#Point estimates

##Game level, STD

```{r}
confint.robust <- function (object, parm, level = 0.95, ...)
{
    cf <- coef(object)
    pnames <- names(cf)
    if (missing(parm))
        parm <- pnames
    else if (is.numeric(parm))
        parm <- pnames[parm]
    a <- (1 - level)/2
    a <- c(a, 1 - a)
    pct <- stats:::format.perc(a, 3)
    fac <- qnorm(a)
    ci <- array(NA, dim = c(length(parm), 2L), dimnames = list(parm,
        pct))
    ses <- sqrt(diag(sandwich::vcovHC(object, type = "HC1", cluster=moby$org_dev)))[parm]
    ci[] <- cf[parm] + ses %o% fac
    ci
}
```


```{r}
#get model coefs with 95% CI
point_est_model1_var1 <- data.frame(without_inclusion_z$coefficients[2] ,confint.robust(without_inclusion_z, 2, level=0.95))
colnames(point_est_model1_var1) <- c("estim", "ci_025", "ci_975")

point_est_model2_var1 <- data.frame(mixing_z$coefficients[2] ,confint.robust(mixing_z, 2, level=0.95))
colnames(point_est_model2_var1) <- c("estim", "ci_025", "ci_975")
point_est_model2_var2 <- data.frame(mixing_z$coefficients[3] ,confint.robust(mixing_z, 3, level=0.95))
colnames(point_est_model2_var2) <- c("estim", "ci_025", "ci_975")
point_est_model2_var3 <- data.frame(mixing_z$coefficients[32] ,confint.robust(mixing_z, 32, level=0.95))
colnames(point_est_model2_var3) <- c("estim", "ci_025", "ci_975")

point_est_model3_var1 <- data.frame(bonding_z$coefficients[2] ,confint.robust(bonding_z, 2, level=0.95))
colnames(point_est_model3_var1) <- c("estim", "ci_025", "ci_975")
point_est_model3_var2 <- data.frame(bonding_z$coefficients[3] ,confint.robust(bonding_z, 3, level=0.95))
colnames(point_est_model3_var2) <- c("estim", "ci_025", "ci_975")
point_est_model3_var3 <- data.frame(bonding_z$coefficients[32] ,confint.robust(bonding_z, 32, level=0.95))
colnames(point_est_model3_var3) <- c("estim", "ci_025", "ci_975")

point_est_model4_var1 <- data.frame(incorporating_z$coefficients[2] ,confint.robust(incorporating_z, 2, level=0.95))
colnames(point_est_model4_var1) <- c("estim", "ci_025", "ci_975")
point_est_model4_var2 <- data.frame(incorporating_z$coefficients[3] ,confint.robust(incorporating_z, 3, level=0.95))
colnames(point_est_model4_var2) <- c("estim", "ci_025", "ci_975")
point_est_model4_var3 <- data.frame(incorporating_z$coefficients[32] ,confint.robust(incorporating_z, 32, level=0.95))
colnames(point_est_model4_var3) <- c("estim", "ci_025", "ci_975")

point_est_model5_var1 <- data.frame(combined_z$coefficients[2] ,confint.robust(combined_z, 2, level=0.95))
colnames(point_est_model5_var1) <- c("estim", "ci_025", "ci_975")
point_est_model5_var2 <- data.frame(combined_z$coefficients[3] ,confint.robust(combined_z, 3, level=0.95))
colnames(point_est_model5_var2) <- c("estim", "ci_025", "ci_975")
point_est_model5_var3 <- data.frame(combined_z$coefficients[32] ,confint.robust(combined_z, 32, level=0.95))
colnames(point_est_model5_var3) <- c("estim", "ci_025", "ci_975")
```

Game level point estiamtes, no title

```{r, fig.width = 2.64, fig.height = 2.3}

dropLeadingZero <- function(l){
  str_replace(l, '0(?=.)', '')
}

s <- 3.1
ps <- 2.85
tit_s <- 12
asp <- 1
annotate_y <- -0.07

m_top <- 1
m_left <-1
m_bottom <- 1
m_right <- 1

nonsig_col <- "gray60"
sig_col <- "black"

ols_estim_gamelevel_notitle <- ggplot()+
  geom_hline(yintercept = 0, linetype="dashed", alpha=0.7, color="black", size=0.2) +
  
  #prop women X inclusion

  geom_errorbar(data = point_est_model2_var3,aes(x = 1.3, ymin = ci_025, ymax = ci_975),width = 0,alpha = 1,color = ifelse(point_est_model2_var3$ci_025 * point_est_model2_var3$ci_975 < 0,nonsig_col,sig_col),size = 0.75) +
  geom_point(data = point_est_model2_var3,aes(x = 1.3, estim),alpha = 1,color = ifelse(point_est_model2_var3$ci_025 * point_est_model2_var3$ci_975 < 0,nonsig_col,sig_col),shape = 21,fill = ifelse(point_est_model2_var3$ci_025 * point_est_model2_var3$ci_975 < 0,nonsig_col,sig_col),size = ps,stroke = 1) +
  annotate(geom = "text",x = 1.3,y = point_est_model2_var3$estim,label = "1",col = "white",size = s,hjust = 0.5,alpha = 1) +
  
  geom_errorbar(data = point_est_model3_var3,aes(x = 1.1, ymin = ci_025, ymax = ci_975),width = 0,alpha = 1,color = ifelse(point_est_model3_var3$ci_025 * point_est_model3_var3$ci_975 < 0,nonsig_col,sig_col),size = 0.75) +
  geom_point(data = point_est_model3_var3,aes(x = 1.1, estim),alpha = 1,color = ifelse(point_est_model3_var3$ci_025 * point_est_model3_var3$ci_975 < 0,nonsig_col,sig_col),shape = 21,fill = ifelse(point_est_model3_var3$ci_025 * point_est_model3_var3$ci_975 < 0,nonsig_col,sig_col),size = ps,stroke = 1) +
  annotate(geom = "text",x = 1.1,y = point_est_model3_var3$estim,label = "2",col = "white",size = s,hjust = 0.5,alpha = 1) +
  
  geom_errorbar(data = point_est_model4_var3,aes(x = 0.9, ymin = ci_025, ymax = ci_975),width = 0,alpha = 1,color = ifelse(point_est_model4_var3$ci_025 * point_est_model4_var3$ci_975 < 0,nonsig_col,sig_col),size = 0.75) +
  geom_point(data = point_est_model4_var3,aes(x = 0.9, estim),alpha = 1,color = ifelse(point_est_model4_var3$ci_025 * point_est_model4_var3$ci_975 < 0,nonsig_col,sig_col),shape = 21,fill = ifelse(point_est_model4_var3$ci_025 * point_est_model4_var3$ci_975 < 0,nonsig_col,sig_col),size = ps,stroke = 1) +
  annotate(geom = "text",x = 0.9,y = point_est_model4_var3$estim,label = "3",col = "white",size = s,hjust = 0.5,alpha = 1) +
  
  geom_errorbar(data = point_est_model5_var3,aes(x = 0.7, ymin = ci_025, ymax = ci_975),width = 0,alpha = 1,color = ifelse(point_est_model5_var3$ci_025 * point_est_model5_var3$ci_975 < 0,nonsig_col,sig_col),size = 0.75) +
  geom_point(data = point_est_model5_var3,aes(x = 0.7, estim),alpha = 1,color = ifelse(point_est_model5_var3$ci_025 * point_est_model5_var3$ci_975 < 0,nonsig_col,sig_col),shape = 21,fill = ifelse(point_est_model5_var3$ci_025 * point_est_model5_var3$ci_975 < 0,nonsig_col,sig_col),size = ps,stroke = 1) +
  annotate(geom = "text",x = 0.7,y = point_est_model5_var3$estim,label = "4",col = "white",size = s,hjust = 0.5,alpha = 1) +
  
  
  #inclusion

  
  geom_errorbar(data = point_est_model2_var2,aes(x = 2.3, ymin = ci_025, ymax = ci_975),width = 0,alpha = 1,color = ifelse(point_est_model2_var2$ci_025 * point_est_model2_var2$ci_975 < 0,nonsig_col,sig_col),size = 0.75) +
  geom_point(data = point_est_model2_var2,aes(x = 2.3, estim),alpha = 1,color = ifelse(point_est_model2_var2$ci_025 * point_est_model2_var2$ci_975 < 0,nonsig_col,sig_col),shape = 21,fill = ifelse(point_est_model2_var2$ci_025 * point_est_model2_var2$ci_975 < 0,nonsig_col,sig_col),size = ps,stroke = 1) +
  annotate(geom = "text",x = 2.3,y = point_est_model2_var2$estim,label = "1",col = "white",size = s,hjust = 0.5,alpha = 1) +
  
  geom_errorbar(data = point_est_model3_var2,aes(x = 2.1, ymin = ci_025, ymax = ci_975),width = 0,alpha = 1,color = ifelse(point_est_model3_var2$ci_025 * point_est_model3_var2$ci_975 < 0,nonsig_col,sig_col),size = 0.75) +
  geom_point(data = point_est_model3_var2,aes(x = 2.1, estim),alpha = 1,color = ifelse(point_est_model3_var2$ci_025 * point_est_model3_var2$ci_975 < 0,nonsig_col,sig_col),shape = 21,fill = ifelse(point_est_model3_var2$ci_025 * point_est_model3_var2$ci_975 < 0,nonsig_col,sig_col),size = ps,stroke = 1) +
  annotate(geom = "text",x = 2.1,y = point_est_model3_var2$estim,label = "2",col = "white",size = s,hjust = 0.5,alpha = 1) +
  
  geom_errorbar(data = point_est_model4_var2,aes(x = 1.9, ymin = ci_025, ymax = ci_975),width = 0,alpha = 1,color = ifelse(point_est_model4_var2$ci_025 * point_est_model4_var2$ci_975 < 0,nonsig_col,sig_col),size = 0.75) +
  geom_point(data = point_est_model4_var2,aes(x = 1.9, estim),alpha = 1,color = ifelse(point_est_model4_var2$ci_025 * point_est_model4_var2$ci_975 < 0,nonsig_col,sig_col),shape = 21,fill = ifelse(point_est_model4_var2$ci_025 * point_est_model4_var2$ci_975 < 0,nonsig_col,sig_col),size = ps,stroke = 1) +
  annotate(geom = "text",x = 1.9,y = point_est_model4_var2$estim, label = "3",col = "white",size = s,hjust = 0.5,alpha = 1) +
  
  geom_errorbar(data = point_est_model5_var2,aes(x = 1.7, ymin = ci_025, ymax = ci_975),width = 0,alpha = 1,color = ifelse(point_est_model5_var2$ci_025 * point_est_model5_var2$ci_975 < 0,nonsig_col,sig_col),size = 0.75) +
  geom_point(data = point_est_model5_var2,aes(x = 1.7, estim),alpha = 1,color = ifelse(point_est_model5_var2$ci_025 * point_est_model5_var2$ci_975 < 0,nonsig_col,sig_col),shape = 21,fill = ifelse(point_est_model5_var2$ci_025 * point_est_model5_var2$ci_975 < 0,nonsig_col,sig_col),size = ps,stroke = 1) +
  annotate(geom = "text",x = 1.7,y = point_est_model5_var2$estim,label = "4",col = "white",size = s,hjust = 0.5,alpha = 1) +
  

  
  #prop women

  geom_errorbar(data = point_est_model1_var1,aes(x = 3.5, ymin = ci_025, ymax = ci_975),width = 0,alpha = 1,color = "red",size = 0.75) +
  geom_point(data = point_est_model1_var1,aes(x = 3.5, estim),alpha = 1,color = "red",shape = 21,fill = "red",size = ps,stroke = 1) +
  annotate(geom = "text",x = 3.5,y = point_est_model1_var1$estim,label = "0",col = "white",size = s,hjust = 0.5,alpha = 1) +
  
  geom_errorbar(data = point_est_model2_var1,aes(x = 3.3, ymin = ci_025, ymax = ci_975),width = 0,alpha = 1,color = ifelse(point_est_model2_var1$ci_025 * point_est_model2_var1$ci_975 < 0,nonsig_col,sig_col),size = 0.75) +
  geom_point(data = point_est_model2_var1,aes(x = 3.3, estim),alpha = 1,color = ifelse(point_est_model2_var1$ci_025 * point_est_model2_var1$ci_975 < 0,nonsig_col,sig_col),shape = 21,fill = ifelse(point_est_model2_var1$ci_025 * point_est_model2_var1$ci_975 < 0,nonsig_col,sig_col),size = ps,stroke = 1) +
  annotate(geom = "text",x = 3.3,y = point_est_model2_var1$estim,label = "1",col = "white",size = s,hjust = 0.5,alpha = 1) +
  
  geom_errorbar(data = point_est_model3_var1,aes(x = 3.1, ymin = ci_025, ymax = ci_975),width = 0,alpha = 1,color = ifelse(point_est_model3_var1$ci_025 * point_est_model3_var1$ci_975 < 0,nonsig_col,sig_col),size = 0.75) +
  geom_point(data = point_est_model3_var1,aes(x = 3.1, estim),alpha = 1,color = ifelse(point_est_model3_var1$ci_025 * point_est_model3_var1$ci_975 < 0,nonsig_col,sig_col),shape = 21,fill = ifelse(point_est_model3_var1$ci_025 * point_est_model3_var1$ci_975 < 0,nonsig_col,sig_col),size = ps,stroke = 1) +
  annotate(geom = "text",x = 3.1,y = point_est_model3_var1$estim,label = "2",col = "white",size = s,hjust = 0.5,alpha = 1) +
  
  geom_errorbar(data = point_est_model4_var1,aes(x = 2.9, ymin = ci_025, ymax = ci_975),width = 0,alpha = 1,color = ifelse(point_est_model4_var1$ci_025 * point_est_model4_var1$ci_975 < 0,nonsig_col,sig_col),size = 0.75) +
  geom_point(data = point_est_model4_var1,aes(x = 2.9, estim),alpha = 1,color = ifelse(point_est_model4_var1$ci_025 * point_est_model4_var1$ci_975 < 0,nonsig_col,sig_col),shape = 21,fill = ifelse(point_est_model4_var1$ci_025 * point_est_model4_var1$ci_975 < 0,nonsig_col,sig_col),size = ps,stroke = 1) +
  annotate(geom = "text",x = 2.9,y = point_est_model4_var1$estim,label = "3",col = "white",size = s,hjust = 0.5,alpha = 1) +
  
  geom_errorbar(data = point_est_model5_var1,aes(x = 2.7, ymin = ci_025, ymax = ci_975),width = 0,alpha = 1,color = ifelse(point_est_model5_var1$ci_025 * point_est_model5_var1$ci_975 < 0,nonsig_col,sig_col),size = 0.75) +
  geom_point(data = point_est_model5_var1,aes(x = 2.7, estim),alpha = 1,color = ifelse(point_est_model5_var1$ci_025 * point_est_model5_var1$ci_975 < 0,nonsig_col,sig_col),shape = 21,fill = ifelse(point_est_model5_var1$ci_025 * point_est_model5_var1$ci_975 < 0,nonsig_col,sig_col),size = ps,stroke = 1) +
  annotate(geom = "text",x = 2.7,y = point_est_model5_var1$estim,label = "4",col = "white",size = s,hjust = 0.5,alpha = 1) +
  

  
  #explain


  annotate(geom="text", x=3.5,    y=annotate_y, label="Main effect",   col="grey50", size=2.9, hjust = 1, alpha = 1) +
  geom_segment(aes(y=annotate_y,    x=3.5, yend = point_est_model1_var1$ci_025-0.01, xend = 3.5),size=0.3, col = "grey50", alpha=0.66, linetype=3) +  
    
  annotate(geom="text", x=1.3,    y=annotate_y, label="Mixing",   col="grey50", size=2.9, hjust = 1, alpha = 1) +
  geom_segment(aes(y=annotate_y,    x=1.3, yend = point_est_model2_var3$ci_025-0.01, xend = 1.3),size=0.3, col = "grey50", alpha=0.66, linetype=3) +
  
  annotate(geom="text", x=1.1,    y=annotate_y, label="Bonding",   col="grey50", size=2.9, hjust = 1, alpha = 1) +
  geom_segment(aes(y=annotate_y,    x=1.1, yend = point_est_model3_var3$ci_025-0.01, xend = 1.1),size=0.3, col = "grey50", alpha=0.66, linetype=3) +
  
  annotate(geom="text", x=0.9,    y=annotate_y, label="Incorporating",   col="grey50", size=2.9, hjust = 1, alpha = 1) +
  geom_segment(aes(y=annotate_y,    x=0.9, yend = point_est_model4_var3$ci_025-0.01, xend = 0.9),size=0.3, col = "grey50", alpha=0.66, linetype=3) +
  
  annotate(geom="text", x=0.7,    y=annotate_y, label="Combined",   col="grey50", size=2.9, hjust = 1, alpha = 1) +
  geom_segment(aes(y=annotate_y,    x=0.7, yend = point_est_model5_var3$ci_025-0.01, xend = 0.7),size=0.3, col = "grey50", alpha=0.66, linetype=3) +

  
  
  geom_vline(xintercept = 1.5, linetype="solid", alpha=0.7, color="black", size=0.2) +
  geom_vline(xintercept = 2.5, linetype="solid", alpha=0.7, color="black", size=0.2) +
  #geom_vline(xintercept = 3.425, linetype="solid", alpha=0.7, color="black", size=0.2) +
  #geom_vline(xintercept = 4.425, linetype="solid", alpha=0.7, color="black", size=0.2) +
  
  scale_x_continuous(breaks=(1:3), expand = c(0.05,0.05), labels=c("Gender\ndiversity \u00D7\nInclusion", "Inclusion", "Gender\ndiversity")) +
  #scale_y_continuous(breaks=c(-0.2, -0.1, 0, 0.1, 0.2, 0.3)) +
  #coord_cartesian(ylim = c(-0.2, 0.2)) +
  
   labs(y="Distinctiveness") +
  #ggtitle("a: Game level") + 
  scale_y_continuous(breaks=seq(-0.4, 0.2, 0.1), labels = dropLeadingZero)+
  coord_flip(ylim = c(-0.25, 0.11)) +
  theme(aspect.ratio=asp, 
            title =element_text(size=11),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(), 
            panel.background = element_blank(), 
            panel.border = element_rect(colour = "black", 
                                        fill=NA, 
                                        size=0.2),
            #legend.position = c(0.2, 0.3),
            plot.title = element_text(size = tit_s, face = "bold", colour = "black"),
            axis.ticks.y = element_blank(),
            axis.title.y = element_blank(),
            axis.text.y = element_text(size = 11, colour = "black"),
            plot.margin = unit(c(m_top,m_right,m_bottom,m_left), "mm")
            )
  

#grid.newpage()
ols_estim_gamelevel_notitle
```

```{r}
ggsave("ols_estim_gamelevel.pdf", ols_estim_gamelevel_notitle, width = 2.5, height = 2.5)
```



##Game level, with random effects

```{r}
confint.robust <- function (object, parm, level = 0.95, ...)
{
    cf <- coef(object)
    pnames <- names(cf)
    if (missing(parm))
        parm <- pnames
    else if (is.numeric(parm))
        parm <- pnames[parm]
    a <- (1 - level)/2
    a <- c(a, 1 - a)
    pct <- stats:::format.perc(a, 3)
    fac <- qnorm(a)
    ci <- array(NA, dim = c(length(parm), 2L), dimnames = list(parm,
        pct))
    ses <- sqrt(diag(sandwich::vcovHC(object, type = "HC1", cluster="group")))[parm]
    ci[] <- cf[parm] + ses %o% fac
    ci
}
```

```{r}
#get model coefs with 95% CI
point_est_model1_var1 <- data.frame(without_inclusion_re$coefficients[2] ,confint.robust(without_inclusion_re, 2, level=0.95))
colnames(point_est_model1_var1) <- c("estim", "ci_025", "ci_975")

point_est_model2_var1 <- data.frame(mixing_re$coefficients[2] ,confint.robust(mixing_re, 2, level=0.95))
colnames(point_est_model2_var1) <- c("estim", "ci_025", "ci_975")
point_est_model2_var2 <- data.frame(mixing_re$coefficients[3] ,confint.robust(mixing_re, 3, level=0.95))
colnames(point_est_model2_var2) <- c("estim", "ci_025", "ci_975")
point_est_model2_var3 <- data.frame(mixing_re$coefficients[32] ,confint.robust(mixing_re, 32, level=0.95))
colnames(point_est_model2_var3) <- c("estim", "ci_025", "ci_975")

point_est_model3_var1 <- data.frame(bonding_re$coefficients[2] ,confint.robust(bonding_re, 2, level=0.95))
colnames(point_est_model3_var1) <- c("estim", "ci_025", "ci_975")
point_est_model3_var2 <- data.frame(bonding_re$coefficients[3] ,confint.robust(bonding_re, 3, level=0.95))
colnames(point_est_model3_var2) <- c("estim", "ci_025", "ci_975")
point_est_model3_var3 <- data.frame(bonding_re$coefficients[32] ,confint.robust(bonding_re, 32, level=0.95))
colnames(point_est_model3_var3) <- c("estim", "ci_025", "ci_975")

point_est_model4_var1 <- data.frame(incorporating_re$coefficients[2] ,confint.robust(incorporating_re, 2, level=0.95))
colnames(point_est_model4_var1) <- c("estim", "ci_025", "ci_975")
point_est_model4_var2 <- data.frame(incorporating_re$coefficients[3] ,confint.robust(incorporating_re, 3, level=0.95))
colnames(point_est_model4_var2) <- c("estim", "ci_025", "ci_975")
point_est_model4_var3 <- data.frame(incorporating_re$coefficients[32] ,confint.robust(incorporating_re, 32, level=0.95))
colnames(point_est_model4_var3) <- c("estim", "ci_025", "ci_975")

point_est_model5_var1 <- data.frame(combined_re$coefficients[2] ,confint.robust(combined_re, 2, level=0.95))
colnames(point_est_model5_var1) <- c("estim", "ci_025", "ci_975")
point_est_model5_var2 <- data.frame(combined_re$coefficients[3] ,confint.robust(combined_re, 3, level=0.95))
colnames(point_est_model5_var2) <- c("estim", "ci_025", "ci_975")
point_est_model5_var3 <- data.frame(combined_re$coefficients[32] ,confint.robust(combined_re, 32, level=0.95))
colnames(point_est_model5_var3) <- c("estim", "ci_025", "ci_975")
```

```{r, fig.width = 2.2, fig.height = 2.6}

dropLeadingZero <- function(l){
  str_replace(l, '0(?=.)', '')
}

s <- 3.1
ps <- 2.85
tit_s <- 12
asp <- 1
annotate_y <- -0.07

m_top <- 2
m_left <-0
m_bottom <- 0
m_right <- 0

nonsig_col <- "gray60"
sig_col <- "black"

ols_estim_gamelevel_re <- ggplot()+
  geom_hline(yintercept = 0, linetype="dashed", alpha=0.7, color="black", size=0.2) +
  
   #prop women X inclusion

  geom_errorbar(
    data = point_est_model2_var3,
    aes(x = 1.3, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model2_var3$ci_025 * point_est_model2_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model2_var3,
    aes(x = 1.3, estim),
    alpha = 1,
    color = ifelse(
      point_est_model2_var3$ci_025 * point_est_model2_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model2_var3$ci_025 * point_est_model2_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 1.3,
    y = point_est_model2_var3$estim,
    label = "1",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  
  geom_errorbar(
    data = point_est_model3_var3,
    aes(x = 1.1, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model3_var3$ci_025 * point_est_model3_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model3_var3,
    aes(x = 1.1, estim),
    alpha = 1,
    color = ifelse(
      point_est_model3_var3$ci_025 * point_est_model3_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model3_var3$ci_025 * point_est_model3_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 1.1,
    y = point_est_model3_var3$estim,
    label = "2",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  
  geom_errorbar(
    data = point_est_model4_var3,
    aes(x = 0.9, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model4_var3$ci_025 * point_est_model4_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model4_var3,
    aes(x = 0.9, estim),
    alpha = 1,
    color = ifelse(
      point_est_model4_var3$ci_025 * point_est_model4_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model4_var3$ci_025 * point_est_model4_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 0.9,
    y = point_est_model4_var3$estim,
    label = "3",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  
  geom_errorbar(
    data = point_est_model5_var3,
    aes(x = 0.7, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model5_var3$ci_025 * point_est_model5_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model5_var3,
    aes(x = 0.7, estim),
    alpha = 1,
    color = ifelse(
      point_est_model5_var3$ci_025 * point_est_model5_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model5_var3$ci_025 * point_est_model5_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 0.7,
    y = point_est_model5_var3$estim,
    label = "4",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  
  
  #inclusion

  
  geom_errorbar(
    data = point_est_model2_var2,
    aes(x = 2.3, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model2_var2$ci_025 * point_est_model2_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model2_var2,
    aes(x = 2.3, estim),
    alpha = 1,
    color = ifelse(
      point_est_model2_var2$ci_025 * point_est_model2_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model2_var2$ci_025 * point_est_model2_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 2.3,
    y = point_est_model2_var2$estim,
    label = "1",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  
  geom_errorbar(
    data = point_est_model3_var2,
    aes(x = 2.1, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model3_var2$ci_025 * point_est_model3_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model3_var2,
    aes(x = 2.1, estim),
    alpha = 1,
    color = ifelse(
      point_est_model3_var2$ci_025 * point_est_model3_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model3_var2$ci_025 * point_est_model3_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 2.1,
    y = point_est_model3_var2$estim,
    label = "2",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  
  geom_errorbar(
    data = point_est_model4_var2,
    aes(x = 1.9, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model4_var2$ci_025 * point_est_model4_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model4_var2,
    aes(x = 1.9, estim),
    alpha = 1,
    color = ifelse(
      point_est_model4_var2$ci_025 * point_est_model4_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model4_var2$ci_025 * point_est_model4_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 1.9,
    y = point_est_model4_var2$estim,
    label = "3",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  
  geom_errorbar(
    data = point_est_model5_var2,
    aes(x = 1.7, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model5_var2$ci_025 * point_est_model5_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model5_var2,
    aes(x = 1.7, estim),
    alpha = 1,
    color = ifelse(
      point_est_model5_var2$ci_025 * point_est_model5_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model5_var2$ci_025 * point_est_model5_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 1.7,
    y = point_est_model5_var2$estim,
    label = "4",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  

  
  #prop women

  
    
  geom_errorbar(
    data = point_est_model1_var1,
    aes(x = 3.5, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = "red",
    size = 0.75
  ) +
  geom_point(
    data = point_est_model1_var1,
    aes(x = 3.5, estim),
    alpha = 1,
    color = "red",
    shape = 21,
    fill = "red",
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 3.5,
    y = point_est_model1_var1$estim,
    label = "0",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  
  geom_errorbar(
    data = point_est_model2_var1,
    aes(x = 3.3, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model2_var1$ci_025 * point_est_model2_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model2_var1,
    aes(x = 3.3, estim),
    alpha = 1,
    color = ifelse(
      point_est_model2_var1$ci_025 * point_est_model2_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model2_var1$ci_025 * point_est_model2_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 3.3,
    y = point_est_model2_var1$estim,
    label = "1",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  
  geom_errorbar(
    data = point_est_model3_var1,
    aes(x = 3.1, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model3_var1$ci_025 * point_est_model3_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model3_var1,
    aes(x = 3.1, estim),
    alpha = 1,
    color = ifelse(
      point_est_model3_var1$ci_025 * point_est_model3_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model3_var1$ci_025 * point_est_model3_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 3.1,
    y = point_est_model3_var1$estim,
    label = "2",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  
  geom_errorbar(
    data = point_est_model4_var1,
    aes(x = 2.9, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model4_var1$ci_025 * point_est_model4_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model4_var1,
    aes(x = 2.9, estim),
    alpha = 1,
    color = ifelse(
      point_est_model4_var1$ci_025 * point_est_model4_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model4_var1$ci_025 * point_est_model4_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 2.9,
    y = point_est_model4_var1$estim,
    label = "3",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  
  geom_errorbar(
    data = point_est_model5_var1,
    aes(x = 2.7, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model5_var1$ci_025 * point_est_model5_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model5_var1,
    aes(x = 2.7, estim),
    alpha = 1,
    color = ifelse(
      point_est_model5_var1$ci_025 * point_est_model5_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model5_var1$ci_025 * point_est_model5_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 2.7,
    y = point_est_model5_var1$estim,
    label = "4",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  

  
  #explain


  # annotate(geom="text", x=3.5,    y=annotate_y, label="Main effect",   col="grey50", size=2.9, hjust = 1, alpha = 1) +
  # geom_segment(aes(y=annotate_y,    x=3.5, yend = point_est_model1_var1$ci_025-0.01, xend = 3.5),size=0.3, col = "grey50", alpha=0.66, linetype=3) +  
  #   
  # annotate(geom="text", x=1.3,    y=annotate_y, label="Mixing",   col="grey50", size=2.9, hjust = 1, alpha = 1) +
  # geom_segment(aes(y=annotate_y,    x=1.3, yend = point_est_model2_var3$ci_025-0.01, xend = 1.3),size=0.3, col = "grey50", alpha=0.66, linetype=3) +
  # 
  # annotate(geom="text", x=1.1,    y=annotate_y, label="Bonding",   col="grey50", size=2.9, hjust = 1, alpha = 1) +
  # geom_segment(aes(y=annotate_y,    x=1.1, yend = point_est_model3_var3$ci_025-0.01, xend = 1.1),size=0.3, col = "grey50", alpha=0.66, linetype=3) +
  # 
  # annotate(geom="text", x=0.9,    y=annotate_y, label="Incorporating",   col="grey50", size=2.9, hjust = 1, alpha = 1) +
  # geom_segment(aes(y=annotate_y,    x=0.9, yend = point_est_model4_var3$ci_025-0.01, xend = 0.9),size=0.3, col = "grey50", alpha=0.66, linetype=3) +
  # 
  # annotate(geom="text", x=0.7,    y=annotate_y, label="Combined",   col="grey50", size=2.9, hjust = 1, alpha = 1) +
  # geom_segment(aes(y=annotate_y,    x=0.7, yend = point_est_model5_var3$ci_025-0.01, xend = 0.7),size=0.3, col = "grey50", alpha=0.66, linetype=3) +

  
  
  geom_vline(xintercept = 1.5, linetype="solid", alpha=0.7, color="black", size=0.2) +
  geom_vline(xintercept = 2.5, linetype="solid", alpha=0.7, color="black", size=0.2) +
  #geom_vline(xintercept = 3.425, linetype="solid", alpha=0.7, color="black", size=0.2) +
  #geom_vline(xintercept = 4.425, linetype="solid", alpha=0.7, color="black", size=0.2) +
  
  scale_x_continuous(breaks=(1:3), expand = c(0.05,0.05)
                     #, labels=c("Gender\ndiversity \u00D7\nInclusion", "Inclusion", "Gender\ndiversity")
                     , labels=c("","","")
                     ) +
  #scale_y_continuous(breaks=c(-0.2, -0.1, 0, 0.1, 0.2, 0.3)) +
  #coord_cartesian(ylim = c(-0.2, 0.2)) +
  
   labs(y="Distinctiveness") +
  ggtitle("b: Game level, firm RE") + 
  scale_y_continuous(breaks=seq(-0.4, 0.2, 0.1), labels = dropLeadingZero)+
  coord_flip(ylim = c(-0.25, 0.12)) +
  theme(aspect.ratio=asp, 
            title =element_text(size=11),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(), 
            panel.background = element_blank(), 
            panel.border = element_rect(colour = "black", 
                                        fill=NA, 
                                        size=0.2),
            #legend.position = c(0.2, 0.3),
            plot.title = element_text(size = tit_s, face = "bold", colour = "black"),
            axis.ticks.y = element_blank(),
            axis.title.y = element_blank(),
            axis.text.y = element_text(size = 11, colour = "black"),
            plot.margin = unit(c(m_top,m_right,m_bottom,m_left), "mm")
            )
  

#grid.newpage()
ols_estim_gamelevel_re
```

##Game level, with fixed intercepts

```{r}
#get model coefs with 95% CI
point_est_model1_var1 <- data.frame(without_inclusion_fe_2$coefficients[1] ,confint(without_inclusion_fe_2, 2, level=0.95))
colnames(point_est_model1_var1) <- c("estim", "ci_025", "ci_975")

point_est_model2_var1 <- data.frame(mixing_fe_2$coefficients[1] ,confint.robust(mixing_fe_2, 1, level=0.95))
colnames(point_est_model2_var1) <- c("estim", "ci_025", "ci_975")
point_est_model2_var2 <- data.frame(mixing_fe_2$coefficients[2] ,confint.robust(mixing_fe_2, 2, level=0.95))
colnames(point_est_model2_var2) <- c("estim", "ci_025", "ci_975")
point_est_model2_var3 <- data.frame(mixing_fe_2$coefficients[31] ,confint.robust(mixing_fe_2, 31, level=0.95))
colnames(point_est_model2_var3) <- c("estim", "ci_025", "ci_975")

point_est_model3_var1 <- data.frame(bonding_fe_2$coefficients[1] ,confint.robust(bonding_fe_2, 1, level=0.95))
colnames(point_est_model3_var1) <- c("estim", "ci_025", "ci_975")
point_est_model3_var2 <- data.frame(bonding_fe_2$coefficients[2] ,confint.robust(bonding_fe_2, 2, level=0.95))
colnames(point_est_model3_var2) <- c("estim", "ci_025", "ci_975")
point_est_model3_var3 <- data.frame(bonding_fe_2$coefficients[31] ,confint.robust(bonding_fe_2, 31, level=0.95))
colnames(point_est_model3_var3) <- c("estim", "ci_025", "ci_975")

point_est_model4_var1 <- data.frame(incorporating_fe_2$coefficients[1] ,confint.robust(incorporating_fe_2, 1, level=0.95))
colnames(point_est_model4_var1) <- c("estim", "ci_025", "ci_975")
point_est_model4_var2 <- data.frame(incorporating_fe_2$coefficients[2] ,confint.robust(incorporating_fe_2, 2, level=0.95))
colnames(point_est_model4_var2) <- c("estim", "ci_025", "ci_975")
point_est_model4_var3 <- data.frame(incorporating_fe_2$coefficients[31] ,confint.robust(incorporating_fe_2, 31, level=0.95))
colnames(point_est_model4_var3) <- c("estim", "ci_025", "ci_975")

point_est_model5_var1 <- data.frame(combined_fe_2$coefficients[1] ,confint.robust(combined_fe_2, 1, level=0.95))
colnames(point_est_model5_var1) <- c("estim", "ci_025", "ci_975")
point_est_model5_var2 <- data.frame(combined_fe_2$coefficients[2] ,confint.robust(combined_fe_2, 2, level=0.95))
colnames(point_est_model5_var2) <- c("estim", "ci_025", "ci_975")
point_est_model5_var3 <- data.frame(combined_fe_2$coefficients[31] ,confint.robust(combined_fe_2, 31, level=0.95))
colnames(point_est_model5_var3) <- c("estim", "ci_025", "ci_975")
```

```{r, fig.width = 2.2, fig.height = 2.6}

dropLeadingZero <- function(l){
  str_replace(l, '0(?=.)', '')
}

s <- 3.1
ps <- 2.85
tit_s <- 12
asp <- 1
annotate_y <- -0.07 


m_top <- 2
m_left <-0
m_bottom <- 0
m_right <- 0

nonsig_col <- "gray60"
sig_col <- "black"

ols_estim_gamelevel_fe <- ggplot()+
  geom_hline(yintercept = 0, linetype="dashed", alpha=0.7, color="black", size=0.2) +
  
   #prop women X inclusion

  geom_errorbar(
    data = point_est_model2_var3,
    aes(x = 1.3, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model2_var3$ci_025 * point_est_model2_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model2_var3,
    aes(x = 1.3, estim),
    alpha = 1,
    color = ifelse(
      point_est_model2_var3$ci_025 * point_est_model2_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model2_var3$ci_025 * point_est_model2_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 1.3,
    y = point_est_model2_var3$estim,
    label = "1",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  
  geom_errorbar(
    data = point_est_model3_var3,
    aes(x = 1.1, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model3_var3$ci_025 * point_est_model3_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model3_var3,
    aes(x = 1.1, estim),
    alpha = 1,
    color = ifelse(
      point_est_model3_var3$ci_025 * point_est_model3_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model3_var3$ci_025 * point_est_model3_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 1.1,
    y = point_est_model3_var3$estim,
    label = "2",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  
  geom_errorbar(
    data = point_est_model4_var3,
    aes(x = 0.9, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model4_var3$ci_025 * point_est_model4_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model4_var3,
    aes(x = 0.9, estim),
    alpha = 1,
    color = ifelse(
      point_est_model4_var3$ci_025 * point_est_model4_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model4_var3$ci_025 * point_est_model4_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 0.9,
    y = point_est_model4_var3$estim,
    label = "3",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  
  geom_errorbar(
    data = point_est_model5_var3,
    aes(x = 0.7, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model5_var3$ci_025 * point_est_model5_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model5_var3,
    aes(x = 0.7, estim),
    alpha = 1,
    color = ifelse(
      point_est_model5_var3$ci_025 * point_est_model5_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model5_var3$ci_025 * point_est_model5_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 0.7,
    y = point_est_model5_var3$estim,
    label = "4",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  
  
  #inclusion

  
  geom_errorbar(
    data = point_est_model2_var2,
    aes(x = 2.3, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model2_var2$ci_025 * point_est_model2_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model2_var2,
    aes(x = 2.3, estim),
    alpha = 1,
    color = ifelse(
      point_est_model2_var2$ci_025 * point_est_model2_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model2_var2$ci_025 * point_est_model2_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 2.3,
    y = point_est_model2_var2$estim,
    label = "1",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  
  geom_errorbar(
    data = point_est_model3_var2,
    aes(x = 2.1, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model3_var2$ci_025 * point_est_model3_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model3_var2,
    aes(x = 2.1, estim),
    alpha = 1,
    color = ifelse(
      point_est_model3_var2$ci_025 * point_est_model3_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model3_var2$ci_025 * point_est_model3_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 2.1,
    y = point_est_model3_var2$estim,
    label = "2",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  
  geom_errorbar(
    data = point_est_model4_var2,
    aes(x = 1.9, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model4_var2$ci_025 * point_est_model4_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model4_var2,
    aes(x = 1.9, estim),
    alpha = 1,
    color = ifelse(
      point_est_model4_var2$ci_025 * point_est_model4_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model4_var2$ci_025 * point_est_model4_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 1.9,
    y = point_est_model4_var2$estim,
    label = "3",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  
  geom_errorbar(
    data = point_est_model5_var2,
    aes(x = 1.7, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model5_var2$ci_025 * point_est_model5_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model5_var2,
    aes(x = 1.7, estim),
    alpha = 1,
    color = ifelse(
      point_est_model5_var2$ci_025 * point_est_model5_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model5_var2$ci_025 * point_est_model5_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 1.7,
    y = point_est_model5_var2$estim,
    label = "4",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  

  
  #prop women

  
    
  geom_errorbar(
    data = point_est_model1_var1,
    aes(x = 3.5, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = "red",
    size = 0.75
  ) +
  geom_point(
    data = point_est_model1_var1,
    aes(x = 3.5, estim),
    alpha = 1,
    color = "red",
    shape = 21,
    fill = "red",
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 3.5,
    y = point_est_model1_var1$estim,
    label = "0",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  
  geom_errorbar(
    data = point_est_model2_var1,
    aes(x = 3.3, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model2_var1$ci_025 * point_est_model2_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model2_var1,
    aes(x = 3.3, estim),
    alpha = 1,
    color = ifelse(
      point_est_model2_var1$ci_025 * point_est_model2_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model2_var1$ci_025 * point_est_model2_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 3.3,
    y = point_est_model2_var1$estim,
    label = "1",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  
  geom_errorbar(
    data = point_est_model3_var1,
    aes(x = 3.1, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model3_var1$ci_025 * point_est_model3_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model3_var1,
    aes(x = 3.1, estim),
    alpha = 1,
    color = ifelse(
      point_est_model3_var1$ci_025 * point_est_model3_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model3_var1$ci_025 * point_est_model3_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 3.1,
    y = point_est_model3_var1$estim,
    label = "2",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  
  geom_errorbar(
    data = point_est_model4_var1,
    aes(x = 2.9, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model4_var1$ci_025 * point_est_model4_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model4_var1,
    aes(x = 2.9, estim),
    alpha = 1,
    color = ifelse(
      point_est_model4_var1$ci_025 * point_est_model4_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model4_var1$ci_025 * point_est_model4_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 2.9,
    y = point_est_model4_var1$estim,
    label = "3",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  
  geom_errorbar(
    data = point_est_model5_var1,
    aes(x = 2.7, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model5_var1$ci_025 * point_est_model5_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model5_var1,
    aes(x = 2.7, estim),
    alpha = 1,
    color = ifelse(
      point_est_model5_var1$ci_025 * point_est_model5_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model5_var1$ci_025 * point_est_model5_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 2.7,
    y = point_est_model5_var1$estim,
    label = "4",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  

  
  #explain


  # annotate(geom="text", x=3.5,    y=annotate_y, label="Main effect",   col="grey50", size=2.9, hjust = 1, alpha = 1) +
  # geom_segment(aes(y=annotate_y,    x=3.5, yend = point_est_model1_var1$ci_025-0.01, xend = 3.5),size=0.3, col = "grey50", alpha=0.66, linetype=3) +  
  #   
  # annotate(geom="text", x=1.3,    y=annotate_y, label="Mixing",   col="grey50", size=2.9, hjust = 1, alpha = 1) +
  # geom_segment(aes(y=annotate_y,    x=1.3, yend = point_est_model2_var3$ci_025-0.01, xend = 1.3),size=0.3, col = "grey50", alpha=0.66, linetype=3) +
  # 
  # annotate(geom="text", x=1.1,    y=annotate_y, label="Bonding",   col="grey50", size=2.9, hjust = 1, alpha = 1) +
  # geom_segment(aes(y=annotate_y,    x=1.1, yend = point_est_model3_var3$ci_025-0.01, xend = 1.1),size=0.3, col = "grey50", alpha=0.66, linetype=3) +
  # 
  # annotate(geom="text", x=0.9,    y=annotate_y, label="Incorporating",   col="grey50", size=2.9, hjust = 1, alpha = 1) +
  # geom_segment(aes(y=annotate_y,    x=0.9, yend = point_est_model4_var3$ci_025-0.01, xend = 0.9),size=0.3, col = "grey50", alpha=0.66, linetype=3) +
  # 
  # annotate(geom="text", x=0.7,    y=annotate_y, label="Combined",   col="grey50", size=2.9, hjust = 1, alpha = 1) +
  # geom_segment(aes(y=annotate_y,    x=0.7, yend = point_est_model5_var3$ci_025-0.01, xend = 0.7),size=0.3, col = "grey50", alpha=0.66, linetype=3) +

  
  
  geom_vline(xintercept = 1.5, linetype="solid", alpha=0.7, color="black", size=0.2) +
  geom_vline(xintercept = 2.5, linetype="solid", alpha=0.7, color="black", size=0.2) +
  #geom_vline(xintercept = 3.425, linetype="solid", alpha=0.7, color="black", size=0.2) +
  #geom_vline(xintercept = 4.425, linetype="solid", alpha=0.7, color="black", size=0.2) +
  
  scale_x_continuous(breaks=(1:3), expand = c(0.05,0.05)
                     #, labels=c("Gender\ndiversity \u00D7\nInclusion", "Inclusion", "Gender\ndiversity")
                     , labels=c("","","")
                     ) +
  #scale_y_continuous(breaks=c(-0.2, -0.1, 0, 0.1, 0.2, 0.3)) +
  #coord_cartesian(ylim = c(-0.2, 0.2)) +
  
   labs(y="Distinctiveness") +
  ggtitle("c: Game level, firm FE") + 
  scale_y_continuous(breaks=seq(-0.4, 0.2, 0.1), labels = dropLeadingZero)+
  coord_flip(ylim = c(-0.25, 0.12)) +
  theme(aspect.ratio=asp, 
            title =element_text(size=11),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(), 
            panel.background = element_blank(), 
            panel.border = element_rect(colour = "black", 
                                        fill=NA, 
                                        size=0.2),
            #legend.position = c(0.2, 0.3),
            plot.title = element_text(size = tit_s, colour = "black", face = "bold"),
            axis.ticks.y = element_blank(),
            axis.title.y = element_blank(),
            axis.text.y = element_text(size = 11, colour = "black"),
            plot.margin = unit(c(m_top,m_right,m_bottom,m_left), "mm")
            )
  

#grid.newpage()
ols_estim_gamelevel_fe
```

##Firm level, STD

```{r}
confint.robust <- function (object, parm, level = 0.95, ...)
{
    cf <- coef(object)
    pnames <- names(cf)
    if (missing(parm))
        parm <- pnames
    else if (is.numeric(parm))
        parm <- pnames[parm]
    a <- (1 - level)/2
    a <- c(a, 1 - a)
    pct <- stats:::format.perc(a, 3)
    fac <- qnorm(a)
    ci <- array(NA, dim = c(length(parm), 2L), dimnames = list(parm,
        pct))
    ses <- sqrt(diag(sandwich::vcovHC(object, type = "HC1")))[parm]
    ci[] <- cf[parm] + ses %o% fac
    ci
}
```

```{r}
#get model coefs with 95% CI
point_est_model1_var1 <- data.frame(without_inclusion_aggr_z$coefficients[2] ,confint.robust(without_inclusion_aggr_z, 2, level=0.95))
colnames(point_est_model1_var1) <- c("estim", "ci_025", "ci_975")


point_est_model2_var1 <- data.frame(mixing_aggr_z$coefficients[2] ,confint.robust(mixing_aggr_z, 2, level=0.95))
colnames(point_est_model2_var1) <- c("estim", "ci_025", "ci_975")
point_est_model2_var2 <- data.frame(mixing_aggr_z$coefficients[3] ,confint.robust(mixing_aggr_z, 3, level=0.95))
colnames(point_est_model2_var2) <- c("estim", "ci_025", "ci_975")
point_est_model2_var3 <- data.frame(mixing_aggr_z$coefficients[32] ,confint.robust(mixing_aggr_z, 32, level=0.95))
colnames(point_est_model2_var3) <- c("estim", "ci_025", "ci_975")

point_est_model3_var1 <- data.frame(bonding_aggr_z$coefficients[2] ,confint.robust(bonding_aggr_z, 2, level=0.95))
colnames(point_est_model3_var1) <- c("estim", "ci_025", "ci_975")
point_est_model3_var2 <- data.frame(bonding_aggr_z$coefficients[3] ,confint.robust(bonding_aggr_z, 3, level=0.95))
colnames(point_est_model3_var2) <- c("estim", "ci_025", "ci_975")
point_est_model3_var3 <- data.frame(bonding_aggr_z$coefficients[32] ,confint.robust(bonding_aggr_z, 32, level=0.95))
colnames(point_est_model3_var3) <- c("estim", "ci_025", "ci_975")

point_est_model4_var1 <- data.frame(incorporating_aggr_z$coefficients[2] ,confint.robust(incorporating_aggr_z, 2, level=0.95))
colnames(point_est_model4_var1) <- c("estim", "ci_025", "ci_975")
point_est_model4_var2 <- data.frame(incorporating_aggr_z$coefficients[3] ,confint.robust(incorporating_aggr_z, 3, level=0.95))
colnames(point_est_model4_var2) <- c("estim", "ci_025", "ci_975")
point_est_model4_var3 <- data.frame(incorporating_aggr_z$coefficients[32] ,confint.robust(incorporating_aggr_z, 32, level=0.95))
colnames(point_est_model4_var3) <- c("estim", "ci_025", "ci_975")

point_est_model5_var1 <- data.frame(combined_aggr_z$coefficients[2] ,confint.robust(combined_aggr_z, 2, level=0.95))
colnames(point_est_model5_var1) <- c("estim", "ci_025", "ci_975")
point_est_model5_var2 <- data.frame(combined_aggr_z$coefficients[3] ,confint.robust(combined_aggr_z, 3, level=0.95))
colnames(point_est_model5_var2) <- c("estim", "ci_025", "ci_975")
point_est_model5_var3 <- data.frame(combined_aggr_z$coefficients[32] ,confint.robust(combined_aggr_z, 32, level=0.95))
colnames(point_est_model5_var3) <- c("estim", "ci_025", "ci_975")
```

```{r, fig.width = 2.2, fig.height = 2.6}
dropLeadingZero <- function(l){
  str_replace(l, '0(?=.)', '')
}


s <- 3.1
ps <- 2.85
tit_s <- 12
asp <- 1
annotate_y <- -0.07

m_top <- 2
m_left <-0
m_bottom <- 0
m_right <- 0

ols_estim_firmlevel <- ggplot()+
  geom_hline(yintercept = 0, linetype="dashed", alpha=0.7, color="black", size=0.2) +
  
  #prop women X inclusion

  geom_errorbar(data = point_est_model2_var3, aes(x = 1.3, ymin = ci_025, ymax = ci_975), width=0, alpha=1, color = ifelse(point_est_model2_var3$ci_025 * point_est_model2_var3$ci_975 < 0,nonsig_col,sig_col), size=0.75) +
  geom_point(   data = point_est_model2_var3, aes(x = 1.3, estim), alpha=1, color = ifelse(point_est_model2_var3$ci_025 * point_est_model2_var3$ci_975 < 0,nonsig_col,sig_col), shape=21, fill= ifelse(point_est_model2_var3$ci_025 * point_est_model2_var3$ci_975 < 0,nonsig_col,sig_col), size=ps, stroke=1) +
  annotate(geom="text", x=1.3,    y=point_est_model2_var3$estim, label="1",   col="white", size=s, hjust = 0.5, alpha = 1) +
  
  geom_errorbar(data = point_est_model3_var3, aes(x=1.1, ymin = ci_025, ymax = ci_975), width=0, alpha=1, color = ifelse(point_est_model3_var3$ci_025 * point_est_model3_var3$ci_975 < 0,nonsig_col,sig_col), size=0.75) +
  geom_point(   data = point_est_model3_var3, aes(x=1.1, estim), alpha=1, color = ifelse(point_est_model3_var3$ci_025 * point_est_model3_var3$ci_975 < 0,nonsig_col,sig_col), shape=21, fill=ifelse(point_est_model3_var3$ci_025 * point_est_model3_var3$ci_975 < 0,nonsig_col,sig_col), size=ps, stroke=1) +
  annotate(geom="text", x=1.1,    y=point_est_model3_var3$estim, label="2",   col="white", size=s, hjust = 0.5, alpha = 1) +
  
  geom_errorbar(data = point_est_model4_var3, aes(x = 0.9, ymin = ci_025, ymax = ci_975), width=0, alpha=1, color=ifelse(point_est_model4_var3$ci_025 * point_est_model4_var3$ci_975 < 0,nonsig_col,sig_col), size=0.75) +
  geom_point(   data = point_est_model4_var3, aes(x = 0.9, estim), alpha=1, color=ifelse(point_est_model4_var3$ci_025 * point_est_model4_var3$ci_975 < 0,nonsig_col,sig_col), shape=21, fill=ifelse(point_est_model4_var3$ci_025 * point_est_model4_var3$ci_975 < 0,nonsig_col,sig_col), size=ps, stroke=1) +
  annotate(geom="text", x=0.9,    y=point_est_model4_var3$estim, label="3",   col="white", size=s, hjust = 0.5, alpha = 1) +
  
  geom_errorbar(data = point_est_model5_var3, aes(x = 0.7, ymin = ci_025, ymax = ci_975), width=0, alpha=1, color=ifelse(point_est_model5_var3$ci_025 * point_est_model5_var3$ci_975 < 0,nonsig_col,sig_col), size=0.75) +
  geom_point(   data = point_est_model5_var3, aes(x = 0.7, estim), alpha=1, color=ifelse(point_est_model5_var3$ci_025 * point_est_model5_var3$ci_975 < 0,nonsig_col,sig_col), shape=21, fill=ifelse(point_est_model5_var3$ci_025 * point_est_model5_var3$ci_975 < 0,nonsig_col,sig_col), size=ps, stroke=1) +
  annotate(geom="text", x=0.7,    y=point_est_model5_var3$estim, label="4",   col="white", size=s, hjust = 0.5, alpha = 1) +
  
  
  #inclusion

  
  geom_errorbar(data = point_est_model2_var2, aes(x = 2.3, ymin = ci_025, ymax = ci_975), width=0, alpha=1, color=ifelse(point_est_model2_var2$ci_025 * point_est_model2_var2$ci_975 < 0,nonsig_col,sig_col), size=0.75) +
  geom_point(   data = point_est_model2_var2, aes(x = 2.3, estim), alpha=1, color=ifelse(point_est_model2_var2$ci_025 * point_est_model2_var2$ci_975 < 0,nonsig_col,sig_col), shape=21, fill=ifelse(point_est_model2_var2$ci_025 * point_est_model2_var2$ci_975 < 0,nonsig_col,sig_col), size=ps, stroke=1) +
  annotate(geom="text", x=2.3,    y=point_est_model2_var2$estim, label="1",   col="white", size=s, hjust = 0.5, alpha = 1) +
  
  geom_errorbar(data = point_est_model3_var2, aes(x=2.1, ymin = ci_025, ymax = ci_975), width=0, alpha=1, color=ifelse(point_est_model3_var2$ci_025 * point_est_model3_var2$ci_975 < 0,nonsig_col,sig_col), size=0.75) +
  geom_point(   data = point_est_model3_var2, aes(x=2.1, estim), alpha=1, color=ifelse(point_est_model3_var2$ci_025 * point_est_model3_var2$ci_975 < 0,nonsig_col,sig_col), shape=21, fill=ifelse(point_est_model3_var2$ci_025 * point_est_model3_var2$ci_975 < 0,nonsig_col,sig_col), size=ps, stroke=1) +
  annotate(geom="text", x=2.1,    y=point_est_model3_var2$estim, label="2",   col="white", size=s, hjust = 0.5, alpha = 1) +
  
  geom_errorbar(data = point_est_model4_var2, aes(x = 1.9, ymin = ci_025, ymax = ci_975), width=0, alpha=1, color=ifelse(point_est_model4_var2$ci_025 * point_est_model4_var2$ci_975 < 0,nonsig_col,sig_col), size=0.75) +
  geom_point(   data = point_est_model4_var2, aes(x = 1.9, estim), alpha=1, color=ifelse(point_est_model4_var2$ci_025 * point_est_model4_var2$ci_975 < 0,nonsig_col,sig_col), shape=21, fill=ifelse(point_est_model4_var2$ci_025 * point_est_model4_var2$ci_975 < 0,nonsig_col,sig_col), size=ps, stroke=1) +
  annotate(geom="text", x=1.9,    y=point_est_model4_var2$estim, label="3",   col="white", size=s, hjust = 0.5, alpha = 1) +
  
  geom_errorbar(data = point_est_model5_var2, aes(x = 1.7, ymin = ci_025, ymax = ci_975), width=0, alpha=1, color=ifelse(point_est_model5_var2$ci_025 * point_est_model5_var2$ci_975 < 0,nonsig_col,sig_col), size=0.75) +
  geom_point(   data = point_est_model5_var2, aes(x = 1.7, estim), alpha=1, color=ifelse(point_est_model5_var2$ci_025 * point_est_model5_var2$ci_975 < 0,nonsig_col,sig_col), shape=21, fill=ifelse(point_est_model5_var2$ci_025 * point_est_model5_var2$ci_975 < 0,nonsig_col,sig_col), size=ps, stroke=1) +
  annotate(geom="text", x=1.7,    y=point_est_model5_var2$estim, label="4",   col="white", size=s, hjust = 0.5, alpha = 1) +
  

  
  #prop women

  
    
  geom_errorbar(data = point_est_model1_var1, aes(x = 3.5, ymin = ci_025, ymax = ci_975), width=0, alpha=1, color="red", size=0.75) +
  geom_point(   data = point_est_model1_var1, aes(x = 3.5, estim), alpha=1, color="red", shape=21, fill="red", size=ps, stroke=1) +
  annotate(geom="text", x=3.5,    y=point_est_model1_var1$estim, label="0",   col="white", size=s, hjust = 0.5, alpha = 1) +
  
  geom_errorbar(data = point_est_model2_var1, aes(x = 3.3, ymin = ci_025, ymax = ci_975), width=0, alpha=1, color=ifelse(point_est_model2_var1$ci_025 * point_est_model2_var1$ci_975 < 0,nonsig_col,sig_col), size=0.75) +
  geom_point(   data = point_est_model2_var1, aes(x = 3.3, estim), alpha=1, color=ifelse(point_est_model2_var1$ci_025 * point_est_model2_var1$ci_975 < 0,nonsig_col,sig_col), shape=21, fill=ifelse(point_est_model2_var1$ci_025 * point_est_model2_var1$ci_975 < 0,nonsig_col,sig_col), size=ps, stroke=1) +
  annotate(geom="text", x=3.3,    y=point_est_model2_var1$estim, label="1",   col="white", size=s, hjust = 0.5, alpha = 1) +
  
  geom_errorbar(data = point_est_model3_var1, aes(x=3.1, ymin = ci_025, ymax = ci_975), width=0, alpha=1, color=ifelse(point_est_model3_var1$ci_025 * point_est_model3_var1$ci_975 < 0,nonsig_col,sig_col), size=0.75) +
  geom_point(   data = point_est_model3_var1, aes(x=3.1, estim), alpha=1, color=ifelse(point_est_model3_var1$ci_025 * point_est_model3_var1$ci_975 < 0,nonsig_col,sig_col), shape=21, fill=ifelse(point_est_model3_var1$ci_025 * point_est_model3_var1$ci_975 < 0,nonsig_col,sig_col), size=ps, stroke=1) +
  annotate(geom="text", x=3.1,    y=point_est_model3_var1$estim, label="2",   col="white", size=s, hjust = 0.5, alpha = 1) +
  
  geom_errorbar(data = point_est_model4_var1, aes(x = 2.9, ymin = ci_025, ymax = ci_975), width=0, alpha=1, color=ifelse(point_est_model4_var1$ci_025 * point_est_model4_var1$ci_975 < 0,nonsig_col,sig_col), size=0.75) +
  geom_point(   data = point_est_model4_var1, aes(x = 2.9, estim), alpha=1, color=ifelse(point_est_model4_var1$ci_025 * point_est_model4_var1$ci_975 < 0,nonsig_col,sig_col), shape=21, fill=ifelse(point_est_model4_var1$ci_025 * point_est_model4_var1$ci_975 < 0,nonsig_col,sig_col), size=ps, stroke=1) +
  annotate(geom="text", x=2.9,    y=point_est_model4_var1$estim, label="3",   col="white", size=s, hjust = 0.5, alpha = 1) +
  
  geom_errorbar(data = point_est_model5_var1, aes(x = 2.7, ymin = ci_025, ymax = ci_975), width=0, alpha=1, color=ifelse(point_est_model5_var1$ci_025 * point_est_model5_var1$ci_975 < 0,nonsig_col,sig_col), size=0.75) +
  geom_point(   data = point_est_model5_var1, aes(x = 2.7, estim), alpha=1, color=ifelse(point_est_model5_var1$ci_025 * point_est_model5_var1$ci_975 < 0,nonsig_col,sig_col), shape=21, fill=ifelse(point_est_model5_var1$ci_025 * point_est_model5_var1$ci_975 < 0,nonsig_col,sig_col), size=ps, stroke=1) +
  annotate(geom="text", x=2.7,    y=point_est_model5_var1$estim, label="4",   col="white", size=s, hjust = 0.5, alpha = 1) +
  

  
  #explain



  # annotate(geom="text", x=3.5,    y=annotate_y, label="Main effect",   col="grey50", size=2.9, hjust = 1, alpha = 1) +
  # geom_segment(aes(y=annotate_y,    x=3.5, yend = point_est_model1_var1$ci_025-0.01, xend = 3.5),size=0.3, col = "grey50", alpha=0.66, linetype=3) +  
  #   
  # annotate(geom="text", x=1.3,    y=annotate_y, label="Mixing",   col="grey50", size=2.9, hjust = 1, alpha = 1) +
  # geom_segment(aes(y=annotate_y,    x=1.3, yend = point_est_model2_var3$ci_025-0.01, xend = 1.3),size=0.3, col = "grey50", alpha=0.66, linetype=3) +
  # 
  # annotate(geom="text", x=1.1,    y=annotate_y, label="Bonding",   col="grey50", size=2.9, hjust = 1, alpha = 1) +
  # geom_segment(aes(y=annotate_y,    x=1.1, yend = point_est_model3_var3$ci_025-0.01, xend = 1.1),size=0.3, col = "grey50", alpha=0.66, linetype=3) +
  # 
  # annotate(geom="text", x=0.9,    y=annotate_y, label="Incorporating",   col="grey50", size=2.9, hjust = 1, alpha = 1) +
  # geom_segment(aes(y=annotate_y,    x=0.9, yend = point_est_model4_var3$ci_025-0.01, xend = 0.9),size=0.3, col = "grey50", alpha=0.66, linetype=3) +
  # 
  # annotate(geom="text", x=0.7,    y=annotate_y, label="Combined",   col="grey50", size=2.9, hjust = 1, alpha = 1) +
  # geom_segment(aes(y=annotate_y,    x=0.7, yend = point_est_model5_var3$ci_025-0.01, xend = 0.7),size=0.3, col = "grey50", alpha=0.66, linetype=3) +

  
  
  geom_vline(xintercept = 1.5, linetype="solid", alpha=0.7, color="black", size=0.2) +
  geom_vline(xintercept = 2.5, linetype="solid", alpha=0.7, color="black", size=0.2) +
  #geom_vline(xintercept = 3.425, linetype="solid", alpha=0.7, color="black", size=0.2) +
  #geom_vline(xintercept = 4.425, linetype="solid", alpha=0.7, color="black", size=0.2) +
  
  scale_x_continuous(breaks=(1:3), expand = c(0.05,0.05)
                     #, labels=c("Gender\ndiversity \u00D7\nInclusion", "Inclusion", "Gender\ndiversity")
                     , labels=c("","","")
                     ) +
  #scale_y_continuous(breaks=c(-0.2, -0.1, 0, 0.1, 0.2, 0.3)) +
  #coord_cartesian(ylim = c(-0.2, 0.2)) +
  
  labs(y="Distinctiveness") +
  ggtitle("d: Firm level") + 
  scale_y_continuous(breaks=seq(-0.4, 0.2, 0.1), labels = dropLeadingZero)+
  coord_flip(ylim = c(-0.4, 0.2)) +
  theme(aspect.ratio=asp, 
            title =element_text(size=11),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(), 
            panel.background = element_blank(), 
            panel.border = element_rect(colour = "black", 
                                        fill=NA, 
                                        size=0.2),
            #legend.position = c(0.2, 0.3),
            plot.title = element_text(size = tit_s, face = "bold", colour = "black"),
            axis.ticks.y = element_blank(),
            axis.title.y = element_blank(),
            axis.text.y = element_text(size = 11, colour = "black"),
            plot.margin = unit(c(m_top,m_right,m_bottom,m_left), "mm")
            )
  

#grid.newpage()
ols_estim_firmlevel
```

```{r, fig.width = 8.5, fig.height = 2.6}
#ols_estim_combined <- grid.arrange(ols_estim_gamelevel, ols_estim_gamelevel_re, ols_estim_gamelevel_fe, ols_estim_firmlevel,nrow = 1)

ols_estim_combined <- cowplot::plot_grid(ols_estim_gamelevel_notitle+ggtitle("a: Game level"), ols_estim_gamelevel_re, ols_estim_gamelevel_fe, ols_estim_firmlevel, align="h",rel_widths=c(1.4,1,1,1),  rel_heights = 1, scale=1, nrow=1)
ols_estim_combined
```

```{r}
ggsave("ols_estim_combined.pdf", ols_estim_combined, width = 8.5, height = 2.6)
```


###Combined figure for predicting distinctiveness
```{r, fig.width = 7.5, fig.height = 2.5}
m_top=5
m_right=0
m_bottom=5
m_left=0

dropLeadingZero3 <- function(l){
  l <- sprintf(l, fmt = '%#.3f')
  str_replace(l, '0.', '.')
}

dropLeadingZero2 <- function(l){
  l <- sprintf(l, fmt = '%#.2f')
  str_replace(l, '0.', '.')
}

dropLeadingZero1 <- function(l){
  l <- sprintf(l, fmt = '%#.1f')
  str_replace(l, '0.', '.')
}

dist_combined <- cowplot::plot_grid(
                                    div_inclusions_dist
                                     +ggtitle("a: LOESS Estimates")
                                     +scale_x_continuous(expand = c(0,0), labels = dropLeadingZero1)
                                     +scale_y_continuous(labels = dropLeadingZero3)
                                     +theme(plot.title =element_text(size=11, face='bold'),
                                            plot.margin = unit(c(m_top,m_right-2,m_bottom,m_left), "mm"),
                                            axis.text = element_text(size = 9, colour = "black")
                                            ),
                                    ols_estim_gamelevel_notitle
                                     +ggtitle("b: Point estimates")
                                     +scale_x_continuous(breaks=(1:3), expand = c(0.05,0.05), labels=c("Diversity \u00D7\nInclusion", "Inclusion", "Diversity"))
                                     +theme(
                                            plot.title =element_text(size=11),
                                            plot.margin = unit(c(m_top,m_right,m_bottom,m_left-3), "mm"),
                                            axis.title.x = element_text(size = 11, colour = "black"),
                                            title =element_text(size=11),
                                            axis.text = element_text(size = 9, colour = "black")
                                            ),
                                    mixing_margins_blue
                                     +scale_x_continuous(
                                          labels = dropLeadingZero1,
                                          expand = c(0.001,0.001), 
                                          name="Diversity")
                                     +scale_y_continuous(
                                          breaks = seq(.73,.85, by=.02), 
                                          labels = dropLeadingZero2,
                                          expand = c(0,0), 
                                          name="Predicted distinctiveness")
                                     + coord_cartesian(clip = "off")
                                     +ggtitle("c: Prediction with Mixing")
                                     +theme(plot.title =element_text(size=11, face='bold'),
                                            plot.margin = unit(c(m_top,m_right+5,m_bottom,m_left), "mm"),
                                            axis.text = element_text(size = 9, colour = "black")
                                            ), 
                                    align="h",
                                    rel_widths=c(1,1.1,1),  
                                    rel_heights = 1, 
                                    scale=1, nrow=1)

```

```{r, fig.width = 8.5, fig.height = 3}
dist_combined
```
```{r}
ggsave("dist_combined.pdf", dist_combined, width = 8.5, height = 3)
```




