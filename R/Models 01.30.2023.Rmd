---
title: "MOBY: 3. Models"
editor_options: 
  markdown: 
    wrap: 350
---

###Preparations

Libraries \ read in libraries

```{r, results='hide'}
util_libraries <- c("foreign", "reshape2", "stargazer", "arm", "plyr", "tidyverse", "stringr", "qdapRegex", "GGally", "progress", "pracma", "lubridate", "DescTools", "irr", "psych", 'gtools', "Hmisc", "colorspace")
vis_libraries  <- c("ggplot2", "ggrepel", "grid", "gridExtra", "RColorBrewer", "scales", "corrplot", "ggeffects", "cowplot", "plot.matrix", "corrgram", "ggnetwork", "vioplot", "dotwhisker", "sjPlot", "sjlabelled", "sjmisc", "plot3D", "ggpubr", "ggExtra", "ggraph")
stat_libraries <- c("network", "sna", "igraph", "moments", "nortest", "MASS", "randomForest", "sandwich", "lmtest", "gmodels", "margins", "sampleSelection", "pROC", "pscl",  "pwr", "relaimpo", "lme4", "plm", "caret", "ResourceSelection", "rvest", "cluster", "factoextra", "outliers", "acss", 'asbio','akima', 'plotly', 'factoextra', 'interactions', 'robustbase', "sandwich", "modelr", "broom", "mgcv", "stringdist", "sem", "lavaan", "corrr")

#install.packages(util_libraries)
#install.packages(vis_libraries)
#install.packages(stat_libraries)

for (l in 1:length(util_libraries)){ library(util_libraries[l], character.only = TRUE)}
for (l in 1:length(vis_libraries)){ library(vis_libraries[l], character.only = TRUE)}
for (l in 1:length(stat_libraries)){ library(stat_libraries[l], character.only = TRUE)}
```

Graph theme set

```{r}
theme_set(theme_bw())

dropLeadingZero <- function(l){
  str_replace(l, '0(?=.)', '')
}
```

Clear the workspace

```{r}
rm(list=ls())
```

###Read data

Read worspace
```{r}
load('Desc_bivar.RData')
```


###Models Predicting Creativity (Distinctiveness)

Add a game count per developer firm variable

```{r}
df <- data.frame(moby$org_dev)
dev_firm_level_obs <- aggregate(df, list(dev_firm = df$moby.org_dev), FUN = length)
colnames(dev_firm_level_obs) <- c("org_dev", "n")
t <- data.frame(table(dev_firm_level_obs$n))
t2 <- data.frame(table(moby$n_per_org_dev))

n_firms <- dim(dev_firm_level_obs)[1]
moby$n_per_org_dev <- 0
```

```{r}
#match dev firm n to dataset
for (i in 1:n_firms) {
  firm <- dev_firm_level_obs$org_dev[i]
  match_yes <- match(moby$org_dev, firm)
  moby$n_per_org_dev[match_yes==1] <- dev_firm_level_obs[i,2]
}

```

```{r}
ggplot(t, aes(x=Var1, y=Freq)) + 
  geom_bar(stat = "identity", color="white", fill=lo_color) +
  
      scale_x_discrete(expand = c(0,0)) +
      scale_y_continuous(expand = c(0,0)) +
  
      labs(y="Frequency") +
      labs(x="Games by Firm") +
  
    theme(aspect.ratio=1, 
        legend.position = "none",
        panel.grid.major = element_line(size=0.2), 
        #panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", 
                                    fill=NA, 
                                    size=0.2),
        #legend.position = c(0.2, 0.3),
        plot.title = element_text(size = 11, face = "bold", colour = "black"),
        #axis.ticks = element_line(colour = "black", size = 0.1),
        axis.title.y = element_text(size = 11, colour = "black"),
        axis.text.x = element_text(size = 9, colour = "black"),
        axis.text.y = element_text(size = 9, colour = "black"),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank()
  )
```

#1. Modeling Distinctiveness

##1.1. Without inclusion

```{r}
#standardized variables
moby$game_dist_prev5yr_z <- (moby$game_dist_prev5yr-min(moby$game_dist_prev5yr, na.rm=T))/sd(moby$game_dist_prev5yr)
moby$prop_women2_z <- (moby$prop_women2-min(moby$prop_women2, na.rm=T))/sd(moby$prop_women2)
moby$blau2_z <- (moby$blau2-min(moby$blau2, na.rm=T))/sd(moby$blau2)


moby_dev_firm_level$game_dist_prev5yr_z <- (moby_dev_firm_level$game_dist_prev5yr-min(moby_dev_firm_level$game_dist_prev5yr, na.rm=T))/sd(moby_dev_firm_level$game_dist_prev5yr)
moby_dev_firm_level$prop_women2_z <- (moby_dev_firm_level$prop_women2-min(moby_dev_firm_level$prop_women2, na.rm=T))/sd(moby_dev_firm_level$prop_women2)
moby_dev_firm_level$blau2_z <- (moby_dev_firm_level$blau2-min(moby_dev_firm_level$blau2, na.rm=T))/sd(moby_dev_firm_level$blau2)

#team size fixed effects: 20 equal sized quantiles of team size
moby$N_quantiles <- cut(moby$N, quantile(moby$N, probs=seq(0,1,0.05)))
#table(moby$N_quantiles)


#1. basic model
without_inclusion <- lm(
  game_dist_prev5yr ~
    blau2 +
    N +
    #as.factor(N_quantiles) + 
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby
)


#2. basic model team size FE
without_inclusion_teamfe <- lm(
  game_dist_prev5yr ~
    blau2 +
    #N +
    as.factor(N_quantiles) +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby
)

#3. standardized model
without_inclusion_z <- lm(
  game_dist_prev5yr_z ~
    blau2_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby
)


#4. fixed effects for developer firm
without_inclusion_fe_1 <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby[moby$n_per_org_dev>=1,],
  index="org_dev",
  model="within"
)

without_inclusion_fe_2 <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby[moby$n_per_org_dev>=2,],
  index="org_dev",
  model="within"
)


without_inclusion_fe_5 <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby[moby$n_per_org_dev>=5,],
  index="org_dev",
  model="within"
)

without_inclusion_fe_10 <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby[moby$n_per_org_dev>=10,],
  index="org_dev",
  model="within"
)


#5. random effects for developer firm
without_inclusion_re <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby,
  index="org_dev",
  model="random"
)


#6. fixed effects model with dummies

org_dev_list <- table(moby$org_dev)
org_dev_list_repeats <- org_dev_list[org_dev_list>1]
org_dev_list_repeats_list <- as.numeric(names(org_dev_list_repeats))
org_dev_list_nonrepeats <- org_dev_list[org_dev_list==1]
org_dev_list_nonrepeats_list <- as.numeric(names(org_dev_list_nonrepeats))

delete_index <- match(org_dev_list_nonrepeats_list, moby$org_dev)

moby_repeat_devs <- moby[-delete_index,]

without_inclusion_fe_dummies <- lm(
  game_dist_prev5yr_z ~
    blau2_z +
    as.factor(org_dev) +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
  ,
  data = moby_repeat_devs
)



#7. developer firm level model
without_inclusion_aggr <- lm(
  game_dist_prev5yr ~
    blau2 +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby_dev_firm_level
)


#8. developer firm level model, standardized
without_inclusion_aggr_z <- lm(
  game_dist_prev5yr_z ~
    blau2_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby_dev_firm_level
)


# Adjust standard errors
#1.1 basic model, robust SE
cov1         <- vcovHC(without_inclusion, type = "HC1")
without_inclusion_robust_se    <- sqrt(diag(cov1))

#1.2 basic model, clustered SE
cov1         <- vcovHC(without_inclusion, type = "HC1", cluster=moby$org_dev)
without_inclusion_clustered_se    <- sqrt(diag(cov1))

#2. basic model team size FE, robust SE
cov1         <- vcovHC(without_inclusion_teamfe, type = "HC1")
without_inclusion_teamfe_robust_se    <- sqrt(diag(cov1))

#3.1 standardized model, robust SE
cov1         <- vcovHC(without_inclusion_z, type = "HC1")
without_inclusion_z_robust_se    <- sqrt(diag(cov1))

#3.2 standardized model, clustered SE
cov1         <- vcovHC(without_inclusion_z, type = "HC1", cluster=moby$org_dev)
without_inclusion_z_clustered_se    <- sqrt(diag(cov1))

#4. fixed effects for developer firm, clustered SE
cov1         <- vcovHC(without_inclusion_fe_1, type = "HC1", cluster = "group")
without_inclusion_fe_1_clustered_se    <- sqrt(diag(cov1))

cov1         <- vcovHC(without_inclusion_fe_2, type = "HC1", cluster = "group")
without_inclusion_fe_2_clustered_se    <- sqrt(diag(cov1))

cov1         <- vcovHC(without_inclusion_fe_5, type = "HC1", cluster = "group")
without_inclusion_fe_5_clustered_se    <- sqrt(diag(cov1))

cov1         <- vcovHC(without_inclusion_fe_10, type = "HC1", cluster = "group")
without_inclusion_fe_10_clustered_se    <- sqrt(diag(cov1))

#5. random effects for developer firm, clsutered SE
cov1         <- vcovHC(without_inclusion_re, type = "HC1", cluster = "group")
without_inclusion_re_clustered_se    <- sqrt(diag(cov1))


#6. fixed effects model with dummies
cov1         <- vcovHC(without_inclusion_fe_dummies, type = "HC1", cluster=moby$org_dev)
without_inclusion_fe_dummies_clustered_se    <- sqrt(diag(cov1))

#7. developer firm level model, robust SE
cov1         <- vcovHC(without_inclusion_aggr, type = "HC1")
without_inclusion_aggr_robust_se    <- sqrt(diag(cov1))

#8. developer firm level model, standardized, robust SE
cov1         <- vcovHC(without_inclusion_aggr_z, type = "HC1")
without_inclusion_aggr_z_robust_se    <- sqrt(diag(cov1))


# Stargazer output
#1. basic model
stargazer(without_inclusion,without_inclusion,
          column.labels=c('Base, rob SE', 'Base, clus SE'),
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "mixing*"), 
          se = list(without_inclusion_robust_se, without_inclusion_clustered_se),
          omit.stat = c("f", "ser")
          )

#2. basic model team size FE, robust SE
stargazer(without_inclusion_teamfe,
          column.labels='Base model team N FE',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "mixing*"), 
          se = list(NULL, without_inclusion_teamfe_robust_se),
          omit.stat = c("f", "ser")
          )
#3. standardized model
stargazer(without_inclusion_z,without_inclusion_z,
          column.labels=c('Std, rob SE', 'Std, clus SE'),
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "mixing*"), 
          se = list(without_inclusion_z_robust_se,without_inclusion_z_clustered_se),
          omit.stat = c("f", "ser")
          )


#4. fixed effects for developer firm, clustered SE
m1 <- without_inclusion_fe_1
m2 <- without_inclusion_fe_2
m3 <- without_inclusion_fe_5
m4 <- without_inclusion_fe_10

stargazer(m1,m2,m3,m4,
          column.labels=c('n>=1','n>=2', 'n>=5', 'n>=10'),
          dep.var.caption = "Dev firm FE, clus SE",
          type="text", 
          keep = c("blau*", "mixing*"), 
          se = list(without_inclusion_fe_1_clustered_se, without_inclusion_fe_2_clustered_se, without_inclusion_fe_5_clustered_se, without_inclusion_fe_10_clustered_se),
          omit.stat = c("f", "ser")
          )

#5. random effects for developer firm, clustered SE
stargazer(without_inclusion_re,
          column.labels='Dev firm RE',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "mixing*"), 
          se = list(NULL, without_inclusion_re_clustered_se),
          omit.stat = c("f", "ser")
          )

#6. fixed effects model with dummies
stargazer(without_inclusion_fe_dummies,
          column.labels='Dev firm FE dummies',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "mixing*"), 
          se = list(NULL, without_inclusion_fe_dummies_clustered_se),
          omit.stat = c("f", "ser")
          )
#7. developer firm level model, robust SE
stargazer(without_inclusion_aggr,
          column.labels='Dev firm level',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "mixing*"), 
          se = list(NULL, without_inclusion_aggr_robust_se),
          omit.stat = c("f", "ser")
          )
#8. developer firm level model, standardized, robust SE
stargazer(without_inclusion_aggr_z,
          column.labels='Dev firm level std',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "mixing*"), 
          se = list(NULL, without_inclusion_aggr_z_robust_se),
          omit.stat = c("f", "ser")
          )
```



##1.2. Mixing

```{r}
moby$mixing <- moby$assortativity_rev_z
moby_dev_firm_level$mixing <- moby_dev_firm_level$assortativity_rev_z

#standardized variables
moby$game_dist_prev5yr_z <- (moby$game_dist_prev5yr-min(moby$game_dist_prev5yr, na.rm=T))/sd(moby$game_dist_prev5yr)
moby$prop_women2_z <- (moby$prop_women2-min(moby$prop_women2, na.rm=T))/sd(moby$prop_women2)
moby$mixing_z <- (moby$mixing-min(moby$mixing, na.rm=T))/sd(moby$mixing)
moby$blau2_z <- (moby$blau2-min(moby$blau2, na.rm=T))/sd(moby$blau2)


moby_dev_firm_level$game_dist_prev5yr_z <- (moby_dev_firm_level$game_dist_prev5yr-min(moby_dev_firm_level$game_dist_prev5yr, na.rm=T))/sd(moby_dev_firm_level$game_dist_prev5yr)
moby_dev_firm_level$prop_women2_z <- (moby_dev_firm_level$prop_women2-min(moby_dev_firm_level$prop_women2, na.rm=T))/sd(moby_dev_firm_level$prop_women2)
moby_dev_firm_level$mixing_z <- (moby_dev_firm_level$mixing-min(moby_dev_firm_level$mixing, na.rm=T))/sd(moby_dev_firm_level$mixing)
moby_dev_firm_level$blau2_z <- (moby_dev_firm_level$blau2-min(moby_dev_firm_level$blau2, na.rm=T))/sd(moby_dev_firm_level$blau2)


#1. basic model
mixing <- lm(
  game_dist_prev5yr ~
    blau2 +
    mixing +
    blau2 * mixing +
    N +
    #as.factor(N_quantiles) + 
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby
)


#2. basic model team size FE
mixing_teamfe <- lm(
  game_dist_prev5yr ~
    blau2 +
    mixing +
    blau2 * mixing +
    #N +
    as.factor(N_quantiles) +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby
)

#3. standardized model
mixing_z <- lm(
  game_dist_prev5yr_z ~
    blau2_z +
    mixing_z +
    blau2_z * mixing_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby
)


#4. fixed effects for developer firm
mixing_fe_1 <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    mixing_z +
    blau2_z * mixing_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby[moby$n_per_org_dev>=1,],
  index="org_dev",
  model="within"
)

mixing_fe_2 <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    mixing_z +
    blau2_z * mixing_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby[moby$n_per_org_dev>=2,],
  index="org_dev",
  model="within"
)


mixing_fe_5 <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    mixing_z +
    blau2_z * mixing_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby[moby$n_per_org_dev>=5,],
  index="org_dev",
  model="within"
)

mixing_fe_10 <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    mixing_z +
    blau2_z * mixing_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby[moby$n_per_org_dev>=10,],
  index="org_dev",
  model="within"
)


#5. random effects for developer firm
mixing_re <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    mixing_z +
    blau2_z * mixing_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby,
  index="org_dev",
  model="random"
)


#6. fixed effects model with dummies

org_dev_list <- table(moby$org_dev)
org_dev_list_repeats <- org_dev_list[org_dev_list>1]
org_dev_list_repeats_list <- as.numeric(names(org_dev_list_repeats))
org_dev_list_nonrepeats <- org_dev_list[org_dev_list==1]
org_dev_list_nonrepeats_list <- as.numeric(names(org_dev_list_nonrepeats))

delete_index <- match(org_dev_list_nonrepeats_list, moby$org_dev)

moby_repeat_devs <- moby[-delete_index,]

mixing_fe_dummies <- lm(
  game_dist_prev5yr_z ~
    blau2_z +
    mixing_z +
    blau2_z * mixing_z +
    as.factor(org_dev) +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
  ,
  data = moby_repeat_devs
)



#7. developer firm level model
mixing_aggr <- lm(
  game_dist_prev5yr ~
    blau2_z +
    mixing_z +
    blau2_z * mixing_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby_dev_firm_level
)


#8. developer firm level model, standardized
mixing_aggr_z <- lm(
  game_dist_prev5yr_z ~
    blau2_z +
    mixing_z +
    blau2_z * mixing_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby_dev_firm_level
)


# Adjust standard errors
#1.1 basic model, robust SE
cov1         <- vcovHC(mixing, type = "HC1")
mixing_robust_se    <- sqrt(diag(cov1))

#1.2 basic model, clustered SE
cov1         <- vcovHC(mixing, type = "HC1", cluster=moby$org_dev)
mixing_clustered_se    <- sqrt(diag(cov1))

#2. basic model team size FE, robust SE
cov1         <- vcovHC(mixing_teamfe, type = "HC1")
mixing_teamfe_robust_se    <- sqrt(diag(cov1))

#3.1 standardized model, robust SE
cov1         <- vcovHC(mixing_z, type = "HC1")
mixing_z_robust_se    <- sqrt(diag(cov1))

#3.2 standardized model, clustered SE
cov1         <- vcovHC(mixing_z, type = "HC1", cluster=moby$org_dev)
mixing_z_clustered_se    <- sqrt(diag(cov1))

#4. fixed effects for developer firm, clustered SE
cov1         <- vcovHC(mixing_fe_1, type = "HC1", cluster = "group")
mixing_fe_1_clustered_se    <- sqrt(diag(cov1))

cov1         <- vcovHC(mixing_fe_2, type = "HC1", cluster = "group")
mixing_fe_2_clustered_se    <- sqrt(diag(cov1))

cov1         <- vcovHC(mixing_fe_5, type = "HC1", cluster = "group")
mixing_fe_5_clustered_se    <- sqrt(diag(cov1))

cov1         <- vcovHC(mixing_fe_10, type = "HC1", cluster = "group")
mixing_fe_10_clustered_se    <- sqrt(diag(cov1))

#5. random effects for developer firm, clsutered SE
cov1         <- vcovHC(mixing_re, type = "HC1", cluster = "group")
mixing_re_clustered_se    <- sqrt(diag(cov1))


#6. fixed effects model with dummies
cov1         <- vcovHC(mixing_fe_dummies, type = "HC1", cluster=moby$org_dev)
mixing_fe_dummies_clustered_se    <- sqrt(diag(cov1))

#7. developer firm level model, robust SE
cov1         <- vcovHC(mixing_aggr, type = "HC1")
mixing_aggr_robust_se    <- sqrt(diag(cov1))

#8. developer firm level model, standardized, robust SE
cov1         <- vcovHC(mixing_aggr_z, type = "HC1")
mixing_aggr_z_robust_se    <- sqrt(diag(cov1))


# Stargazer output
#1. basic model
stargazer(mixing,mixing,
          column.labels=c('Base, rob SE', 'Base, clus SE'),
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "mixing*"), 
          se = list(mixing_robust_se, mixing_clustered_se),
          omit.stat = c("f", "ser")
          )

#2. basic model team size FE, robust SE
stargazer(mixing_teamfe,
          column.labels='Base model team N FE',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "mixing*"), 
          se = list(mixing_teamfe_robust_se),
          omit.stat = c("f", "ser")
          )
#3. standardized model
stargazer(mixing_z,mixing_z,
          column.labels=c('Std, rob SE', 'Std, clus SE'),
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "mixing*"), 
          se = list(mixing_z_robust_se,mixing_z_clustered_se),
          omit.stat = c("f", "ser")
          )


#4. fixed effects for developer firm, clustered SE
m1 <- mixing_fe_1
m2 <- mixing_fe_2
m3 <- mixing_fe_5
m4 <- mixing_fe_10

stargazer(m1,m2,m3,m4,
          column.labels=c('n>=1','n>=2', 'n>=5', 'n>=10'),
          dep.var.caption = "Dev firm FE, clus SE",
          type="text", 
          keep = c("blau*", "mixing*"), 
          se = list(mixing_fe_1_clustered_se, mixing_fe_2_clustered_se, mixing_fe_5_clustered_se, mixing_fe_10_clustered_se),
          omit.stat = c("f", "ser")
          )

#5. random effects for developer firm, clustered SE
stargazer(mixing_re,
          column.labels='Dev firm RE',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "mixing*"), 
          se = list(mixing_re_clustered_se),
          omit.stat = c("f", "ser")
          )

#6. fixed effects model with dummies
stargazer(mixing_fe_dummies,
          column.labels='Dev firm FE dummies',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "mixing*"), 
          se = list(mixing_fe_dummies_clustered_se),
          omit.stat = c("f", "ser")
          )
#7. developer firm level model, robust SE
stargazer(mixing_aggr,
          column.labels='Dev firm level',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "mixing*"), 
          se = list(mixing_aggr_robust_se),
          omit.stat = c("f", "ser")
          )
#8. developer firm level model, standardized, robust SE
stargazer(mixing_aggr_z,
          column.labels='Dev firm level std',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "mixing*"), 
          se = list(mixing_aggr_z_robust_se),
          omit.stat = c("f", "ser")
          )
```

##1.3. Bonding

```{r}
moby$bonding <- moby$weighted_cross_edges_ratio_z
moby_dev_firm_level$bonding <- moby_dev_firm_level$weighted_cross_edges_ratio_z

#standardized variables
moby$game_dist_prev5yr_z <- (moby$game_dist_prev5yr-min(moby$game_dist_prev5yr, na.rm=T))/sd(moby$game_dist_prev5yr)
moby$prop_women2_z <- (moby$prop_women2-min(moby$prop_women2, na.rm=T))/sd(moby$prop_women2)
moby$bonding_z <- (moby$bonding-min(moby$bonding, na.rm=T))/sd(moby$bonding)
moby$blau2_z <- (moby$blau2-min(moby$blau2, na.rm=T))/sd(moby$blau2)


moby_dev_firm_level$game_dist_prev5yr_z <- (moby_dev_firm_level$game_dist_prev5yr-min(moby_dev_firm_level$game_dist_prev5yr, na.rm=T))/sd(moby_dev_firm_level$game_dist_prev5yr)
moby_dev_firm_level$prop_women2_z <- (moby_dev_firm_level$prop_women2-min(moby_dev_firm_level$prop_women2, na.rm=T))/sd(moby_dev_firm_level$prop_women2)
moby_dev_firm_level$bonding_z <- (moby_dev_firm_level$bonding-min(moby_dev_firm_level$bonding, na.rm=T))/sd(moby_dev_firm_level$bonding)
moby_dev_firm_level$blau2_z <- (moby_dev_firm_level$blau2-min(moby_dev_firm_level$blau2, na.rm=T))/sd(moby_dev_firm_level$blau2)

#1. basic model
bonding <- lm(
  game_dist_prev5yr ~
    blau2 +
    bonding +
    blau2 * bonding +
    N +
    #as.factor(N_quantiles) + 
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby
)


#2. basic model team size FE
bonding_teamfe <- lm(
  game_dist_prev5yr ~
    blau2 +
    bonding +
    blau2 * bonding +
    #N +
    as.factor(N_quantiles) +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby
)

#3. standardized model
bonding_z <- lm(
  game_dist_prev5yr_z ~
    blau2_z +
    bonding_z +
    blau2_z * bonding_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby
)


#4. fixed effects for developer firm
bonding_fe_1 <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    bonding_z +
    blau2_z * bonding_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby[moby$n_per_org_dev>=1,],
  index="org_dev",
  model="within"
)

bonding_fe_2 <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    bonding_z +
    blau2_z * bonding_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby[moby$n_per_org_dev>=2,],
  index="org_dev",
  model="within"
)


bonding_fe_5 <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    bonding_z +
    blau2_z * bonding_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby[moby$n_per_org_dev>=5,],
  index="org_dev",
  model="within"
)

bonding_fe_10 <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    bonding_z +
    blau2_z * bonding_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby[moby$n_per_org_dev>=10,],
  index="org_dev",
  model="within"
)


#5. random effects for developer firm
bonding_re <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    bonding_z +
    blau2_z * bonding_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby,
  index="org_dev",
  model="random"
)


#6. fixed effects model with dummies

org_dev_list <- table(moby$org_dev)
org_dev_list_repeats <- org_dev_list[org_dev_list>1]
org_dev_list_repeats_list <- as.numeric(names(org_dev_list_repeats))
org_dev_list_nonrepeats <- org_dev_list[org_dev_list==1]
org_dev_list_nonrepeats_list <- as.numeric(names(org_dev_list_nonrepeats))

delete_index <- match(org_dev_list_nonrepeats_list, moby$org_dev)

moby_repeat_devs <- moby[-delete_index,]

bonding_fe_dummies <- lm(
  game_dist_prev5yr_z ~
    blau2_z +
    bonding_z +
    blau2_z * bonding_z +
    as.factor(org_dev) +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
  ,
  data = moby_repeat_devs
)



#7. developer firm level model
bonding_aggr <- lm(
  game_dist_prev5yr ~
    blau2_z +
    bonding_z +
    blau2_z * bonding_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby_dev_firm_level
)


#8. developer firm level model, standardized
bonding_aggr_z <- lm(
  game_dist_prev5yr_z ~
    blau2_z +
    bonding_z +
    blau2_z * bonding_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby_dev_firm_level
)


# Adjust standard errors
#1.1 basic model, robust SE
cov1         <- vcovHC(bonding, type = "HC1")
bonding_robust_se    <- sqrt(diag(cov1))

#1.2 basic model, clustered SE
cov1         <- vcovHC(bonding, type = "HC1", cluster=moby$org_dev)
bonding_clustered_se    <- sqrt(diag(cov1))

#2. basic model team size FE, robust SE
cov1         <- vcovHC(bonding_teamfe, type = "HC1")
bonding_teamfe_robust_se    <- sqrt(diag(cov1))

#3.1 standardized model, robust SE
cov1         <- vcovHC(bonding_z, type = "HC1")
bonding_z_robust_se    <- sqrt(diag(cov1))

#3.2 standardized model, clustered SE
cov1         <- vcovHC(bonding_z, type = "HC1", cluster=moby$org_dev)
bonding_z_clustered_se    <- sqrt(diag(cov1))

#4. fixed effects for developer firm, clustered SE
cov1         <- vcovHC(bonding_fe_1, type = "HC1", cluster = "group")
bonding_fe_1_clustered_se    <- sqrt(diag(cov1))

cov1         <- vcovHC(bonding_fe_2, type = "HC1", cluster = "group")
bonding_fe_2_clustered_se    <- sqrt(diag(cov1))

cov1         <- vcovHC(bonding_fe_5, type = "HC1", cluster = "group")
bonding_fe_5_clustered_se    <- sqrt(diag(cov1))

cov1         <- vcovHC(bonding_fe_10, type = "HC1", cluster = "group")
bonding_fe_10_clustered_se    <- sqrt(diag(cov1))

#5. random effects for developer firm, clsutered SE
cov1         <- vcovHC(bonding_re, type = "HC1", cluster = "group")
bonding_re_clustered_se    <- sqrt(diag(cov1))


#6. fixed effects model with dummies
cov1         <- vcovHC(bonding_fe_dummies, type = "HC1", cluster=moby$org_dev)
bonding_fe_dummies_clustered_se    <- sqrt(diag(cov1))

#7. developer firm level model, robust SE
cov1         <- vcovHC(bonding_aggr, type = "HC1")
bonding_aggr_robust_se    <- sqrt(diag(cov1))

#8. developer firm level model, standardized, robust SE
cov1         <- vcovHC(bonding_aggr_z, type = "HC1")
bonding_aggr_z_robust_se    <- sqrt(diag(cov1))


# Stargazer output
#1. basic model
stargazer(bonding,bonding,
          column.labels=c('Base, rob SE', 'Base, clus SE'),
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "bonding*"), 
          se = list(bonding_robust_se, bonding_clustered_se),
          omit.stat = c("f", "ser")
          )

#2. basic model team size FE, robust SE
stargazer(bonding_teamfe,
          column.labels='Base model team N FE',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "bonding*"), 
          se = list(bonding_teamfe_robust_se),
          omit.stat = c("f", "ser")
          )
#3. standardized model
stargazer(bonding_z,bonding_z,
          column.labels=c('Std, rob SE', 'Std, clus SE'),
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "bonding*"), 
          se = list(bonding_z_robust_se,bonding_z_clustered_se),
          omit.stat = c("f", "ser")
          )


#4. fixed effects for developer firm, clustered SE
m1 <- bonding_fe_1
m2 <- bonding_fe_2
m3 <- bonding_fe_5
m4 <- bonding_fe_10

stargazer(m1,m2,m3,m4,
          column.labels=c('n>=1','n>=2', 'n>=5', 'n>=10'),
          dep.var.caption = "Dev firm FE, clus SE",
          type="text", 
          keep = c("blau*", "bonding*"), 
          se = list(bonding_fe_1_clustered_se, bonding_fe_2_clustered_se, bonding_fe_5_clustered_se, bonding_fe_10_clustered_se),
          omit.stat = c("f", "ser")
          )

#5. random effects for developer firm, clustered SE
stargazer(bonding_re,
          column.labels='Dev firm RE',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "bonding*"), 
          se = list(bonding_re_clustered_se),
          omit.stat = c("f", "ser")
          )

#6. fixed effects model with dummies
stargazer(bonding_fe_dummies,
          column.labels='Dev firm FE dummies',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "bonding*"), 
          se = list(bonding_fe_dummies_clustered_se),
          omit.stat = c("f", "ser")
          )
#7. developer firm level model, robust SE
stargazer(bonding_aggr,
          column.labels='Dev firm level',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "bonding*"), 
          se = list(bonding_aggr_robust_se),
          omit.stat = c("f", "ser")
          )
#8. developer firm level model, standardized, robust SE
stargazer(bonding_aggr_z,
          column.labels='Dev firm level std',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "bonding*"), 
          se = list(bonding_aggr_z_robust_se),
          omit.stat = c("f", "ser")
          )
```

##1.4. Incorporating

```{r}
moby$incorporating <- moby$female_coreness_log_z
moby_dev_firm_level$incorporating <- moby_dev_firm_level$female_coreness_log_z

#standardized variables
moby$game_dist_prev5yr_z <- (moby$game_dist_prev5yr-min(moby$game_dist_prev5yr, na.rm=T))/sd(moby$game_dist_prev5yr)
moby$prop_women2_z <- (moby$prop_women2-min(moby$prop_women2, na.rm=T))/sd(moby$prop_women2)
moby$incorporating_z <- (moby$incorporating-min(moby$incorporating, na.rm=T))/sd(moby$incorporating)
moby$blau2_z <- (moby$blau2-min(moby$blau2, na.rm=T))/sd(moby$blau2)


moby_dev_firm_level$game_dist_prev5yr_z <- (moby_dev_firm_level$game_dist_prev5yr-min(moby_dev_firm_level$game_dist_prev5yr, na.rm=T))/sd(moby_dev_firm_level$game_dist_prev5yr)
moby_dev_firm_level$prop_women2_z <- (moby_dev_firm_level$prop_women2-min(moby_dev_firm_level$prop_women2, na.rm=T))/sd(moby_dev_firm_level$prop_women2)
moby_dev_firm_level$incorporating_z <- (moby_dev_firm_level$incorporating-min(moby_dev_firm_level$incorporating, na.rm=T))/sd(moby_dev_firm_level$incorporating)
moby_dev_firm_level$blau2_z <- (moby_dev_firm_level$blau2-min(moby_dev_firm_level$blau2, na.rm=T))/sd(moby_dev_firm_level$blau2)

#1. basic model
incorporating <- lm(
  game_dist_prev5yr ~
    blau2 +
    incorporating +
    blau2 * incorporating +
    N +
    #as.factor(N_quantiles) + 
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby
)


#2. basic model team size FE
incorporating_teamfe <- lm(
  game_dist_prev5yr ~
    blau2 +
    incorporating +
    blau2 * incorporating +
    #N +
    as.factor(N_quantiles) +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby
)

#3. standardized model
incorporating_z <- lm(
  game_dist_prev5yr_z ~
    blau2_z +
    incorporating_z +
    blau2_z * incorporating_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby
)


#4. fixed effects for developer firm
incorporating_fe_1 <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    incorporating_z +
    blau2_z * incorporating_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby[moby$n_per_org_dev>=1,],
  index="org_dev",
  model="within"
)

incorporating_fe_2 <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    incorporating_z +
    blau2_z * incorporating_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby[moby$n_per_org_dev>=2,],
  index="org_dev",
  model="within"
)


incorporating_fe_5 <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    incorporating_z +
    blau2_z * incorporating_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby[moby$n_per_org_dev>=5,],
  index="org_dev",
  model="within"
)

incorporating_fe_10 <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    incorporating_z +
    blau2_z * incorporating_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby[moby$n_per_org_dev>=10,],
  index="org_dev",
  model="within"
)


#5. random effects for developer firm
incorporating_re <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    incorporating_z +
    blau2_z * incorporating_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby,
  index="org_dev",
  model="random"
)


#6. fixed effects model with dummies

org_dev_list <- table(moby$org_dev)
org_dev_list_repeats <- org_dev_list[org_dev_list>1]
org_dev_list_repeats_list <- as.numeric(names(org_dev_list_repeats))
org_dev_list_nonrepeats <- org_dev_list[org_dev_list==1]
org_dev_list_nonrepeats_list <- as.numeric(names(org_dev_list_nonrepeats))

delete_index <- match(org_dev_list_nonrepeats_list, moby$org_dev)

moby_repeat_devs <- moby[-delete_index,]

incorporating_fe_dummies <- lm(
  game_dist_prev5yr_z ~
    blau2_z +
    incorporating_z +
    blau2_z * incorporating_z +
    as.factor(org_dev) +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
  ,
  data = moby_repeat_devs
)



#7. developer firm level model
incorporating_aggr <- lm(
  game_dist_prev5yr ~
    blau2_z +
    incorporating_z +
    blau2_z * incorporating_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby_dev_firm_level
)


#8. developer firm level model, standardized
incorporating_aggr_z <- lm(
  game_dist_prev5yr_z ~
    blau2_z +
    incorporating_z +
    blau2_z * incorporating_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby_dev_firm_level
)


# Adjust standard errors
#1.1 basic model, robust SE
cov1         <- vcovHC(incorporating, type = "HC1")
incorporating_robust_se    <- sqrt(diag(cov1))

#1.2 basic model, clustered SE
cov1         <- vcovHC(incorporating, type = "HC1", cluster=moby$org_dev)
incorporating_clustered_se    <- sqrt(diag(cov1))

#2. basic model team size FE, robust SE
cov1         <- vcovHC(incorporating_teamfe, type = "HC1")
incorporating_teamfe_robust_se    <- sqrt(diag(cov1))

#3.1 standardized model, robust SE
cov1         <- vcovHC(incorporating_z, type = "HC1")
incorporating_z_robust_se    <- sqrt(diag(cov1))

#3.2 standardized model, clustered SE
cov1         <- vcovHC(incorporating_z, type = "HC1", cluster=moby$org_dev)
incorporating_z_clustered_se    <- sqrt(diag(cov1))

#4. fixed effects for developer firm, clustered SE
cov1         <- vcovHC(incorporating_fe_1, type = "HC1", cluster = "group")
incorporating_fe_1_clustered_se    <- sqrt(diag(cov1))

cov1         <- vcovHC(incorporating_fe_2, type = "HC1", cluster = "group")
incorporating_fe_2_clustered_se    <- sqrt(diag(cov1))

cov1         <- vcovHC(incorporating_fe_5, type = "HC1", cluster = "group")
incorporating_fe_5_clustered_se    <- sqrt(diag(cov1))

cov1         <- vcovHC(incorporating_fe_10, type = "HC1", cluster = "group")
incorporating_fe_10_clustered_se    <- sqrt(diag(cov1))

#5. random effects for developer firm, clsutered SE
cov1         <- vcovHC(incorporating_re, type = "HC1", cluster = "group")
incorporating_re_clustered_se    <- sqrt(diag(cov1))


#6. fixed effects model with dummies
cov1         <- vcovHC(incorporating_fe_dummies, type = "HC1", cluster=moby$org_dev)
incorporating_fe_dummies_clustered_se    <- sqrt(diag(cov1))

#7. developer firm level model, robust SE
cov1         <- vcovHC(incorporating_aggr, type = "HC1")
incorporating_aggr_robust_se    <- sqrt(diag(cov1))

#8. developer firm level model, standardized, robust SE
cov1         <- vcovHC(incorporating_aggr_z, type = "HC1")
incorporating_aggr_z_robust_se    <- sqrt(diag(cov1))


# Stargazer output
#1. basic model
stargazer(incorporating,incorporating,
          column.labels=c('Base, rob SE', 'Base, clus SE'),
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "incorporating*"), 
          se = list(incorporating_robust_se, incorporating_clustered_se),
          omit.stat = c("f", "ser")
          )

#2. basic model team size FE, robust SE
stargazer(incorporating_teamfe,
          column.labels='Base model team N FE',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "incorporating*"), 
          se = list(incorporating_teamfe_robust_se),
          omit.stat = c("f", "ser")
          )
#3. standardized model
stargazer(incorporating_z,incorporating_z,
          column.labels=c('Std, rob SE', 'Std, clus SE'),
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "incorporating*"), 
          se = list(incorporating_z_robust_se,incorporating_z_clustered_se),
          omit.stat = c("f", "ser")
          )


#4. fixed effects for developer firm, clustered SE
m1 <- incorporating_fe_1
m2 <- incorporating_fe_2
m3 <- incorporating_fe_5
m4 <- incorporating_fe_10

stargazer(m1,m2,m3,m4,
          column.labels=c('n>=1','n>=2', 'n>=5', 'n>=10'),
          dep.var.caption = "Dev firm FE, clus SE",
          type="text", 
          keep = c("blau*", "incorporating*"), 
          se = list(incorporating_fe_1_clustered_se, incorporating_fe_2_clustered_se, incorporating_fe_5_clustered_se, incorporating_fe_10_clustered_se),
          omit.stat = c("f", "ser")
          )

#5. random effects for developer firm, clustered SE
stargazer(incorporating_re,
          column.labels='Dev firm RE',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "incorporating*"), 
          se = list(incorporating_re_clustered_se),
          omit.stat = c("f", "ser")
          )

#6. fixed effects model with dummies
stargazer(incorporating_fe_dummies,
          column.labels='Dev firm FE dummies',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "incorporating*"), 
          se = list(incorporating_fe_dummies_clustered_se),
          omit.stat = c("f", "ser")
          )
#7. developer firm level model, robust SE
stargazer(incorporating_aggr,
          column.labels='Dev firm level',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "incorporating*"), 
          se = list(incorporating_aggr_robust_se),
          omit.stat = c("f", "ser")
          )
#8. developer firm level model, standardized, robust SE
stargazer(incorporating_aggr_z,
          column.labels='Dev firm level std',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "incorporating*"), 
          se = list(incorporating_aggr_z_robust_se),
          omit.stat = c("f", "ser")
          )
```

##1.5. Combined

```{r}
moby$combined <- moby$mixing_z*moby$bonding_z*moby$incorporating_z
moby_dev_firm_level$combined <- moby_dev_firm_level$mixing_z*moby_dev_firm_level$bonding_z*moby_dev_firm_level$incorporating_z

#standardized variables
moby$game_dist_prev5yr_z <- (moby$game_dist_prev5yr-min(moby$game_dist_prev5yr, na.rm=T))/sd(moby$game_dist_prev5yr)
moby$prop_women2_z <- (moby$prop_women2-min(moby$prop_women2, na.rm=T))/sd(moby$prop_women2)
moby$combined_z <- (moby$combined-min(moby$combined, na.rm=T))/sd(moby$combined)
moby$blau2_z <- (moby$blau2-min(moby$blau2, na.rm=T))/sd(moby$blau2)
moby$rank_avg_01_z <- (moby$rank_avg_01-min(moby$rank_avg_01, na.rm=T))/sd(moby$rank_avg_01)


moby_dev_firm_level$game_dist_prev5yr_z <- (moby_dev_firm_level$game_dist_prev5yr-min(moby_dev_firm_level$game_dist_prev5yr, na.rm=T))/sd(moby_dev_firm_level$game_dist_prev5yr)
moby_dev_firm_level$prop_women2_z <- (moby_dev_firm_level$prop_women2-min(moby_dev_firm_level$prop_women2, na.rm=T))/sd(moby_dev_firm_level$prop_women2)
moby_dev_firm_level$combined_z <- (moby_dev_firm_level$combined-min(moby_dev_firm_level$combined, na.rm=T))/sd(moby_dev_firm_level$combined)
moby_dev_firm_level$blau2_z <- (moby_dev_firm_level$blau2-min(moby_dev_firm_level$blau2, na.rm=T))/sd(moby_dev_firm_level$blau2)

#1. basic model
combined <- lm(
  game_dist_prev5yr ~
    blau2 +
    combined +
    blau2 * combined +
    N +
    #as.factor(N_quantiles) + 
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby
)


#2. basic model team size FE
combined_teamfe <- lm(
  game_dist_prev5yr ~
    blau2 +
    combined +
    blau2 * combined +
    #N +
    as.factor(N_quantiles) +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby
)

#3. standardized model
combined_z <- lm(
  game_dist_prev5yr_z ~
    blau2_z +
    combined_z +
    blau2_z * combined_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby
)


#4. fixed effects for developer firm
combined_fe_1 <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    combined_z +
    blau2_z * combined_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby[moby$n_per_org_dev>=1,],
  index="org_dev",
  model="within"
)

combined_fe_2 <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    combined_z +
    blau2_z * combined_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby[moby$n_per_org_dev>=2,],
  index="org_dev",
  model="within"
)


combined_fe_5 <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    combined_z +
    blau2_z * combined_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby[moby$n_per_org_dev>=5,],
  index="org_dev",
  model="within"
)

combined_fe_10 <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    combined_z +
    blau2_z * combined_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby[moby$n_per_org_dev>=10,],
  index="org_dev",
  model="within"
)


#5. random effects for developer firm
combined_re <- plm(
  game_dist_prev5yr_z ~
    blau2_z +
    combined_z +
    blau2_z * combined_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby,
  index="org_dev",
  model="random"
)


#6. fixed effects model with dummies

org_dev_list <- table(moby$org_dev)
org_dev_list_repeats <- org_dev_list[org_dev_list>1]
org_dev_list_repeats_list <- as.numeric(names(org_dev_list_repeats))
org_dev_list_nonrepeats <- org_dev_list[org_dev_list==1]
org_dev_list_nonrepeats_list <- as.numeric(names(org_dev_list_nonrepeats))

delete_index <- match(org_dev_list_nonrepeats_list, moby$org_dev)

moby_repeat_devs <- moby[-delete_index,]

combined_fe_dummies <- lm(
  game_dist_prev5yr_z ~
    blau2_z +
    combined_z +
    blau2_z * combined_z +
    as.factor(org_dev) +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
  ,
  data = moby_repeat_devs
)



#7. developer firm level model
combined_aggr <- lm(
  game_dist_prev5yr ~
    blau2_z +
    combined_z +
    blau2_z * combined_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby_dev_firm_level
)


#8. developer firm level model, standardized
combined_aggr_z <- lm(
  game_dist_prev5yr_z ~
    blau2_z +
    combined_z +
    blau2_z * combined_z +
    N +
    newbies_prop +
    games_tenure +
    star_prior +
    hold_single_firm +
    ratio_core_z +
    num_countries +
    plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
    year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
    ,
  data = moby_dev_firm_level
)


# Adjust standard errors
#1.1 basic model, robust SE
cov1         <- vcovHC(combined, type = "HC1")
combined_robust_se    <- sqrt(diag(cov1))

#1.2 basic model, clustered SE
cov1         <- vcovHC(combined, type = "HC1", cluster=moby$org_dev)
combined_clustered_se    <- sqrt(diag(cov1))

#2. basic model team size FE, robust SE
cov1         <- vcovHC(combined_teamfe, type = "HC1")
combined_teamfe_robust_se    <- sqrt(diag(cov1))

#3.1 standardized model, robust SE
cov1         <- vcovHC(combined_z, type = "HC1")
combined_z_robust_se    <- sqrt(diag(cov1))

#3.2 standardized model, clustered SE
cov1         <- vcovHC(combined_z, type = "HC1", cluster=moby$org_dev)
combined_z_clustered_se    <- sqrt(diag(cov1))

#4. fixed effects for developer firm, clustered SE
cov1         <- vcovHC(combined_fe_1, type = "HC1", cluster = "group")
combined_fe_1_clustered_se    <- sqrt(diag(cov1))

cov1         <- vcovHC(combined_fe_2, type = "HC1", cluster = "group")
combined_fe_2_clustered_se    <- sqrt(diag(cov1))

cov1         <- vcovHC(combined_fe_5, type = "HC1", cluster = "group")
combined_fe_5_clustered_se    <- sqrt(diag(cov1))

cov1         <- vcovHC(combined_fe_10, type = "HC1", cluster = "group")
combined_fe_10_clustered_se    <- sqrt(diag(cov1))

#5. random effects for developer firm, clsutered SE
cov1         <- vcovHC(combined_re, type = "HC1", cluster = "group")
combined_re_clustered_se    <- sqrt(diag(cov1))


#6. fixed effects model with dummies
cov1         <- vcovHC(combined_fe_dummies, type = "HC1", cluster=moby$org_dev)
combined_fe_dummies_clustered_se    <- sqrt(diag(cov1))

#7. developer firm level model, robust SE
cov1         <- vcovHC(combined_aggr, type = "HC1")
combined_aggr_robust_se    <- sqrt(diag(cov1))

#8. developer firm level model, standardized, robust SE
cov1         <- vcovHC(combined_aggr_z, type = "HC1")
combined_aggr_z_robust_se    <- sqrt(diag(cov1))


# Stargazer output
#1. basic model
stargazer(combined,combined,
          column.labels=c('Base, rob SE', 'Base, clus SE'),
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "combined*"), 
          se = list(combined_robust_se, combined_clustered_se),
          omit.stat = c("f", "ser")
          )

#2. basic model team size FE, robust SE
stargazer(combined_teamfe,
          column.labels='Base model team N FE',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "combined*"), 
          se = list(combined_teamfe_robust_se),
          omit.stat = c("f", "ser")
          )
#3. standardized model
stargazer(combined_z,combined_z,
          column.labels=c('Std, rob SE', 'Std, clus SE'),
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "combined*"), 
          se = list(combined_z_robust_se,combined_z_clustered_se),
          omit.stat = c("f", "ser")
          )


#4. fixed effects for developer firm, clustered SE
m1 <- combined_fe_1
m2 <- combined_fe_2
m3 <- combined_fe_5
m4 <- combined_fe_10

stargazer(m1,m2,m3,m4,
          column.labels=c('n>=1','n>=2', 'n>=5', 'n>=10'),
          dep.var.caption = "Dev firm FE, clus SE",
          type="text", 
          keep = c("blau*", "combined*"), 
          se = list(combined_fe_1_clustered_se, combined_fe_2_clustered_se, combined_fe_5_clustered_se, combined_fe_10_clustered_se),
          omit.stat = c("f", "ser")
          )

#5. random effects for developer firm, clustered SE
stargazer(combined_re,
          column.labels='Dev firm RE',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "combined*"), 
          se = list(combined_re_clustered_se),
          omit.stat = c("f", "ser")
          )

#6. fixed effects model with dummies
stargazer(combined_fe_dummies,
          column.labels='Dev firm FE dummies',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "combined*"), 
          se = list(combined_fe_dummies_clustered_se),
          omit.stat = c("f", "ser")
          )
#7. developer firm level model, robust SE
stargazer(combined_aggr,
          column.labels='Dev firm level',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "combined*"), 
          se = list(combined_aggr_robust_se),
          omit.stat = c("f", "ser")
          )
#8. developer firm level model, standardized, robust SE
stargazer(combined_aggr_z,
          column.labels='Dev firm level std',
          dep.var.caption = "",
          type="text", 
          keep = c("blau*", "combined*"), 
          se = list(combined_aggr_z_robust_se),
          omit.stat = c("f", "ser")
          )
```

```{r, message=FALSE, warning = FALSE}
#developer firm level aggregation
moby_dev_firm_level <- aggregate(moby, list(dev_firm = moby$org_dev), mean)
```




#Models Predicting Success (Review Score)

###Heckman selection model for review score | has review
```{r}
library(sampleSelection)

df=moby


df$div_inc <- df$blau2*df$combined
df$div_inc_z <- (df$div_inc-mean(df$div_inc, na.rm=T))/sd(df$div_inc)

df$div_mixing <- df$blau2*df$mixing
df$div_mixing_z <- (df$div_mixing-mean(df$div_mixing, na.rm=T))/sd(df$div_mixing)

df$div_bonding <- df$blau2*df$bonding
df$div_bonding_z <- (df$div_bonding-mean(df$div_bonding, na.rm=T))/sd(df$div_bonding)

df$div_incorporating <- df$blau2*df$incorporating
df$div_incorporating_z <- (df$div_incorporating-mean(df$div_incorporating, na.rm=T))/sd(df$div_incorporating)


df$div_inc_dist <- df$game_dist_prev5yr*df$blau2*df$combined
df$div_inc_dist_z <- (df$div_inc_dist-mean(df$div_inc_dist, na.rm=T))/sd(df$div_inc_dist)

df$div_mixing_dist <- df$game_dist_prev5yr*df$blau2*df$mixing
df$div_mixing_dist_z <- (df$div_mixing_dist-mean(df$div_mixing_dist, na.rm=T))/sd(df$div_mixing_dist)

df$div_bonding_dist <- df$game_dist_prev5yr*df$blau2*df$bonding
df$div_bonding_dist_z <- (df$div_bonding_dist-mean(df$div_bonding_dist, na.rm=T))/sd(df$div_bonding_dist)

df$div_incorporating_dist <- df$game_dist_prev5yr*df$blau2*df$incorporating
df$div_incorporating_dist_z <- (df$div_incorporating_dist-mean(df$div_incorporating_dist, na.rm=T))/sd(df$div_incorporating_dist)

df$rank_avg_01_z <- (df$rank_avg_01-mean(df$rank_avg_01, na.rm=T))/sd(df$rank_avg_01, na.rm=T)

#summary(glm(review ~ prop_women2, data=moby))


incl_mixing_sel_sm <- heckit( 
      review ~ 
      prop_women2 
      ,
      
      rank_avg_01_z ~ 
      game_dist_prev5yr +
      #div_mixing_dist_z
      div_mixing_z
      , 
       data=df)


incl_mixing_rev_sm <- lm(
      rank_avg_01_z ~ 
      game_dist_prev5yr +
      #div_mixing_dist_z
      div_mixing_z
      , 
       data=df[df$rank_avg_01>0,] 
)



incl_mixing_sel <- heckit( 
      review ~ 
      #game_dist_prev5yr +
      prop_women2 + 
      N +   
      star_prior +
      num_countries +
      plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
      year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
      ,
      
      rank_avg_01_z ~ 
      game_dist_prev5yr +
      #div_mixing_dist_z
      div_mixing_z +
      N +
      #newbies_prop +
      games_tenure +
      star_prior +
      hold_single_firm +
      ratio_core +
      #num_countries +
      #plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
      year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
      , 
       data=df)


incl_mixing_rev <- lm(
      rank_avg_01_z ~ 
      game_dist_prev5yr +
      #div_mixing_dist_z
      div_mixing_z +
      N +
      #newbies_prop +
      games_tenure +
      star_prior +
      hold_single_firm +
      ratio_core +
      num_countries +
      plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
      year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
      , 
       data=df[df$rank_avg_01>0,] 
)






incl_bonding_sel_sm <- heckit( 
      review ~ 
      prop_women2 
      ,
      
      rank_avg_01_z ~ 
      game_dist_prev5yr +
      #div_bonding_dist_z
      div_bonding_z
      , 
       data=df)


incl_bonding_rev_sm <- lm(
      rank_avg_01_z ~ 
      game_dist_prev5yr +
      #div_bonding_dist_z
      div_bonding_z
      , 
       data=df[df$rank_avg_01>0,] 
)



incl_bonding_sel <- heckit( 
      review ~ 
      #game_dist_prev5yr +
      prop_women2 + 
      N +   
      star_prior +
      num_countries +
      plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
      year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
      ,
      
      rank_avg_01_z ~ 
      game_dist_prev5yr +
      #div_bonding_dist_z
      div_bonding_z +
      N +
      #newbies_prop +
      games_tenure +
      star_prior +
      hold_single_firm +
      ratio_core +
      #num_countries +
      #plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
      year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
      , 
       data=df)


incl_bonding_rev <- lm(
      rank_avg_01_z ~ 
      game_dist_prev5yr +
      #div_bonding_dist_z
      div_bonding_z +
      N +
      #newbies_prop +
      games_tenure +
      star_prior +
      hold_single_firm +
      ratio_core +
      #num_countries +
      #plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
      year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
      , 
       data=df[df$rank_avg_01>0,] 
)






incl_incorporating_sel_sm <- heckit( 
      review ~ 
      prop_women2 
      ,
      
      rank_avg_01_z ~ 
      game_dist_prev5yr +
      #div_incorporating_dist_z
      div_incorporating_z
      , 
       data=df)


incl_incorporating_rev_sm <- lm(
      rank_avg_01_z ~ 
      game_dist_prev5yr +
      #div_incorporating_dist_z
      div_incorporating_z
      , 
       data=df[df$rank_avg_01>0,] 
)



incl_incorporating_sel <- heckit( 
      review ~ 
      #game_dist_prev5yr +
      prop_women2 + 
      N +   
      star_prior +
      num_countries +
      plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
      year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
      ,
      
      rank_avg_01_z ~ 
      game_dist_prev5yr +
      #div_incorporating_dist_z
      div_incorporating_z +
      N +
      #newbies_prop +
      games_tenure +
      star_prior +
      hold_single_firm +
      ratio_core +
      #num_countries +
      #plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
      year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
      , 
       data=df)


incl_incorporating_rev <- lm(
      rank_avg_01_z ~ 
      game_dist_prev5yr +
      #div_incorporating_dist_z
      div_incorporating_z +
      N +
      #newbies_prop +
      games_tenure +
      star_prior +
      hold_single_firm +
      ratio_core +
      #num_countries +
      #plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
      year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
      , 
       data=df[df$rank_avg_01>0,] 
)







incl_sel_sm <- heckit( 
      review ~ 
      prop_women2 
      ,
      
      rank_avg_01_z ~ 
      game_dist_prev5yr +
      #div_inc_dist_z
      div_inc_z
      , 
       data=df)


incl_rev_sm <- lm(
      rank_avg_01_z ~ 
      game_dist_prev5yr +
      #div_inc_dist_z
      div_inc_z
      , 
       data=df[df$rank_avg_01>0,] 
)



incl_sel <- heckit( 
      review ~ 
      #game_dist_prev5yr +
      prop_women2 + 
      N +   
      star_prior +
      num_countries +
      plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
      year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
      ,
      
      rank_avg_01_z ~ 
      game_dist_prev5yr +
      #div_inc_dist_z
      div_inc_z +
      N +
      #newbies_prop +
      games_tenure +
      star_prior +
      hold_single_firm +
      ratio_core +
      #num_countries +
      #plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
      year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
      , 
       data=df)


incl_rev <- lm(
      rank_avg_01_z ~ 
      game_dist_prev5yr +
      #div_inc_dist_z
      div_inc_z +
      N +
      #newbies_prop +
      games_tenure +
      star_prior +
      hold_single_firm +
      ratio_core +
      #num_countries +
      #plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
      year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
      , 
       data=df[df$rank_avg_01>0,] 
)




incl_sel_s <- incl_sel
incl_sel_s$param$index$betaO <- incl_sel$param$index$betaS
incl_sel_s$param$index$betaS <- incl_sel$param$index$betaO

incl_sel_sm_s <- incl_sel_sm
incl_sel_sm_s$param$index$betaO <- incl_sel_sm$param$index$betaS
incl_sel_sm_s$param$index$betaS <- incl_sel_sm$param$index$betaO


incl_mixing_sel_s <- incl_mixing_sel
incl_mixing_sel_s$param$index$betaO <- incl_mixing_sel$param$index$betaS
incl_mixing_sel_s$param$index$betaS <- incl_mixing_sel$param$index$betaO

incl_mixing_sel_sm_s <- incl_mixing_sel_sm
incl_mixing_sel_sm_s$param$index$betaO <- incl_mixing_sel_sm$param$index$betaS
incl_mixing_sel_sm_s$param$index$betaS <- incl_mixing_sel_sm$param$index$betaO


incl_bonding_sel_s <- incl_bonding_sel
incl_bonding_sel_s$param$index$betaO <- incl_bonding_sel$param$index$betaS
incl_bonding_sel_s$param$index$betaS <- incl_bonding_sel$param$index$betaO

incl_bonding_sel_sm_s <- incl_bonding_sel_sm
incl_bonding_sel_sm_s$param$index$betaO <- incl_bonding_sel_sm$param$index$betaS
incl_bonding_sel_sm_s$param$index$betaS <- incl_bonding_sel_sm$param$index$betaO


incl_incorporating_sel_s <- incl_incorporating_sel
incl_incorporating_sel_s$param$index$betaO <- incl_incorporating_sel$param$index$betaS
incl_incorporating_sel_s$param$index$betaS <- incl_incorporating_sel$param$index$betaO

incl_incorporating_sel_sm_s <- incl_incorporating_sel_sm
incl_incorporating_sel_sm_s$param$index$betaO <- incl_incorporating_sel_sm$param$index$betaS
incl_incorporating_sel_sm_s$param$index$betaS <- incl_incorporating_sel_sm$param$index$betaO



m1 <- incl_sel_sm_s
m2 <- incl_sel_sm
m3 <- incl_rev_sm
m4 <- incl_sel_s
m5 <- incl_sel
m6 <- incl_rev




stargazer(m1,m2,m3,m4,m5,m6, 
          model.numbers = T,
          type="text", 
          keep = c("n_wom*", "*onst*", "prop_wom*", "review", "rank_avg_*", "div_inc*", "combined*", "game_dist_*", "mixing*", "bondin*", "incorp*"),
          add.lines=list(c("Controls added", "No", "No", "No", "Yes", "Yes", "Yes")),
          #order=c( "^game_dist_prev5yr_z$", "^blau2_z$","^game_dist_prev5yr_z:blau2_z$", "Constant"),
          #table.layout = "=ldc-ta-s=n",
          #report=("vc*p"),
          selection.equation = F,
          omit.stat = c("f", "ser"),
          column.labels = c("selection", "outcome","ols","selection", "outcome","ols")
          )



m1 <- incl_mixing_sel_sm_s
m2 <- incl_mixing_sel_sm
m3 <- incl_mixing_rev_sm
m4 <- incl_mixing_sel_s
m5 <- incl_mixing_sel
m6 <- incl_mixing_rev




stargazer(m1,m2,m3,m4,m5,m6, 
          model.numbers = T,
          type="text", 
          keep = c("n_wom*", "*onst*", "prop_wom*", "review", "rank_avg_*", "div_mixing*", "combined*", "game_dist_*", "mixing*", "bondin*", "incorp*"),
          add.lines=list(c("Controls added", "No", "No", "No", "Yes", "Yes", "Yes")),
          #order=c( "^game_dist_prev5yr_z$", "^blau2_z$","^game_dist_prev5yr_z:blau2_z$", "Constant"),
          #table.layout = "=ldc-ta-s=n",
          #report=("vc*p"),
          selection.equation = F,
          omit.stat = c("f", "ser"),
          column.labels = c("selection", "outcome","ols","selection", "outcome","ols")
          )



m1 <- incl_bonding_sel_sm_s
m2 <- incl_bonding_sel_sm
m3 <- incl_bonding_rev_sm
m4 <- incl_bonding_sel_s
m5 <- incl_bonding_sel
m6 <- incl_bonding_rev




stargazer(m1,m2,m3,m4,m5,m6, 
          model.numbers = T,
          type="text", 
          keep = c("n_wom*", "*onst*", "prop_wom*", "review", "rank_avg_*", "div_bonding*", "combined*", "game_dist_*", "mixing*", "bondin*", "incorp*"),
          add.lines=list(c("Controls added", "No", "No", "No", "Yes", "Yes", "Yes")),
          #order=c( "^game_dist_prev5yr_z$", "^blau2_z$","^game_dist_prev5yr_z:blau2_z$", "Constant"),
          #table.layout = "=ldc-ta-s=n",
          #report=("vc*p"),
          selection.equation = F,
          omit.stat = c("f", "ser"),
          column.labels = c("selection", "outcome","ols","selection", "outcome","ols")
          )



m1 <- incl_incorporating_sel_sm_s
m2 <- incl_incorporating_sel_sm
m3 <- incl_incorporating_rev_sm
m4 <- incl_incorporating_sel_s
m5 <- incl_incorporating_sel
m6 <- incl_incorporating_rev




stargazer(m1,m2,m3,m4,m5,m6, 
          model.numbers = T,
          type="text", 
          keep = c("n_wom*", "*onst*", "prop_wom*", "review", "rank_avg_*", "div_incorporating*", "combined*", "game_dist_*", "mixing*", "bondin*", "incorp*"),
          add.lines=list(c("Controls added", "No", "No", "No", "Yes", "Yes", "Yes")),
          #order=c( "^game_dist_prev5yr_z$", "^blau2_z$","^game_dist_prev5yr_z:blau2_z$", "Constant"),
          #table.layout = "=ldc-ta-s=n",
          #report=("vc*p"),
          selection.equation = F,
          omit.stat = c("f", "ser"),
          column.labels = c("selection", "outcome","ols","selection", "outcome","ols")
          )



#summary(combined_sel)
#summary(incl_sel)

``` 



Point estimate for DIV x INC with and without controlling for sample selection

```{r, fig.width = 2.5, fig.height = 2.5}

scaleFUN <- function(x) sprintf("%.2f", x)

dropLeadingZero <- function(l){
  str_replace(scaleFUN(l), '0.', '.')
}


lo_color = "#69629a"


B_ols <- summary(incl_rev)$coefficients[3,1]
B_sel <- summary(incl_sel$lm)$coefficients[3,1]

se_ols <- summary(incl_rev)$coefficients[3,2]
ci_ols_hi <- B_ols + 1.96*se_ols
ci_ols_lo <- B_ols - 1.96*se_ols

se_sel <- summary(incl_sel$lm)$coefficients[3,2]
ci_sel_hi <- B_sel + 1.96*se_sel
ci_sel_lo <- B_sel - 1.96*se_sel

min_y=min(ci_ols_lo, ci_sel_lo)
max_y=max(ci_ols_hi,ci_sel_hi)



nonsig_col <- "gray60"
sig_col <- "black"

s <- 3.1
ps <- 2.85
  







review_score_point <- ggplot()+
  
  geom_hline(yintercept = 0, linetype="dashed", alpha=0.7, color="black", size=0.2) +
  
  geom_point(aes(x=as.factor(2), y=B_ols),size=ps,stroke = 1, shape = 21, fill =sig_col, color=sig_col)+
  geom_errorbar(aes(x=as.factor(2), ymin=ci_ols_lo, ymax=ci_ols_hi),width=0, linewidth=0.75, color=sig_col)+
  annotate(geom = "text",x =as.factor(2) ,y = B_ols,label = "1",col = "white",size = s,hjust = 0.5,alpha = 1) +
  
  geom_point(aes(x=as.factor(1), y=B_sel),size=ps,stroke = 1, shape = 21, fill =nonsig_col, color=nonsig_col)+
  geom_errorbar(aes(x=as.factor(1), ymin=ci_sel_lo, ymax=ci_sel_hi),width=0, linewidth=0.75, color=nonsig_col)+
  annotate(geom = "text",x =as.factor(1) ,y = B_sel,label = "2",col = "white",size = s,hjust = 0.5,alpha = 1) +
  
  annotate("text", label = "OLS", x = 2, y = min_y-abs(.4*min_y), size = 3, hjust=0, colour = "black") +
  annotate("text", label = "Controlling for\nsample\nselection bias", x = 1, y = min_y-abs(.4*min_y), size = 3.3, hjust=0, colour = "black") +
  
  
  
    
  #axes formatting
  scale_y_continuous(
                     #trans='log10',
                     limits=c(min_y-abs(.4*min_y), max_y), 
                     labels = dropLeadingZero,
                     expand=expansion(add=c(.005,.005)),
                     breaks = c(-.08, -.06, -.04, -.02, 0, .02), 
                     name="Change in Review Score") +
  scale_x_discrete(
                     expand=expansion(add=c(.5,.5)), 
                     #breaks = pretty(syn_data_mixing$blau2, n = 5), 
                     name="One SD change in\nDiversity \u00D7 Inclusion") +
  
  coord_flip( ) +
  
  theme(aspect.ratio=1, 
            title =element_text(size=11),
            panel.grid.major.x = element_line(size=0.2), 
            panel.grid.major.y = element_blank(), 
            panel.grid.minor = element_blank(), 
            panel.background = element_blank(), 
            panel.border = element_rect(colour = "black", 
                                        fill=NA, 
                                        size=0.2),
            #legend.position = c(0.2, 0.3),
            plot.title = element_text(size = tit_s, face = "bold", colour = "black"),
            #axis.ticks.x = element_blank(),
            axis.title.x = element_text(size = 11, colour = "black"),
            axis.title.y = element_text(size = 11, colour = "black"),
            axis.text.y = element_blank()
            #axis.text.x = element_blank()
            #plot.margin = unit(c(m_top,m_right,m_bottom,m_left), "mm")
            )

review_score_point
  
```










```{r}

moby$log_global_sales2_annual_z <- (moby$log_global_sales2_annual-mean(moby$log_global_sales2_annual, na.rm=T))/sd(moby$log_global_sales2_annual, na.rm=T)

moby$sales_per_member <- log10(moby$log_global_sales2_annual/moby$N)

sales_m0 <- lm(
      log_global_sales2_annual_z ~ 
      rank_avg_01_z +
      #div_inc_dist_z
      div_inc_z +
      N +
      #newbies_prop +
      games_tenure +
      star_prior +
      hold_single_firm +
      ratio_core +
      #num_countries +
      #plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
      year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
      , 
       data=df 
)

sales_sel <- heckit( 
      review ~ 
      #game_dist_prev5yr +
      prop_women2 + 
      N +   
      star_prior +
      num_countries +
      plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
      year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
      ,
      
      log_global_sales2_annual_z ~ 
      rank_avg_01_z +
      #div_inc_dist_z
      div_inc_z +
      N +
      #newbies_prop +
      games_tenure +
      star_prior +
      hold_single_firm +
      ratio_core +
      #num_countries +
      #plat2 + plat7 + plat12 + plat13 + plat14 + plat15 +
      year13 + year15 + year16 + year17 + year18 + year19 + year20 + year21 + year22 + year23 + year24 + year25 + year26 + year27 + year28
      , 
       data=df)


sales_sel_s <- sales_sel
sales_sel_s$param$index$betaO <- sales_sel$param$index$betaS
sales_sel_s$param$index$betaS <- sales_sel$param$index$betaO  
 
m0 <- sales_m0
m1 <- sales_sel_s
m2 <- sales_sel

  
stargazer(m0,m1,m2,
          #column.labels=c('Std, clus SE','Std, clus SE','Std, clus SE','Std, clus SE'),
          model.numbers = T,
          #dep.var.labels = c("log sales Z", "sales", "log sales Z"),
          type="text", 
          keep = c("revie*", "*onst*", "div_inc_z*", "review", "rank_avg_*", "div_incorporating*", "combined*", "game_dist_*", "mixing*", "bondin*", "incorp*"),
          #add.lines=list(c("Controls added", "No", "No", "Yes", "No", "Yes", "Yes", "Yes", "Yes")),
          #order=c( "^game_dist_prev5yr_z$", "^blau2_z$","^game_dist_prev5yr_z:blau2_z$", "Constant"),
          table.layout = "=ldc-ta-s=n",
          # se = list(has_review_sales_sm_clustered_se, 
          #           review_sales_sm_clustered_se,
          #           review_sales_div_clustered_se,
          #           review_sales_div_int_clustered_se),
          omit.stat = c("f", "ser")
          )

```










###Predictions and Marginsplots
Synthetic data file for interaction of two variables, with Robust SE (without fixed effects dummies factor)
```{r}
create_synt <- function(model_object, data_file, cluster_attrib=NULL) {
  # this is a function that creates synthetic data
  
  var_names <- names(model_object$coefficients)
  #delete intercept
  var_sel <- grepl("ntercept", var_names) #small and big i
  var_names <- var_names[!var_sel]
  #delete squared term
  var_sel <- grepl("2)", var_names)
  var_names <- var_names[!var_sel]

  #save interaction
  var_sel <- grepl(":", var_names)
  var_inter_names <- var_names[var_sel]
  
  var_inter_names <- unique(unlist(strsplit(var_inter_names, "[:]")))
  
  #delete interactions
  var_sel <- grepl(":", var_names)
  var_names <- var_names[!var_sel]
  
  #delete variables involved in interactions
  for (i in 1:length(var_inter_names)){
  var_names <- var_names[var_names!=var_inter_names[i]]
  }
  
  #results
  cbind(var_inter_names)
  cbind(var_names)
  
  #min and max values for interaction variables
  inter_min_vec <- array(0, dim=c(1,length(var_inter_names)))
  
  for (v in 1:length(var_inter_names)){
    inter_min_vec[v] <- min(as.numeric(unlist(data_file[var_inter_names[v]])), na.rm=TRUE)
  }
  
  inter_max_vec <- array(0, dim=c(1,length(var_inter_names)))
  
  for (v in 1:length(var_inter_names)){
    inter_max_vec[v] <- max(as.numeric(unlist(data_file[var_inter_names[v]])), na.rm=TRUE)
  }


  #interaction grid settings
  var1_from <- inter_min_vec[1]
  var1_to   <- inter_max_vec[1]
  var1_step <- (inter_max_vec[1]-inter_min_vec[1])/100
  
  #var1_from <- 0
  #var1_to   <- 1
  #var1_step <- 0.01
  
  var2_from <- inter_min_vec[2]
  var2_to   <- inter_max_vec[2]
  var2_step <- (inter_max_vec[2]-inter_min_vec[2])/100
  
  
  #number of variables and interactions
  n_inter_vars <- length(var_inter_names)
  n_vars <- length(var_names)
  
  #interaction combination
  inter_grid <- expand.grid(
                       seq(from = var1_from, to = var1_to, by = var1_step),
                       seq(from = var2_from, to = var2_to, by = var2_step)
                       )
  
  #fixing controls at the mean
  means_vec <- array(0, dim=c(1,n_vars))
  
  for (v in 1:n_vars){
    means_vec[v] <- mean(as.numeric(unlist(data_file[var_names[v]])), na.rm=TRUE)
  }
  
  #assembling the synthetic datafile
  n_rows <- dim(inter_grid)[1]
  means_grid <- matrix(means_vec,nrow=n_rows,ncol=length(means_vec),byrow=TRUE)
  
  syn_data <- data.frame(cbind(inter_grid, means_grid))
  names(syn_data) <- c(var_inter_names,var_names)
  
  #with clustered SE or robust SE
  #--if clustering attribute is added, clustered SE is computed, otherwise robust SE
  if(is.null(cluster_attrib)) {
      predvals <- predict(model_object, newdata=syn_data, se.fit = TRUE, vcov.fun = "vcovHC", vcov.type = "HC1")
  }
    if(!is.null(cluster_attrib)) {
      predvals <- predict(model_object, newdata=syn_data, se.fit = TRUE, vcov.fun = "vcovHC", vcov.type = "HC1", cluster=cluster_attrib)
  }

  
 
  
  #withour robust SE it would be:
  #predvals <- predict(model_object, newdata=syn_data, se.fit = TRUE)

  
  syn_data$ols_pred <- predvals$fit
  syn_data$ols_low <- (predvals$fit - 1.96 * predvals$se.fit)
  syn_data$ols_up <- (predvals$fit + 1.96 * predvals$se.fit)
  
  return(syn_data)
  }
```





Synthetic data file for Heckman
```{r}
create_synt_heck <- function(model_object, data_file, cluster_attrib=NULL) {
  # this is a function that creates synthetic data
  
  model_object <- mixing_sel
  data_file <- moby
  cluster_attrib <- NULL
  
  var_names <- names(model_object$coefficients)
  #delete intercept
  var_sel <- grepl("ntercept", var_names) #small and big i
  var_names <- var_names[!var_sel]
  #delete squared term
  var_sel <- grepl("2)", var_names)
  var_names <- var_names[!var_sel]

  #save interaction
  var_sel <- grepl(":", var_names)
  var_inter_names <- var_names[var_sel]
  
  var_inter_names <- unique(unlist(strsplit(var_inter_names, "[:]")))
  
  #delete interactions
  var_sel <- grepl(":", var_names)
  var_names <- var_names[!var_sel]
  
  #delete variables involved in interactions
  for (i in 1:length(var_inter_names)){
  var_names <- var_names[var_names!=var_inter_names[i]]
  }
  
  #results
  cbind(var_inter_names)
  cbind(var_names)
  
  #take out last three var names: "invMillsRatio" "sigma" "rho"       
  var_names <- var_names[-((length(var_names)-2):length(var_names))]
  
  #min and max values for interaction variables
  inter_min_vec <- array(0, dim=c(1,length(var_inter_names)))
  
  for (v in 1:length(var_inter_names)){
    inter_min_vec[v] <- min(as.numeric(unlist(data_file[var_inter_names[v]])), na.rm=TRUE)
  }
  
  inter_max_vec <- array(0, dim=c(1,length(var_inter_names)))
  
  for (v in 1:length(var_inter_names)){
    inter_max_vec[v] <- max(as.numeric(unlist(data_file[var_inter_names[v]])), na.rm=TRUE)
  }


  #interaction grid settings
  var1_from <- inter_min_vec[1]
  var1_to   <- inter_max_vec[1]
  var1_step <- (inter_max_vec[1]-inter_min_vec[1])/100
  
  #var1_from <- 0
  #var1_to   <- 1
  #var1_step <- 0.01
  
  var2_from <- inter_min_vec[2]
  var2_to   <- inter_max_vec[2]
  var2_step <- (inter_max_vec[2]-inter_min_vec[2])/100
  
  
  #number of variables and interactions
  n_inter_vars <- length(var_inter_names)
  n_vars <- length(var_names)
  
  #interaction combination
  inter_grid <- expand.grid(
                       seq(from = var1_from, to = var1_to, by = var1_step),
                       seq(from = var2_from, to = var2_to, by = var2_step)
                       )
  
  #fixing controls at the mean
  means_vec <- array(0, dim=c(1,n_vars))
  
  for (v in 1:n_vars){
    means_vec[v] <- mean(as.numeric(unlist(data_file[var_names[v]])), na.rm=TRUE)
  }
  
  #assembling the synthetic datafile
  n_rows <- dim(inter_grid)[1]
  means_grid <- matrix(means_vec,nrow=n_rows,ncol=length(means_vec),byrow=TRUE)
  
  syn_data <- data.frame(cbind(inter_grid, means_grid))
  names(syn_data) <- c(var_inter_names,var_names)
  
  #with clustered SE or robust SE
  #--if clustering attribute is added, clustered SE is computed, otherwise robust SE
  if(is.null(cluster_attrib)) {
      predvals <- predict(model_object, newdata=syn_data, se.fit = TRUE, part="outcome")
  }
    if(!is.null(cluster_attrib)) {
      predvals <- predict(model_object, newdata=syn_data, se.fit = TRUE, part="outcome", interval="confidence")
  }

  
vcov(model_object)
  
  predvals_lm <- predict.lm(model_object$lm, newdata=syn_data, se.fit = TRUE)
  predictSE(model_object$lm, newdata=syn_data, se.fit = TRUE)
  
  v <- vcov(model_object$lm)
  v <- v[2:(dim(v)-2), 2:(dim(v)-2)]
  
  se.yhat = sqrt(diag(syn_data%*%v%*%t(syn_data)))
  
  
  #withour robust SE it would be:
  #predvals <- predict(model_object, newdata=syn_data, se.fit = TRUE)

  
  syn_data$ols_pred <- predvals
  syn_data$ols_low <- (predvals$fit - 1.96 * predvals$se.fit)
  syn_data$ols_up <- (predvals$fit + 1.96 * predvals$se.fit)
  
  return(syn_data)
  }
```






```{r}
create_synt_one_var <-
  function(model_object,
           var,
           min,
           max,
           data_file,
           cluster_attrib = NULL) {
    # this is a function that creates synthetic data
    
    var_names <- names(model_object$coefficients)
    #delete intercept
    var_sel <- grepl("ntercept", var_names) #small and big i
    var_names <- var_names[!var_sel]
    #delete squared term
    var_sel <- grepl("2)", var_names)
    var_names <- var_names[!var_sel]
    
    #save selected variable
    var_sel <- var_names == var
    var_focal_name <- var_names[var_sel]
    
    #delete selected variable
    var_names <- var_names[!var_sel]
    
    #results
    cbind(var_focal_name)
    cbind(var_names)
    n_vars <- length(var_names)
    
    #min and max values for interaction variables
    if (is.na(min)) {
      var_focal_min <-
        min(as.numeric(unlist(data_file[var_focal_name])), na.rm = TRUE)
    } else{
      var_focal_min <- min
    }
    
    if (is.na(max)) {
      var_focal_max <-
        max(as.numeric(unlist(data_file[var_focal_name])), na.rm = TRUE)
    } else{
      var_focal_max <- max
    }
    
    
    var_focal_step <- (var_focal_max - var_focal_min) / 100
    
    #interaction combination
    inter_grid <- expand.grid(seq(from = var_focal_min, to = var_focal_max, by = var_focal_step))
    
    #fixing controls at the mean
    means_vec <- array(0, dim = c(1, n_vars))
    
    for (v in 1:n_vars) {
      means_vec[v] <-
        mean(as.numeric(unlist(data_file[var_names[v]])), na.rm = TRUE)
    }
    
    #assembling the synthetic datafile
    n_rows <- dim(inter_grid)[1]
    means_grid <-
      matrix(
        means_vec,
        nrow = n_rows,
        ncol = length(means_vec),
        byrow = TRUE
      )
    
    syn_data <- data.frame(cbind(inter_grid, means_grid))
    names(syn_data) <- c(var_focal_name, var_names)
    
    #with clustered SE or robust SE
    #--if clustering attribute is added, clustered SE is computed, otherwise robust SE
    if (is.null(cluster_attrib)) {
      predvals <-
        predict(
          model_object,
          newdata = syn_data,
          se.fit = TRUE,
          vcov.fun = "vcovHC",
          vcov.type = "HC1"
        )
    }
    if (!is.null(cluster_attrib)) {
      predvals <-
        predict(
          model_object,
          newdata = syn_data,
          se.fit = TRUE,
          vcov.fun = "vcovHC",
          vcov.type = "HC1",
          cluster = cluster_attrib
        )
    }
    
    #withour robust SE
    #predvals <- predict(model_object, newdata=syn_data, se.fit = TRUE)
    
    
    syn_data$ols_pred <- predvals$fit
    syn_data$ols_low <- (predvals$fit - 1.96 * predvals$se.fit)
    syn_data$ols_up <- (predvals$fit + 1.96 * predvals$se.fit)
    
    return(syn_data)
  }
```

Synthetic data file with fixed effects dummies factor
```{r}
create_synt_factor <-
  function(model_object, data_file, cluster_attrib = NULL) {
    # this is a function that creates synthetic data when there is a fixed effect factor
    
    # this is a function that creates synthetic data
    var_names <- names(model_object$coefficients)
    #delete intercept
    var_sel <- grepl("ntercept", var_names) #small and big i
    var_names <- var_names[!var_sel]
    #delete squared term
    var_sel <- grepl("2)", var_names)
    var_names <- var_names[!var_sel]
    
    #save interaction
    var_sel <- grepl(":", var_names)
    var_inter_names <- var_names[var_sel]
    
    var_inter_names <-
      unique(unlist(strsplit(var_inter_names, "[:]")))
    
    #delete interactions
    var_sel <- grepl(":", var_names)
    var_names <- var_names[!var_sel]
    
    #delete variables involved in interactions
    for (i in 1:length(var_inter_names)) {
      var_names <- var_names[var_names != var_inter_names[i]]
    }
    
    #identify factor
    var_sel <- grepl("as.factor*", var_names)
    var_factor_coefs <- var_names[var_sel]
    var_factor <-
      sub("\\).*", "", sub(".*\\(", "", var_factor_coefs))[1]
    
    #get the first factor level
    pos_start <-
      which(strsplit(var_factor_coefs[1], "")[[1]] == ")") + 1
    pos_end <- nchar(var_factor_coefs[1])
    var_factor_level <-
      as.numeric(substr(var_factor_coefs[1], pos_start, pos_end))
    
    #remove factors from variable list
    var_names <- var_names[!var_sel]
    
    #results
    cbind(var_inter_names)
    cbind(var_names)
    
    #min and max values for interaction variables
    inter_min_vec <- array(0, dim = c(1, length(var_inter_names)))
    
    for (v in 1:length(var_inter_names)) {
      inter_min_vec[v] <-
        min(as.numeric(unlist(data_file[var_inter_names[v]])), na.rm = TRUE)
    }
    
    inter_max_vec <- array(0, dim = c(1, length(var_inter_names)))
    
    for (v in 1:length(var_inter_names)) {
      inter_max_vec[v] <-
        max(as.numeric(unlist(data_file[var_inter_names[v]])), na.rm = TRUE)
    }
    
    
    #interaction grid settings
    var1_from <- inter_min_vec[1]
    var1_to   <- inter_max_vec[1]
    var1_step <- (inter_max_vec[1] - inter_min_vec[1]) / 100
    
    #var1_from <- 0
    #var1_to   <- 1
    #var1_step <- 0.01
    
    var2_from <- inter_min_vec[2]
    var2_to   <- inter_max_vec[2]
    var2_step <- (inter_max_vec[2] - inter_min_vec[2]) / 100
    
    
    #number of variables and interactions
    n_inter_vars <- length(var_inter_names)
    n_vars <- length(var_names)
    
    #interaction combination
    inter_grid <- expand.grid(
      seq(from = var1_from, to = var1_to, by = var1_step),
      seq(from = var2_from, to = var2_to, by = var2_step)
    )
    
    #fixing controls at the mean
    means_vec <- array(0, dim = c(1, n_vars))
    
    for (v in 1:n_vars) {
      means_vec[v] <-
        mean(as.numeric(unlist(data_file[var_names[v]])), na.rm = TRUE)
    }
    
    means_vec <- c(means_vec, var_factor_level)
    #assembling the synthetic datafile
    n_rows <- dim(inter_grid)[1]
    means_grid <-
      matrix(
        means_vec,
        nrow = n_rows,
        ncol = length(means_vec),
        byrow = TRUE
      )
    
    syn_data <- data.frame(cbind(inter_grid, means_grid))
    names(syn_data) <- c(var_inter_names, var_names, var_factor)
    
    #with clustered SE or robust SE
    #--if clustering attribute is added, clustered SE is computed, otherwise robust SE
    if (is.null(cluster_attrib)) {
      predvals <-
        predict(
          model_object,
          newdata = syn_data,
          se.fit = TRUE,
          vcov.fun = "vcovHC",
          vcov.type = "HC1"
        )
    }
    if (!is.null(cluster_attrib)) {
      predvals <-
        predict(
          model_object,
          newdata = syn_data,
          se.fit = TRUE,
          vcov.fun = "vcovHC",
          vcov.type = "HC1",
          cluster = cluster_attrib
        )
    }
    
    #withour robust SE it would be
    #predvals <- predict(model_object, newdata=syn_data, se.fit = TRUE)
    
    
    syn_data$ols_pred <- predvals$fit
    syn_data$ols_low <- (predvals$fit - 1.96 * predvals$se.fit)
    syn_data$ols_up <- (predvals$fit + 1.96 * predvals$se.fit)
    
    return(syn_data)
  }
```

Synthetic data file with fixed effects dummies factor and fixed slopes
```{r}
create_synt_factor_slopes <- function(model_object, model_object2, data_file) {
  # this is a function that creates synthetic data when there is a fixed effect factor

  # this is a function that creates synthetic data
  var_names <- names(model_object$coefficients)
  #delete intercept
  var_sel <- grepl("ntercept", var_names) #small and big i
  var_names <- var_names[!var_sel]
  #delete squared term
  var_sel <- grepl("2)", var_names)
  var_names <- var_names[!var_sel]

  #save interaction
  var_sel <- grepl(":", var_names)
  var_inter_names <- var_names[var_sel]
  
  var_inter_names <- unique(unlist(strsplit(var_inter_names, "[:]")))
  
  #delete interactions
  var_sel <- grepl(":", var_names)
  var_names <- var_names[!var_sel]
  
  #delete variables involved in interactions
  for (i in 1:length(var_inter_names)){
  var_names <- var_names[var_names!=var_inter_names[i]]
  }
  
  #identify factor
  var_sel <- grepl("as.factor*", var_names)
  var_factor_coefs <- var_names[var_sel]
  var_factor <- sub("\\).*", "", sub(".*\\(", "", var_factor_coefs))[1]

  #get the first factor level
  pos_start <- which(strsplit(var_factor_coefs[1], "")[[1]] == ")")+1
  pos_end <- nchar(var_factor_coefs[1])
  var_factor_level <- as.numeric(substr(var_factor_coefs[1], pos_start, pos_end))
  
  #remove factors from variable list
  var_names <- var_names[!var_sel]
  
  #results
  cbind(var_inter_names)
  cbind(var_names)
  
  #min and max values for interaction variables
  inter_min_vec <- array(0, dim=c(1,length(var_inter_names)))
  
  for (v in 1:length(var_inter_names)){
    inter_min_vec[v] <- min(as.numeric(unlist(data_file[var_inter_names[v]])), na.rm=TRUE)
  }
  
  inter_max_vec <- array(0, dim=c(1,length(var_inter_names)))
  
  for (v in 1:length(var_inter_names)){
    inter_max_vec[v] <- max(as.numeric(unlist(data_file[var_inter_names[v]])), na.rm=TRUE)
  }


  #interaction grid settings
  var1_from <- inter_min_vec[1]
  var1_to   <- inter_max_vec[1]
  var1_step <- (inter_max_vec[1]-inter_min_vec[1])/100
  
  #var1_from <- 0
  #var1_to   <- 1
  #var1_step <- 0.01
  
  var2_from <- inter_min_vec[2]
  var2_to   <- inter_max_vec[2]
  var2_step <- (inter_max_vec[2]-inter_min_vec[2])/100
  
  
  #number of variables and interactions
  n_inter_vars <- length(var_inter_names)
  n_vars <- length(var_names)
  
  #interaction combination
  inter_grid <- expand.grid(
                       seq(from = var1_from, to = var1_to, by = var1_step),
                       seq(from = var2_from, to = var2_to, by = var2_step)
                       )
  
  #fixing controls at the mean
  means_vec <- array(0, dim=c(1,n_vars))
  
  for (v in 1:n_vars){
    means_vec[v] <- mean(as.numeric(unlist(data_file[var_names[v]])), na.rm=TRUE)
  }
  
  means_vec <- c(means_vec, var_factor_level)
  #assembling the synthetic datafile
  n_rows <- dim(inter_grid)[1]
  means_grid <- matrix(means_vec,nrow=n_rows,ncol=length(means_vec),byrow=TRUE)
  
  syn_data <- data.frame(cbind(inter_grid, means_grid))
  names(syn_data) <- c(var_inter_names,var_names, var_factor)
  #with robust SE
  predvals <- predict(model_object2, newdata=syn_data, se.fit = TRUE, vcov.fun = "vcovHC", vcov.type = "HC3")
  #withour robust SE
  #predvals <- predict(model_object, newdata=syn_data, se.fit = TRUE)

  
  syn_data$ols_pred <- predvals$fit
  syn_data$ols_low <- (predvals$fit - 1.96 * predvals$se.fit)
  syn_data$ols_up <- (predvals$fit + 1.96 * predvals$se.fit)
  
  return(syn_data)
  }
```

```{r}
min(moby$mixing, na.rm = T)
max(moby$mixing, na.rm = T)
min(moby$bonding, na.rm = T)
max(moby$bonding, na.rm = T)
min(moby$incorporating, na.rm = T)
max(moby$incorporating, na.rm = T)
```



```{r}
syn_data_baseline_dist<-create_synt_one_var(without_inclusion,"blau2",0,1,moby, moby$org_dev)

syn_data_mixing<-create_synt(mixing,moby, moby$org_dev)
syn_data_bonding<-create_synt(bonding,moby, moby$org_dev)
syn_data_incorporating<-create_synt(incorporating,moby, moby$org_dev)
syn_data_combined<-create_synt(combined,moby, moby$org_dev)
syn_data_combined_z<-create_synt(combined_z,moby, moby$org_dev)

syn_data_mixing_fe<-create_synt_factor(mixing_fe_dummies,moby_repeat_devs, moby$org_dev)
syn_data_bonding_fe<-create_synt_factor(bonding_fe_dummies,moby_repeat_devs, moby$org_dev)
syn_data_incorporating_fe<-create_synt_factor(incorporating_fe_dummies,moby_repeat_devs, moby$org_dev)
syn_data_combined_fe<-create_synt_factor(combined_fe_dummies,moby_repeat_devs, moby$org_dev)

syn_data_mixing_aggr<-create_synt(mixing_aggr,moby_dev_firm_level)
syn_data_bonding_aggr<-create_synt(bonding_aggr,moby_dev_firm_level)
syn_data_incorporating_aggr<-create_synt(incorporating_aggr,moby_dev_firm_level)
syn_data_combined_aggr<-create_synt(combined_aggr,moby_dev_firm_level)
```



```{r}
#syn_data_review_mixing <- create_synt_heck(mixing_sel, moby)
#create_synt(mixing_sel$lm, moby)
```



```{r}
hist(syn_data_combined$ols_pred)
```

# save syn_data out

```{r}
write.csv(syn_data_mixing, "synt_data_mixing_blau.csv")
write.csv(syn_data_bonding, "synt_data_bonding_blau.csv") 
write.csv(syn_data_incorporating, "synt_data_incorporating_blau.csv") 
write.csv(syn_data_combined, "synt_data_combined_blau.csv") 

write.csv(syn_data_mixing_aggr, "synt_data_mixing_aggr_blau.csv")
write.csv(syn_data_bonding_aggr, "synt_data_bonding_aggr_blau.csv") 
write.csv(syn_data_incorporating_aggr, "synt_data_incorporating_aggr_blau.csv") 
write.csv(syn_data_combined_aggr, "synt_data_combined_aggr_blau.csv") 
```


Margins plot - diversity for distinctiveness

```{r, fig.width = 2.5, fig.height = 2.5}
theme_set(theme_bw())

dropLeadingZero <- function(l){
  str_replace(l, '0(?=.)', '')
}

mean_diversity <- mean(moby$blau2)
min_diversity <- round(min(moby$blau2),2)
max_diversity <- round(max(moby$blau2),2)
sd_diversity <- sd(moby$blau2)
q1_diversity <- quantile(moby$blau2, probs = 0.25)
q3_diversity <- quantile(moby$blau2, probs = 0.75)

hi_color = "#b4de75"
lo_color = "#69629a"

x_range_filter=syn_data_baseline_dist$blau2<=max_diversity & syn_data_baseline_dist$blau2>=min_diversity


syn_data_mixing_min <- min(syn_data_mixing$ols_low)
syn_data_mixing_max <- max(syn_data_mixing$ols_up)
syn_data_mixing_min_inclusion <- min(syn_data_mixing$mixing)
syn_data_mixing_max_inclusion <- max(syn_data_mixing$mixing)

syn_data_bonding_min <- min(syn_data_bonding$ols_low)
syn_data_bonding_max <- max(syn_data_bonding$ols_up)
syn_data_bonding_min_inclusion <- min(syn_data_bonding$bonding)
syn_data_bonding_max_inclusion <- max(syn_data_bonding$bonding)

syn_data_incorporating_min <- min(syn_data_incorporating$ols_low)
syn_data_incorporating_max <- max(syn_data_incorporating$ols_up)
syn_data_incorporating_min_inclusion <- min(syn_data_incorporating$incorporating)
syn_data_incorporating_max_inclusion <- max(syn_data_incorporating$incorporating)

syn_data_combined_min <- min(syn_data_combined$ols_low)
syn_data_combined_max <- max(syn_data_combined$ols_up)
syn_data_combined_min_inclusion <- min(syn_data_combined$combined)
syn_data_combined_max_inclusion <- max(syn_data_combined$combined)

global_y_max <- max(c(syn_data_mixing_max, syn_data_bonding_max, syn_data_incorporating_max, syn_data_combined_max))
global_y_min <- min(c(syn_data_mixing_min, syn_data_bonding_min, syn_data_incorporating_min, syn_data_combined_min))


m_top <- 2
m_left <-0
m_bottom <- 0
m_right <- 0
ts <- 3.2
tit_s <- 11
iqr_alpha <- 0.07
ribbon_alpha <- 0.33


blau_dist_margins <- ggplot()+
  
  #annotate("rect", xmin = min_diversity, xmax = max_diversity, ymin = 0.65, ymax = 1, alpha = .05) +
  #annotate("rect", xmin = q1_diversity, xmax = q3_diversity, ymin = global_y_min, ymax = global_y_max, alpha = iqr_alpha) +
  #geom_vline(xintercept = q1_diversity,size=0.1) +
  #geom_vline(xintercept = q3_diversity,size=0.1) +
  #geom_vline(xintercept = mean_diversity,size=0.3, linetype="dashed", alpha = .5) +
  
  #prediction and CI
  geom_line(data=syn_data_baseline_dist[x_range_filter,],   aes(blau2, ols_pred), color=lo_color)+
  geom_ribbon(data=syn_data_baseline_dist[x_range_filter,], aes(blau2, ymin=ols_low, ymax=ols_up),alpha=ribbon_alpha, fill=lo_color)+

  
  #axes formatting
  scale_y_continuous(
                     #trans='log10',
                     #limits=c(global_y_min, global_y_max), 
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     #breaks = c(30, 50, 100, 200, 300, 400, 500), 
                     name="Predicted distinctiveness") +
  scale_x_continuous(
                     #limits=c(min_diversity, max_diversity),
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     #breaks = pretty(syn_data_mixing$blau2, n = 5), 
                     name="Diversity") +
  
#coord_cartesian(ylim = c(0.69, 0.90)) +
  
  
    #annotate(geom="text", x=mean_diversity-0.01,    y=0.87, label="Mean\n Gender\nDiversity", lineheight = .8,  col="black", size=3.2, hjust = 1, alpha = 1) +
  
    #annotate(geom="text", x=mean_diversity,    y=0.715, label="IQR of \nGender Diversity", lineheight = .8,  col="black", size=3.2, hjust = 0.5, alpha = 1) +
    #annotate("segment", x = q1_diversity, xend = q3_diversity, y = .70, yend = .70, size=0.2, arrow = arrow(ends = "both", angle = 45, length = unit(1,"mm"))) +
  
    #annotate(geom="text", x=.45,    y=0.847, label="Maximal\nInclusion", lineheight = .8,  col="black", size=3.2, hjust = 1, alpha = 1, angle = 20) +
    #geom_segment(aes(y=0.85,    x=0.25, yend = 0.81, xend = 0.28),size=0.6, col = hi_color, alpha=0.66, linetype=3) +
  
    #annotate(geom="text", x=.45,    y=0.779, label="Minimal\nInclusion", lineheight = .8,   col="black", size=3.2, hjust = 1, alpha = 1, angle = -12) +
    #geom_segment(aes(y=0.72,    x=.25, yend = 0.76, xend = .28),size=0.6, col = lo_color, alpha=0.66, linetype=3) +
  
    
  

  
  labs(title="a")+
  
  #theme
  theme(aspect.ratio=1, 
            panel.grid.major = element_line(size=0.2), 
            panel.grid.minor = element_blank(), 
            panel.background = element_blank(), 
            panel.border = element_rect(colour = "black", 
                                        fill=NA, 
                                        size=0.2),
            legend.position = c(0.2, 0.3),
            plot.title = element_text(size = tit_s, face = "bold", colour = "black"),
            #axis.ticks.y = element_blank(),
            axis.title.y = element_text(size = 11, colour = "black"),
            axis.text.x = element_text(size = 9, colour = "black"),
            axis.text.y = element_text(size = 9, colour = "black"),
            #plot.margin = unit(c(m_top,m_right-7,m_bottom,0), "mm")
            )




blau_dist_margins
#margins
```

Margins plot - game level

```{r, fig.width = 5, fig.height = 5}
theme_set(theme_bw())

dropLeadingZero <- function(l){
  str_replace(l, '0(?=.)', '')
}

mean_diversity <- mean(moby$blau2)
min_diversity <- min(moby$blau2)
max_diversity <- max(moby$blau2)
sd_diversity <- sd(moby$blau2)
q1_diversity <- quantile(moby$blau2, probs = 0.25)
q3_diversity <- quantile(moby$blau2, probs = 0.75)

hi_color = "#b4de75"
hi_color_dark = "#75914c"
lo_color = "#69629a"
lo_color_dark = "#4f4973"


syn_data_mixing_min <- min(syn_data_mixing$ols_low)
syn_data_mixing_max <- max(syn_data_mixing$ols_up)
syn_data_mixing_min_inclusion <- min(syn_data_mixing$mixing)
syn_data_mixing_max_inclusion <- max(syn_data_mixing$mixing)

syn_data_bonding_min <- min(syn_data_bonding$ols_low)
syn_data_bonding_max <- max(syn_data_bonding$ols_up)
syn_data_bonding_min_inclusion <- min(syn_data_bonding$bonding)
syn_data_bonding_max_inclusion <- max(syn_data_bonding$bonding)

syn_data_incorporating_min <- min(syn_data_incorporating$ols_low)
syn_data_incorporating_max <- max(syn_data_incorporating$ols_up)
syn_data_incorporating_min_inclusion <- min(syn_data_incorporating$incorporating)
syn_data_incorporating_max_inclusion <- max(syn_data_incorporating$incorporating)

syn_data_combined_min <- min(syn_data_combined$ols_low)
syn_data_combined_max <- max(syn_data_combined$ols_up)
syn_data_combined_min_inclusion <- min(syn_data_combined$combined)
syn_data_combined_max_inclusion <- max(syn_data_combined$combined)

global_y_max <- max(c(syn_data_mixing_max, syn_data_bonding_max, syn_data_incorporating_max, syn_data_combined_max))
global_y_min <- min(c(syn_data_mixing_min, syn_data_bonding_min, syn_data_incorporating_min, syn_data_combined_min))


m_top <- 2
m_left <-0
m_bottom <- 0
m_right <- 0
ts <- 3.2
tit_s <- 11
iqr_alpha <- 0.07
ribbon_alpha <- 0.33


mixing_margins_blue <- ggplot()+
  
  #annotate("rect", xmin = min_diversity, xmax = max_diversity, ymin = 0.65, ymax = 1, alpha = .05) +
  #annotate("rect", xmin = q1_diversity, xmax = q3_diversity, ymin = global_y_min, ymax = global_y_max, alpha = iqr_alpha) +
  #geom_vline(xintercept = q1_diversity,size=0.1) +
  #geom_vline(xintercept = q3_diversity,size=0.1) +
  #geom_vline(xintercept = mean_diversity,size=0.3, linetype="dashed", alpha = .5) +
  
  #min inclusion prediction and CI
  geom_line(data=syn_data_mixing[syn_data_mixing$mixing==syn_data_mixing_min_inclusion,],   aes(blau2, ols_pred), color=hi_color_1)+
  geom_ribbon(data=syn_data_mixing[syn_data_mixing$mixing==syn_data_mixing_min_inclusion,], aes(blau2, ymin=ols_low, ymax=ols_up),alpha=ribbon_alpha, fill=hi_color_1)+

  #max inclusion prediction and CI
  geom_line(data=syn_data_mixing[syn_data_mixing$mixing==syn_data_mixing_max_inclusion,],   aes(blau2, ols_pred), color=hi_color_9)+
  geom_ribbon(data=syn_data_mixing[syn_data_mixing$mixing==syn_data_mixing_max_inclusion,], aes(blau2, ymin=ols_low, ymax=ols_up),alpha=ribbon_alpha, fill=hi_color_9)+ 
  
  #axes formatting
  scale_y_continuous(
                     #trans='log10',
                     limits=c(global_y_min, global_y_max), 
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     #breaks = c(30, 50, 100, 200, 300, 400, 500), 
                     name="Predicted distinctiveness") +
  scale_x_continuous(limits=c(min_diversity, max_diversity),
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     breaks = pretty(syn_data_mixing$blau2, n = 5), 
                     name="") +
  
coord_cartesian(ylim = c(0.7, 0.87)) +
  
  
    #annotate(geom="text", x=mean_diversity-0.01,    y=0.87, label="Mean\n Gender\nDiversity", lineheight = .8,  col="black", size=3.2, hjust = 1, alpha = 1) +
  
    #annotate(geom="text", x=mean_diversity,    y=0.715, label="IQR of \nGender Diversity", lineheight = .8,  col="black", size=3.2, hjust = 0.5, alpha = 1) +
    #annotate("segment", x = q1_diversity, xend = q3_diversity, y = .70, yend = .70, size=0.2, arrow = arrow(ends = "both", angle = 45, length = unit(1,"mm"))) +
  
    annotate(geom="text", x=.45,    y=0.847, label="Maximal\nInclusion", lineheight = .8,  col=lo_color_dark, size=3.2, hjust = 1, alpha = 1, angle = 24) +
    #geom_segment(aes(y=0.85,    x=0.25, yend = 0.81, xend = 0.28),size=0.6, col = hi_color, alpha=0.66, linetype=3) +
  
    annotate(geom="text", x=.45,    y=0.780, label="Minimal\nInclusion", lineheight = .8,   col=lo_color, size=3.2, hjust = 1, alpha = 1, angle = -12) +
    #geom_segment(aes(y=0.72,    x=.25, yend = 0.76, xend = .28),size=0.6, col = lo_color, alpha=0.66, linetype=3) +
  
    
  

  
  labs(title="a: Mixing")+
  
  #theme
  theme(aspect.ratio=1, 
            panel.grid.major = element_line(size=0.2),  
            panel.grid.minor = element_blank(), 
            panel.background = element_blank(), 
            panel.border = element_rect(colour = "black", 
                                        fill=NA, 
                                        size=0.2),
            legend.position = c(0.2, 0.3),
            plot.title = element_text(size = tit_s, face = "bold", colour = "black"),
            #axis.ticks.y = element_blank(),
            axis.title.y = element_text(size = 11, colour = "black"),
            axis.text.x = element_text(size = 9, colour = "black"),
            axis.text.y = element_text(size = 9, colour = "black"),
            plot.margin = unit(c(m_top,m_right-7,m_bottom,0), "mm")
            )


mixing_margins <- ggplot()+
  
  #annotate("rect", xmin = min_diversity, xmax = max_diversity, ymin = 0.65, ymax = 1, alpha = .05) +
  #annotate("rect", xmin = q1_diversity, xmax = q3_diversity, ymin = global_y_min, ymax = global_y_max, alpha = iqr_alpha) +
  #geom_vline(xintercept = q1_diversity,size=0.1) +
  #geom_vline(xintercept = q3_diversity,size=0.1) +
  #geom_vline(xintercept = mean_diversity,size=0.3, linetype="dashed", alpha = .5) +
  
  #min inclusion prediction and CI
  geom_line(data=syn_data_mixing[syn_data_mixing$mixing==syn_data_mixing_min_inclusion,],   aes(blau2, ols_pred), color=lo_color)+
  geom_ribbon(data=syn_data_mixing[syn_data_mixing$mixing==syn_data_mixing_min_inclusion,], aes(blau2, ymin=ols_low, ymax=ols_up),alpha=ribbon_alpha, fill=lo_color)+

  #max inclusion prediction and CI
  geom_line(data=syn_data_mixing[syn_data_mixing$mixing==syn_data_mixing_max_inclusion,],   aes(blau2, ols_pred), color=hi_color)+
  geom_ribbon(data=syn_data_mixing[syn_data_mixing$mixing==syn_data_mixing_max_inclusion,], aes(blau2, ymin=ols_low, ymax=ols_up),alpha=ribbon_alpha, fill=hi_color)+ 
  
  #axes formatting
  scale_y_continuous(
                     #trans='log10',
                     limits=c(global_y_min, global_y_max), 
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     #breaks = c(30, 50, 100, 200, 300, 400, 500), 
                     name="Predicted distinctiveness") +
  scale_x_continuous(limits=c(min_diversity, max_diversity),
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     breaks = pretty(syn_data_mixing$blau2, n = 5), 
                     name="") +
  
coord_cartesian(ylim = c(0.7, 0.87)) +
  
  
    #annotate(geom="text", x=mean_diversity-0.01,    y=0.87, label="Mean\n Gender\nDiversity", lineheight = .8,  col="black", size=3.2, hjust = 1, alpha = 1) +
  
    #annotate(geom="text", x=mean_diversity,    y=0.715, label="IQR of \nGender Diversity", lineheight = .8,  col="black", size=3.2, hjust = 0.5, alpha = 1) +
    #annotate("segment", x = q1_diversity, xend = q3_diversity, y = .70, yend = .70, size=0.2, arrow = arrow(ends = "both", angle = 45, length = unit(1,"mm"))) +
  
    annotate(geom="text", x=.45,    y=0.847, label="Maximal\nInclusion", lineheight = .8,  col=hi_color_dark, size=3.2, hjust = 1, alpha = 1, angle = 24) +
    #geom_segment(aes(y=0.85,    x=0.25, yend = 0.81, xend = 0.28),size=0.6, col = hi_color, alpha=0.66, linetype=3) +
  
    annotate(geom="text", x=.45,    y=0.780, label="Minimal\nInclusion", lineheight = .8,   col=lo_color_dark, size=3.2, hjust = 1, alpha = 1, angle = -12) +
    #geom_segment(aes(y=0.72,    x=.25, yend = 0.76, xend = .28),size=0.6, col = lo_color, alpha=0.66, linetype=3) +
  
    
  

  
  labs(title="a: Mixing")+
  
  #theme
  theme(aspect.ratio=1, 
            panel.grid.major = element_line(size=0.2),  
            panel.grid.minor = element_blank(), 
            panel.background = element_blank(), 
            panel.border = element_rect(colour = "black", 
                                        fill=NA, 
                                        size=0.2),
            legend.position = c(0.2, 0.3),
            plot.title = element_text(size = tit_s, face = "bold", colour = "black"),
            #axis.ticks.y = element_blank(),
            axis.title.y = element_text(size = 11, colour = "black"),
            axis.text.x = element_text(size = 9, colour = "black"),
            axis.text.y = element_text(size = 9, colour = "black"),
            plot.margin = unit(c(m_top,m_right-7,m_bottom,0), "mm")
            )




bonding_margins <- ggplot()+
  
  #annotate("rect", xmin = min_diversity, xmax = max_diversity, ymin = 0.65, ymax = 1, alpha = .05) +
  #annotate("rect", xmin = q1_diversity, xmax = q3_diversity, ymin = global_y_min, ymax = global_y_max, alpha = iqr_alpha) +
  #geom_vline(xintercept = q1_diversity,size=0.1) +
  #geom_vline(xintercept = q3_diversity,size=0.1) +
  #geom_vline(xintercept = mean_diversity,size=0.3, linetype="dashed", alpha = .5) +
  
  #min inclusion prediction and CI
  geom_line(data=syn_data_bonding[syn_data_bonding$bonding==syn_data_bonding_min_inclusion,],   aes(blau2, ols_pred), color=lo_color)+
  geom_ribbon(data=syn_data_bonding[syn_data_bonding$bonding==syn_data_bonding_min_inclusion,], aes(blau2, ymin=ols_low, ymax=ols_up),alpha=ribbon_alpha, fill=lo_color)+

  #max inclusion prediction and CI
  geom_line(data=syn_data_bonding[syn_data_bonding$bonding==syn_data_bonding_max_inclusion,],   aes(blau2, ols_pred), color=hi_color)+
  geom_ribbon(data=syn_data_bonding[syn_data_bonding$bonding==syn_data_bonding_max_inclusion,], aes(blau2, ymin=ols_low, ymax=ols_up),alpha=ribbon_alpha, fill=hi_color)+ 
  
  #axes formatting
  scale_y_continuous(
                     #trans='log10',
                     limits=c(global_y_min, global_y_max), 
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     #breaks = c(30, 50, 100, 200, 300, 400, 500), 
                     name="") +
  scale_x_continuous(limits=c(min_diversity, max_diversity),
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     breaks = pretty(syn_data_bonding$blau2, n = 5), 
                     name="") +
  
coord_cartesian(ylim = c(0.7, 0.87)) +

  
  labs(title="b: Bonding")+
  
  #theme
  theme(aspect.ratio=1, 
            panel.grid.major = element_line(size=0.2),  
            panel.grid.minor = element_blank(), 
            panel.background = element_blank(), 
            panel.border = element_rect(colour = "black", 
                                        fill=NA, 
                                        size=0.2),
            legend.position = c(0.2, 0.3),
            plot.title = element_text(size = tit_s, face = "bold", colour = "black"),
            #axis.ticks.y = element_blank(),
            axis.title.y = element_text(size = 11, colour = "black"),
            axis.text.x = element_text(size = 9, colour = "black"),
            axis.text.y = element_text(size = 9, colour = "black"),
            plot.margin = unit(c(m_top,m_right,m_bottom,m_left), "mm")
            )




incorporating_margins <- ggplot()+
  
  #annotate("rect", xmin = min_diversity, xmax = max_diversity, ymin = 0.65, ymax = 1, alpha = .05) +
  #annotate("rect", xmin = q1_diversity, xmax = q3_diversity, ymin = global_y_min, ymax = global_y_max, alpha = iqr_alpha) +
  #geom_vline(xintercept = q1_diversity,size=0.1) +
  #geom_vline(xintercept = q3_diversity,size=0.1) +
  #geom_vline(xintercept = mean_diversity,size=0.3, linetype="dashed", alpha = .5) +
  
  #min inclusion prediction and CI
  geom_line(data=syn_data_incorporating[syn_data_incorporating$incorporating==syn_data_incorporating_min_inclusion,],   aes(blau2, ols_pred), color=lo_color)+
  geom_ribbon(data=syn_data_incorporating[syn_data_incorporating$incorporating==syn_data_incorporating_min_inclusion,], aes(blau2, ymin=ols_low, ymax=ols_up),alpha=ribbon_alpha, fill=lo_color)+

  #max inclusion prediction and CI
  geom_line(data=syn_data_incorporating[syn_data_incorporating$incorporating==syn_data_incorporating_max_inclusion,],   aes(blau2, ols_pred), color=hi_color)+
  geom_ribbon(data=syn_data_incorporating[syn_data_incorporating$incorporating==syn_data_incorporating_max_inclusion,], aes(blau2, ymin=ols_low, ymax=ols_up),alpha=ribbon_alpha, fill=hi_color)+ 
  
  #axes formatting
  scale_y_continuous(
                     #trans='log10',
                     limits=c(global_y_min, global_y_max), 
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     #breaks = c(30, 50, 100, 200, 300, 400, 500), 
                     name="Predicted distinctiveness") +
  scale_x_continuous(limits=c(min_diversity, max_diversity),
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     breaks = pretty(syn_data_incorporating$blau2, n = 5), 
                     name="Gender diversity") +
  
  coord_cartesian(ylim = c(0.7, 0.87)) +
  
  

  
  labs(title="c: Incorporating")+
  
  #theme
  theme(aspect.ratio=1, 
            panel.grid.major = element_line(size=0.2),  
            panel.grid.minor = element_blank(), 
            panel.background = element_blank(), 
            panel.border = element_rect(colour = "black", 
                                        fill=NA, 
                                        size=0.2),
            legend.position = c(0.2, 0.3),
            plot.title = element_text(size = tit_s, face = "bold", colour = "black"),
            #axis.ticks.y = element_blank(),
            axis.title.y = element_text(size = 11, colour = "black"),
            axis.text.x = element_text(size = 9, colour = "black"),
            axis.text.y = element_text(size = 9, colour = "black"),
            plot.margin = unit(c(m_top,m_right-7,m_bottom,m_left), "mm")
            )





combined_margins <- ggplot()+
  
  #annotate("rect", xmin = min_diversity, xmax = max_diversity, ymin = 0.65, ymax = 1, alpha = .05) +
  #annotate("rect", xmin = q1_diversity, xmax = q3_diversity, ymin = global_y_min, ymax = global_y_max, alpha = iqr_alpha) +
  #geom_vline(xintercept = q1_diversity,size=0.1) +
  #geom_vline(xintercept = q3_diversity,size=0.1) +
  #geom_vline(xintercept = mean_diversity,size=0.3, linetype="dashed", alpha = .5) +
  
  #min inclusion prediction and CI
  geom_line(data=syn_data_combined[syn_data_combined$combined==syn_data_combined_min_inclusion,],   aes(blau2, ols_pred), color=lo_color)+
  geom_ribbon(data=syn_data_combined[syn_data_combined$combined==syn_data_combined_min_inclusion,], aes(blau2, ymin=ols_low, ymax=ols_up),alpha=ribbon_alpha, fill=lo_color)+

  #max inclusion prediction and CI
  geom_line(data=syn_data_combined[syn_data_combined$combined==syn_data_combined_max_inclusion,],   aes(blau2, ols_pred), color=hi_color)+
  geom_ribbon(data=syn_data_combined[syn_data_combined$combined==syn_data_combined_max_inclusion,], aes(blau2, ymin=ols_low, ymax=ols_up),alpha=ribbon_alpha, fill=hi_color)+ 
  
  #axes formatting
  scale_y_continuous(
                     #trans='log10',
                     limits=c(global_y_min, global_y_max), 
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     #breaks = c(30, 50, 100, 200, 300, 400, 500), 
                     name="") +
  scale_x_continuous(limits=c(min_diversity, max_diversity),
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     breaks = pretty(syn_data_combined$blau2, n = 5), 
                     name="Gender diversity") +
  
  coord_cartesian(ylim = c(0.7, 0.87)) +
  
  

  
  labs(title="d: Combined inclusion")+
  
  #theme
  theme(aspect.ratio=1, 
            panel.grid.major = element_line(size=0.2),  
            panel.grid.minor = element_blank(), 
            panel.background = element_blank(), 
            panel.border = element_rect(colour = "black", 
                                        fill=NA, 
                                        size=0.2),
            legend.position = c(0.2, 0.3),
            plot.title = element_text(size = tit_s, face = "bold", colour = "black"),
            #axis.ticks.y = element_blank(),
            axis.title.y = element_text(size = 11, colour = "black"),
            axis.text.x = element_text(size = 9, colour = "black"),
            axis.text.y = element_text(size = 9, colour = "black"),
            plot.margin = unit(c(m_top,m_right,m_bottom,m_left), "mm")
            )





margins_gamelevel <- grid.arrange(mixing_margins, bonding_margins, incorporating_margins,combined_margins, nrow = 2)
#margins
```

```{r, fig.width = 4, fig.height = 4}
margins_gamelevel_v2 <- cowplot::plot_grid(mixing_margins, bonding_margins, incorporating_margins,combined_margins, align="h",rel_widths=1,  rel_heights = 1, scale=1, nrow=2)
margins_gamelevel_v2
```

```{r}
ggsave("margins_gamelevel_mid.pdf", margins_gamelevel_v2, width = 5, height = 5)
ggsave("margins_gamelevel_sm.pdf", margins_gamelevel_v2, width = 4, height = 4)
```



predictions for mixing

```{r}
q1_diversity <- quantile(moby$blau2, probs = 0.25)
q3_diversity <- quantile(moby$blau2, probs = 0.75)

print("------min-------")
data_at_min <- syn_data_mixing[syn_data_mixing$blau2==min(syn_data_mixing$blau2),]
data_at_min[data_at_min$mixing==1,]$ols_low
data_at_min[data_at_min$mixing==1,]$ols_pred
data_at_min[data_at_min$mixing==1,]$ols_up
print("------q1-------")
data_at_q1 <- syn_data_mixing[round(syn_data_mixing$blau2, digits=2)==round(q1_diversity, digits = 2),]
data_at_q1[data_at_q1$mixing==1,]$ols_low
data_at_q1[data_at_q1$mixing==1,]$ols_pred
data_at_q1[data_at_q1$mixing==1,]$ols_up
print("------q3-------")
data_at_q3 <- syn_data_mixing[round(syn_data_mixing$blau2, digits=2)==round(q3_diversity, digits = 2),]
data_at_q3[data_at_q3$mixing==1,]$ols_low
data_at_q3[data_at_q3$mixing==1,]$ols_pred
data_at_q3[data_at_q3$mixing==1,]$ols_up
print("------max-------")
data_at_max <- syn_data_mixing[syn_data_mixing$blau2==max(syn_data_mixing$blau2),]
data_at_max[data_at_max$mixing==1,]$ols_low
data_at_max[data_at_max$mixing==1,]$ols_pred
data_at_max[data_at_max$mixing==1,]$ols_up

data_at_max[data_at_max$mixing==1,]$ols_pred/data_at_min[data_at_min$mixing==1,]$ols_pred
```

predictions for bonding

```{r}
print("------min-------")
data_at_min <- syn_data_bonding[syn_data_bonding$blau2==min(syn_data_bonding$blau2),]
data_at_min[data_at_min$bonding==1,]$ols_low
data_at_min[data_at_min$bonding==1,]$ols_pred
data_at_min[data_at_min$bonding==1,]$ols_up
print("------q1-------")
data_at_q1 <- syn_data_bonding[round(syn_data_bonding$blau2, digits=3)==round(q1_diversity, digits = 3),]
data_at_q1[data_at_q1$bonding==1,]$ols_low
data_at_q1[data_at_q1$bonding==1,]$ols_pred
data_at_q1[data_at_q1$bonding==1,]$ols_up
print("------q3-------")
data_at_q3 <- syn_data_bonding[round(syn_data_bonding$blau2, digits=3)==round(q3_diversity, digits = 3),]
data_at_q3[data_at_q3$bonding==1,]$ols_low
data_at_q3[data_at_q3$bonding==1,]$ols_pred
data_at_q3[data_at_q3$bonding==1,]$ols_up
print("------max-------")
data_at_max <- syn_data_bonding[syn_data_bonding$blau2==max(syn_data_bonding$blau2),]
data_at_max[data_at_max$bonding==1,]$ols_low
data_at_max[data_at_max$bonding==1,]$ols_pred
data_at_max[data_at_max$bonding==1,]$ols_up

data_at_max[data_at_max$bonding==1,]$ols_pred/data_at_min[data_at_min$bonding==1,]$ols_pred
```

predictions for incorporating

```{r}
print("------min-------")
data_at_min <- syn_data_incorporating[syn_data_incorporating$blau2==min(syn_data_incorporating$blau2),]
data_at_min[data_at_min$incorporating==max(data_at_min$incorporating),]$ols_low
data_at_min[data_at_min$incorporating==max(data_at_min$incorporating),]$ols_pred
data_at_min[data_at_min$incorporating==max(data_at_min$incorporating),]$ols_up
print("------q1-------")
data_at_q1 <- syn_data_incorporating[round(syn_data_incorporating$blau2, digits=3)==round(q1_diversity, digits = 3),]
data_at_q1[data_at_q1$incorporating==max(data_at_min$incorporating),]$ols_low
data_at_q1[data_at_q1$incorporating==max(data_at_min$incorporating),]$ols_pred
data_at_q1[data_at_q1$incorporating==max(data_at_min$incorporating),]$ols_up
print("------q3-------")
data_at_q3 <- syn_data_incorporating[round(syn_data_incorporating$blau2, digits=3)==round(q3_diversity, digits = 3),]
data_at_q3[data_at_q3$incorporating==max(data_at_min$incorporating),]$ols_low
data_at_q3[data_at_q3$incorporating==max(data_at_min$incorporating),]$ols_pred
data_at_q3[data_at_q3$incorporating==max(data_at_min$incorporating),]$ols_up
print("------max-------")
data_at_max <- syn_data_incorporating[syn_data_incorporating$blau2==max(syn_data_incorporating$blau2),]
data_at_max[data_at_max$incorporating==max(data_at_min$incorporating),]$ols_low
data_at_max[data_at_max$incorporating==max(data_at_min$incorporating),]$ols_pred
data_at_max[data_at_max$incorporating==max(data_at_min$incorporating),]$ols_up

data_at_max[data_at_max$incorporating==max(data_at_min$incorporating),]$ols_pred/data_at_min[data_at_min$incorporating==max(data_at_min$incorporating),]$ols_pred
```

predictions for combined

```{r}
print("------min-------")
data_at_min <- syn_data_combined[syn_data_combined$blau2==min(syn_data_combined$blau2),]
data_at_min[data_at_min$combined==max(data_at_min$combined),]$ols_low
data_at_min[data_at_min$combined==max(data_at_min$combined),]$ols_pred
data_at_min[data_at_min$combined==max(data_at_min$combined),]$ols_up
print("------q1-------")
data_at_q1 <- syn_data_incorporating[round(syn_data_incorporating$blau2, digits=3)==round(q1_diversity, digits = 3),]
data_at_q1[data_at_q1$combined==max(data_at_min$combined),]$ols_low
data_at_q1[data_at_q1$combined==max(data_at_min$combined),]$ols_pred
data_at_q1[data_at_q1$combined==max(data_at_min$combined),]$ols_up
print("------q3-------")
data_at_q3 <- syn_data_combined[round(syn_data_incorporating$blau2, digits=3)==round(q3_diversity, digits = 3),]
data_at_q3[data_at_q3$combined==max(data_at_min$combined),]$ols_low
data_at_q3[data_at_q3$combinedg==max(data_at_min$combined),]$ols_pred
data_at_q3[data_at_q3$combined==max(data_at_min$combined),]$ols_up
print("------max-------")
data_at_max <- syn_data_combined[syn_data_incorporating$blau2==max(syn_data_incorporating$blau2),]
data_at_max[data_at_max$combined==max(data_at_min$combined),]$ols_low
data_at_max[data_at_max$combined==max(data_at_min$combined),]$ols_pred
data_at_max[data_at_max$combined==max(data_at_min$combined),]$ols_up

data_at_max[data_at_max$combined==max(data_at_min$combined),]$ols_pred/data_at_min[data_at_min$combined==max(data_at_min$combined),]$ols_pred
```

Margins plot - game level w firm FE

```{r, fig.width = 6.6, fig.height = 6.6}
theme_set(theme_bw())

dropLeadingZero <- function(l){
  str_replace(l, '0(?=.)', '')
}

mean_diversity <- mean(moby_repeat_devs$blau2_z)
min_diversity <- min(moby_repeat_devs$blau2_z)
max_diversity <- max(moby_repeat_devs$blau2_z)
sd_diversity <- sd(moby_repeat_devs$blau2_z)
q1_diversity <- quantile(moby_repeat_devs$blau2_z, probs = 0.25)
q3_diversity <- quantile(moby_repeat_devs$blau2_z, probs = 0.75)

hi_color = "#b4de75"
lo_color = "#69629a"


syn_data_mixing_min <- min(syn_data_mixing_fe$ols_low)
syn_data_mixing_max <- max(syn_data_mixing_fe$ols_up)
syn_data_mixing_min_inclusion <- min(syn_data_mixing_fe$mixing)
syn_data_mixing_max_inclusion <- max(syn_data_mixing_fe$mixing)

syn_data_bonding_min <- min(syn_data_bonding_fe$ols_low)
syn_data_bonding_max <- max(syn_data_bonding_fe$ols_up)
syn_data_bonding_min_inclusion <- min(syn_data_bonding_fe$bonding)
syn_data_bonding_max_inclusion <- max(syn_data_bonding_fe$bonding)

syn_data_incorporating_min <- min(syn_data_incorporating_fe$ols_low)
syn_data_incorporating_max <- max(syn_data_incorporating_fe$ols_up)
syn_data_incorporating_min_inclusion <- min(syn_data_incorporating_fe$incorporating)
syn_data_incorporating_max_inclusion <- max(syn_data_incorporating_fe$incorporating)

syn_data_combined_min <- min(syn_data_combined_fe$ols_low)
syn_data_combined_max <- max(syn_data_combined_fe$ols_up)
syn_data_combined_min_inclusion <- min(syn_data_combined_fe$combined)
syn_data_combined_max_inclusion <- max(syn_data_combined_fe$combined)

global_y_max <- max(c(syn_data_mixing_max, syn_data_bonding_max, syn_data_incorporating_max, syn_data_combined_max))
global_y_min <- min(c(syn_data_mixing_min, syn_data_bonding_min, syn_data_incorporating_min, syn_data_combined_min))
#global_y_max=0.9
#global_y_min=0.5


m_top <- 2
m_left <-0
m_bottom <- 0
m_right <- 0
ts <- 3.2
tit_s <- 11



mixing_margins_fe <- ggplot()+
  
  #annotate("rect", xmin = min_diversity, xmax = max_diversity, ymin = 0.65, ymax = 1, alpha = .05) +
  annotate("rect", xmin = q1_diversity, xmax = q3_diversity, ymin = global_y_min, ymax = global_y_max, alpha = .1) +
  geom_vline(xintercept = q1_diversity,size=0.1) +
  geom_vline(xintercept = q3_diversity,size=0.1) +
  geom_vline(xintercept = mean_diversity,size=0.3, linetype="dashed", alpha = .5) +
  
  #min inclusion prediction and CI
  geom_line(data=syn_data_mixing_fe[syn_data_mixing_fe$mixing==syn_data_mixing_min_inclusion,],   aes(blau2_z, ols_pred), color=lo_color)+
  geom_ribbon(data=syn_data_mixing_fe[syn_data_mixing_fe$mixing==syn_data_mixing_min_inclusion,], aes(blau2_z, ymin=ols_low, ymax=ols_up),alpha=0.2, fill=lo_color)+

  #max inclusion prediction and CI
  geom_line(data=syn_data_mixing_fe[syn_data_mixing_fe$mixing==syn_data_mixing_max_inclusion,],   aes(blau2_z, ols_pred), color=hi_color)+
  geom_ribbon(data=syn_data_mixing_fe[syn_data_mixing_fe$mixing==syn_data_mixing_max_inclusion,], aes(blau2_z, ymin=ols_low, ymax=ols_up),alpha=0.2, fill=hi_color)+ 
  
  #axes formatting
  scale_y_continuous(
                     #trans='log10',
                     limits=c(global_y_min, global_y_max), 
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     #breaks = c(30, 50, 100, 200, 300, 400, 500), 
                     name="Predicted distinctiveness") +
  scale_x_continuous(limits=c(min_diversity, max_diversity),
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     breaks = pretty(syn_data_mixing_fe$blau2_z, n = 5), 
                     name="") +
  
#coord_cartesian(ylim = c(0.69, 0.90)) +
  
  
    annotate(geom="text", x=mean_diversity-0.01,    y=0.88, label="Mean\n Gender\nDiversity", lineheight = .8,  col="black", size=3.2, hjust = 1, alpha = 1) +
  
    annotate(geom="text", x=mean_diversity,    y=0.715, label="IQR of \nGender Diversity", lineheight = .8,  col="black", size=3.2, hjust = 0.5, alpha = 1) +
    annotate("segment", x = q1_diversity, xend = q3_diversity, y = .70, yend = .70, size=0.2, arrow = arrow(ends = "both", angle = 45, length = unit(1,"mm"))) +
  
    annotate(geom="text", x=0.45,    y=0.87, label="Maximal\nInclusion", lineheight = .8,  col=hi_color, size=3.2, hjust = 1, alpha = 1) +
    #geom_segment(aes(y=0.85,    x=0.25, yend = 0.81, xend = 0.28),size=0.6, col = hi_color, alpha=0.66, linetype=3) +
  
    annotate(geom="text", x=.45,    y=0.71, label="Minimal\nInclusion", lineheight = .8,   col=lo_color, size=3.2, hjust = 1, alpha = 1) +
    #geom_segment(aes(y=0.72,    x=.25, yend = 0.76, xend = .28),size=0.6, col = lo_color, alpha=0.66, linetype=3) +
  
    
  

  
  labs(title="Mixing")+
  
  #theme
  theme(aspect.ratio=1, 
            #panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(), 
            panel.background = element_blank(), 
            panel.border = element_rect(colour = "black", 
                                        fill=NA, 
                                        size=0.2),
            legend.position = c(0.2, 0.3),
            plot.title = element_text(size = tit_s, face = "bold", colour = "black"),
            #axis.ticks.y = element_blank(),
            axis.title.y = element_text(size = 11, colour = "black"),
            axis.text.x = element_text(size = 9, colour = "black"),
            axis.text.y = element_text(size = 9, colour = "black"),
            plot.margin = unit(c(m_top,m_right,m_bottom,0), "mm")
            )




bonding_margins_fe <- ggplot()+
  
  #annotate("rect", xmin = min_diversity, xmax = max_diversity, ymin = 0.65, ymax = 1, alpha = .05) +
  #annotate("rect", xmin = q1_diversity, xmax = q3_diversity, ymin = global_y_min, ymax = global_y_max, alpha = .1) +
  #geom_vline(xintercept = q1_diversity,size=0.1) +
  #geom_vline(xintercept = q3_diversity,size=0.1) +
  #geom_vline(xintercept = mean_diversity,size=0.3, linetype="dashed", alpha = .5) +
  
  #min inclusion prediction and CI
  geom_line(data=syn_data_bonding_fe[syn_data_bonding_fe$bonding==syn_data_bonding_min_inclusion,],   aes(blau2_z, ols_pred), color=lo_color)+
  geom_ribbon(data=syn_data_bonding_fe[syn_data_bonding_fe$bonding==syn_data_bonding_min_inclusion,], aes(blau2_z, ymin=ols_low, ymax=ols_up),alpha=0.2, fill=lo_color)+

  #max inclusion prediction and CI
  geom_line(data=syn_data_bonding_fe[syn_data_bonding_fe$bonding==syn_data_bonding_max_inclusion,],   aes(blau2_z, ols_pred), color=hi_color)+
  geom_ribbon(data=syn_data_bonding_fe[syn_data_bonding_fe$bonding==syn_data_bonding_max_inclusion,], aes(blau2_z, ymin=ols_low, ymax=ols_up),alpha=0.2, fill=hi_color)+ 
  
  #axes formatting
  scale_y_continuous(
                     #trans='log10',
                     limits=c(global_y_min, global_y_max), 
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     #breaks = c(30, 50, 100, 200, 300, 400, 500), 
                     name="") +
  scale_x_continuous(limits=c(min_diversity, max_diversity),
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     breaks = pretty(syn_data_bonding_fe$blau2_z, n = 5), 
                     name="") +
  
#coord_cartesian(ylim = c(0.69, 0.90)) +

  
  labs(title="Bonding")+
  
  #theme
  theme(aspect.ratio=1, 
            #panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(), 
            panel.background = element_blank(), 
            panel.border = element_rect(colour = "black", 
                                        fill=NA, 
                                        size=0.2),
            legend.position = c(0.2, 0.3),
            plot.title = element_text(size = tit_s, face = "bold", colour = "black"),
            #axis.ticks.y = element_blank(),
            axis.title.y = element_text(size = 11, colour = "black"),
            axis.text.x = element_text(size = 9, colour = "black"),
            axis.text.y = element_text(size = 9, colour = "black"),
            plot.margin = unit(c(m_top,m_right,m_bottom,m_left), "mm")
            )




incorporating_margins_fe <- ggplot()+
  
  #annotate("rect", xmin = min_diversity, xmax = max_diversity, ymin = 0.65, ymax = 1, alpha = .05) +
  #annotate("rect", xmin = q1_diversity, xmax = q3_diversity, ymin = global_y_min, ymax = global_y_max, alpha = .1) +
  #geom_vline(xintercept = q1_diversity,size=0.1) +
  #geom_vline(xintercept = q3_diversity,size=0.1) +
  #geom_vline(xintercept = mean_diversity,size=0.3, linetype="dashed", alpha = .5) +
  
  #min inclusion prediction and CI
  geom_line(data=syn_data_incorporating_fe[syn_data_incorporating_fe$incorporating==syn_data_incorporating_min_inclusion,],   aes(blau2_z, ols_pred), color=lo_color)+
  geom_ribbon(data=syn_data_incorporating_fe[syn_data_incorporating_fe$incorporating==syn_data_incorporating_min_inclusion,], aes(blau2_z, ymin=ols_low, ymax=ols_up),alpha=0.2, fill=lo_color)+

  #max inclusion prediction and CI
  geom_line(data=syn_data_incorporating_fe[syn_data_incorporating_fe$incorporating==syn_data_incorporating_max_inclusion,],   aes(blau2_z, ols_pred), color=hi_color)+
  geom_ribbon(data=syn_data_incorporating_fe[syn_data_incorporating_fe$incorporating==syn_data_incorporating_max_inclusion,], aes(blau2_z, ymin=ols_low, ymax=ols_up),alpha=0.2, fill=hi_color)+ 
  
  #axes formatting
  scale_y_continuous(
                     #trans='log10',
                     limits=c(global_y_min, global_y_max), 
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     #breaks = c(30, 50, 100, 200, 300, 400, 500), 
                     name="Predicted distinctiveness") +
  scale_x_continuous(limits=c(min_diversity, max_diversity),
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     breaks = pretty(syn_data_incorporating_fe$blau2_z, n = 5), 
                     name="Gender diversity") +
  
  #coord_cartesian(ylim = c(0.69, 0.90)) +
  
  

  
  labs(title="Incorporating")+
  
  #theme
  theme(aspect.ratio=1, 
            #panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(), 
            panel.background = element_blank(), 
            panel.border = element_rect(colour = "black", 
                                        fill=NA, 
                                        size=0.2),
            legend.position = c(0.2, 0.3),
            plot.title = element_text(size = tit_s, face = "bold", colour = "black"),
            #axis.ticks.y = element_blank(),
            axis.title.y = element_text(size = 11, colour = "black"),
            axis.text.x = element_text(size = 9, colour = "black"),
            axis.text.y = element_text(size = 9, colour = "black"),
            plot.margin = unit(c(m_top,m_right,m_bottom,m_left), "mm")
            )





combined_margins_fe <- ggplot()+
  
  #annotate("rect", xmin = min_diversity, xmax = max_diversity, ymin = 0.65, ymax = 1, alpha = .05) +
  #annotate("rect", xmin = q1_diversity, xmax = q3_diversity, ymin = global_y_min, ymax = global_y_max, alpha = .1) +
  #geom_vline(xintercept = q1_diversity,size=0.1) +
  #geom_vline(xintercept = q3_diversity,size=0.1) +
  #geom_vline(xintercept = mean_diversity,size=0.3, linetype="dashed", alpha = .5) +
  
  #min inclusion prediction and CI
  geom_line(data=syn_data_combined_fe[syn_data_combined_fe$combined==syn_data_combined_min_inclusion,],   aes(blau2_z, ols_pred), color=lo_color)+
  geom_ribbon(data=syn_data_combined_fe[syn_data_combined_fe$combined==syn_data_combined_min_inclusion,], aes(blau2_z, ymin=ols_low, ymax=ols_up),alpha=0.2, fill=lo_color)+

  #max inclusion prediction and CI
  geom_line(data=syn_data_combined_fe[syn_data_combined_fe$combined==syn_data_combined_max_inclusion,],   aes(blau2_z, ols_pred), color=hi_color)+
  geom_ribbon(data=syn_data_combined_fe[syn_data_combined_fe$combined==syn_data_combined_max_inclusion,], aes(blau2_z, ymin=ols_low, ymax=ols_up),alpha=0.2, fill=hi_color)+ 
  
  #axes formatting
  scale_y_continuous(
                     #trans='log10',
                     limits=c(global_y_min, global_y_max), 
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     #breaks = c(30, 50, 100, 200, 300, 400, 500), 
                     name="") +
  scale_x_continuous(limits=c(min_diversity, max_diversity),
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     breaks = pretty(syn_data_combined_fe$blau2_z, n = 5), 
                     name="Gender diversity") +
  
  #coord_cartesian(ylim = c(0.69, 0.90)) +
  
  

  
  labs(title="Combined inclusion")+
  
  #theme
  theme(aspect.ratio=1, 
            #panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(), 
            panel.background = element_blank(), 
            panel.border = element_rect(colour = "black", 
                                        fill=NA, 
                                        size=0.2),
            legend.position = c(0.2, 0.3),
            plot.title = element_text(size = tit_s, face = "bold", colour = "black"),
            #axis.ticks.y = element_blank(),
            axis.title.y = element_text(size = 11, colour = "black"),
            axis.text.x = element_text(size = 9, colour = "black"),
            axis.text.y = element_text(size = 9, colour = "black"),
            plot.margin = unit(c(m_top,m_right,m_bottom,m_left), "mm")
            )





margins_gamelevel_fe <- grid.arrange(mixing_margins_fe, bonding_margins_fe, incorporating_margins_fe,combined_margins_fe, nrow = 2)
#margins
```

```{r}
ggsave("margins_fe_mid.pdf", margins_gamelevel_fe, width = 5, height = 5)
ggsave("margins_fe_sm.pdf", margins_gamelevel_fe, width = 4, height = 4)
```



Margins plot - firm level

```{r, fig.width = 6.6, fig.height = 6.6}
theme_set(theme_bw())

dropLeadingZero <- function(l){
  str_replace(l, '0(?=.)', '')
}

mean_diversity <- mean(moby_dev_firm_level$blau2_z)
min_diversity <- min(moby_dev_firm_level$blau2_z)
max_diversity <- max(moby_dev_firm_level$blau2_z)
sd_diversity <- sd(moby_dev_firm_level$blau2_z)
q1_diversity <- quantile(moby_dev_firm_level$blau2_z, probs = 0.25)
q3_diversity <- quantile(moby_dev_firm_level$blau2_z, probs = 0.75)

hi_color = "#b4de75"
lo_color = "#69629a"


syn_data_mixing_aggr_min <- min(syn_data_mixing_aggr$ols_low)
syn_data_mixing_aggr_max <- max(syn_data_mixing_aggr$ols_up)
syn_data_mixing_aggr_min_inclusion <- min(syn_data_mixing_aggr$mixing)
syn_data_mixing_aggr_max_inclusion <- max(syn_data_mixing_aggr$mixing)

syn_data_bonding_aggr_min <- min(syn_data_bonding_aggr$ols_low)
syn_data_bonding_aggr_max <- max(syn_data_bonding_aggr$ols_up)
syn_data_bonding_aggr_min_inclusion <- min(syn_data_bonding_aggr$bonding)
syn_data_bonding_aggr_max_inclusion <- max(syn_data_bonding_aggr$bonding)

syn_data_incorporating_aggr_min <- min(syn_data_incorporating_aggr$ols_low)
syn_data_incorporating_aggr_max <- max(syn_data_incorporating_aggr$ols_up)
syn_data_incorporating_aggr_min_inclusion <- min(syn_data_incorporating_aggr$incorporating)
syn_data_incorporating_aggr_max_inclusion <- max(syn_data_incorporating_aggr$incorporating)

syn_data_combined_aggr_min <- min(syn_data_combined_aggr$ols_low)
syn_data_combined_aggr_max <- max(syn_data_combined_aggr$ols_up)
syn_data_combined_aggr_min_inclusion <- min(syn_data_combined_aggr$combined)
syn_data_combined_aggr_max_inclusion <- max(syn_data_combined_aggr$combined)

global_y_max <- max(c(syn_data_mixing_aggr_max, syn_data_bonding_aggr_max, syn_data_incorporating_aggr_max, syn_data_combined_aggr_max))
global_y_min <- min(c(syn_data_mixing_aggr_min, syn_data_bonding_aggr_min, syn_data_incorporating_aggr_min, syn_data_combined_aggr_min))


m_top <- 2
m_left <-0
m_bottom <- 0
m_right <- 0
ts <- 3.2
tit_s <- 11
iqr_alpha <- 0.07
ribbon_alpha <- 0.33


mixing_margins_aggr <- ggplot()+
  
  #annotate("rect", xmin = min_diversity, xmax = max_diversity, ymin = 0.65, ymax = 1, alpha = .05) +
  annotate("rect", xmin = q1_diversity, xmax = q3_diversity, ymin = global_y_min, ymax = global_y_max, alpha = iqr_alpha) +
  geom_vline(xintercept = q1_diversity,size=0.1) +
  geom_vline(xintercept = q3_diversity,size=0.1) +
  geom_vline(xintercept = mean_diversity,size=0.3, linetype="dashed", alpha = .5) +
  
  #min inclusion prediction and CI
  geom_line(data=syn_data_mixing_aggr[syn_data_mixing_aggr$mixing==syn_data_mixing_aggr_min_inclusion,],   aes(blau2_z, ols_pred), color=lo_color)+
  geom_ribbon(data=syn_data_mixing_aggr[syn_data_mixing_aggr$mixing==syn_data_mixing_aggr_min_inclusion,], aes(blau2_z, ymin=ols_low, ymax=ols_up),alpha=ribbon_alpha, fill=lo_color)+

  #max inclusion prediction and CI
  geom_line(data=syn_data_mixing_aggr[syn_data_mixing_aggr$mixing==syn_data_mixing_aggr_max_inclusion,],   aes(blau2_z, ols_pred), color=hi_color)+
  geom_ribbon(data=syn_data_mixing_aggr[syn_data_mixing_aggr$mixing==syn_data_mixing_aggr_max_inclusion,], aes(blau2_z, ymin=ols_low, ymax=ols_up),alpha=ribbon_alpha, fill=hi_color)+ 
  
  #axes formatting
  scale_y_continuous(
                     #trans='log10',
                     limits=c(global_y_min, global_y_max), 
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     #breaks = c(30, 50, 100, 200, 300, 400, 500), 
                     name="Predicted distinctiveness") +
  scale_x_continuous(limits=c(min_diversity, max_diversity),
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     breaks = pretty(syn_data_mixing_aggr$blau2_z, n = 5), 
                     name="") +
  
coord_cartesian(ylim = c(0.69, 0.90)) +
  
  
    annotate(geom="text", x=mean_diversity-0.01,    y=0.88, label="Mean\n Gender\nDiversity", lineheight = .8,  col="black", size=3.2, hjust = 1, alpha = 1) +
  
    annotate(geom="text", x=mean_diversity,    y=0.715, label="IQR of \nGender Diversity", lineheight = .8,  col="black", size=3.2, hjust = 0.5, alpha = 1) +
    annotate("segment", x = q1_diversity, xend = q3_diversity, y = .70, yend = .70, size=0.2, arrow = arrow(ends = "both", angle = 45, length = unit(1,"mm"))) +
  
    annotate(geom="text", x=.42,    y=0.869, label="Maximal\nInclusion", lineheight = .8,  col="black", size=3.2, hjust = 1, alpha = 1, angle = 35.5) +
    #geom_segment(aes(y=0.85,    x=0.25, yend = 0.81, xend = 0.28),size=0.6, col = hi_color, alpha=0.66, linetype=3) +
  
    annotate(geom="text", x=.42,    y=0.74, label="Minimal\nInclusion", lineheight = .8,   col="black", size=3.2, hjust = 1, alpha = 1, angle = -30) +
    #geom_segment(aes(y=0.72,    x=.25, yend = 0.76, xend = .28),size=0.6, col = lo_color, alpha=0.66, linetype=3) +
  
    
  

  
  labs(title="Mixing")+
  
  #theme
  theme(aspect.ratio=1, 
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(), 
            panel.background = element_blank(), 
            panel.border = element_rect(colour = "black", 
                                        fill=NA, 
                                        size=0.2),
            legend.position = c(0.2, 0.3),
            plot.title = element_text(size = tit_s, face = "bold", colour = "black"),
            #axis.ticks.y = element_blank(),
            axis.title.y = element_text(size = 11, colour = "black"),
            axis.text.x = element_text(size = 9, colour = "black"),
            axis.text.y = element_text(size = 9, colour = "black"),
            plot.margin = unit(c(m_top,m_right,m_bottom,0), "mm")
            )




bonding_margins_aggr <- ggplot()+
  
  #annotate("rect", xmin = min_diversity, xmax = max_diversity, ymin = 0.65, ymax = 1, alpha = .05) +
  annotate("rect", xmin = q1_diversity, xmax = q3_diversity, ymin = global_y_min, ymax = global_y_max, alpha = iqr_alpha) +
  geom_vline(xintercept = q1_diversity,size=0.1) +
  geom_vline(xintercept = q3_diversity,size=0.1) +
  geom_vline(xintercept = mean_diversity,size=0.3, linetype="dashed", alpha = .5) +
  
  #min inclusion prediction and CI
  geom_line(data=syn_data_bonding_aggr[syn_data_bonding_aggr$bonding==syn_data_bonding_aggr_min_inclusion,],   aes(blau2_z, ols_pred), color=lo_color)+
  geom_ribbon(data=syn_data_bonding_aggr[syn_data_bonding_aggr$bonding==syn_data_bonding_aggr_min_inclusion,], aes(blau2_z, ymin=ols_low, ymax=ols_up),alpha=ribbon_alpha, fill=lo_color)+

  #max inclusion prediction and CI
  geom_line(data=syn_data_bonding_aggr[syn_data_bonding_aggr$bonding==syn_data_bonding_aggr_max_inclusion,],   aes(blau2_z, ols_pred), color=hi_color)+
  geom_ribbon(data=syn_data_bonding_aggr[syn_data_bonding_aggr$bonding==syn_data_bonding_aggr_max_inclusion,], aes(blau2_z, ymin=ols_low, ymax=ols_up),alpha=ribbon_alpha, fill=hi_color)+ 
  
  #axes formatting
  scale_y_continuous(
                     #trans='log10',
                     limits=c(global_y_min, global_y_max), 
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     #breaks = c(30, 50, 100, 200, 300, 400, 500), 
                     name="") +
  scale_x_continuous(limits=c(min_diversity, max_diversity),
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     breaks = pretty(syn_data_bonding_aggr$blau2_z, n = 5), 
                     name="") +
  
coord_cartesian(ylim = c(0.69, 0.90)) +

  
  labs(title="Bonding")+
  
  #theme
  theme(aspect.ratio=1, 
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(), 
            panel.background = element_blank(), 
            panel.border = element_rect(colour = "black", 
                                        fill=NA, 
                                        size=0.2),
            legend.position = c(0.2, 0.3),
            plot.title = element_text(size = tit_s, face = "bold", colour = "black"),
            #axis.ticks.y = element_blank(),
            axis.title.y = element_text(size = 11, colour = "black"),
            axis.text.x = element_text(size = 9, colour = "black"),
            axis.text.y = element_text(size = 9, colour = "black"),
            plot.margin = unit(c(m_top,m_right,m_bottom,m_left), "mm")
            )




incorporating_margins_aggr <- ggplot()+
  
  #annotate("rect", xmin = min_diversity, xmax = max_diversity, ymin = 0.65, ymax = 1, alpha = .05) +
  annotate("rect", xmin = q1_diversity, xmax = q3_diversity, ymin = global_y_min, ymax = global_y_max, alpha = iqr_alpha) +
  geom_vline(xintercept = q1_diversity,size=0.1) +
  geom_vline(xintercept = q3_diversity,size=0.1) +
  geom_vline(xintercept = mean_diversity,size=0.3, linetype="dashed", alpha = .5) +
  
  #min inclusion prediction and CI
  geom_ribbon(data=syn_data_incorporating_aggr[syn_data_incorporating_aggr$incorporating==syn_data_incorporating_aggr_min_inclusion,], aes(blau2_z, ymin=ols_low, ymax=ols_up),alpha=ribbon_alpha, fill=lo_color)+
  geom_line(data=syn_data_incorporating_aggr[syn_data_incorporating_aggr$incorporating==syn_data_incorporating_aggr_min_inclusion,],   aes(blau2_z, ols_pred), color=lo_color)+

  #max inclusion prediction and CI
  
  geom_ribbon(data=syn_data_incorporating_aggr[syn_data_incorporating_aggr$incorporating==syn_data_incorporating_aggr_max_inclusion,], aes(blau2_z, ymin=ols_low, ymax=ols_up),alpha=ribbon_alpha, fill=hi_color)+ 
  geom_line(data=syn_data_incorporating_aggr[syn_data_incorporating_aggr$incorporating==syn_data_incorporating_aggr_max_inclusion,],   aes(blau2_z, ols_pred), color=hi_color)+
  
  #axes formatting
  scale_y_continuous(
                     #trans='log10',
                     limits=c(global_y_min, global_y_max), 
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     #breaks = c(30, 50, 100, 200, 300, 400, 500), 
                     name="Predicted distinctiveness") +
  scale_x_continuous(limits=c(min_diversity, max_diversity),
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     breaks = pretty(syn_data_incorporating_aggr$blau2_z, n = 5), 
                     name="Gender diversity") +
  
  coord_cartesian(ylim = c(0.69, 0.90)) +
  
  

  
  labs(title="Incorporating")+
  
  #theme
  theme(aspect.ratio=1, 
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(), 
            panel.background = element_blank(), 
            panel.border = element_rect(colour = "black", 
                                        fill=NA, 
                                        size=0.2),
            legend.position = c(0.2, 0.3),
            plot.title = element_text(size = tit_s, face = "bold", colour = "black"),
            #axis.ticks.y = element_blank(),
            axis.title.y = element_text(size = 11, colour = "black"),
            axis.text.x = element_text(size = 9, colour = "black"),
            axis.text.y = element_text(size = 9, colour = "black"),
            plot.margin = unit(c(m_top,m_right,m_bottom,m_left), "mm")
            )





combined_margins_aggr <- ggplot()+
  
  #annotate("rect", xmin = min_diversity, xmax = max_diversity, ymin = 0.65, ymax = 1, alpha = .05) +
  annotate("rect", xmin = q1_diversity, xmax = q3_diversity, ymin = global_y_min, ymax = global_y_max, alpha = iqr_alpha) +
  geom_vline(xintercept = q1_diversity,size=0.1) +
  geom_vline(xintercept = q3_diversity,size=0.1) +
  geom_vline(xintercept = mean_diversity,size=0.3, linetype="dashed", alpha = .5) +
  
  #min inclusion prediction and CI
  geom_line(data=syn_data_combined_aggr[syn_data_combined_aggr$combined==syn_data_combined_aggr_min_inclusion,],   aes(blau2_z, ols_pred), color=lo_color)+
  geom_ribbon(data=syn_data_combined_aggr[syn_data_combined_aggr$combined==syn_data_combined_aggr_min_inclusion,], aes(blau2_z, ymin=ols_low, ymax=ols_up),alpha=ribbon_alpha, fill=lo_color)+

  #max inclusion prediction and CI
  geom_line(data=syn_data_combined_aggr[syn_data_combined_aggr$combined==syn_data_combined_aggr_max_inclusion,],   aes(blau2_z, ols_pred), color=hi_color)+
  geom_ribbon(data=syn_data_combined_aggr[syn_data_combined_aggr$combined==syn_data_combined_aggr_max_inclusion,], aes(blau2_z, ymin=ols_low, ymax=ols_up),alpha=ribbon_alpha, fill=hi_color)+ 
  
  #axes formatting
  scale_y_continuous(
                     #trans='log10',
                     limits=c(global_y_min, global_y_max), 
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     #breaks = c(30, 50, 100, 200, 300, 400, 500), 
                     name="") +
  scale_x_continuous(limits=c(min_diversity, max_diversity),
                     labels = dropLeadingZero,
                     expand = c(0.001,0.001), 
                     breaks = pretty(syn_data_combined_aggr$blau2_z, n = 5), 
                     name="Gender diversity") +
  
  coord_cartesian(ylim = c(0.69, 0.90)) +
  
  

  
  labs(title="Combined inclusion")+
  
  #theme
  theme(aspect.ratio=1, 
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(), 
            panel.background = element_blank(), 
            panel.border = element_rect(colour = "black", 
                                        fill=NA, 
                                        size=0.2),
            legend.position = c(0.2, 0.3),
            plot.title = element_text(size = tit_s, face = "bold", colour = "black"),
            #axis.ticks.y = element_blank(),
            axis.title.y = element_text(size = 11, colour = "black"),
            axis.text.x = element_text(size = 9, colour = "black"),
            axis.text.y = element_text(size = 9, colour = "black"),
            plot.margin = unit(c(m_top,m_right,m_bottom,m_left), "mm")
            )





margins_firmlevel <- grid.arrange(mixing_margins_aggr, bonding_margins_aggr, incorporating_margins_aggr,combined_margins_aggr, nrow = 2)
#margins
```

```{r}
ggsave("margins_firmlevel_mid.pdf", margins_firmlevel, width = 5, height = 5)
ggsave("margins_firmlevel_sm.pdf", margins_firmlevel, width = 4, height = 4)
```



#Point estimates

##Game level, STD

```{r}
confint.robust <- function (object, parm, level = 0.95, ...)
{
    cf <- coef(object)
    pnames <- names(cf)
    if (missing(parm))
        parm <- pnames
    else if (is.numeric(parm))
        parm <- pnames[parm]
    a <- (1 - level)/2
    a <- c(a, 1 - a)
    pct <- stats:::format.perc(a, 3)
    fac <- qnorm(a)
    ci <- array(NA, dim = c(length(parm), 2L), dimnames = list(parm,
        pct))
    ses <- sqrt(diag(sandwich::vcovHC(object, type = "HC1", cluster=moby$org_dev)))[parm]
    ci[] <- cf[parm] + ses %o% fac
    ci
}
```


```{r}
#get model coefs with 95% CI
point_est_model1_var1 <- data.frame(without_inclusion_z$coefficients[2] ,confint.robust(without_inclusion_z, 2, level=0.95))
colnames(point_est_model1_var1) <- c("estim", "ci_025", "ci_975")

point_est_model2_var1 <- data.frame(mixing_z$coefficients[2] ,confint.robust(mixing_z, 2, level=0.95))
colnames(point_est_model2_var1) <- c("estim", "ci_025", "ci_975")
point_est_model2_var2 <- data.frame(mixing_z$coefficients[3] ,confint.robust(mixing_z, 3, level=0.95))
colnames(point_est_model2_var2) <- c("estim", "ci_025", "ci_975")
point_est_model2_var3 <- data.frame(mixing_z$coefficients[32] ,confint.robust(mixing_z, 32, level=0.95))
colnames(point_est_model2_var3) <- c("estim", "ci_025", "ci_975")

point_est_model3_var1 <- data.frame(bonding_z$coefficients[2] ,confint.robust(bonding_z, 2, level=0.95))
colnames(point_est_model3_var1) <- c("estim", "ci_025", "ci_975")
point_est_model3_var2 <- data.frame(bonding_z$coefficients[3] ,confint.robust(bonding_z, 3, level=0.95))
colnames(point_est_model3_var2) <- c("estim", "ci_025", "ci_975")
point_est_model3_var3 <- data.frame(bonding_z$coefficients[32] ,confint.robust(bonding_z, 32, level=0.95))
colnames(point_est_model3_var3) <- c("estim", "ci_025", "ci_975")

point_est_model4_var1 <- data.frame(incorporating_z$coefficients[2] ,confint.robust(incorporating_z, 2, level=0.95))
colnames(point_est_model4_var1) <- c("estim", "ci_025", "ci_975")
point_est_model4_var2 <- data.frame(incorporating_z$coefficients[3] ,confint.robust(incorporating_z, 3, level=0.95))
colnames(point_est_model4_var2) <- c("estim", "ci_025", "ci_975")
point_est_model4_var3 <- data.frame(incorporating_z$coefficients[32] ,confint.robust(incorporating_z, 32, level=0.95))
colnames(point_est_model4_var3) <- c("estim", "ci_025", "ci_975")

point_est_model5_var1 <- data.frame(combined_z$coefficients[2] ,confint.robust(combined_z, 2, level=0.95))
colnames(point_est_model5_var1) <- c("estim", "ci_025", "ci_975")
point_est_model5_var2 <- data.frame(combined_z$coefficients[3] ,confint.robust(combined_z, 3, level=0.95))
colnames(point_est_model5_var2) <- c("estim", "ci_025", "ci_975")
point_est_model5_var3 <- data.frame(combined_z$coefficients[32] ,confint.robust(combined_z, 32, level=0.95))
colnames(point_est_model5_var3) <- c("estim", "ci_025", "ci_975")
```

Game level point estiamtes, no title

```{r, fig.width = 2.64, fig.height = 2.3}

dropLeadingZero <- function(l){
  str_replace(l, '0(?=.)', '')
}

s <- 3.1
ps <- 2.85
tit_s <- 12
asp <- 1
annotate_y <- -0.07

m_top <- 1
m_left <-1
m_bottom <- 1
m_right <- 1

nonsig_col <- "gray60"
sig_col <- "black"

ols_estim_gamelevel_notitle <- ggplot()+
  geom_hline(yintercept = 0, linetype="dashed", alpha=0.7, color="black", size=0.2) +
  
  #prop women X inclusion

  geom_errorbar(data = point_est_model2_var3,aes(x = 1.3, ymin = ci_025, ymax = ci_975),width = 0,alpha = 1,color = ifelse(point_est_model2_var3$ci_025 * point_est_model2_var3$ci_975 < 0,nonsig_col,sig_col),size = 0.75) +
  geom_point(data = point_est_model2_var3,aes(x = 1.3, estim),alpha = 1,color = ifelse(point_est_model2_var3$ci_025 * point_est_model2_var3$ci_975 < 0,nonsig_col,sig_col),shape = 21,fill = ifelse(point_est_model2_var3$ci_025 * point_est_model2_var3$ci_975 < 0,nonsig_col,sig_col),size = ps,stroke = 1) +
  annotate(geom = "text",x = 1.3,y = point_est_model2_var3$estim,label = "1",col = "white",size = s,hjust = 0.5,alpha = 1) +
  
  geom_errorbar(data = point_est_model3_var3,aes(x = 1.1, ymin = ci_025, ymax = ci_975),width = 0,alpha = 1,color = ifelse(point_est_model3_var3$ci_025 * point_est_model3_var3$ci_975 < 0,nonsig_col,sig_col),size = 0.75) +
  geom_point(data = point_est_model3_var3,aes(x = 1.1, estim),alpha = 1,color = ifelse(point_est_model3_var3$ci_025 * point_est_model3_var3$ci_975 < 0,nonsig_col,sig_col),shape = 21,fill = ifelse(point_est_model3_var3$ci_025 * point_est_model3_var3$ci_975 < 0,nonsig_col,sig_col),size = ps,stroke = 1) +
  annotate(geom = "text",x = 1.1,y = point_est_model3_var3$estim,label = "2",col = "white",size = s,hjust = 0.5,alpha = 1) +
  
  geom_errorbar(data = point_est_model4_var3,aes(x = 0.9, ymin = ci_025, ymax = ci_975),width = 0,alpha = 1,color = ifelse(point_est_model4_var3$ci_025 * point_est_model4_var3$ci_975 < 0,nonsig_col,sig_col),size = 0.75) +
  geom_point(data = point_est_model4_var3,aes(x = 0.9, estim),alpha = 1,color = ifelse(point_est_model4_var3$ci_025 * point_est_model4_var3$ci_975 < 0,nonsig_col,sig_col),shape = 21,fill = ifelse(point_est_model4_var3$ci_025 * point_est_model4_var3$ci_975 < 0,nonsig_col,sig_col),size = ps,stroke = 1) +
  annotate(geom = "text",x = 0.9,y = point_est_model4_var3$estim,label = "3",col = "white",size = s,hjust = 0.5,alpha = 1) +
  
  geom_errorbar(data = point_est_model5_var3,aes(x = 0.7, ymin = ci_025, ymax = ci_975),width = 0,alpha = 1,color = ifelse(point_est_model5_var3$ci_025 * point_est_model5_var3$ci_975 < 0,nonsig_col,sig_col),size = 0.75) +
  geom_point(data = point_est_model5_var3,aes(x = 0.7, estim),alpha = 1,color = ifelse(point_est_model5_var3$ci_025 * point_est_model5_var3$ci_975 < 0,nonsig_col,sig_col),shape = 21,fill = ifelse(point_est_model5_var3$ci_025 * point_est_model5_var3$ci_975 < 0,nonsig_col,sig_col),size = ps,stroke = 1) +
  annotate(geom = "text",x = 0.7,y = point_est_model5_var3$estim,label = "4",col = "white",size = s,hjust = 0.5,alpha = 1) +
  
  
  #inclusion

  
  geom_errorbar(data = point_est_model2_var2,aes(x = 2.3, ymin = ci_025, ymax = ci_975),width = 0,alpha = 1,color = ifelse(point_est_model2_var2$ci_025 * point_est_model2_var2$ci_975 < 0,nonsig_col,sig_col),size = 0.75) +
  geom_point(data = point_est_model2_var2,aes(x = 2.3, estim),alpha = 1,color = ifelse(point_est_model2_var2$ci_025 * point_est_model2_var2$ci_975 < 0,nonsig_col,sig_col),shape = 21,fill = ifelse(point_est_model2_var2$ci_025 * point_est_model2_var2$ci_975 < 0,nonsig_col,sig_col),size = ps,stroke = 1) +
  annotate(geom = "text",x = 2.3,y = point_est_model2_var2$estim,label = "1",col = "white",size = s,hjust = 0.5,alpha = 1) +
  
  geom_errorbar(data = point_est_model3_var2,aes(x = 2.1, ymin = ci_025, ymax = ci_975),width = 0,alpha = 1,color = ifelse(point_est_model3_var2$ci_025 * point_est_model3_var2$ci_975 < 0,nonsig_col,sig_col),size = 0.75) +
  geom_point(data = point_est_model3_var2,aes(x = 2.1, estim),alpha = 1,color = ifelse(point_est_model3_var2$ci_025 * point_est_model3_var2$ci_975 < 0,nonsig_col,sig_col),shape = 21,fill = ifelse(point_est_model3_var2$ci_025 * point_est_model3_var2$ci_975 < 0,nonsig_col,sig_col),size = ps,stroke = 1) +
  annotate(geom = "text",x = 2.1,y = point_est_model3_var2$estim,label = "2",col = "white",size = s,hjust = 0.5,alpha = 1) +
  
  geom_errorbar(data = point_est_model4_var2,aes(x = 1.9, ymin = ci_025, ymax = ci_975),width = 0,alpha = 1,color = ifelse(point_est_model4_var2$ci_025 * point_est_model4_var2$ci_975 < 0,nonsig_col,sig_col),size = 0.75) +
  geom_point(data = point_est_model4_var2,aes(x = 1.9, estim),alpha = 1,color = ifelse(point_est_model4_var2$ci_025 * point_est_model4_var2$ci_975 < 0,nonsig_col,sig_col),shape = 21,fill = ifelse(point_est_model4_var2$ci_025 * point_est_model4_var2$ci_975 < 0,nonsig_col,sig_col),size = ps,stroke = 1) +
  annotate(geom = "text",x = 1.9,y = point_est_model4_var2$estim, label = "3",col = "white",size = s,hjust = 0.5,alpha = 1) +
  
  geom_errorbar(data = point_est_model5_var2,aes(x = 1.7, ymin = ci_025, ymax = ci_975),width = 0,alpha = 1,color = ifelse(point_est_model5_var2$ci_025 * point_est_model5_var2$ci_975 < 0,nonsig_col,sig_col),size = 0.75) +
  geom_point(data = point_est_model5_var2,aes(x = 1.7, estim),alpha = 1,color = ifelse(point_est_model5_var2$ci_025 * point_est_model5_var2$ci_975 < 0,nonsig_col,sig_col),shape = 21,fill = ifelse(point_est_model5_var2$ci_025 * point_est_model5_var2$ci_975 < 0,nonsig_col,sig_col),size = ps,stroke = 1) +
  annotate(geom = "text",x = 1.7,y = point_est_model5_var2$estim,label = "4",col = "white",size = s,hjust = 0.5,alpha = 1) +
  

  
  #prop women

  geom_errorbar(data = point_est_model1_var1,aes(x = 3.5, ymin = ci_025, ymax = ci_975),width = 0,alpha = 1,color = "red",size = 0.75) +
  geom_point(data = point_est_model1_var1,aes(x = 3.5, estim),alpha = 1,color = "red",shape = 21,fill = "red",size = ps,stroke = 1) +
  annotate(geom = "text",x = 3.5,y = point_est_model1_var1$estim,label = "0",col = "white",size = s,hjust = 0.5,alpha = 1) +
  
  geom_errorbar(data = point_est_model2_var1,aes(x = 3.3, ymin = ci_025, ymax = ci_975),width = 0,alpha = 1,color = ifelse(point_est_model2_var1$ci_025 * point_est_model2_var1$ci_975 < 0,nonsig_col,sig_col),size = 0.75) +
  geom_point(data = point_est_model2_var1,aes(x = 3.3, estim),alpha = 1,color = ifelse(point_est_model2_var1$ci_025 * point_est_model2_var1$ci_975 < 0,nonsig_col,sig_col),shape = 21,fill = ifelse(point_est_model2_var1$ci_025 * point_est_model2_var1$ci_975 < 0,nonsig_col,sig_col),size = ps,stroke = 1) +
  annotate(geom = "text",x = 3.3,y = point_est_model2_var1$estim,label = "1",col = "white",size = s,hjust = 0.5,alpha = 1) +
  
  geom_errorbar(data = point_est_model3_var1,aes(x = 3.1, ymin = ci_025, ymax = ci_975),width = 0,alpha = 1,color = ifelse(point_est_model3_var1$ci_025 * point_est_model3_var1$ci_975 < 0,nonsig_col,sig_col),size = 0.75) +
  geom_point(data = point_est_model3_var1,aes(x = 3.1, estim),alpha = 1,color = ifelse(point_est_model3_var1$ci_025 * point_est_model3_var1$ci_975 < 0,nonsig_col,sig_col),shape = 21,fill = ifelse(point_est_model3_var1$ci_025 * point_est_model3_var1$ci_975 < 0,nonsig_col,sig_col),size = ps,stroke = 1) +
  annotate(geom = "text",x = 3.1,y = point_est_model3_var1$estim,label = "2",col = "white",size = s,hjust = 0.5,alpha = 1) +
  
  geom_errorbar(data = point_est_model4_var1,aes(x = 2.9, ymin = ci_025, ymax = ci_975),width = 0,alpha = 1,color = ifelse(point_est_model4_var1$ci_025 * point_est_model4_var1$ci_975 < 0,nonsig_col,sig_col),size = 0.75) +
  geom_point(data = point_est_model4_var1,aes(x = 2.9, estim),alpha = 1,color = ifelse(point_est_model4_var1$ci_025 * point_est_model4_var1$ci_975 < 0,nonsig_col,sig_col),shape = 21,fill = ifelse(point_est_model4_var1$ci_025 * point_est_model4_var1$ci_975 < 0,nonsig_col,sig_col),size = ps,stroke = 1) +
  annotate(geom = "text",x = 2.9,y = point_est_model4_var1$estim,label = "3",col = "white",size = s,hjust = 0.5,alpha = 1) +
  
  geom_errorbar(data = point_est_model5_var1,aes(x = 2.7, ymin = ci_025, ymax = ci_975),width = 0,alpha = 1,color = ifelse(point_est_model5_var1$ci_025 * point_est_model5_var1$ci_975 < 0,nonsig_col,sig_col),size = 0.75) +
  geom_point(data = point_est_model5_var1,aes(x = 2.7, estim),alpha = 1,color = ifelse(point_est_model5_var1$ci_025 * point_est_model5_var1$ci_975 < 0,nonsig_col,sig_col),shape = 21,fill = ifelse(point_est_model5_var1$ci_025 * point_est_model5_var1$ci_975 < 0,nonsig_col,sig_col),size = ps,stroke = 1) +
  annotate(geom = "text",x = 2.7,y = point_est_model5_var1$estim,label = "4",col = "white",size = s,hjust = 0.5,alpha = 1) +
  

  
  #explain


  annotate(geom="text", x=3.5,    y=annotate_y, label="Main effect",   col="grey50", size=2.9, hjust = 1, alpha = 1) +
  geom_segment(aes(y=annotate_y,    x=3.5, yend = point_est_model1_var1$ci_025-0.01, xend = 3.5),size=0.3, col = "grey50", alpha=0.66, linetype=3) +  
    
  annotate(geom="text", x=1.3,    y=annotate_y, label="Mixing",   col="grey50", size=2.9, hjust = 1, alpha = 1) +
  geom_segment(aes(y=annotate_y,    x=1.3, yend = point_est_model2_var3$ci_025-0.01, xend = 1.3),size=0.3, col = "grey50", alpha=0.66, linetype=3) +
  
  annotate(geom="text", x=1.1,    y=annotate_y, label="Bonding",   col="grey50", size=2.9, hjust = 1, alpha = 1) +
  geom_segment(aes(y=annotate_y,    x=1.1, yend = point_est_model3_var3$ci_025-0.01, xend = 1.1),size=0.3, col = "grey50", alpha=0.66, linetype=3) +
  
  annotate(geom="text", x=0.9,    y=annotate_y, label="Incorporating",   col="grey50", size=2.9, hjust = 1, alpha = 1) +
  geom_segment(aes(y=annotate_y,    x=0.9, yend = point_est_model4_var3$ci_025-0.01, xend = 0.9),size=0.3, col = "grey50", alpha=0.66, linetype=3) +
  
  annotate(geom="text", x=0.7,    y=annotate_y, label="Combined",   col="grey50", size=2.9, hjust = 1, alpha = 1) +
  geom_segment(aes(y=annotate_y,    x=0.7, yend = point_est_model5_var3$ci_025-0.01, xend = 0.7),size=0.3, col = "grey50", alpha=0.66, linetype=3) +

  
  
  geom_vline(xintercept = 1.5, linetype="solid", alpha=0.7, color="black", size=0.2) +
  geom_vline(xintercept = 2.5, linetype="solid", alpha=0.7, color="black", size=0.2) +
  #geom_vline(xintercept = 3.425, linetype="solid", alpha=0.7, color="black", size=0.2) +
  #geom_vline(xintercept = 4.425, linetype="solid", alpha=0.7, color="black", size=0.2) +
  
  scale_x_continuous(breaks=(1:3), expand = c(0.05,0.05), labels=c("Gender\ndiversity \u00D7\nInclusion", "Inclusion", "Gender\ndiversity")) +
  #scale_y_continuous(breaks=c(-0.2, -0.1, 0, 0.1, 0.2, 0.3)) +
  #coord_cartesian(ylim = c(-0.2, 0.2)) +
  
   labs(y="Distinctiveness") +
  #ggtitle("a: Game level") + 
  scale_y_continuous(breaks=seq(-0.4, 0.2, 0.1), labels = dropLeadingZero)+
  coord_flip(ylim = c(-0.25, 0.11)) +
  theme(aspect.ratio=asp, 
            title =element_text(size=11),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(), 
            panel.background = element_blank(), 
            panel.border = element_rect(colour = "black", 
                                        fill=NA, 
                                        size=0.2),
            #legend.position = c(0.2, 0.3),
            plot.title = element_text(size = tit_s, face = "bold", colour = "black"),
            axis.ticks.y = element_blank(),
            axis.title.y = element_blank(),
            axis.text.y = element_text(size = 11, colour = "black"),
            plot.margin = unit(c(m_top,m_right,m_bottom,m_left), "mm")
            )
  

#grid.newpage()
ols_estim_gamelevel_notitle
```

```{r}
ggsave("ols_estim_gamelevel.pdf", ols_estim_gamelevel_notitle, width = 2.5, height = 2.5)
```



##Game level, with random effects

```{r}
confint.robust <- function (object, parm, level = 0.95, ...)
{
    cf <- coef(object)
    pnames <- names(cf)
    if (missing(parm))
        parm <- pnames
    else if (is.numeric(parm))
        parm <- pnames[parm]
    a <- (1 - level)/2
    a <- c(a, 1 - a)
    pct <- stats:::format.perc(a, 3)
    fac <- qnorm(a)
    ci <- array(NA, dim = c(length(parm), 2L), dimnames = list(parm,
        pct))
    ses <- sqrt(diag(sandwich::vcovHC(object, type = "HC1", cluster="group")))[parm]
    ci[] <- cf[parm] + ses %o% fac
    ci
}
```

```{r}
#get model coefs with 95% CI
point_est_model1_var1 <- data.frame(without_inclusion_re$coefficients[2] ,confint.robust(without_inclusion_re, 2, level=0.95))
colnames(point_est_model1_var1) <- c("estim", "ci_025", "ci_975")

point_est_model2_var1 <- data.frame(mixing_re$coefficients[2] ,confint.robust(mixing_re, 2, level=0.95))
colnames(point_est_model2_var1) <- c("estim", "ci_025", "ci_975")
point_est_model2_var2 <- data.frame(mixing_re$coefficients[3] ,confint.robust(mixing_re, 3, level=0.95))
colnames(point_est_model2_var2) <- c("estim", "ci_025", "ci_975")
point_est_model2_var3 <- data.frame(mixing_re$coefficients[32] ,confint.robust(mixing_re, 32, level=0.95))
colnames(point_est_model2_var3) <- c("estim", "ci_025", "ci_975")

point_est_model3_var1 <- data.frame(bonding_re$coefficients[2] ,confint.robust(bonding_re, 2, level=0.95))
colnames(point_est_model3_var1) <- c("estim", "ci_025", "ci_975")
point_est_model3_var2 <- data.frame(bonding_re$coefficients[3] ,confint.robust(bonding_re, 3, level=0.95))
colnames(point_est_model3_var2) <- c("estim", "ci_025", "ci_975")
point_est_model3_var3 <- data.frame(bonding_re$coefficients[32] ,confint.robust(bonding_re, 32, level=0.95))
colnames(point_est_model3_var3) <- c("estim", "ci_025", "ci_975")

point_est_model4_var1 <- data.frame(incorporating_re$coefficients[2] ,confint.robust(incorporating_re, 2, level=0.95))
colnames(point_est_model4_var1) <- c("estim", "ci_025", "ci_975")
point_est_model4_var2 <- data.frame(incorporating_re$coefficients[3] ,confint.robust(incorporating_re, 3, level=0.95))
colnames(point_est_model4_var2) <- c("estim", "ci_025", "ci_975")
point_est_model4_var3 <- data.frame(incorporating_re$coefficients[32] ,confint.robust(incorporating_re, 32, level=0.95))
colnames(point_est_model4_var3) <- c("estim", "ci_025", "ci_975")

point_est_model5_var1 <- data.frame(combined_re$coefficients[2] ,confint.robust(combined_re, 2, level=0.95))
colnames(point_est_model5_var1) <- c("estim", "ci_025", "ci_975")
point_est_model5_var2 <- data.frame(combined_re$coefficients[3] ,confint.robust(combined_re, 3, level=0.95))
colnames(point_est_model5_var2) <- c("estim", "ci_025", "ci_975")
point_est_model5_var3 <- data.frame(combined_re$coefficients[32] ,confint.robust(combined_re, 32, level=0.95))
colnames(point_est_model5_var3) <- c("estim", "ci_025", "ci_975")
```

```{r, fig.width = 2.2, fig.height = 2.6}

dropLeadingZero <- function(l){
  str_replace(l, '0(?=.)', '')
}

s <- 3.1
ps <- 2.85
tit_s <- 12
asp <- 1
annotate_y <- -0.07

m_top <- 2
m_left <-0
m_bottom <- 0
m_right <- 0

nonsig_col <- "gray60"
sig_col <- "black"

ols_estim_gamelevel_re <- ggplot()+
  geom_hline(yintercept = 0, linetype="dashed", alpha=0.7, color="black", size=0.2) +
  
   #prop women X inclusion

  geom_errorbar(
    data = point_est_model2_var3,
    aes(x = 1.3, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model2_var3$ci_025 * point_est_model2_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model2_var3,
    aes(x = 1.3, estim),
    alpha = 1,
    color = ifelse(
      point_est_model2_var3$ci_025 * point_est_model2_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model2_var3$ci_025 * point_est_model2_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 1.3,
    y = point_est_model2_var3$estim,
    label = "1",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  
  geom_errorbar(
    data = point_est_model3_var3,
    aes(x = 1.1, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model3_var3$ci_025 * point_est_model3_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model3_var3,
    aes(x = 1.1, estim),
    alpha = 1,
    color = ifelse(
      point_est_model3_var3$ci_025 * point_est_model3_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model3_var3$ci_025 * point_est_model3_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 1.1,
    y = point_est_model3_var3$estim,
    label = "2",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  
  geom_errorbar(
    data = point_est_model4_var3,
    aes(x = 0.9, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model4_var3$ci_025 * point_est_model4_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model4_var3,
    aes(x = 0.9, estim),
    alpha = 1,
    color = ifelse(
      point_est_model4_var3$ci_025 * point_est_model4_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model4_var3$ci_025 * point_est_model4_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 0.9,
    y = point_est_model4_var3$estim,
    label = "3",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  
  geom_errorbar(
    data = point_est_model5_var3,
    aes(x = 0.7, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model5_var3$ci_025 * point_est_model5_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model5_var3,
    aes(x = 0.7, estim),
    alpha = 1,
    color = ifelse(
      point_est_model5_var3$ci_025 * point_est_model5_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model5_var3$ci_025 * point_est_model5_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 0.7,
    y = point_est_model5_var3$estim,
    label = "4",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  
  
  #inclusion

  
  geom_errorbar(
    data = point_est_model2_var2,
    aes(x = 2.3, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model2_var2$ci_025 * point_est_model2_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model2_var2,
    aes(x = 2.3, estim),
    alpha = 1,
    color = ifelse(
      point_est_model2_var2$ci_025 * point_est_model2_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model2_var2$ci_025 * point_est_model2_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 2.3,
    y = point_est_model2_var2$estim,
    label = "1",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  
  geom_errorbar(
    data = point_est_model3_var2,
    aes(x = 2.1, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model3_var2$ci_025 * point_est_model3_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model3_var2,
    aes(x = 2.1, estim),
    alpha = 1,
    color = ifelse(
      point_est_model3_var2$ci_025 * point_est_model3_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model3_var2$ci_025 * point_est_model3_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 2.1,
    y = point_est_model3_var2$estim,
    label = "2",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  
  geom_errorbar(
    data = point_est_model4_var2,
    aes(x = 1.9, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model4_var2$ci_025 * point_est_model4_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model4_var2,
    aes(x = 1.9, estim),
    alpha = 1,
    color = ifelse(
      point_est_model4_var2$ci_025 * point_est_model4_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model4_var2$ci_025 * point_est_model4_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 1.9,
    y = point_est_model4_var2$estim,
    label = "3",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  
  geom_errorbar(
    data = point_est_model5_var2,
    aes(x = 1.7, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model5_var2$ci_025 * point_est_model5_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model5_var2,
    aes(x = 1.7, estim),
    alpha = 1,
    color = ifelse(
      point_est_model5_var2$ci_025 * point_est_model5_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model5_var2$ci_025 * point_est_model5_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 1.7,
    y = point_est_model5_var2$estim,
    label = "4",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  

  
  #prop women

  
    
  geom_errorbar(
    data = point_est_model1_var1,
    aes(x = 3.5, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = "red",
    size = 0.75
  ) +
  geom_point(
    data = point_est_model1_var1,
    aes(x = 3.5, estim),
    alpha = 1,
    color = "red",
    shape = 21,
    fill = "red",
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 3.5,
    y = point_est_model1_var1$estim,
    label = "0",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  
  geom_errorbar(
    data = point_est_model2_var1,
    aes(x = 3.3, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model2_var1$ci_025 * point_est_model2_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model2_var1,
    aes(x = 3.3, estim),
    alpha = 1,
    color = ifelse(
      point_est_model2_var1$ci_025 * point_est_model2_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model2_var1$ci_025 * point_est_model2_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 3.3,
    y = point_est_model2_var1$estim,
    label = "1",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  
  geom_errorbar(
    data = point_est_model3_var1,
    aes(x = 3.1, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model3_var1$ci_025 * point_est_model3_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model3_var1,
    aes(x = 3.1, estim),
    alpha = 1,
    color = ifelse(
      point_est_model3_var1$ci_025 * point_est_model3_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model3_var1$ci_025 * point_est_model3_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 3.1,
    y = point_est_model3_var1$estim,
    label = "2",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  
  geom_errorbar(
    data = point_est_model4_var1,
    aes(x = 2.9, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model4_var1$ci_025 * point_est_model4_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model4_var1,
    aes(x = 2.9, estim),
    alpha = 1,
    color = ifelse(
      point_est_model4_var1$ci_025 * point_est_model4_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model4_var1$ci_025 * point_est_model4_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 2.9,
    y = point_est_model4_var1$estim,
    label = "3",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  
  geom_errorbar(
    data = point_est_model5_var1,
    aes(x = 2.7, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model5_var1$ci_025 * point_est_model5_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model5_var1,
    aes(x = 2.7, estim),
    alpha = 1,
    color = ifelse(
      point_est_model5_var1$ci_025 * point_est_model5_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model5_var1$ci_025 * point_est_model5_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 2.7,
    y = point_est_model5_var1$estim,
    label = "4",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  

  
  #explain


  # annotate(geom="text", x=3.5,    y=annotate_y, label="Main effect",   col="grey50", size=2.9, hjust = 1, alpha = 1) +
  # geom_segment(aes(y=annotate_y,    x=3.5, yend = point_est_model1_var1$ci_025-0.01, xend = 3.5),size=0.3, col = "grey50", alpha=0.66, linetype=3) +  
  #   
  # annotate(geom="text", x=1.3,    y=annotate_y, label="Mixing",   col="grey50", size=2.9, hjust = 1, alpha = 1) +
  # geom_segment(aes(y=annotate_y,    x=1.3, yend = point_est_model2_var3$ci_025-0.01, xend = 1.3),size=0.3, col = "grey50", alpha=0.66, linetype=3) +
  # 
  # annotate(geom="text", x=1.1,    y=annotate_y, label="Bonding",   col="grey50", size=2.9, hjust = 1, alpha = 1) +
  # geom_segment(aes(y=annotate_y,    x=1.1, yend = point_est_model3_var3$ci_025-0.01, xend = 1.1),size=0.3, col = "grey50", alpha=0.66, linetype=3) +
  # 
  # annotate(geom="text", x=0.9,    y=annotate_y, label="Incorporating",   col="grey50", size=2.9, hjust = 1, alpha = 1) +
  # geom_segment(aes(y=annotate_y,    x=0.9, yend = point_est_model4_var3$ci_025-0.01, xend = 0.9),size=0.3, col = "grey50", alpha=0.66, linetype=3) +
  # 
  # annotate(geom="text", x=0.7,    y=annotate_y, label="Combined",   col="grey50", size=2.9, hjust = 1, alpha = 1) +
  # geom_segment(aes(y=annotate_y,    x=0.7, yend = point_est_model5_var3$ci_025-0.01, xend = 0.7),size=0.3, col = "grey50", alpha=0.66, linetype=3) +

  
  
  geom_vline(xintercept = 1.5, linetype="solid", alpha=0.7, color="black", size=0.2) +
  geom_vline(xintercept = 2.5, linetype="solid", alpha=0.7, color="black", size=0.2) +
  #geom_vline(xintercept = 3.425, linetype="solid", alpha=0.7, color="black", size=0.2) +
  #geom_vline(xintercept = 4.425, linetype="solid", alpha=0.7, color="black", size=0.2) +
  
  scale_x_continuous(breaks=(1:3), expand = c(0.05,0.05)
                     #, labels=c("Gender\ndiversity \u00D7\nInclusion", "Inclusion", "Gender\ndiversity")
                     , labels=c("","","")
                     ) +
  #scale_y_continuous(breaks=c(-0.2, -0.1, 0, 0.1, 0.2, 0.3)) +
  #coord_cartesian(ylim = c(-0.2, 0.2)) +
  
   labs(y="Distinctiveness") +
  ggtitle("b: Game level, firm RE") + 
  scale_y_continuous(breaks=seq(-0.4, 0.2, 0.1), labels = dropLeadingZero)+
  coord_flip(ylim = c(-0.25, 0.12)) +
  theme(aspect.ratio=asp, 
            title =element_text(size=11),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(), 
            panel.background = element_blank(), 
            panel.border = element_rect(colour = "black", 
                                        fill=NA, 
                                        size=0.2),
            #legend.position = c(0.2, 0.3),
            plot.title = element_text(size = tit_s, face = "bold", colour = "black"),
            axis.ticks.y = element_blank(),
            axis.title.y = element_blank(),
            axis.text.y = element_text(size = 11, colour = "black"),
            plot.margin = unit(c(m_top,m_right,m_bottom,m_left), "mm")
            )
  

#grid.newpage()
ols_estim_gamelevel_re
```

##Game level, with fixed intercepts

```{r}
#get model coefs with 95% CI
point_est_model1_var1 <- data.frame(without_inclusion_fe_2$coefficients[1] ,confint(without_inclusion_fe_2, 2, level=0.95))
colnames(point_est_model1_var1) <- c("estim", "ci_025", "ci_975")

point_est_model2_var1 <- data.frame(mixing_fe_2$coefficients[1] ,confint.robust(mixing_fe_2, 1, level=0.95))
colnames(point_est_model2_var1) <- c("estim", "ci_025", "ci_975")
point_est_model2_var2 <- data.frame(mixing_fe_2$coefficients[2] ,confint.robust(mixing_fe_2, 2, level=0.95))
colnames(point_est_model2_var2) <- c("estim", "ci_025", "ci_975")
point_est_model2_var3 <- data.frame(mixing_fe_2$coefficients[31] ,confint.robust(mixing_fe_2, 31, level=0.95))
colnames(point_est_model2_var3) <- c("estim", "ci_025", "ci_975")

point_est_model3_var1 <- data.frame(bonding_fe_2$coefficients[1] ,confint.robust(bonding_fe_2, 1, level=0.95))
colnames(point_est_model3_var1) <- c("estim", "ci_025", "ci_975")
point_est_model3_var2 <- data.frame(bonding_fe_2$coefficients[2] ,confint.robust(bonding_fe_2, 2, level=0.95))
colnames(point_est_model3_var2) <- c("estim", "ci_025", "ci_975")
point_est_model3_var3 <- data.frame(bonding_fe_2$coefficients[31] ,confint.robust(bonding_fe_2, 31, level=0.95))
colnames(point_est_model3_var3) <- c("estim", "ci_025", "ci_975")

point_est_model4_var1 <- data.frame(incorporating_fe_2$coefficients[1] ,confint.robust(incorporating_fe_2, 1, level=0.95))
colnames(point_est_model4_var1) <- c("estim", "ci_025", "ci_975")
point_est_model4_var2 <- data.frame(incorporating_fe_2$coefficients[2] ,confint.robust(incorporating_fe_2, 2, level=0.95))
colnames(point_est_model4_var2) <- c("estim", "ci_025", "ci_975")
point_est_model4_var3 <- data.frame(incorporating_fe_2$coefficients[31] ,confint.robust(incorporating_fe_2, 31, level=0.95))
colnames(point_est_model4_var3) <- c("estim", "ci_025", "ci_975")

point_est_model5_var1 <- data.frame(combined_fe_2$coefficients[1] ,confint.robust(combined_fe_2, 1, level=0.95))
colnames(point_est_model5_var1) <- c("estim", "ci_025", "ci_975")
point_est_model5_var2 <- data.frame(combined_fe_2$coefficients[2] ,confint.robust(combined_fe_2, 2, level=0.95))
colnames(point_est_model5_var2) <- c("estim", "ci_025", "ci_975")
point_est_model5_var3 <- data.frame(combined_fe_2$coefficients[31] ,confint.robust(combined_fe_2, 31, level=0.95))
colnames(point_est_model5_var3) <- c("estim", "ci_025", "ci_975")
```

```{r, fig.width = 2.2, fig.height = 2.6}

dropLeadingZero <- function(l){
  str_replace(l, '0(?=.)', '')
}

s <- 3.1
ps <- 2.85
tit_s <- 12
asp <- 1
annotate_y <- -0.07 


m_top <- 2
m_left <-0
m_bottom <- 0
m_right <- 0

nonsig_col <- "gray60"
sig_col <- "black"

ols_estim_gamelevel_fe <- ggplot()+
  geom_hline(yintercept = 0, linetype="dashed", alpha=0.7, color="black", size=0.2) +
  
   #prop women X inclusion

  geom_errorbar(
    data = point_est_model2_var3,
    aes(x = 1.3, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model2_var3$ci_025 * point_est_model2_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model2_var3,
    aes(x = 1.3, estim),
    alpha = 1,
    color = ifelse(
      point_est_model2_var3$ci_025 * point_est_model2_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model2_var3$ci_025 * point_est_model2_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 1.3,
    y = point_est_model2_var3$estim,
    label = "1",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  
  geom_errorbar(
    data = point_est_model3_var3,
    aes(x = 1.1, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model3_var3$ci_025 * point_est_model3_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model3_var3,
    aes(x = 1.1, estim),
    alpha = 1,
    color = ifelse(
      point_est_model3_var3$ci_025 * point_est_model3_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model3_var3$ci_025 * point_est_model3_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 1.1,
    y = point_est_model3_var3$estim,
    label = "2",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  
  geom_errorbar(
    data = point_est_model4_var3,
    aes(x = 0.9, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model4_var3$ci_025 * point_est_model4_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model4_var3,
    aes(x = 0.9, estim),
    alpha = 1,
    color = ifelse(
      point_est_model4_var3$ci_025 * point_est_model4_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model4_var3$ci_025 * point_est_model4_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 0.9,
    y = point_est_model4_var3$estim,
    label = "3",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  
  geom_errorbar(
    data = point_est_model5_var3,
    aes(x = 0.7, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model5_var3$ci_025 * point_est_model5_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model5_var3,
    aes(x = 0.7, estim),
    alpha = 1,
    color = ifelse(
      point_est_model5_var3$ci_025 * point_est_model5_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model5_var3$ci_025 * point_est_model5_var3$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 0.7,
    y = point_est_model5_var3$estim,
    label = "4",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  
  
  #inclusion

  
  geom_errorbar(
    data = point_est_model2_var2,
    aes(x = 2.3, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model2_var2$ci_025 * point_est_model2_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model2_var2,
    aes(x = 2.3, estim),
    alpha = 1,
    color = ifelse(
      point_est_model2_var2$ci_025 * point_est_model2_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model2_var2$ci_025 * point_est_model2_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 2.3,
    y = point_est_model2_var2$estim,
    label = "1",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  
  geom_errorbar(
    data = point_est_model3_var2,
    aes(x = 2.1, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model3_var2$ci_025 * point_est_model3_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model3_var2,
    aes(x = 2.1, estim),
    alpha = 1,
    color = ifelse(
      point_est_model3_var2$ci_025 * point_est_model3_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model3_var2$ci_025 * point_est_model3_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 2.1,
    y = point_est_model3_var2$estim,
    label = "2",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  
  geom_errorbar(
    data = point_est_model4_var2,
    aes(x = 1.9, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model4_var2$ci_025 * point_est_model4_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model4_var2,
    aes(x = 1.9, estim),
    alpha = 1,
    color = ifelse(
      point_est_model4_var2$ci_025 * point_est_model4_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model4_var2$ci_025 * point_est_model4_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 1.9,
    y = point_est_model4_var2$estim,
    label = "3",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  
  geom_errorbar(
    data = point_est_model5_var2,
    aes(x = 1.7, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model5_var2$ci_025 * point_est_model5_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model5_var2,
    aes(x = 1.7, estim),
    alpha = 1,
    color = ifelse(
      point_est_model5_var2$ci_025 * point_est_model5_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model5_var2$ci_025 * point_est_model5_var2$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 1.7,
    y = point_est_model5_var2$estim,
    label = "4",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  

  
  #prop women

  
    
  geom_errorbar(
    data = point_est_model1_var1,
    aes(x = 3.5, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = "red",
    size = 0.75
  ) +
  geom_point(
    data = point_est_model1_var1,
    aes(x = 3.5, estim),
    alpha = 1,
    color = "red",
    shape = 21,
    fill = "red",
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 3.5,
    y = point_est_model1_var1$estim,
    label = "0",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  
  geom_errorbar(
    data = point_est_model2_var1,
    aes(x = 3.3, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model2_var1$ci_025 * point_est_model2_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model2_var1,
    aes(x = 3.3, estim),
    alpha = 1,
    color = ifelse(
      point_est_model2_var1$ci_025 * point_est_model2_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model2_var1$ci_025 * point_est_model2_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 3.3,
    y = point_est_model2_var1$estim,
    label = "1",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  
  geom_errorbar(
    data = point_est_model3_var1,
    aes(x = 3.1, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model3_var1$ci_025 * point_est_model3_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model3_var1,
    aes(x = 3.1, estim),
    alpha = 1,
    color = ifelse(
      point_est_model3_var1$ci_025 * point_est_model3_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model3_var1$ci_025 * point_est_model3_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 3.1,
    y = point_est_model3_var1$estim,
    label = "2",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  
  geom_errorbar(
    data = point_est_model4_var1,
    aes(x = 2.9, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model4_var1$ci_025 * point_est_model4_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model4_var1,
    aes(x = 2.9, estim),
    alpha = 1,
    color = ifelse(
      point_est_model4_var1$ci_025 * point_est_model4_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model4_var1$ci_025 * point_est_model4_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 2.9,
    y = point_est_model4_var1$estim,
    label = "3",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  
  geom_errorbar(
    data = point_est_model5_var1,
    aes(x = 2.7, ymin = ci_025, ymax = ci_975),
    width = 0,
    alpha = 1,
    color = ifelse(
      point_est_model5_var1$ci_025 * point_est_model5_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = 0.75
  ) +
  geom_point(
    data = point_est_model5_var1,
    aes(x = 2.7, estim),
    alpha = 1,
    color = ifelse(
      point_est_model5_var1$ci_025 * point_est_model5_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    shape = 21,
    fill = ifelse(
      point_est_model5_var1$ci_025 * point_est_model5_var1$ci_975 < 0,
      nonsig_col,
      sig_col
    ),
    size = ps,
    stroke = 1
  ) +
  annotate(
    geom = "text",
    x = 2.7,
    y = point_est_model5_var1$estim,
    label = "4",
    col = "white",
    size = s,
    hjust = 0.5,
    alpha = 1
  ) +
  

  
  #explain


  # annotate(geom="text", x=3.5,    y=annotate_y, label="Main effect",   col="grey50", size=2.9, hjust = 1, alpha = 1) +
  # geom_segment(aes(y=annotate_y,    x=3.5, yend = point_est_model1_var1$ci_025-0.01, xend = 3.5),size=0.3, col = "grey50", alpha=0.66, linetype=3) +  
  #   
  # annotate(geom="text", x=1.3,    y=annotate_y, label="Mixing",   col="grey50", size=2.9, hjust = 1, alpha = 1) +
  # geom_segment(aes(y=annotate_y,    x=1.3, yend = point_est_model2_var3$ci_025-0.01, xend = 1.3),size=0.3, col = "grey50", alpha=0.66, linetype=3) +
  # 
  # annotate(geom="text", x=1.1,    y=annotate_y, label="Bonding",   col="grey50", size=2.9, hjust = 1, alpha = 1) +
  # geom_segment(aes(y=annotate_y,    x=1.1, yend = point_est_model3_var3$ci_025-0.01, xend = 1.1),size=0.3, col = "grey50", alpha=0.66, linetype=3) +
  # 
  # annotate(geom="text", x=0.9,    y=annotate_y, label="Incorporating",   col="grey50", size=2.9, hjust = 1, alpha = 1) +
  # geom_segment(aes(y=annotate_y,    x=0.9, yend = point_est_model4_var3$ci_025-0.01, xend = 0.9),size=0.3, col = "grey50", alpha=0.66, linetype=3) +
  # 
  # annotate(geom="text", x=0.7,    y=annotate_y, label="Combined",   col="grey50", size=2.9, hjust = 1, alpha = 1) +
  # geom_segment(aes(y=annotate_y,    x=0.7, yend = point_est_model5_var3$ci_025-0.01, xend = 0.7),size=0.3, col = "grey50", alpha=0.66, linetype=3) +

  
  
  geom_vline(xintercept = 1.5, linetype="solid", alpha=0.7, color="black", size=0.2) +
  geom_vline(xintercept = 2.5, linetype="solid", alpha=0.7, color="black", size=0.2) +
  #geom_vline(xintercept = 3.425, linetype="solid", alpha=0.7, color="black", size=0.2) +
  #geom_vline(xintercept = 4.425, linetype="solid", alpha=0.7, color="black", size=0.2) +
  
  scale_x_continuous(breaks=(1:3), expand = c(0.05,0.05)
                     #, labels=c("Gender\ndiversity \u00D7\nInclusion", "Inclusion", "Gender\ndiversity")
                     , labels=c("","","")
                     ) +
  #scale_y_continuous(breaks=c(-0.2, -0.1, 0, 0.1, 0.2, 0.3)) +
  #coord_cartesian(ylim = c(-0.2, 0.2)) +
  
   labs(y="Distinctiveness") +
  ggtitle("c: Game level, firm FE") + 
  scale_y_continuous(breaks=seq(-0.4, 0.2, 0.1), labels = dropLeadingZero)+
  coord_flip(ylim = c(-0.25, 0.12)) +
  theme(aspect.ratio=asp, 
            title =element_text(size=11),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(), 
            panel.background = element_blank(), 
            panel.border = element_rect(colour = "black", 
                                        fill=NA, 
                                        size=0.2),
            #legend.position = c(0.2, 0.3),
            plot.title = element_text(size = tit_s, colour = "black", face = "bold"),
            axis.ticks.y = element_blank(),
            axis.title.y = element_blank(),
            axis.text.y = element_text(size = 11, colour = "black"),
            plot.margin = unit(c(m_top,m_right,m_bottom,m_left), "mm")
            )
  

#grid.newpage()
ols_estim_gamelevel_fe
```

##Firm level, STD

```{r}
confint.robust <- function (object, parm, level = 0.95, ...)
{
    cf <- coef(object)
    pnames <- names(cf)
    if (missing(parm))
        parm <- pnames
    else if (is.numeric(parm))
        parm <- pnames[parm]
    a <- (1 - level)/2
    a <- c(a, 1 - a)
    pct <- stats:::format.perc(a, 3)
    fac <- qnorm(a)
    ci <- array(NA, dim = c(length(parm), 2L), dimnames = list(parm,
        pct))
    ses <- sqrt(diag(sandwich::vcovHC(object, type = "HC1")))[parm]
    ci[] <- cf[parm] + ses %o% fac
    ci
}
```

```{r}
#get model coefs with 95% CI
point_est_model1_var1 <- data.frame(without_inclusion_aggr_z$coefficients[2] ,confint.robust(without_inclusion_aggr_z, 2, level=0.95))
colnames(point_est_model1_var1) <- c("estim", "ci_025", "ci_975")


point_est_model2_var1 <- data.frame(mixing_aggr_z$coefficients[2] ,confint.robust(mixing_aggr_z, 2, level=0.95))
colnames(point_est_model2_var1) <- c("estim", "ci_025", "ci_975")
point_est_model2_var2 <- data.frame(mixing_aggr_z$coefficients[3] ,confint.robust(mixing_aggr_z, 3, level=0.95))
colnames(point_est_model2_var2) <- c("estim", "ci_025", "ci_975")
point_est_model2_var3 <- data.frame(mixing_aggr_z$coefficients[32] ,confint.robust(mixing_aggr_z, 32, level=0.95))
colnames(point_est_model2_var3) <- c("estim", "ci_025", "ci_975")

point_est_model3_var1 <- data.frame(bonding_aggr_z$coefficients[2] ,confint.robust(bonding_aggr_z, 2, level=0.95))
colnames(point_est_model3_var1) <- c("estim", "ci_025", "ci_975")
point_est_model3_var2 <- data.frame(bonding_aggr_z$coefficients[3] ,confint.robust(bonding_aggr_z, 3, level=0.95))
colnames(point_est_model3_var2) <- c("estim", "ci_025", "ci_975")
point_est_model3_var3 <- data.frame(bonding_aggr_z$coefficients[32] ,confint.robust(bonding_aggr_z, 32, level=0.95))
colnames(point_est_model3_var3) <- c("estim", "ci_025", "ci_975")

point_est_model4_var1 <- data.frame(incorporating_aggr_z$coefficients[2] ,confint.robust(incorporating_aggr_z, 2, level=0.95))
colnames(point_est_model4_var1) <- c("estim", "ci_025", "ci_975")
point_est_model4_var2 <- data.frame(incorporating_aggr_z$coefficients[3] ,confint.robust(incorporating_aggr_z, 3, level=0.95))
colnames(point_est_model4_var2) <- c("estim", "ci_025", "ci_975")
point_est_model4_var3 <- data.frame(incorporating_aggr_z$coefficients[32] ,confint.robust(incorporating_aggr_z, 32, level=0.95))
colnames(point_est_model4_var3) <- c("estim", "ci_025", "ci_975")

point_est_model5_var1 <- data.frame(combined_aggr_z$coefficients[2] ,confint.robust(combined_aggr_z, 2, level=0.95))
colnames(point_est_model5_var1) <- c("estim", "ci_025", "ci_975")
point_est_model5_var2 <- data.frame(combined_aggr_z$coefficients[3] ,confint.robust(combined_aggr_z, 3, level=0.95))
colnames(point_est_model5_var2) <- c("estim", "ci_025", "ci_975")
point_est_model5_var3 <- data.frame(combined_aggr_z$coefficients[32] ,confint.robust(combined_aggr_z, 32, level=0.95))
colnames(point_est_model5_var3) <- c("estim", "ci_025", "ci_975")
```

```{r, fig.width = 2.2, fig.height = 2.6}
dropLeadingZero <- function(l){
  str_replace(l, '0(?=.)', '')
}


s <- 3.1
ps <- 2.85
tit_s <- 12
asp <- 1
annotate_y <- -0.07

m_top <- 2
m_left <-0
m_bottom <- 0
m_right <- 0

ols_estim_firmlevel <- ggplot()+
  geom_hline(yintercept = 0, linetype="dashed", alpha=0.7, color="black", size=0.2) +
  
  #prop women X inclusion

  geom_errorbar(data = point_est_model2_var3, aes(x = 1.3, ymin = ci_025, ymax = ci_975), width=0, alpha=1, color = ifelse(point_est_model2_var3$ci_025 * point_est_model2_var3$ci_975 < 0,nonsig_col,sig_col), size=0.75) +
  geom_point(   data = point_est_model2_var3, aes(x = 1.3, estim), alpha=1, color = ifelse(point_est_model2_var3$ci_025 * point_est_model2_var3$ci_975 < 0,nonsig_col,sig_col), shape=21, fill= ifelse(point_est_model2_var3$ci_025 * point_est_model2_var3$ci_975 < 0,nonsig_col,sig_col), size=ps, stroke=1) +
  annotate(geom="text", x=1.3,    y=point_est_model2_var3$estim, label="1",   col="white", size=s, hjust = 0.5, alpha = 1) +
  
  geom_errorbar(data = point_est_model3_var3, aes(x=1.1, ymin = ci_025, ymax = ci_975), width=0, alpha=1, color = ifelse(point_est_model3_var3$ci_025 * point_est_model3_var3$ci_975 < 0,nonsig_col,sig_col), size=0.75) +
  geom_point(   data = point_est_model3_var3, aes(x=1.1, estim), alpha=1, color = ifelse(point_est_model3_var3$ci_025 * point_est_model3_var3$ci_975 < 0,nonsig_col,sig_col), shape=21, fill=ifelse(point_est_model3_var3$ci_025 * point_est_model3_var3$ci_975 < 0,nonsig_col,sig_col), size=ps, stroke=1) +
  annotate(geom="text", x=1.1,    y=point_est_model3_var3$estim, label="2",   col="white", size=s, hjust = 0.5, alpha = 1) +
  
  geom_errorbar(data = point_est_model4_var3, aes(x = 0.9, ymin = ci_025, ymax = ci_975), width=0, alpha=1, color=ifelse(point_est_model4_var3$ci_025 * point_est_model4_var3$ci_975 < 0,nonsig_col,sig_col), size=0.75) +
  geom_point(   data = point_est_model4_var3, aes(x = 0.9, estim), alpha=1, color=ifelse(point_est_model4_var3$ci_025 * point_est_model4_var3$ci_975 < 0,nonsig_col,sig_col), shape=21, fill=ifelse(point_est_model4_var3$ci_025 * point_est_model4_var3$ci_975 < 0,nonsig_col,sig_col), size=ps, stroke=1) +
  annotate(geom="text", x=0.9,    y=point_est_model4_var3$estim, label="3",   col="white", size=s, hjust = 0.5, alpha = 1) +
  
  geom_errorbar(data = point_est_model5_var3, aes(x = 0.7, ymin = ci_025, ymax = ci_975), width=0, alpha=1, color=ifelse(point_est_model5_var3$ci_025 * point_est_model5_var3$ci_975 < 0,nonsig_col,sig_col), size=0.75) +
  geom_point(   data = point_est_model5_var3, aes(x = 0.7, estim), alpha=1, color=ifelse(point_est_model5_var3$ci_025 * point_est_model5_var3$ci_975 < 0,nonsig_col,sig_col), shape=21, fill=ifelse(point_est_model5_var3$ci_025 * point_est_model5_var3$ci_975 < 0,nonsig_col,sig_col), size=ps, stroke=1) +
  annotate(geom="text", x=0.7,    y=point_est_model5_var3$estim, label="4",   col="white", size=s, hjust = 0.5, alpha = 1) +
  
  
  #inclusion

  
  geom_errorbar(data = point_est_model2_var2, aes(x = 2.3, ymin = ci_025, ymax = ci_975), width=0, alpha=1, color=ifelse(point_est_model2_var2$ci_025 * point_est_model2_var2$ci_975 < 0,nonsig_col,sig_col), size=0.75) +
  geom_point(   data = point_est_model2_var2, aes(x = 2.3, estim), alpha=1, color=ifelse(point_est_model2_var2$ci_025 * point_est_model2_var2$ci_975 < 0,nonsig_col,sig_col), shape=21, fill=ifelse(point_est_model2_var2$ci_025 * point_est_model2_var2$ci_975 < 0,nonsig_col,sig_col), size=ps, stroke=1) +
  annotate(geom="text", x=2.3,    y=point_est_model2_var2$estim, label="1",   col="white", size=s, hjust = 0.5, alpha = 1) +
  
  geom_errorbar(data = point_est_model3_var2, aes(x=2.1, ymin = ci_025, ymax = ci_975), width=0, alpha=1, color=ifelse(point_est_model3_var2$ci_025 * point_est_model3_var2$ci_975 < 0,nonsig_col,sig_col), size=0.75) +
  geom_point(   data = point_est_model3_var2, aes(x=2.1, estim), alpha=1, color=ifelse(point_est_model3_var2$ci_025 * point_est_model3_var2$ci_975 < 0,nonsig_col,sig_col), shape=21, fill=ifelse(point_est_model3_var2$ci_025 * point_est_model3_var2$ci_975 < 0,nonsig_col,sig_col), size=ps, stroke=1) +
  annotate(geom="text", x=2.1,    y=point_est_model3_var2$estim, label="2",   col="white", size=s, hjust = 0.5, alpha = 1) +
  
  geom_errorbar(data = point_est_model4_var2, aes(x = 1.9, ymin = ci_025, ymax = ci_975), width=0, alpha=1, color=ifelse(point_est_model4_var2$ci_025 * point_est_model4_var2$ci_975 < 0,nonsig_col,sig_col), size=0.75) +
  geom_point(   data = point_est_model4_var2, aes(x = 1.9, estim), alpha=1, color=ifelse(point_est_model4_var2$ci_025 * point_est_model4_var2$ci_975 < 0,nonsig_col,sig_col), shape=21, fill=ifelse(point_est_model4_var2$ci_025 * point_est_model4_var2$ci_975 < 0,nonsig_col,sig_col), size=ps, stroke=1) +
  annotate(geom="text", x=1.9,    y=point_est_model4_var2$estim, label="3",   col="white", size=s, hjust = 0.5, alpha = 1) +
  
  geom_errorbar(data = point_est_model5_var2, aes(x = 1.7, ymin = ci_025, ymax = ci_975), width=0, alpha=1, color=ifelse(point_est_model5_var2$ci_025 * point_est_model5_var2$ci_975 < 0,nonsig_col,sig_col), size=0.75) +
  geom_point(   data = point_est_model5_var2, aes(x = 1.7, estim), alpha=1, color=ifelse(point_est_model5_var2$ci_025 * point_est_model5_var2$ci_975 < 0,nonsig_col,sig_col), shape=21, fill=ifelse(point_est_model5_var2$ci_025 * point_est_model5_var2$ci_975 < 0,nonsig_col,sig_col), size=ps, stroke=1) +
  annotate(geom="text", x=1.7,    y=point_est_model5_var2$estim, label="4",   col="white", size=s, hjust = 0.5, alpha = 1) +
  

  
  #prop women

  
    
  geom_errorbar(data = point_est_model1_var1, aes(x = 3.5, ymin = ci_025, ymax = ci_975), width=0, alpha=1, color="red", size=0.75) +
  geom_point(   data = point_est_model1_var1, aes(x = 3.5, estim), alpha=1, color="red", shape=21, fill="red", size=ps, stroke=1) +
  annotate(geom="text", x=3.5,    y=point_est_model1_var1$estim, label="0",   col="white", size=s, hjust = 0.5, alpha = 1) +
  
  geom_errorbar(data = point_est_model2_var1, aes(x = 3.3, ymin = ci_025, ymax = ci_975), width=0, alpha=1, color=ifelse(point_est_model2_var1$ci_025 * point_est_model2_var1$ci_975 < 0,nonsig_col,sig_col), size=0.75) +
  geom_point(   data = point_est_model2_var1, aes(x = 3.3, estim), alpha=1, color=ifelse(point_est_model2_var1$ci_025 * point_est_model2_var1$ci_975 < 0,nonsig_col,sig_col), shape=21, fill=ifelse(point_est_model2_var1$ci_025 * point_est_model2_var1$ci_975 < 0,nonsig_col,sig_col), size=ps, stroke=1) +
  annotate(geom="text", x=3.3,    y=point_est_model2_var1$estim, label="1",   col="white", size=s, hjust = 0.5, alpha = 1) +
  
  geom_errorbar(data = point_est_model3_var1, aes(x=3.1, ymin = ci_025, ymax = ci_975), width=0, alpha=1, color=ifelse(point_est_model3_var1$ci_025 * point_est_model3_var1$ci_975 < 0,nonsig_col,sig_col), size=0.75) +
  geom_point(   data = point_est_model3_var1, aes(x=3.1, estim), alpha=1, color=ifelse(point_est_model3_var1$ci_025 * point_est_model3_var1$ci_975 < 0,nonsig_col,sig_col), shape=21, fill=ifelse(point_est_model3_var1$ci_025 * point_est_model3_var1$ci_975 < 0,nonsig_col,sig_col), size=ps, stroke=1) +
  annotate(geom="text", x=3.1,    y=point_est_model3_var1$estim, label="2",   col="white", size=s, hjust = 0.5, alpha = 1) +
  
  geom_errorbar(data = point_est_model4_var1, aes(x = 2.9, ymin = ci_025, ymax = ci_975), width=0, alpha=1, color=ifelse(point_est_model4_var1$ci_025 * point_est_model4_var1$ci_975 < 0,nonsig_col,sig_col), size=0.75) +
  geom_point(   data = point_est_model4_var1, aes(x = 2.9, estim), alpha=1, color=ifelse(point_est_model4_var1$ci_025 * point_est_model4_var1$ci_975 < 0,nonsig_col,sig_col), shape=21, fill=ifelse(point_est_model4_var1$ci_025 * point_est_model4_var1$ci_975 < 0,nonsig_col,sig_col), size=ps, stroke=1) +
  annotate(geom="text", x=2.9,    y=point_est_model4_var1$estim, label="3",   col="white", size=s, hjust = 0.5, alpha = 1) +
  
  geom_errorbar(data = point_est_model5_var1, aes(x = 2.7, ymin = ci_025, ymax = ci_975), width=0, alpha=1, color=ifelse(point_est_model5_var1$ci_025 * point_est_model5_var1$ci_975 < 0,nonsig_col,sig_col), size=0.75) +
  geom_point(   data = point_est_model5_var1, aes(x = 2.7, estim), alpha=1, color=ifelse(point_est_model5_var1$ci_025 * point_est_model5_var1$ci_975 < 0,nonsig_col,sig_col), shape=21, fill=ifelse(point_est_model5_var1$ci_025 * point_est_model5_var1$ci_975 < 0,nonsig_col,sig_col), size=ps, stroke=1) +
  annotate(geom="text", x=2.7,    y=point_est_model5_var1$estim, label="4",   col="white", size=s, hjust = 0.5, alpha = 1) +
  

  
  #explain



  # annotate(geom="text", x=3.5,    y=annotate_y, label="Main effect",   col="grey50", size=2.9, hjust = 1, alpha = 1) +
  # geom_segment(aes(y=annotate_y,    x=3.5, yend = point_est_model1_var1$ci_025-0.01, xend = 3.5),size=0.3, col = "grey50", alpha=0.66, linetype=3) +  
  #   
  # annotate(geom="text", x=1.3,    y=annotate_y, label="Mixing",   col="grey50", size=2.9, hjust = 1, alpha = 1) +
  # geom_segment(aes(y=annotate_y,    x=1.3, yend = point_est_model2_var3$ci_025-0.01, xend = 1.3),size=0.3, col = "grey50", alpha=0.66, linetype=3) +
  # 
  # annotate(geom="text", x=1.1,    y=annotate_y, label="Bonding",   col="grey50", size=2.9, hjust = 1, alpha = 1) +
  # geom_segment(aes(y=annotate_y,    x=1.1, yend = point_est_model3_var3$ci_025-0.01, xend = 1.1),size=0.3, col = "grey50", alpha=0.66, linetype=3) +
  # 
  # annotate(geom="text", x=0.9,    y=annotate_y, label="Incorporating",   col="grey50", size=2.9, hjust = 1, alpha = 1) +
  # geom_segment(aes(y=annotate_y,    x=0.9, yend = point_est_model4_var3$ci_025-0.01, xend = 0.9),size=0.3, col = "grey50", alpha=0.66, linetype=3) +
  # 
  # annotate(geom="text", x=0.7,    y=annotate_y, label="Combined",   col="grey50", size=2.9, hjust = 1, alpha = 1) +
  # geom_segment(aes(y=annotate_y,    x=0.7, yend = point_est_model5_var3$ci_025-0.01, xend = 0.7),size=0.3, col = "grey50", alpha=0.66, linetype=3) +

  
  
  geom_vline(xintercept = 1.5, linetype="solid", alpha=0.7, color="black", size=0.2) +
  geom_vline(xintercept = 2.5, linetype="solid", alpha=0.7, color="black", size=0.2) +
  #geom_vline(xintercept = 3.425, linetype="solid", alpha=0.7, color="black", size=0.2) +
  #geom_vline(xintercept = 4.425, linetype="solid", alpha=0.7, color="black", size=0.2) +
  
  scale_x_continuous(breaks=(1:3), expand = c(0.05,0.05)
                     #, labels=c("Gender\ndiversity \u00D7\nInclusion", "Inclusion", "Gender\ndiversity")
                     , labels=c("","","")
                     ) +
  #scale_y_continuous(breaks=c(-0.2, -0.1, 0, 0.1, 0.2, 0.3)) +
  #coord_cartesian(ylim = c(-0.2, 0.2)) +
  
  labs(y="Distinctiveness") +
  ggtitle("d: Firm level") + 
  scale_y_continuous(breaks=seq(-0.4, 0.2, 0.1), labels = dropLeadingZero)+
  coord_flip(ylim = c(-0.4, 0.2)) +
  theme(aspect.ratio=asp, 
            title =element_text(size=11),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(), 
            panel.background = element_blank(), 
            panel.border = element_rect(colour = "black", 
                                        fill=NA, 
                                        size=0.2),
            #legend.position = c(0.2, 0.3),
            plot.title = element_text(size = tit_s, face = "bold", colour = "black"),
            axis.ticks.y = element_blank(),
            axis.title.y = element_blank(),
            axis.text.y = element_text(size = 11, colour = "black"),
            plot.margin = unit(c(m_top,m_right,m_bottom,m_left), "mm")
            )
  

#grid.newpage()
ols_estim_firmlevel
```

```{r, fig.width = 8.5, fig.height = 2.6}
#ols_estim_combined <- grid.arrange(ols_estim_gamelevel, ols_estim_gamelevel_re, ols_estim_gamelevel_fe, ols_estim_firmlevel,nrow = 1)

ols_estim_combined <- cowplot::plot_grid(ols_estim_gamelevel_notitle+ggtitle("a: Game level"), ols_estim_gamelevel_re, ols_estim_gamelevel_fe, ols_estim_firmlevel, align="h",rel_widths=c(1.4,1,1,1),  rel_heights = 1, scale=1, nrow=1)
ols_estim_combined
```

```{r}
ggsave("ols_estim_combined.pdf", ols_estim_combined, width = 8.5, height = 2.6)
```




###Figure for creativity prediction

Combined figure for predicting distinctiveness
```{r, fig.width = 7.5, fig.height = 2.5}
m_top=5
m_right=0
m_bottom=5
m_left=0

dropLeadingZero3 <- function(l){
  l <- sprintf(l, fmt = '%#.3f')
  str_replace(l, '0.', '.')
}

dropLeadingZero2 <- function(l){
  l <- sprintf(l, fmt = '%#.2f')
  str_replace(l, '0.', '.')
}

dropLeadingZero1 <- function(l){
  l <- sprintf(l, fmt = '%#.1f')
  str_replace(l, '0.', '.')
}

dist_combined <- cowplot::plot_grid(
                                    div_inclusions_dist
                                     +ggtitle("a")
                                     +scale_x_continuous(expand = c(0,0), labels = dropLeadingZero1)
                                     +scale_y_continuous(labels = dropLeadingZero3)
                                     +theme(plot.title =element_text(size=11, face='bold'),
                                            plot.margin = unit(c(m_top,m_right-2,m_bottom,m_left), "mm"),
                                            axis.text = element_text(size = 9, colour = "black")
                                            ),
                                    ols_estim_gamelevel_notitle
                                     +ggtitle("b")
                                     +scale_x_continuous(breaks=(1:3), expand = c(0.05,0.05), labels=c("Diversity \u00D7\nInclusion", "Inclusion", "Diversity"))
                                     +theme(
                                            plot.title =element_text(size=11),
                                            plot.margin = unit(c(m_top,m_right,m_bottom,m_left-3), "mm"),
                                            axis.title.x = element_text(size = 11, colour = "black"),
                                            title =element_text(size=11),
                                            axis.text = element_text(size = 9, colour = "black")
                                            ),
                                    mixing_margins_blue
                                     +scale_x_continuous(
                                          labels = dropLeadingZero1,
                                          expand = c(0.001,0.001), 
                                          name="Diversity")
                                     +scale_y_continuous(
                                          breaks = seq(.73,.85, by=.02), 
                                          labels = dropLeadingZero2,
                                          expand = c(0,0), 
                                          name="Predicted distinctiveness")
                                     + coord_cartesian(clip = "off")
                                     +ggtitle("c")
                                     +theme(plot.title =element_text(size=11, face='bold'),
                                            plot.margin = unit(c(m_top,m_right+5,m_bottom,m_left), "mm"),
                                            axis.text = element_text(size = 9, colour = "black")
                                            ), 
                                    align="h",
                                    rel_widths=c(1,1.1,1),  
                                    rel_heights = 1, 
                                    scale=1, nrow=1)

```

```{r, fig.width = 8.5, fig.height = 3}
dist_combined
```
```{r}
ggsave("dist_combined.pdf", dist_combined, width = 8.5, height = 3)
```


###Figure for success prediction

Diversity and probability of review
```{r, fig.width = 3, fig.height = 3}

#-------------scale_x_continuous(expand = c(0,0), labels = dropLeadingZero)-----------------------------
scaleFUN <- function(x) sprintf("%.1f", x)

dropLeadingZero <- function(l){
  str_replace(scaleFUN(l), '0.', '.')
}
#-------------------------------------------------------------------------------------------------------

lo_color = hi_color_1
hi_color = hi_color_9

lo_label_color = "#69629a"
hi_label_color = "#4f4973"

div_prev <- ggplot() +
  
stat_smooth(data=moby, aes(x=prop_women2, y=review), method = "loess", formula = y ~ x, span=1, se = T,size=0.5, alpha=0.4, na.rm=TRUE, color=hi_color, fill=hi_color) +  

  
    scale_x_continuous(expand = c(0,0), labels = dropLeadingZero) +
    coord_cartesian(xlim=c(0.02, .4), ylim=c(0.27, .77)) +
    scale_y_continuous(expand = c(0,0), labels = dropLeadingZero) +
  
    labs(y="P(Review)") +
    labs(x="Female proportion") +
  
  theme(aspect.ratio=1, 
        legend.position = "none",
        panel.grid.major = element_line(size=0.2), 
        #panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", 
                                    fill=NA, 
                                    size=0.2),
        #legend.position = c(0.2, 0.3),
        plot.title = element_text(size = 11, face = "bold", colour = "black"),
        #axis.ticks = element_line(colour = "black", size = 0.1),
        axis.title.y = element_text(size = 11, colour = "black"),
        axis.text.x = element_text(size = 9, colour = "black"),
        axis.text.y = element_text(size = 9, colour = "black"),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank()
  )



div_prev
```







```{r}
m_top=3
m_right=0
m_bottom=3
m_left=0

success_3_combined_row <- cowplot::plot_grid(
                                    corr_arcs_sm 
                                     +ggtitle("a")
                                     +theme(asp=.78,
                                            plot.title =element_text(size=11, face='bold'),
                                            plot.margin = unit(c(m_top-2,m_right,m_bottom,m_left), "mm"),
                                            axis.text = element_blank(),
                                            panel.border = element_blank()
                                            ),
                                    
                                     div_prev
                                     +ggtitle("b")
                                     #+scale_x_continuous(breaks=(1:3), expand = c(0.05,0.05), labels=c("Diversity \u00D7\nInclusion", "Inclusion", "Diversity"))
                                     +theme(
                                            plot.title =element_text(size=11),
                                            plot.margin = unit(c(m_top,m_right,m_bottom,m_left), "mm"),
                                            axis.title.x = element_text(size = 11, colour = "black"),
                                            title =element_text(size=11),
                                            axis.text = element_text(size = 9, colour = "black")
                                            ),
                                    
                                    review_score_point
                                     +ggtitle("c")
                                     #+scale_x_continuous(breaks=(1:3), expand = c(0.05,0.05), labels=c("Diversity \u00D7\nInclusion", "Inclusion", "Diversity"))
                                     +theme(
                                            plot.title =element_text(size=11),
                                            plot.margin = unit(c(m_top,m_right,m_bottom,m_left), "mm"),
                                            axis.title.x = element_text(size = 11, colour = "black"),
                                            title =element_text(size=11),
                                            axis.text = element_text(size = 9, colour = "black")
                                            ),
                                     
                                    
                                    #align="h",
                                    #axis = "b",
                                    rel_widths  = c(1,1,1),  
                                    rel_heights = c(1,1,1),
                                    axis="tb",
                                    nrow=1)
```

```{r, fig.width = 7.5, fig.height = 2.5}
success_3_combined_row
```


```{r}
ggsave("success_3_combined_row.pdf", success_3_combined_row, width = 7.5, height = 2.5)
```



```{r, fig.width = 3.5, fig.height = 2.5}

c_mat <- cor_results$r
p_mat <- cor_results$P

diag(c_mat) <- 0
c_mat[c_mat>.33] <- .33

c_mat[upper.tri(c_mat)]<- 0

c_mat <- c_mat[, nrow(c_mat):1]
#c_mat <- c_mat[1:3, 1:3]
c_mat <- c_mat[6:1,6:1]


melted_cormat <- melt(c_mat)

corr_plot <- ggplot(melted_cormat, aes(Var2, Var1, fill = value))+
 geom_tile(color = "white")+
scale_fill_gradient2(labels = dropLeadingZero, breaks=c(-.25, 0, .25), low = "red", high = "darkblue", mid = "white", 
   midpoint = 0, limit = c(-.25,.33), space = "Lab", 
    name="r") +

  
  theme_minimal()+ # minimal theme
  
   coord_fixed() +
  xlab("")+
  ylab("") +
  
 theme(
       asp=1,
       axis.text.x = element_text(angle = 45, vjust = 1, size = 9, hjust = 1),
       axis.text.y = element_text(size = 9, hjust = 1),
       axis.ticks = element_blank(),
       panel.grid.major = element_blank(),
       legend.key.height = unit(.2, 'cm'),
       legend.key.width = unit(.30, 'cm'),
       legend.position = c(0.8, .68)
       )

corr_plot

```


```{r}
m_top=0
m_right=0
m_bottom=0
m_left=0

success_3_combined_row2 <- cowplot::plot_grid(
                                     corr_plot
                                     +ggtitle("a")
                                     +theme(
                                            plot.title =element_text(size=11, face='bold'),
                                            plot.margin = unit(c(m_top,m_right,m_bottom,m_left), "mm"),
                                            #axis.text = element_blank()#,
                                            panel.border = element_blank()
                                            ),
                                    
                                     div_prev
                                     +ggtitle("b")
                                     #+scale_x_continuous(breaks=(1:3), expand = c(0.05,0.05), labels=c("Diversity \u00D7\nInclusion", "Inclusion", "Diversity"))
                                     +theme(
                                            plot.title =element_text(size=11),
                                            plot.margin = unit(c(m_top,m_right,m_bottom,m_left), "mm"),
                                            axis.title.x = element_text(size = 11, colour = "black"),
                                            title =element_text(size=11),
                                            axis.text = element_text(size = 9, colour = "black")
                                            ),
                                    
                                    review_score_point
                                     +ggtitle("c")
                                     #+scale_x_continuous(breaks=(1:3), expand = c(0.05,0.05), labels=c("Diversity \u00D7\nInclusion", "Inclusion", "Diversity"))
                                     +theme(
                                            plot.title =element_text(size=11),
                                            plot.margin = unit(c(m_top,m_right,m_bottom,m_left), "mm"),
                                            axis.title.x = element_text(size = 11, colour = "black"),
                                            title =element_text(size=11),
                                            axis.text = element_text(size = 9, colour = "black")
                                            ),
                                     
                                    
                                    #align="h",
                                    #axis = "b",
                                    rel_widths  = c(1,1,1),  
                                    rel_heights = c(1,1,1), 
                                    nrow=1)
```

```{r, fig.width = 8, fig.height = 2.5}
success_3_combined_row2
```


```{r}
ggsave("success_3_combined_row2.pdf", success_3_combined_row2, width = 8, height = 2.5)
```
